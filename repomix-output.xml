This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

<additional_info>

</additional_info>

</file_summary>

<directory_structure>
.github/
  workflows/
    all-deploy.yml
    all-test.yml
    deploy-docker.yml
  workflow-template-deploy.yml
  workflow-template-docker.yml
  workflow-template-test.yml
.runeya/
  dbs/
    envs/
      Local.encrypted.json
    services/
      Documentation.encrypted.json
      Front.encrypted.json
      Server.encrypted.json
    .gitignore
    leafs-leafs.encrypted.json
common/
  check-monorepo/
    src/
      index.js
      index.spec.js
      searchForWorkspaces.js
    .npmrc
    CHANGELOG.md
    jest.config.js
    package.json
    README.md
  express/
    src/
      index.js
    .npmrc
    CHANGELOG.md
    package.json
  express-404/
    src/
      index.js
      index.spec.js
    .npmrc
    CHANGELOG.md
    jest.config.js
    package.json
  express-error-handler/
    src/
      errorCodes.js
      index.js
      index.spec.js
    .npmrc
    CHANGELOG.md
    jest.config.js
    package.json
  express-health-check/
    src/
      index.js
      index.spec.js
    .npmrc
    CHANGELOG.md
    jest.config.js
    package.json
  express-http-error/
    src/
      HTTPError.js
      index.js
    .npmrc
    CHANGELOG.md
    package.json
  retrigger-all-build/
    src/
      commit-a-space-here.txt
    .npmrc
    CHANGELOG.md
    package.json
  socket-front/
    src/
      CustomObservable.js
      index.js
      Socket.js
    .npmrc
    CHANGELOG.md
    package.json
  socket-server/
    src/
      CustomObservable.js
      index.js
      sockets.js
    .npmrc
    CHANGELOG.md
    package.json
  typings/
    src/
      index.ts
    .npmrc
    CHANGELOG.md
    package.json
    tsconfig.json
  workflows/
    src/
      index.js
      walker.js
      walkerFork.js
    .npmrc
    CHANGELOG.md
    package.json
  README.md
fronts/
  app/
    src/
      assets/
        fonts/
          Jost/
            Jost.css
        theme/
          _a.scss
          _button.scss
          _font.scss
          _input.scss
          _mixin.scss
          _reset.scss
          _scrollbar.scss
          _var.scss
          index.scss
        androidstudio.svg
        cursor.svg
        intellij.svg
        nodered.svg
        sublimetext.svg
        vscode-icon.svg
      components/
        BackgroundStackChooser.vue
        Card.vue
        CurrentEditor.vue
        DoughtnutChart.vue
        Editor-monokai.json
        Editor.vue
        EnvironmentsChooser.vue
        Explorer.vue
        LeftLogo.vue
        Markdown.vue
        Modal.vue
        Multiselect.vue
        NotifHistory.vue
        Notification.vue
        NotificationBell.vue
        Notifications.vue
        Popover.vue
        Progress.vue
        Section.vue
        SectionsContainer.vue
        sidebar.vue
        sidebarGroup.vue
        sidebarItem.vue
        SidebarViewMode.vue
        SidebarViewModeItem.vue
        Spinner.vue
        StackChooser.vue
        TableGeneric.vue
        TableGenericToolBar.vue
        Tabs.vue
      helpers/
        themes/
          base.js
          baseDark.js
          darkBlue.js
          darkOrange.js
          darkPurple.js
          lightBlue.js
          lightOrange.js
          lightPurple.js
          theme.d.ts
        axios.js
        config.js
        CustomObservable.js
        githubIssue.js
        notification.js
        ServiceError.js
        Socket.js
        Theme.js
      models/
        currentEditor.js
        fs.js
        git.js
        Parsers.js
        service.js
        stack.js
        system.js
      router/
        router.js
      typings/
        global.d.ts
      views/
        settings/
          Environments/
            Variables.vue
          Crypto.vue
          Environments.vue
          General.vue
          Notifications.vue
          Parsers.vue
        ImportCreate.vue
        Init.vue
        Overview.vue
        Settings.vue
        StackChooser.vue
        StackMultiple.vue
        StackSingle.vue
      App.vue
      main.js
    .gitignore
    .npmrc
    babel.config.js
    CHANGELOG.md
    index.html
    LICENSE
    package.json
    README.md
    vite.config.mjs
  docs/
    .vitepress/
      theme/
        custom.css
        index.js
      config.mjs
    guide/
      create-new-service.md
      first-launch.md
    integration/
      vscode.md
    introduction/
      getting-started.md
      what-is.md
    reference/
      commands.md
      envs.md
      git.md
      global-environment-variables.md
      health-check.md
      metadata.md
      openapi.md
      parsers.md
      security.md
    .gitignore
    .npmrc
    CHANGELOG.md
    index.md
    package.json
modules/
  bugs/
    backend/
      .npmrc
      CHANGELOG.md
      checkJsFork.js
      defaultJsConfig.json
      index.js
      package.json
      routes.js
    front/
      src/
        Bugs.vue
      .npmrc
      CHANGELOG.md
      package.json
  configuration/
    backend/
      .npmrc
      CHANGELOG.md
      index.js
      package.json
      routes.js
    front/
      src/
        Configs.vue
        ModalEditEnvs.vue
      .npmrc
      CHANGELOG.md
      package.json
  dev-ops/
    backend/
      .npmrc
      CHANGELOG.md
      index.js
      package.json
    front/
      src/
        Index.vue
      .npmrc
      CHANGELOG.md
      package.json
  diff/
    backend/
      .npmrc
      CHANGELOG.md
      index.js
      package.json
      routes.js
    front/
      src/
        Index.vue
      .npmrc
      CHANGELOG.md
      package.json
  docker/
    backend/
      .npmrc
      CHANGELOG.md
      index.js
      package.json
      routes.js
    front/
      src/
        Index.vue
      .npmrc
      CHANGELOG.md
      package.json
  documentation/
    backend/
      .npmrc
      CHANGELOG.md
      Documentation.js
      index.js
      Leaf.js
      package.json
      routes.js
    front/
      src/
        Index.vue
        Leaf.vue
        Tree.vue
      .npmrc
      CHANGELOG.md
      package.json
  finder/
    backend/
      .npmrc
      CHANGELOG.md
      index.js
      package.json
      routes.js
    front/
      src/
        Index.vue
      .npmrc
      CHANGELOG.md
      package.json
  git/
    backend/
      .npmrc
      CHANGELOG.md
      Git.js
      index.js
      package.json
      routes.js
    front/
      src/
        Git.vue
        NotUpToDate.vue
      .npmrc
      CHANGELOG.md
      package.json
  github/
    backend/
      .npmrc
      CHANGELOG.md
      index.js
      package.json
      routes.js
    front/
      src/
        Index.vue
      .npmrc
      CHANGELOG.md
      package.json
  global-scripts/
    backend/
      .npmrc
      CHANGELOG.md
      GlobalScripts.js
      index.js
      package.json
      routes.js
    front/
      src/
        Index.vue
      .npmrc
      CHANGELOG.md
      package.json
  help/
    backend/
      .npmrc
      CHANGELOG.md
      index.js
      package.json
    front/
      src/
        Index.vue
      .npmrc
      CHANGELOG.md
      package.json
  json-formatter/
    backend/
      .npmrc
      CHANGELOG.md
      index.js
      package.json
    front/
      src/
        Index.vue
      .npmrc
      CHANGELOG.md
      package.json
  jwt/
    backend/
      .npmrc
      CHANGELOG.md
      index.js
      package.json
      routes.js
    front/
      src/
        Index.vue
      .npmrc
      CHANGELOG.md
      package.json
  kanban/
    backend/
      .npmrc
      CHANGELOG.md
      index.js
      Kanban.js
      package.json
      routes.js
      save.js
    front/
      src/
        Column.vue
        Index.vue
      .npmrc
      CHANGELOG.md
      package.json
  logs/
    backend/
      .npmrc
      CHANGELOG.md
      index.js
      package.json
      routes.js
    front/
      src/
        Logs.vue
        PassThrough.vue
      .npmrc
      CHANGELOG.md
      package.json
  mongo/
    backend/
      .npmrc
      CHANGELOG.md
      index.js
      package.json
      routes.js
    front/
      src/
        Index.vue
      .npmrc
      CHANGELOG.md
      package.json
  node-repl/
    backend/
      .gitignore
      .npmrc
      CHANGELOG.md
      index.js
      package.json
      routes.js
    front/
      src/
        Index.vue
      .npmrc
      CHANGELOG.md
      package.json
  npm/
    backend/
      .npmrc
      CHANGELOG.md
      index.js
      Npm.js
      package.json
      routes.js
    front/
      src/
        Npm.vue
      .npmrc
      CHANGELOG.md
      package.json
  openai/
    backend/
      .gitignore
      .npmrc
      CHANGELOG.md
      index.js
      package.json
      routes.js
    front/
      src/
        Chat.vue
        OpenAi.vue
      .gitignore
      .npmrc
      CHANGELOG.md
      package.json
  openapi/
    backend/
      .npmrc
      CHANGELOG.md
      index.js
      package.json
      routes.js
    front/
      src/
        Index.vue
      .npmrc
      CHANGELOG.md
      package.json
  plugins-loader/
    backend/
      .npmrc
      CHANGELOG.md
      package.json
      plugins.js
    front/
      src/
        DynamicComponent.vue
        views.js
      .npmrc
      CHANGELOG.md
      package.json
  regex/
    backend/
      .npmrc
      CHANGELOG.md
      index.js
      package.json
    front/
      src/
        Index.vue
      .npmrc
      CHANGELOG.md
      package.json
  toolbox/
    backend/
      .npmrc
      CHANGELOG.md
      index.js
      package.json
    front/
      src/
        Toolbox.vue
      .npmrc
      CHANGELOG.md
      package.json
  uuid/
    backend/
      .npmrc
      CHANGELOG.md
      index.js
      package.json
      routes.js
      UUID.js
    front/
      src/
        UUID.vue
      .npmrc
      CHANGELOG.md
      package.json
  vscode/
    backend/
      .gitignore
      .npmrc
      CHANGELOG.md
      index.js
      package.json
      routes.js
    extension/
      src/
        commands/
          commands.js
        helpers/
          decorationManager.js
          exec.js
          initialize.js
        networks/
          axios.js
          Socket.js
        providers/
          CodeLensProvider.js
          ServicesProvider.js
          TreeProvider.js
        schedule/
          heartbeat.js
        views/
          views.js
        extension.js
      test/
        extension.test.js
      .gitignore
      .npmrc
      .vscode-test.mjs
      .vscodeignore
      .yarnrc
      build.js
      CHANGELOG.md
      jsconfig.json
      package.json
      README.md
      vsc-extension-quickstart.md
    front/
      src/
        Index.vue
      .npmrc
      CHANGELOG.md
      package.json
  workflows/
    backend/
      nodes/
        helpers/
          socket.js
        manual-launcher/
          index.html
          index.js
        popup/
          index.html
          index.js
        run-command/
          index.html
          index.js
        service-action/
          index.html
          index.js
        service-selector/
          index.html
          index.js
        services-events-launcher/
          index.html
          index.js
        package.json
      .npmrc
      CHANGELOG.md
      index.js
      package.json
      routes.js
      Workflows.js
    front/
      src/
        helpers/
          socket.js
        modals/
          Modals.vue
          Popup.vue
          Selector.vue
        Index.vue
      .npmrc
      CHANGELOG.md
      package.json
servers/
  server/
    bin/
      server.js
      www
    helpers/
      ansiconvert.js
      args.js
      console.table.js
      cpu.js
      cpuFork.js
      crypto.js
      dbs.js
      exec.js
      exportedHelpers.js
      isWindows.js
      plugins.js
      readline.js
      reencrypt-nodered.js
      specialCaracters.helper.js
      stringTransformer.helper.js
      version.js
    models/
      .gitignore
      editors.js
      EncryptionKey.js
      Environment.js
      myConfs.js
      Parser.js
      ports.js
      saves.js
      Service.js
      Service.spec.js
      stack.js
    parser/
      debug.js
      json.js
      link.js
    routes/
      crypto.js
      editors.js
      fs.js
      index.js
      parsers.js
      plugins.js
      stack.js
      system.js
    .gitignore
    .npmrc
    app.js
    CHANGELOG.md
    jest.config.js
    nodemon.json
    package.json
    tsconfig.json
    tsup.config.ts
.eslintignore
.eslintrc.js
.gitignore
.yarnrc.yml
CHANGELOG.md
knip.js
lerna.json
package.json
runScriptWithEnv.js
tsconfig.json
turbo.json
watch.js
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".github/workflows/all-test.yml">
# Autogenerated by @runeya/common-workflows package
# If you must edit this file, edit files in .github/workflow-*.yml
# Then launch "yarn ci:generate"

name: Tests
on:
  pull_request:
    branches: 
      - '!master'
      - '!develop'
      - '*'
      - '!deploy-docker'

jobs:
  checks:
    runs-on: ubuntu-latest
    env:
      TURBO_TOKEN: ${{ secrets.TURBO_TOKEN }}
      TURBO_TEAM: ${{ vars.TURBO_TEAM }}

    steps:
    - name: "Checkout"
      uses: actions/checkout@v3
      with:
        fetch-depth: 0

    - name: Setup Node.js environment
      uses: actions/setup-node@v3
      with:
        node-version: 18
        registry-url: 'https://npm.pkg.github.com/'
        cache: 'yarn'

    - name: Ensure access
      run: npm whoami --registry https://npm.pkg.github.com/
      env:
        NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}

    - name: Config git user
      run: |
        git config --global user.name "${{ github.actor }}"
        git config --global user.email "${{ github.actor }}@users.noreply.github.com"

    - name: Install dependencies.
      run: yarn install --immutable

    - name: Lint
      run: yarn run lint

    - name: Tests
      run: yarn run test

    - name: Build
      run: yarn run build
</file>

<file path=".github/workflows/deploy-docker.yml">
# Autogenerated by @runeya/common-workflows package
# If you must edit this file, edit files in .github/workflow-*.yml
# Then launch "yarn ci:generate"

name: Publish docker
on:
  push:
    branches: 
      - 'deploy-docker'

jobs:
  checks:
    runs-on: ubuntu-latest
    env:
      TURBO_TOKEN: ${{ secrets.TURBO_TOKEN }}
      TURBO_TEAM: ${{ vars.TURBO_TEAM }}

    steps:


      - name: Checkout
        uses: actions/checkout@v3

      - name: Config git user
        run: |
          git config --global user.name "${{ github.actor }}"
          git config --global user.email "${{ github.actor }}@users.noreply.github.com"
  
      - name: Set up QEMU
        uses: docker/setup-qemu-action@v3

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: Login to Docker Hub
        uses: docker/login-action@v3
        with:
          registry: ghcr.io
          username: ${{ vars.DOCKER_HUB_USER }}
          password: ${{ secrets.NPM_TOKEN }}

      - name: Build and push base node 18 image
        uses: docker/build-push-action@v5
        with:
          tags: ghcr.io/runeya/monorepo/infra-docker-base-node-18:latest
          platforms: linux/amd64,linux/arm64,linux/arm/v7
          context: ./docker
          file: ./docker/Dockerfile.base-node-18
          push: true
          build-args: |
            NPM_TOKEN=${{secrets.NPM_TOKEN}}
          cache-from: type=gha
          cache-to: type=gha,mode=max

      - name: Build and push build image
        uses: docker/build-push-action@v5
        with:
          tags: ghcr.io/runeya/monorepo/infra-docker-build-node:latest
          platforms: linux/amd64,linux/arm64,linux/arm/v7
          context: ./docker
          file: ./docker/Dockerfile.build
          push: true
          build-args: |
            NPM_TOKEN=${{secrets.NPM_TOKEN}}
          cache-from: type=gha
          cache-to: type=gha,mode=max

      - name: Build and push chromium image
        uses: docker/build-push-action@v5
        with:
          tags: ghcr.io/runeya/monorepo/infra-docker-chromium-node:latest
          platforms: linux/amd64,linux/arm64,linux/arm/v7
          context: ./docker
          file: ./docker/Dockerfile.chromium
          push: true
          build-args: |
            NPM_TOKEN=${{secrets.NPM_TOKEN}}
          cache-from: type=gha
          cache-to: type=gha,mode=max

      - name: Build and push Rollout image
        uses: docker/build-push-action@v5
        with:
          tags: ghcr.io/runeya/monorepo/infra-docker-rollout-node-18:latest
          platforms: linux/amd64,linux/arm64,linux/arm/v7
          context: ./docker
          file: ./docker/Dockerfile.rollout-node-18
          push: true
          build-args: |
            NPM_TOKEN=${{secrets.NPM_TOKEN}}
          cache-from: type=gha
          cache-to: type=gha,mode=max
</file>

<file path=".github/workflow-template-docker.yml">
{{NAME_ROUTE_SANITIZED}}-docker:
    needs: [publish]
    runs-on: ubuntu-latest
    if: contains(needs.publish.outputs.changed, '{{NAME_ROUTE}}')
    env:
      TURBO_TOKEN: ${{ secrets.TURBO_TOKEN }}
      TURBO_TEAM: ${{ vars.TURBO_TEAM }}
    steps:
      - name: "Checkout"
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Setup Node.js environment
        uses: actions/setup-node@v3
        with:
          node-version: 18
          registry-url: 'https://npm.pkg.github.com/'
          cache: 'yarn'

      - name: Set up QEMU
        uses: docker/setup-qemu-action@v3

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: Login to Docker Hub
        uses: docker/login-action@v3
        with:
          registry: ghcr.io
          username: ${{ vars.DOCKER_HUB_USER }}
          password: ${{ secrets.NPM_TOKEN }}

      - id: package-json
        name: Read package.json
        run: |
          echo packageJSON=$(cat {{LOCATION}}/package.json) >> $GITHUB_OUTPUT

      - name: Publish ${{needs.publish.outputs.versionType}} - ${{ github.ref_name }} 
        if: contains(github.ref_name, 'develop') || contains(github.ref_name, 'staging')
        uses: docker/build-push-action@v5
        with:
          context: .
          file: {{LOCATION}}/Dockerfile
          tags: | 
            ghcr.io/runeya/monorepo/{{NAME_ROUTE}}:${{ github.ref_name }} 
          push: true
          build-args: |
            NPM_TOKEN=${{secrets.NPM_TOKEN}}
            TURBO_TEAM=${{ vars.TURBO_TEAM }}
            TURBO_TOKEN=${{ secrets.TURBO_TOKEN }}
          cache-from: type=gha
          cache-to: type=gha,mode=max

      - name: Publish Latest ${{needs.publish.outputs.versionType}} - ${{ github.ref_name }} 
        if: contains(github.ref_name, 'master')
        uses: docker/build-push-action@v5
        with:
          context: .
          file: {{LOCATION}}/Dockerfile
          tags: | 
            ghcr.io/runeya/monorepo/{{NAME_ROUTE}}:latest
            ghcr.io/runeya/monorepo/{{NAME_ROUTE}}:${{fromJson(steps.package-json.outputs.packageJson).version}}
          push: true
          build-args: |
            NPM_TOKEN=${{secrets.NPM_TOKEN}}
            TURBO_TEAM=${{ vars.TURBO_TEAM }}
            TURBO_TOKEN=${{ secrets.TURBO_TOKEN }}
          cache-from: type=gha
          cache-to: type=gha,mode=max
</file>

<file path=".github/workflow-template-test.yml">
name: Tests
on:
  pull_request:
    branches: 
      - '!master'
      - '!develop'
      - '*'
      - '!deploy-docker'

jobs:
  checks:
    runs-on: ubuntu-latest
    env:
      TURBO_TOKEN: ${{ secrets.TURBO_TOKEN }}
      TURBO_TEAM: ${{ vars.TURBO_TEAM }}

    steps:
    - name: "Checkout"
      uses: actions/checkout@v3
      with:
        fetch-depth: 0

    - name: Setup Node.js environment
      uses: actions/setup-node@v3
      with:
        node-version: 18
        registry-url: 'https://npm.pkg.github.com/'
        cache: 'yarn'

    - name: Ensure access
      run: npm whoami --registry https://npm.pkg.github.com/
      env:
        NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}

    - name: Config git user
      run: |
        git config --global user.name "${{ github.actor }}"
        git config --global user.email "${{ github.actor }}@users.noreply.github.com"

    - name: Install dependencies.
      run: yarn install --immutable

    - name: Lint
      run: yarn run lint

    - name: Tests
      run: yarn run test

    - name: Build
      run: yarn run build
</file>

<file path="common/check-monorepo/src/index.js">
require('./index.spec');
</file>

<file path="common/check-monorepo/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="common/check-monorepo/README.md">
# Check monorepo

This library is used to guarantee the concsistency of this monorepo and to reduce infrastructure error
</file>

<file path="common/express/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="common/express-404/src/index.js">
module.exports = (req, res) => {
  res.status(404).send(`${req.method} ${req.url} not found`);
};
</file>

<file path="common/express-404/src/index.spec.js">
const middleware404 = require('./index');

const mockRes = {
  status: jest.fn(() => mockRes),
  send: jest.fn(() => mockRes),
};

describe('Middleware: 404', () => {
  it('should set 404 status', async () => {
    middleware404({}, mockRes);
    expect(mockRes.status).toHaveBeenCalledWith(404);
  });
});
</file>

<file path="common/express-404/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="common/express-404/jest.config.js">
const path = require('path');

module.exports = {
  ...require('@runeya/common-jest/src/jest.config.default'),
  rootDir: path.resolve(__dirname),
};
</file>

<file path="common/express-error-handler/src/errorCodes.js">
module.exports = [
  { code: 100, label: 'Continue' },
  { code: 101, label: 'Switching Protocols' },
  { code: 102, label: 'Processing (WebDAV; RFC 2518)' },
  { code: 103, label: 'Early Hints (RFC 8297)' },
  { code: 200, label: 'OK' },
  { code: 201, label: 'Created' },
  { code: 202, label: 'Accepted' },
  { code: 203, label: 'Non-Authoritative Information (since HTTP/1.1)' },
  { code: 204, label: 'No Content' },
  { code: 205, label: 'Reset Content' },
  { code: 206, label: 'Partial Content' },
  { code: 207, label: 'Multi-Status (WebDAV; RFC 4918)' },
  { code: 208, label: 'Already Reported (WebDAV; RFC 5842)' },
  { code: 226, label: 'IM Used (RFC 3229)' },
  { code: 300, label: 'Multiple Choices' },
  { code: 301, label: 'Moved Permanently' },
  { code: 302, label: 'Found (Previously "Moved temporarily")' },
  { code: 303, label: 'See Other (since HTTP/1.1)' },
  { code: 304, label: 'Not Modified' },
  { code: 305, label: 'Use Proxy (since HTTP/1.1)' },
  { code: 306, label: 'Switch Proxy' },
  { code: 307, label: 'Temporary Redirect (since HTTP/1.1)' },
  { code: 308, label: 'Permanent Redirect' },
  { code: 400, label: 'Bad Request' },
  { code: 401, label: 'Unauthorized' },
  { code: 402, label: 'Payment Required' },
  { code: 403, label: 'Forbidden' },
  { code: 404, label: 'Not Found' },
  { code: 405, label: 'Method Not Allowed' },
  { code: 406, label: 'Not Acceptable' },
  { code: 407, label: 'Proxy Authentication Required' },
  { code: 408, label: 'Request Timeout' },
  { code: 409, label: 'Conflict' },
  { code: 410, label: 'Gone' },
  { code: 411, label: 'Length Required' },
  { code: 412, label: 'Precondition Failed' },
  { code: 413, label: 'Payload Too Large' },
  { code: 414, label: 'URI Too Long' },
  { code: 415, label: 'Unsupported Media Type' },
  { code: 416, label: 'Range Not Satisfiable' },
  { code: 417, label: 'Expectation Failed' },
  { code: 418, label: 'I\'m a teapot (RFC 2324, RFC 7168)' },
  { code: 421, label: 'Misdirected Request' },
  { code: 422, label: 'Unprocessable Entity' },
  { code: 423, label: 'Locked (WebDAV; RFC 4918)' },
  { code: 424, label: 'Failed Dependency (WebDAV; RFC 4918)' },
  { code: 425, label: 'Too Early (RFC 8470)' },
  { code: 426, label: 'Upgrade Required' },
  { code: 428, label: 'Precondition Required (RFC 6585)' },
  { code: 429, label: 'Too Many Requests (RFC 6585)' },
  { code: 431, label: 'Request Header Fields Too Large (RFC 6585)' },
  { code: 451, label: 'Unavailable For Legal Reasons (RFC 7725)' },
  { code: 500, label: 'Internal Server Error' },
  { code: 501, label: 'Not Implemented' },
  { code: 502, label: 'Bad Gateway' },
  { code: 503, label: 'Service Unavailable' },
  { code: 504, label: 'Gateway Timeout' },
  { code: 505, label: 'HTTP Version Not Supported' },
  { code: 506, label: 'Variant Also Negotiates (RFC 2295)' },
  { code: 507, label: 'Insufficient Storage (WebDAV; RFC 4918)' },
  { code: 508, label: 'Loop Detected (WebDAV; RFC 5842)' },
  { code: 510, label: 'Not Extended (RFC 2774)' },
  { code: 511, label: 'Network Authentication Required (RFC 6585)' },
  { code: 419, label: 'Page Expired (Laravel Framework)' },
  { code: 420, label: 'Method Failure (Spring Framework)' },
  { code: 420, label: 'Enhance Your Calm (Twitter)' },
  { code: 430, label: 'Request Header Fields Too Large (Shopify)' },
  { code: 450, label: 'Blocked by Windows Parental Controls (Microsoft)' },
  { code: 498, label: 'Invalid Token (Esri)' },
  { code: 499, label: 'Token Required (Esri)' },
  { code: 509, label: 'Bandwidth Limit Exceeded (Apache Web Server/cPanel)' },
  { code: 529, label: 'Site is overloaded' },
  { code: 530, label: 'Site is frozen' },
  { code: 598, label: '(Informal convention) Network read timeout error' },
  { code: 599, label: 'Network Connect Timeout Error' },
  { code: 440, label: 'Login Time-out' },
  { code: 449, label: 'Retry With' },
  { code: 451, label: 'Redirect' },
  { code: 444, label: 'No Response' },
  { code: 494, label: 'Request header too large' },
  { code: 495, label: 'SSL Certificate Error' },
  { code: 496, label: 'SSL Certificate Required' },
  { code: 497, label: 'HTTP Request Sent to HTTPS Port' },
  { code: 499, label: 'Client Closed Request' },
  { code: 520, label: 'Web Server Returned an Unknown Error' },
  { code: 521, label: 'Web Server Is Down' },
  { code: 522, label: 'Connection Timed Out' },
  { code: 523, label: 'Origin Is Unreachable' },
  { code: 524, label: 'A Timeout Occurred' },
  { code: 525, label: 'SSL Handshake Failed' },
  { code: 526, label: 'Invalid SSL Certificate' },
  { code: 527, label: 'Railgun Error' },
  { code: 460, label: '' },
  { code: 463, label: '' },
  { code: 464, label: '' },
  { code: 561, label: 'Unauthorized' },
  { code: 110, label: 'Response is Stale' },
  { code: 111, label: 'Revalidation Failed' },
  { code: 112, label: 'Disconnected Operation' },
  { code: 113, label: 'Heuristic Expiration' },
  { code: 199, label: 'Miscellaneous Warning' },
  { code: 214, label: 'Transformation Applied' },
  { code: 299, label: 'Miscellaneous Persistent Warning' },
];
</file>

<file path="common/express-error-handler/src/index.spec.js">
jest.mock('@runeya/common-express-logger', () => {
  const mockError = {
    errorId: 'errorId',
    date: new Date(),
  };
  return {
    error: jest.fn().mockImplementation(() => mockError),
  };
});
const HTTPError = require('@runeya/common-express-http-error');
const ErrorHandler = require('./index');

const mockRes = {
  status: jest.fn(() => mockRes),
  send: jest.fn(() => mockRes),
  json: jest.fn(() => mockRes),
};
beforeAll(() => { process.env.NODE_ENV = 'production'; });
afterAll(() => { process.env.NODE_ENV = 'test'; });

describe('Middleware: ErrorHandler', () => {
  it('should set 500 status and change message', async () => {
    const err = new HTTPError('This is an error');
    const errorHandler = ErrorHandler();
    errorHandler(err, {}, mockRes, () => { });
    expect(mockRes.status).toHaveBeenCalledWith(500);
    expect(mockRes.json).toHaveBeenCalledWith({
      code: 500,
      errorId: err.errorId,
      date: err.date,
      message:
        'We cannot respond to your request for moment. Contact support for more information',
    });
  });
  it('should set 500 status when err.code is not valid', async () => {
    const err = new HTTPError('This is an error');
    err.code = 'this is not a valid code http';
    const errorHandler = ErrorHandler();
    errorHandler(err, {}, mockRes, () => { });
    expect(mockRes.status).toHaveBeenCalledWith(500);
    expect(mockRes.json).toHaveBeenCalledWith({
      code: 500,
      errorId: err.errorId,
      date: err.date,
      message:
        'We cannot respond to your request for moment. Contact support for more information',
    });
  });
  it('should set 400 status with simple object', async () => {
    const err = new HTTPError('This is an error');
    err.code = 400;
    const errorHandler = ErrorHandler();
    errorHandler(err, {}, mockRes, () => { });
    expect(mockRes.status).toHaveBeenCalledWith(400);
    expect(mockRes.json).toHaveBeenCalledWith({
      code: err.code,
      errorId: err.errorId,
      date: err.date,
      message: err.message,
    });
  });
  it('should set 400 status with HTTPErrror', async () => {
    const err = new HTTPError('This is an error', 400);
    const errorHandler = ErrorHandler();
    errorHandler(err, {}, mockRes, () => { });
    expect(mockRes.status).toHaveBeenCalledWith(400);
    expect(mockRes.json).toHaveBeenCalledWith({
      code: err.code,
      errorId: err.errorId,
      date: err.date,
      message: err.message,
    });
  });
});
</file>

<file path="common/express-error-handler/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="common/express-error-handler/jest.config.js">
const path = require('path');

module.exports = {
  ...require('@runeya/common-jest/src/jest.config.default'),
  rootDir: path.resolve(__dirname),
};
</file>

<file path="common/express-health-check/src/index.js">
/**
 * @param {import('express')} express
 * @param {{name?:string, version?:string}} param1
 * @returns
 */
module.exports = (express, { name = '', version = '' } = {}) => express.Router().use('/health', (req, res) => {
  res.json({
    name, version, health: true,
  });
});
</file>

<file path="common/express-health-check/src/index.spec.js">
const express = require('express');
const supertest = require('supertest');
const middleware = require('./index');

describe('Middleware: healthcheck', () => {
  it('should send a healthcheck', async () => {
    const health = middleware(express, ({ name: 'toto', version: 'titi' }));
    const app = express();
    app.use(health);
    const { body } = await supertest(app).get('/health').send();
    expect(body).toEqual({ name: 'toto', version: 'titi', health: true });
  });
});
</file>

<file path="common/express-health-check/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="common/express-health-check/jest.config.js">
const path = require('path');

module.exports = {
  ...require('@runeya/common-jest/src/jest.config.default'),
  rootDir: path.resolve(__dirname),
};
</file>

<file path="common/express-http-error/src/HTTPError.js">
const dayjs = require('dayjs');
const { v4: uuid } = require('uuid');

const statusMessage = {
  403: 'Not allowed',
  404: 'Resource not found',
  500: 'We cannot respond to your request for moment. Contact support for more information',
};
module.exports.statusMessage = statusMessage;

class HTTPError extends Error {
  /**
   *
   * @param {string} message
   * @param {number} code
   * @param {string} errorId
   * @param {string} date
   * @param {string} stack
   */
  constructor(
    message,
    code = 500,
    errorId = uuid(),
    date = dayjs().format('YYYY-MM-DD HH:mm:ss'),
    stack = '',
  ) {
    super(message);
    this.code = code || 500;
    this.errorId = errorId;
    this.date = date;
    this.message = process.env.NODE_ENV === 'production'
      ? statusMessage[this.code] || message?.toString() || message
      : message?.toString() || message || statusMessage[this.code];
    this.originalMessage = message;
    this.originalStack = stack || new Error().stack;
  }
}

module.exports = HTTPError;
</file>

<file path="common/express-http-error/src/index.js">
const HTTPError = require('./HTTPError');

module.exports = HTTPError;
</file>

<file path="common/express-http-error/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="common/retrigger-all-build/src/commit-a-space-here.txt">

</file>

<file path="common/retrigger-all-build/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="common/socket-front/src/index.js">
import SocketLib from './Socket';

export const Socket = SocketLib;
</file>

<file path="common/socket-front/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="common/socket-server/src/index.js">
module.exports = {
  sockets: require('./sockets'),
};
</file>

<file path="common/socket-server/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="common/typings/src/index.ts">
export type FunctionPropertyNames<T> = {
  [K in keyof T]: T[K] extends Function ? K : never;
}[keyof T];
export type NonFunctionPropertyNames<T> = {
  [K in keyof T]: T[K] extends Function ? never : K;
}[keyof T];
export type NonFunctionPropertyNamesNumber<T> = {
  [K in keyof T]: T[K] extends Function ? never : K;
}[keyof T];
// @ts-ignore
export type PartialPick<T,M> = Partial<Pick<T, M>>
export type FunctionProperties<T> = PartialPick<T, FunctionPropertyNames<T>>;
export type NonFunctionProperties<T> = PartialPick<T, NonFunctionPropertyNames<T>>;


type addPrefix<TKey, TPrefix extends string> = TKey extends string
  ? `${TPrefix}${TKey}`
  : never;

type removePrefix<TPrefixedKey, TPrefix extends string> = TPrefixedKey extends addPrefix<infer TKey, TPrefix>
  ? TKey
  : '';

type prefixedValue<TObject extends object, TPrefixedKey extends string, TPrefix extends string> = TObject extends {[K in removePrefix<TPrefixedKey, TPrefix>]: infer TValue}
  ? TValue
  : never;


export type addPrefixToObject<TObject extends object, TPrefix extends string> = {
  [K in addPrefix<keyof TObject, TPrefix>]: prefixedValue<TObject, K, TPrefix>
} 

export interface FieldDescriptior {
  field: string,
  type: 'string' | 'number' | 'boolean' | 'objectId'
}
type validation = (value: any, path: string) => {
  isValid: boolean,
  message: string
}
type validationFactory = (...args: any) => validation

export type GenericFields<M> = {
// @ts-ignore
  default:  M = M
  validation?: validation
  hasMany?: string
  hasOne?: string,
  doc?: string
}
export type SchemaField = GenericFields<String> | GenericFields<Number>| GenericFields<any>
export type Generic = {
  [key: string]: SchemaField
}

type GeneratedClass<T, D, E> = {
  new(schema: SchemaTransformed<T>): Instance<T,Partial<D>>;
// @ts-ignore
  find: (filter: {filter: SchemaTransformed<T>, limit?: number, skip?: number, sort?: any, lookups?: any}) => Promise<Instance<T>[]>
// @ts-ignore
  findOne: (filter: {filter: SchemaTransformed<T>, limit?: number, skip?: number, sort?: any, lookups?: any}) => Promise<Instance<T>>
// @ts-ignore
  update: (filter: Instance<T>) => Promise<Instance<T>>
  updateMany: (filter: SchemaTransformed<T>, set: SchemaTransformed<T>) => void
  schema: T
  schemaName: string
} & Partial<E> & {[key: string]: any}
type SchemaTransformed<M> = {
// @ts-ignore
  [K in keyof M]?: M[K]['default']
}
type Instance<M, D> = SchemaTransformed<M> &  {
// @ts-ignore
  save: () => Promise<Instance<M>>
} & D
interface Option<C, D, E> {
  mongo?: any,
  description?: string
  extends?: C
  routes?: {
    prefix: string,
    paths: {
      
    } 
  }
  docs?: {
    methods: {
      [key: string]: {
        description?: string,
        params?: {
          label: string,
          type?: any,
          description?: string
        }
      }
    }
  }
  methods?: D,
  staticMethods?: E,
}
type CustomFunctions<M> = {[key: string]: (this: M,...args: any) => any}
export interface Schema {
  createSchema<M extends Generic ,C extends  Generic, D extends CustomFunctions<Instance<M & C,Partial<D>>>, E extends CustomFunctions<F>, F extends GeneratedClass<M & C, D, E>>(name: string, schema: M, option?: Option<C, D, E>): F
}
// @ts-ignore
export type AnyObject<T = string> = Record<T, any>;


import type {
  GlobalScript as _Script,
  ScriptStep as _ScriptStep,
  TrackStep as _TrackStep,
} from '../../../modules/global-scripts/backend/GlobalScripts';

//= ==== Plugins ==========
import type {
  PluginSM as _RuneyaPlugin,
} from '../../../modules/plugins-loader/front/src/views';

//= ==== Leaf ==========
import type {
  Leaf as _Leaf,
} from '../../../modules/documentation/backend/index';

//= ==== Npm ==========
import type {
  Outdated as _Outdated,
} from '../../../modules/npm/backend/index';

//= ==== Npm ==========
import type {
  OpenAiChat as _OpenAiChat,
} from '../../../modules/openai/backend/index.js';

//= ==== Fs ==========
import type {
  Entry as _Entry,
  NpmInfos as _NpmInfos,
} from '../../../servers/server/routes/fs';

export type {
  StackFile,
  StackArray,
  StackObject,
  StackFunction,
  Environment,
  StackWithPlugins as Runeya,
} from '../../../servers/server/models/stack.js';

export type {
  SpawnOptions,
  ServiceType as Service,
  LogMessage,
  Parser,
} from '../../../servers/server/models/Service';
export namespace GlobalScripts {
  export type Script = _Script
  export type ScriptStep = _ScriptStep
  export type TrackStep = _TrackStep
}
export namespace Plugins {
  export type RuneyaPlugin<T> = _RuneyaPlugin<T>
}
export namespace Documentation {
  export type Leaf = _Leaf
}
export namespace Npm {
  export type Outdated = _Outdated
}
export namespace OpenAi {
  export type OpenAiChat = _OpenAiChat
}

export namespace FS {
  export type Entry = _Entry
  export type NpmInfos = _NpmInfos
}
</file>

<file path="common/typings/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="common/typings/tsconfig.json">
{
  "compilerOptions": {
    "outFile": "dist/index.js",
    "module": "AMD",
    "noEmit": false,
    "declaration": true,
  },
  "include": ["."],
  "exclude": [
    "node_modules/**/*",
    "dist/**/*"
  ]
}
</file>

<file path="common/workflows/src/index.js">
const fs = require('fs');
const pathfs = require('path');
const walker = require('./walker');

const root = pathfs.resolve(__dirname, '..', '..', '..');
const githubRoot = pathfs.resolve(root, '.github');
const workflowsRoot = pathfs.resolve(githubRoot, 'workflows');

const workflowTemplateDockerPath = pathfs.resolve(githubRoot, 'workflow-template-docker.yml');
const workflowTemplateDocker = fs.readFileSync(workflowTemplateDockerPath, 'utf-8');

const workflowTemplateTestPath = pathfs.resolve(githubRoot, 'workflow-template-test.yml');
const workflowTemplateTest = fs.readFileSync(workflowTemplateTestPath, 'utf-8');

const workflowTemplateDeployPath = pathfs.resolve(githubRoot, 'workflow-template-deploy.yml');
const workflowTemplateDeploy = fs.readFileSync(workflowTemplateDeployPath, 'utf-8');

const prependText = `
# Autogenerated by @runeya/common-workflows package
# If you must edit this file, edit files in .github/workflow-*.yml
# Then launch "yarn ci:generate"

`;
(async () => {
  let files = await walker.import({ paths: ['.'] });
  files = files.sort((a, b) => a.localeCompare(b));
  await generateDeployWorkflows(files);
  await generateTestWorkflows();
})();
async function generateDeployWorkflows(files) {
  let workflow = workflowTemplateDeploy;
  workflow = prependText + workflow;

  // Generate docker steps
  const dockerfiles = files.filter((file) => file.endsWith('Dockerfile'));
  dockerfiles.forEach((dockerfilePath) => {
    const LOCATION = pathfs.dirname(dockerfilePath).split(root).join('').split(pathfs.sep)
      .filter((a) => a)
      .join('/');
    const NAME_ROUTE = pathfs.dirname(dockerfilePath).split(root).join('').split(pathfs.sep)
      .filter((a) => a)
      .join('-');
    workflow += `${workflowTemplateDocker
      .replaceAll(/{{LOCATION}}/gi, LOCATION)
      .replaceAll(/{{NAME_ROUTE_SANITIZED}}/gi, NAME_ROUTE.replaceAll('.', '_'))
      .replaceAll(/{{NAME_ROUTE}}/gi, NAME_ROUTE)}\n`;
  });
  fs.writeFileSync(pathfs.join(workflowsRoot, 'all-deploy.yml'), workflow);
}

async function generateTestWorkflows() {
  let workflow = workflowTemplateTest;
  workflow = prependText + workflow;
  fs.writeFileSync(pathfs.join(workflowsRoot, 'all-test.yml'), workflow);
}
</file>

<file path="common/workflows/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="common/README.md">
# Common

This is all libraries that can be used across multiple projects
</file>

<file path="fronts/app/src/assets/fonts/Jost/Jost.css">
/* JOST* */

@font-face {
  font-family: "Jost";
  src: url("Jost-100.ttf") format("truetype");
  font-weight: 100;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "Jost";
  src: url("Jost-200.ttf") format("truetype");
  font-weight: 200;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "Jost";
  src: url("Jost-300.ttf") format("truetype");
  font-weight: 300;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "Jost";
  src: url("Jost-400.ttf") format("truetype");
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "Jost";
  src: url("Jost-500.ttf") format("truetype");
  font-weight: 500;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "Jost";
  src: url("Jost-600.ttf") format("truetype");
  font-weight: 600;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "Jost";
  src: url("Jost-700.ttf") format("truetype");
  font-weight: 700;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "Jost";
  src: url("Jost-800.ttf") format("truetype");
  font-weight: 800;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "Jost";
  src: url("Jost-900.ttf") format("truetype");
  font-weight: 900;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "Jost";
  src: url("Jost-100-Italic.ttf") format("truetype");
  font-weight: 100;
  font-style: italic;
  font-display: swap;
}

@font-face {
  font-family: "Jost";
  src: url("Jost-200-Italic.ttf") format("truetype");
  font-weight: 200;
  font-style: italic;
  font-display: swap;
}

@font-face {
  font-family: "Jost";
  src: url("Jost-300-Italic.ttf") format("truetype");
  font-weight: 300;
  font-style: italic;
  font-display: swap;
}

@font-face {
  font-family: "Jost";
  src: url("Jost-400-Italic.ttf") format("truetype");
  font-weight: 400;
  font-style: italic;
  font-display: swap;
}

@font-face {
  font-family: "Jost";
  src: url("Jost-500-Italic.ttf") format("truetype");
  font-weight: 500;
  font-style: italic;
  font-display: swap;
}

@font-face {
  font-family: "Jost";
  src: url("Jost-600-Italic.ttf") format("truetype");
  font-weight: 600;
  font-style: italic;
  font-display: swap;
}

@font-face {
  font-family: "Jost";
  src: url("Jost-700-Italic.ttf") format("truetype");
  font-weight: 700;
  font-style: italic;

}

@font-face {
  font-family: "Jost";
  src: url("Jost-800-Italic.ttf") format("truetype");
  font-weight: 800;
  font-style: italic;
  font-display: swap;
}

@font-face {
  font-family: "Jost";
  src: url("Jost-900-Italic.ttf") format("truetype");
  font-weight: 900;
  font-style: italic;
  font-display: swap;
}
</file>

<file path="fronts/app/src/assets/theme/_font.scss">
@font-face {
  font-family: "Logo";
  src: url("./assets/fonts/MuseoModerno.ttf") format("truetype")
}
</file>

<file path="fronts/app/src/assets/theme/_scrollbar.scss">
/* width */
::-webkit-scrollbar {
  width: 5px;
  height: 5px;
}

/* Track */
::-webkit-scrollbar-track {
  background: #e1e1e1;
}

/* Handle */
::-webkit-scrollbar-thumb {
  background: #aaa;
  border-radius: 5px;
}

/* Handle on hover */
::-webkit-scrollbar-thumb:hover {
  background: #666;
}
</file>

<file path="fronts/app/src/assets/theme/_var.scss">
:root {
  --fontSize: 1em;
  --BgColor: 70, 108, 128;
  --BgColorAccent: 44, 62, 80;
  --BgColorAccentGradient: 80, 138, 177;
  --headerBgColor: rgb(var(--BgColor));
  --headerBgColorAccent: rgb(var(--BgColorAccent));
  --headerBgColorAccentGradient: rgb(var(--BgColorAccentGradient));
  --headerTextColor: white;
  --headerTextColorAccent: white;
}
</file>

<file path="fronts/app/src/components/BackgroundStackChooser.vue">
<template>
  <div class="background-root">
    <div class="stars">
      <transition-group name="appear">
        <div class="star" v-for="(star, i) in stars" :key="'star-'+i" :style="{...star}"></div>
      </transition-group>
    </div>
    <div class="bars left">
      <transition-group name="appear">
        <div class="bar" v-for="(bar, i) in barsLeft" :key="'bar-left'+i" :style="{...bar}"></div>
      </transition-group>
    </div>
    <div class="bars right">
      <transition-group name="appear">
        <div class="bar" v-for="(bar, i) in barsRight" :key="'bar-right'+i" :style="{...bar}"></div>
      </transition-group>
    </div>
  </div>
</template>

<script>
import { ref, onBeforeUnmount, onMounted } from 'vue'

export default {
  props: {
    lowResources: {default: false}
  },
  setup(props) {
    /** @type {import('vue').Ref<StarPosition[]>} */
    const stars = ref([])
    /**
     * @param {number} i
     * @return {StarPosition}
     */
    const getStarPosition = (i) => {
      const line = Math.floor((i * 100 / 5) / 100)
      const maxLine = Math.floor((100 * 100 / 5) / 100)
      const left = (i * 100 / 5) % 100
      const top =  line*100/maxLine
      const random = Math.floor(Math.random() * 40)
      const randomizedLeft = Math.random() > 0.5 ? left + random : left - random
      const randomizedTop = Math.random() > 0.5 ? top + random : top - random
      return {
        top: randomizedTop+'%',
        left: randomizedLeft + '%',
        backgroundColor: `rgba(255, 255, 255, 0.6)`,
        boxShadow: '0 0 10px 1px white',
      }
    }
    onMounted(()=> stars.value = Array(100).fill('').map((_, i) => getStarPosition(i)))

    // Bars
    const nbBars = 10
    /**
     * @param {number} i
     * @return {BarPosition}
     */
    const getBarLeftPosition = (i) => {
      const top =  i*100/nbBars
      const randomizedLeft = top
      return {bottom: '0', top: randomizedLeft + '%', width: (Math.random() * 50) + '%' }
    }
    /**
     * @param {number} i
     * @return {BarPosition}
     */
    const getBarRightPosition = (i) => {
      const top =  i*100/nbBars
      const randomizedLeft = top
      return {right: '0', top: randomizedLeft + '%', width: (Math.random() * 50) + '%' }
    }
    /**@type {import('vue').Ref<BarPosition[]>} */
    const barsLeft = ref([])
    /**@type {import('vue').Ref<BarPosition[]>} */
    const barsRight = ref([])
    onMounted(() => setTimeout(() => barsLeft.value = Array(10).fill('').map((_, i) => getBarLeftPosition(i))))
    onMounted(() => setTimeout(() => barsRight.value = Array(10).fill('').map((_, i) => getBarRightPosition(i))))
    /** @type {NodeJS.Timer} */
    let interval
    if(!props.lowResources) {
      interval = setInterval(() => {
        stars.value.map(star => {
          const opacity = (Math.random() / 3) + 1/3
          star.backgroundColor = `rgba(255, 255, 255, ${opacity})`
        })
      }, 300);
    }
    // @ts-ignore
    onBeforeUnmount(()=> clearInterval(interval))
    return {
      barsLeft,
      barsRight,
      stars,
    }
  }
}

/**
 * @typedef {{
 *  top: string,
 *  left: string,
 *  backgroundColor: string,
 *  boxShadow: string,
 * }} StarPosition
 */
/**
 * @typedef {{
 *  bottom?: string,
 *  top?: string,
 *  right?: string,
 *  left?: string,
 *  width: string,
 * }} BarPosition
 */
</script>

<style lang="scss" scoped>
.background-root {
  position: absolute;
  z-index: -1;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: 
    radial-gradient(circle at 74.02% 88.01%, #382d92, transparent 41%),
    radial-gradient(circle at 68.03% 89.02%, #382d92, transparent 9%),
    radial-gradient(circle at 0% 50%, #252388, transparent 50%),
    radial-gradient(circle at 0 63.01%, #312b5c, transparent 40%),
    radial-gradient(circle at 50% 100%, rgb(24, 19, 92), transparent 40%),
    radial-gradient(circle at 50% 50%, #382d92, #060130 100%);
  .stars {
    .star {
      width: 5px;
      height: 5px;
      border-radius: 50%;
      position: absolute;
      transition: 300ms;
    }
  }
  .bars {
    .bar {
      height: 30px;
      border-radius: 20px;
      background-color: #ffffff1a;
      filter: blur(10);
      position: absolute;
      transition: 300ms;
    }
  }
  .bars.left {
    .bar {
      left: 0;
      border-bottom-left-radius: 0;
      border-top-left-radius: 0;
    }
  }
  .bars.right {
    .bar {
      right: 0;
      border-bottom-right-radius: 0;
      border-top-right-radius: 0;
    }
  }
}

.appear-enter-active,
.appear-leave-active {
  transition: 300ms;
}

.appear-enter-from,
.appear-leave-to {
  opacity: 0;
  width: 0;
}
</style>
</file>

<file path="fronts/app/src/components/Card.vue">
<template>
  <div class="card-root" :class="{[color]: true, mini}">
    <div class="card-container">
      <slot></slot>
    </div>
  </div>
</template>

<script setup>
defineProps({
  color: {default: 'blue'},
  mini: {default: false},
})
</script>

<style lang="scss" scoped>

.card-root {
  width: 300px;
  height: auto;
  &.mini {
    border-radius: 1000px;
    .card-container {
      flex-direction: row;
    }
  }
  display: flex;
  align-items: center;
  position: relative;
  overflow: hidden;
  &::before, &::after {
    content: "";
    width: 150%;
    height: 75%;
    border-radius: 100%;
    position: absolute;
    top: 0;
    right: -100%;
    transform: rotate(20deg);
    transform-origin: top;

  }
  &::after {
    height: 45%;
  }
  .card-container {
    width: 100%;
    z-index: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 10px;
    box-sizing: border-box;
  }

  
  &.blue {
    @include card-tertiary()
  }
  &.purple {
    @include card()
  }
  
  &.orange {
    @include card-secondary()
  }
}

</style>
</file>

<file path="fronts/app/src/components/DoughtnutChart.vue">
<template>
  <div v-if="value !== null" :style="{width, textAlign, marginLeft: adjustLeft, marginTop: adjustTop}" class="root" :title="placeholder">
    <section>
      <svg :width="rayon *2 +strokeWidth + padding + adjustContainer" :height="rayon *2 +strokeWidth + padding + adjustContainer" xmlns="http://www.w3.org/2000/svg">
        <circle
          :stroke="strokeColorBg"
          :stroke-width="strokeWidthBg"
          fill="none"
          :cx="rayon + strokeWidth / 2 + padding / 2 + adjustContainer / 2"
          :cy="rayon + strokeWidth / 2 + padding / 2 + adjustContainer / 2"
          :r="rayon"/>
        <circle class="circle"
          :stroke="strokeColor"
          :stroke-width="strokeWidth"
          fill="none"
          :cx="rayon + strokeWidth  / 2 + padding / 2 + adjustContainer / 2"
          :cy="rayon + strokeWidth / 2 + padding / 2 + adjustContainer / 2"
          :r="rayon"
          :stroke-dasharray="(2 * 3.14 * rayon)"
          :stroke-dashoffset="(2 * 3.14 * rayon) * (1 - (value / 100))"
          />
        <g :class="'info info-anim-' + anim" v-if="!noSubtitle">
          <text class='text' x="50%" :y="rayon +13 + padding / 2  + adjustSubtitleTop" width="70" textAlign="center" dominant-baseline="central" alignment-baseline="central" text-anchor="middle" :fill="strokeColorBg" font-weight="bold"  :font-size="fontSize">
            {{value.toFixed(0)}}%
          </text>
        </g>
        <text class='additionnalText'
          :x="rayon + padding - 10 + adjustTitleLeft + adjustContainer / 2"
          :y="rayon + padding - 25 + adjustTitleTop + adjustContainer / 2"
          width="60"
          dominant-baseline="central"
          alignment-baseline="central"
          text-anchor="middle"
          :fill="color" :font-size="fontSize">
            {{title}} {{titleSuffix}}
          </text>
        <text class='additionnalSubText'
          :x="rayon + padding - 10 + adjustTitleLeft"
          :y="rayon + 10 + padding + adjustTitleTop"
          width="60"
          dominant-baseline="central"
          alignment-baseline="central"
          text-anchor="middle"
          :fill="color"
          font-size="15">
            {{subtitle}}
          </text>
      </svg>
    </section>
  </div>
</template>

<script>
export default {
  name: 'doughtnut-chart',
  props: {
    'value': { default: 0 },
    'rayon': { default: 150 },
    'strokeWidth': { default: 25 },
    'strokeWidthBg': { default: 10 },
    'strokeColorBg': { default: '#b8d3ca' },
    'strokeColor': { default: '#5e9985' },
    'padding': { default: 50 },
    'title': { default: '' },
    'adjustTop': {default: 0},
    'adjustLeft': {default: 0},
    'adjustTitleTop': {default: 0},
    'adjustTitleLeft': {default: 0},
    'adjustSubtitleTop': {default: 0},
    'adjustSubtitleLeft': {default: 0},
    'adjustContainer': {default: 0},
    'subtitle': { default: '' },
    'width': {default: 'auto'},
    'textAlign': {
      /** @type {"start" | "right" | "left" | "-webkit-match-parent" | "center" | "end" | "justify" | "match-parent"} */
      default: 'left'
    },
    'noSubtitle': {default: false},
    'fontSize': {default: 30},
    'titleSuffix': {default: ''},
    'color': {default: '#606060'},
    'placeholder': {default: ''},
  },
  data() {
    return {anim: 1}
  },
  mounted() {
    this.animation()
  },
  methods: {
    animation() {
      this.anim = this.anim ? 1 : 2
    }
  }
}
</script>

<style scoped lang="scss">
section {
  display: inline-block;
  height: 55px;
  position: relative;
}
.circle {
  transform: rotate(-180deg);
  transform-origin: center;
}

.info {
  opacity: 1
}

@for $i from 1 through 2 {
  .circle-anim-#{$i} {
    animation: chart-fill- + i 1s reverse
  }
  .info-anim-#{$i} {
    animation: chart-appear- + i 1s forwards
  }
  @keyframes chart-fill-#{$i} {
    to {
      stroke-dasharray: 0 380;
    }
  }
  @keyframes chart-appear-#{$i} {
    to {
      opacity: 1;
    }
  }
}
</style>
</file>

<file path="fronts/app/src/components/Editor-monokai.json">
{
    "base": "vs-dark",
    "inherit": true,
    "rules": [
        {
            "background": "272822",
            "token": ""
        },
        {
            "foreground": "75715e",
            "token": "comment"
        },
        {
            "foreground": "e6db74",
            "token": "string"
        },
        {
            "foreground": "ae81ff",
            "token": "constant.numeric"
        },
        {
            "foreground": "ae81ff",
            "token": "constant.language"
        },
        {
            "foreground": "ae81ff",
            "token": "constant.character"
        },
        {
            "foreground": "ae81ff",
            "token": "constant.other"
        },
        {
            "foreground": "f92672",
            "token": "keyword"
        },
        {
            "foreground": "f92672",
            "token": "storage"
        },
        {
            "foreground": "66d9ef",
            "fontStyle": "italic",
            "token": "storage.type"
        },
        {
            "foreground": "a6e22e",
            "fontStyle": "underline",
            "token": "entity.name.class"
        },
        {
            "foreground": "a6e22e",
            "fontStyle": "italic underline",
            "token": "entity.other.inherited-class"
        },
        {
            "foreground": "a6e22e",
            "token": "entity.name.function"
        },
        {
            "foreground": "fd971f",
            "fontStyle": "italic",
            "token": "variable.parameter"
        },
        {
            "foreground": "f92672",
            "token": "entity.name.tag"
        },
        {
            "foreground": "a6e22e",
            "token": "entity.other.attribute-name"
        },
        {
            "foreground": "66d9ef",
            "token": "support.function"
        },
        {
            "foreground": "66d9ef",
            "token": "support.constant"
        },
        {
            "foreground": "66d9ef",
            "fontStyle": "italic",
            "token": "support.type"
        },
        {
            "foreground": "66d9ef",
            "fontStyle": "italic",
            "token": "support.class"
        },
        {
            "foreground": "f8f8f0",
            "background": "f92672",
            "token": "invalid"
        },
        {
            "foreground": "f8f8f0",
            "background": "ae81ff",
            "token": "invalid.deprecated"
        },
        {
            "foreground": "cfcfc2",
            "token": "meta.structure.dictionary.json string.quoted.double.json"
        },
        {
            "foreground": "75715e",
            "token": "meta.diff"
        },
        {
            "foreground": "75715e",
            "token": "meta.diff.header"
        },
        {
            "foreground": "f92672",
            "token": "markup.deleted"
        },
        {
            "foreground": "a6e22e",
            "token": "markup.inserted"
        },
        {
            "foreground": "e6db74",
            "token": "markup.changed"
        },
        {
            "foreground": "ae81ffa0",
            "token": "constant.numeric.line-number.find-in-files - match"
        },
        {
            "foreground": "e6db74",
            "token": "entity.name.filename.find-in-files"
        },
        {
            "token": "meta.embedded",
            "foreground": "#F8F8F2"
        },
        {
            "token": "source.groovy.embedded",
            "foreground": "#F8F8F2"
        },
        {
            "token": "string meta.image.inline.markdown",
            "foreground": "#F8F8F2"
        },
        {
            "token": "variable.legacy.builtin.python",
            "foreground": "#F8F8F2"
        },
        {
            "token": "comment",
            "foreground": "#88846f"
        },
        {
            "token": "string",
            "foreground": "#E6DB74"
        },
        {
            "token": "punctuation.definition.template-expression",
            "foreground": "#F92672"
        },
        {
            "token": "punctuation.section.embedded",
            "foreground": "#F92672"
        },
        {
            "token": "meta.template.expression",
            "foreground": "#F8F8F2"
        },
        {
            "token": "constant.numeric",
            "foreground": "#AE81FF"
        },
        {
            "token": "constant.language",
            "foreground": "#AE81FF"
        },
        {
            "token": "constant.character, constant.other",
            "foreground": "#AE81FF"
        },
        {
            "token": "variable",
            "fontStyle": "",
            "foreground": "#F8F8F2"
        },
        {
            "token": "keyword",
            "foreground": "#F92672"
        },
        {
            "token": "storage",
            "fontStyle": "",
            "foreground": "#F92672"
        },
        {
            "token": "storage.type",
            "fontStyle": "italic",
            "foreground": "#66D9EF"
        },
        {
            "token": "entity.name.type, entity.name.class, entity.name.namespace, entity.name.scope-resolution",
            "fontStyle": "underline",
            "foreground": "#A6E22E"
        },
        {
            "token": "entity.other.inherited-class",
            "fontStyle": "italic underline",
            "foreground": "#A6E22E"
        },
        {
            "token": "entity.name.function",
            "fontStyle": "",
            "foreground": "#A6E22E"
        },
        {
            "token": "variable.parameter",
            "fontStyle": "italic",
            "foreground": "#FD971F"
        },
        {
            "token": "entity.name.tag",
            "fontStyle": "",
            "foreground": "#F92672"
        },
        {
            "token": "entity.other.attribute-name",
            "fontStyle": "",
            "foreground": "#A6E22E"
        },
        {
            "token": "support.function",
            "fontStyle": "",
            "foreground": "#66D9EF"
        },
        {
            "token": "support.constant",
            "fontStyle": "",
            "foreground": "#66D9EF"
        },
        {
            "token": "support.type, support.class",
            "fontStyle": "italic",
            "foreground": "#66D9EF"
        },
        {
            "token": "support.other.variable",
            "fontStyle": ""
        },
        {
            "token": "invalid",
            "fontStyle": "",
            "foreground": "#F44747"
        },
        {
            "token": "invalid.deprecated",
            "foreground": "#F44747"
        },
        {
            "token": "meta.structure.dictionary.json string.quoted.double.json",
            "foreground": "#CFCFC2"
        },
        {
            "token": "meta.diff, meta.diff.header",
            "foreground": "#75715E"
        },
        {
            "token": "markup.deleted",
            "foreground": "#F92672"
        },
        {
            "token": "markup.inserted",
            "foreground": "#A6E22E"
        },
        {
            "token": "markup.changed",
            "foreground": "#E6DB74"
        },
        {
            "token": "constant.numeric.line-number.find-in-files - match",
            "foreground": "#AE81FFA0"
        },
        {
            "token": "entity.name.filename.find-in-files",
            "foreground": "#E6DB74"
        },
        {
            "token": "markup.quote",
            "foreground": "#F92672"
        },
        {
            "token": "markup.list",
            "foreground": "#E6DB74"
        },
        {
            "token": "markup.bold, markup.italic",
            "foreground": "#66D9EF"
        },
        {
            "token": "markup.inline.raw",
            "fontStyle": "",
            "foreground": "#FD971F"
        },
        {
            "token": "markup.heading",
            "foreground": "#A6E22E"
        },
        {
            "token": "markup.heading.setext",
            "foreground": "#A6E22E",
            "fontStyle": "bold"
        },
        {
            "token": "markup.heading.markdown",
            "fontStyle": "bold"
        },
        {
            "token": "markup.quote.markdown",
            "fontStyle": "italic",
            "foreground": "#75715E"
        },
        {
            "token": "markup.bold.markdown",
            "fontStyle": "bold"
        },
        {
            "token": "string.other.link.title.markdown,string.other.link.description.markdown",
            "foreground": "#AE81FF"
        },
        {
            "token": "markup.underline.link.markdown,markup.underline.link.image.markdown",
            "foreground": "#E6DB74"
        },
        {
            "token": "markup.italic.markdown",
            "fontStyle": "italic"
        },
        {
            "token": "markup.strikethrough",
            "fontStyle": "strikethrough"
        },
        {
            "token": "markup.list.unnumbered.markdown, markup.list.numbered.markdown",
            "foreground": "#f8f8f2"
        },
        {
            "token": "punctuation.definition.list.begin.markdown",
            "foreground": "#A6E22E"
        },
        {
            "token": "token.info-token",
            "foreground": "#6796e6"
        },
        {
            "token": "token.warn-token",
            "foreground": "#cd9731"
        },
        {
            "token": "token.error-token",
            "foreground": "#f44747"
        },
        {
            "token": "token.debug-token",
            "foreground": "#b267e6"
        },
        {
            "token": "variable.language",
            "foreground": "#FD971F"
        }
    ],
    "colors": {
        "dropdown.background": "#414339",
        "list.activeSelectionBackground": "#75715E",
        "quickInputList.focusBackground": "#414339",
        "dropdown.listBackground": "#1e1f1c",
        "list.inactiveSelectionBackground": "#414339",
        "list.hoverBackground": "#3e3d32",
        "list.dropBackground": "#414339",
        "list.highlightForeground": "#f8f8f2",
        "button.background": "#75715E",
        "editor.background": "#272822",
        "editor.foreground": "#f8f8f2",
        "selection.background": "#878b9180",
        "editor.selectionHighlightBackground": "#575b6180",
        "editor.selectionBackground": "#878b9180",
        "minimap.selectionHighlight": "#878b9180",
        "editor.wordHighlightBackground": "#4a4a7680",
        "editor.wordHighlightStrongBackground": "#6a6a9680",
        "editor.lineHighlightBackground": "#3e3d32",
        "editorLineNumber.activeForeground": "#c2c2bf",
        "editorCursor.foreground": "#f8f8f0",
        "editorWhitespace.foreground": "#464741",
        "editorIndentGuide.background": "#464741",
        "editorIndentGuide.activeBackground": "#767771",
        "editorGroupHeader.tabsBackground": "#1e1f1c",
        "editorGroup.dropBackground": "#41433980",
        "tab.inactiveBackground": "#34352f",
        "tab.border": "#1e1f1c",
        "tab.inactiveForeground": "#ccccc7",
        "tab.lastPinnedBorder": "#414339",
        "widget.shadow": "#00000098",
        "progressBar.background": "#75715E",
        "badge.background": "#75715E",
        "badge.foreground": "#f8f8f2",
        "editorLineNumber.foreground": "#90908a",
        "panelTitle.activeForeground": "#f8f8f2",
        "panelTitle.activeBorder": "#75715E",
        "panelTitle.inactiveForeground": "#75715E",
        "panel.border": "#414339",
        "settings.focusedRowBackground": "#4143395A",
        "titleBar.activeBackground": "#1e1f1c",
        "statusBar.background": "#414339",
        "statusBar.noFolderBackground": "#414339",
        "statusBar.debuggingBackground": "#75715E",
        "statusBarItem.remoteBackground": "#AC6218",
        "ports.iconRunningProcessForeground": "#ccccc7",
        "activityBar.background": "#272822",
        "activityBar.foreground": "#f8f8f2",
        "sideBar.background": "#1e1f1c",
        "sideBarSectionHeader.background": "#272822",
        "menu.background": "#1e1f1c",
        "menu.foreground": "#cccccc",
        "pickerGroup.foreground": "#75715E",
        "input.background": "#414339",
        "inputOption.activeBorder": "#75715E",
        "focusBorder": "#99947c",
        "editorWidget.background": "#1e1f1c",
        "debugToolBar.background": "#1e1f1c",
        "diffEditor.insertedTextBackground": "#4b661680",
        "diffEditor.removedTextBackground": "#90274A70",
        "inputValidation.errorBackground": "#90274A",
        "inputValidation.errorBorder": "#f92672",
        "inputValidation.warningBackground": "#848528",
        "inputValidation.warningBorder": "#e2e22e",
        "inputValidation.infoBackground": "#546190",
        "inputValidation.infoBorder": "#819aff",
        "editorHoverWidget.background": "#414339",
        "editorHoverWidget.border": "#75715E",
        "editorSuggestWidget.background": "#272822",
        "editorSuggestWidget.border": "#75715E",
        "editorGroup.border": "#34352f",
        "peekView.border": "#75715E",
        "peekViewEditor.background": "#272822",
        "peekViewResult.background": "#1e1f1c",
        "peekViewTitle.background": "#1e1f1c",
        "peekViewResult.selectionBackground": "#414339",
        "peekViewResult.matchHighlightBackground": "#75715E",
        "peekViewEditor.matchHighlightBackground": "#75715E",
        "terminal.ansiBlack": "#333333",
        "terminal.ansiRed": "#C4265E",
        "terminal.ansiGreen": "#86B42B",
        "terminal.ansiYellow": "#B3B42B",
        "terminal.ansiBlue": "#6A7EC8",
        "terminal.ansiMagenta": "#8C6BC8",
        "terminal.ansiCyan": "#56ADBC",
        "terminal.ansiWhite": "#e3e3dd",
        "terminal.ansiBrightBlack": "#666666",
        "terminal.ansiBrightRed": "#f92672",
        "terminal.ansiBrightGreen": "#A6E22E",
        "terminal.ansiBrightYellow": "#e2e22e",
        "terminal.ansiBrightBlue": "#819aff",
        "terminal.ansiBrightMagenta": "#AE81FF",
        "terminal.ansiBrightCyan": "#66D9EF",
        "terminal.ansiBrightWhite": "#f8f8f2"
    }
}
</file>

<file path="fronts/app/src/components/Explorer.vue">
<template>
  <div class="explorer-root">
    <div class="explorer-content">
      <div class="header">
        <div class="current-directory">
          <i class="fas fa-folder-open" aria-hidden="true"></i>
          <div class="current-path">{{currentPath}}</div>
        </div>
      </div>
      <div class="explorer-view">
        <ul>
          <li v-for="dir of directories" :key="dir.name" @click="ls(dir.absolutePath)">
            <i class="fas fa-arrow-left" v-if="dir.name === '..'"  aria-hidden="true"></i>
            <i class="fas fa-folder" v-else-if="!dir.npmInfos"  aria-hidden="true"></i>
            <i class="fab fa-npm" v-else  aria-hidden="true"></i>
            {{dir.name}}
          </li>
        </ul>
        <ul>
          <li v-for="file of files" :key="file.name" class="success" @click="$emit('file', file.absolutePath)">
            <i class="fas fa-cog" aria-hidden="true"></i>
            {{file.name}}
          </li>
        </ul>
      </div>
    </div>
  </div>
</template>

<script>
import { computed, onMounted, ref } from 'vue'
import fs from '../models/fs'
export default {
  name: 'explorer',
  props: {
  },
  setup() {
    /** @type {import('vue').Ref<import('../../../../servers/server/routes/fs').Entry[]>} */
    const dir = ref([])
    const currentPath = ref('')
    /** @param {string} path */
    const ls = async path => {
      currentPath.value = path
      dir.value = await fs.ls(path)
    }
    onMounted(async() => {
      const homeDir = await fs.homeDir()
      await ls(homeDir)
    })
    return {
      dir,
      ls,
      currentPath,
      directories: computed(() => dir.value.filter(entry => entry.isDirectory)),
      files: computed(() => dir.value.filter(entry => !entry.isDirectory && entry.isStack))
    }
  }
}
</script>

<style scoped lang="scss">
.explorer-root {
  display: flex;
  flex-direction: column;
  max-height: calc(100vh - 75px);
  overflow: auto;
  box-sizing: border-box;
  .explorer-content {
    height: calc(100vh - 300px);
    box-sizing: border-box;
    margin: 40px;
    overflow: auto;
    display: flex;
    flex-direction: column;
  }
  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    .current-directory {
      display: flex;
      align-items: center;
      flex-grow: 1;
    }
  }
  .explorer-view {
    overflow: auto;
    padding: 10px;
    ul {
      margin: 0;
      list-style-type: none;
      li {
        display: flex;
        align-items: center;
        padding: 5px;
        &.success {
          color: green;
        }
        &:hover {
          background-color: rgba(0,0,0,0.1);
          cursor: pointer;
        }
      }
    }
  }
  i {
    font-size: 1.3em;
    margin-right: 10px;
    margin-left: 10px;
  }
  .current-path {
    background-color: rgba(255,255,255,0.1);
    padding: 5px;
    width: 100%;
    border-radius: 3px;
    font-size: 1.3em;
  }
}
</style>
</file>

<file path="fronts/app/src/components/Multiselect.vue">
<template>
  <div class="root" :class="{ column, reorder }" @click.stop :style="{ width }">
    <div ref="input" class="input" :class="{ open: isOpen }" @click.stop="open()">
      <div v-if="!value.length && !isOpen" class="placeholder">
        {{ placeholder }}
      </div>
      <div v-if="!value.length && isOpen" class="placeholder">
        Choisir une entrée ci-dessous...
      </div>
      <spinner class="spinner" :size="20" v-if="opening"></spinner>
      <div class="labels">
        <div v-for="itemValue in value" :key="getKey(itemValue)" class="item-container" @dragstart="drag(itemValue)"
          @dragenter="drop(itemValue)" :draggable="reorder">
          <div class="label">
            {{ getLabel(itemValue) }}
          </div>
          <div class="delete" @click.stop="deleteTag(itemValue)">
            <i class="fas fa-trash"></i>
          </div>
        </div>
        <div class="random" v-if="random" @click.stop="selectRandom">
          <i class="fas fa-sync"></i>
        </div>
      </div>
    </div>
    <transition name="fade">
      <div class="container" v-if="isOpen">
        <div class="search-actions">
          <input type="text" ref="filterRef" placeholder="Rechercher..." @input="filter()"
            @keypress.enter="select($event.target.value)" />
          <button v-if="dynamic" class="add-button">
            <em class="fas fa-plus"></em>
          </button>
        </div>
        <div class="categories" v-if="categories && option.values && option.values.length">
          <div @click="changeCategory(option)" class="category" :class="{
              active:
                option.name === currentCateg.name && option.name !== undefined,
            }" v-for="option of options" :key="option.name">
            {{ option.name }}
          </div>
        </div>
        <div class="options-container">
          <div v-for="option in filteredOptions" :key="getKey(option)" class="item"
            :id="'multiselect-item-' + getLabel(option)" @click="select(option)">
            <span>{{ getLabel(option) }}</span>
            <span v-if="option.additionnal">{{ option.additionnal }}</span>
          </div>
        </div>
        <div class="count" v-if="filteredOptions && filteredOptions.length">
          {{ filteredOptions.length }} entrée
        </div>
      </div>
    </transition>
  </div>
</template>

<script>
import { some } from "lodash-es";
import Spinner from "./Spinner.vue";
import { ref, onMounted, nextTick, watch, getCurrentInstance } from 'vue';
export default {
  name: "multiselect",
  $_veeValidate: {
    // fetch the current value from the innerValue defined in the component data.
    value() {
      return this.value;
    },
    name() {
      return this.name;
    }
  },
  props: {
    options: { default: () => [] },
    value: { default: () => [] },
    initialValue: { default: () => [] },
    customLabel: { default: null },
    customKey: { default: null },
    width: { default: "auto" },
    single: { default: false },
    categories: { default: false },
    name: { default: 'name' },
    reorder: { default: false },
    placeholder: { default: "Cliquez pour choisir..." },
    max: { default: Infinity },
    dynamic: { default: false },
    column: { default: false },
    oninput: { default: () => { } },
    random: { default: false }
  },
  components: {
    spinner: Spinner,
  },
  setup(props, comp) {
    const instance = getCurrentInstance()?.proxy;
    const isOpen = ref(false)
    const filteredOptions = ref([])
    const currentCateg = ref(null)
    const count = ref(0)
    const opening = ref(false)
    const filterRef = ref(null)
    const localValue = ref(props.value)
    localValue.value.push(...props.initialValue)
    watch(() => props.value, () => localValue.value = props.value, { deep: true })
    function emit() {
      comp.emit('update:value', props.value)
      if (props.oninput) props.oninput(localValue.value)
    }
    const getLabel = (option) => {
      return currentCateg.value?.customLabel
        ? option[currentCateg.value.customLabel]
        : option[props.customLabel] || option
    }
    const getKey = (option) => {
      return currentCateg.value?.customKey
        ? option[currentCateg.value.customKey]
        : option[props.customKey] || option
    }
    const filter = () => {
      const value = filterRef.value?.value
        ? filterRef.value.value.toUpperCase()
        : ''
      let options = props.options
      if (props.categories && currentCateg.value) {
        options = props.options
          .filter((opt) => opt.name === currentCateg.value.name)
          .pop().values
      }
      filteredOptions.value = options.filter((option) => {
        // @ts-ignore
        if (some(props.value, option) || props.value.includes(option)) {
          return false
        }
        const label = getLabel(option)
        const key = getKey(option)
        return (
          (label && typeof label === 'string' && label.toUpperCase().includes(value)) ||
          (key && typeof key === 'string' && key.toUpperCase().includes(value))
        )
      })
    }
    onMounted(() => {
      filteredOptions.value = props.options
      if (props.categories) {
        currentCateg.value = props.options[0]
      }
      filter()
    })
    const select = value => {
      if (localValue.value.length >= props.max) return
      const index = filteredOptions.value.indexOf(value)
      let valueToPush
      if (index !== -1) {
        filteredOptions.value.splice(index, 1)
        valueToPush = value
      } else if (props.dynamic && !localValue.value.includes(value)) {
        valueToPush = value
      }
      if (props.single) {
        localValue.value.pop()
        isOpen.value = false
      }
      if (valueToPush) {
        localValue.value.push(valueToPush)
        if (filterRef.value) {
          filterRef.value.value = ''
          filter()
        }
        filter()
        instance.$forceUpdate()
      }
      emit()
    }
    const selectRandom = () => {
      const random = filteredOptions.value[Math.floor(Math.random() * filteredOptions.value.length)]
      select(random)
    }
    let currentDrag = null
    return {
      isOpen,
      filteredOptions,
      currentCateg,
      count,
      opening,
      filterRef,
      getKey,
      getLabel,
      filter,
      selectRandom,
      drag(item) {
        currentDrag = item
      },
      drop(destination) {
        const indexDestination = localValue.value.indexOf(destination)
        const indexSource = props.value.indexOf(currentDrag)
        if (indexDestination > -1 && indexSource > -1 && destination !== currentDrag) {
          const temp = localValue.value[indexSource];
          localValue.value[indexSource] = localValue.value[indexDestination];
          localValue.value[indexDestination] = temp;
        }
        emit()
      },
      changeCategory(category) {
        currentCateg.value = category
        filter()
      },
      async open() {
        opening.value = true
        await nextTick()
        isOpen.value = true
        filter()
        await nextTick()
        await nextTick()
        if (filterRef.value) {
          filterRef.value.focus()
        }
        const cb = () => {
          isOpen.value = false
          document.removeEventListener("click", cb)
        }
        document.addEventListener("click", cb, false)
        opening.value = false
      },
      select,
      deleteTag(value) {
        const index = props.value.indexOf(value)
        localValue.value.splice(index, 1)
        filteredOptions.value.push(value)
        filter()
        instance.$forceUpdate()
        emit()
      },
    };
  },
};
</script>
<style scoped lang="scss" >
.input {
  background-color: #fff;
  width: auto;
  cursor: pointer;
  min-height: 30px;
  border: 1px solid lightgrey;
  padding: 5px 10px;
  position: relative;
  border-radius: 15px;
  display: flex;
  align-items: center;
  transition: 300ms;

  &.open {
    border-bottom-left-radius: 0;
    border-bottom-right-radius: 0;
  }

  .spinner {
    position: absolute;
    top: -10px;
    right: -10px;
    height: 100%;
  }

  .placeholder {
    color: #a1a1a1;
    padding-top: 4px;
  }

  .random {
    position: absolute;
    top: 50%;
    transform: translateY(-45%);
    right: 10px;
    font-size: 1.4em;
  }

  .item-container {
    border: 1px solid lightgrey;
    display: inline-block;
    border-radius: 15px;
    overflow: hidden;
    $gradient: 50deg, #1d95db 0%, #074971 100%;
    background: -webkit-linear-gradient($gradient);
    background: linear-gradient($gradient);
    max-width: 100%;
    padding: 5px;
    box-sizing: border-box;
    position: relative;
    opacity: 1;
    transition: 200ms;
    transition-property: opacity, transform;

    &>div {
      color: white;
      // height 1.2em
      padding: 5px;
      text-overflow: ellipsis;
      overflow: hidden;
      white-space: nowrap;
      opacity: 1;
    }

    .delete {
      transition: 200ms;
      transition-property: opacity;
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      box-sizing: border-box;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      opacity: 0;
      color: white;
    }

    &:hover {
      transform: scale(1.05);

      .delete {
        background-color: rgba(0, 0, 0, 0.3);
        opacity: 1;
      }

      &>div {
        opacity: 0;
      }
    }
  }
}

.container {
  width: 100%;
  position: absolute;
  z-index: 1;
  max-height: 300px;
  opacity: 1;
  overflow: hidden;
  box-sizing: border-box;
  background-color: #fff;
  border: 1px solid lightgrey;
  border-top: none;
  display: flex;
  flex-direction: column;
  border-bottom-left-radius: 15px;
  border-bottom-right-radius: 15px;

  .search-actions {
    width: auto;
    margin: 10px;
    margin-bottom: 10px;
    display: flex;

    input {
      flex-grow: 1;
    }

    .add-button {
      width: 20px;
      padding: 0;
      background-color: transparent;
      border-color: transparent;
      color: #717171;
    }
  }

  .categories {
    display: flex;
    align-items: flex-end;
    padding-left: 10px;
    border-bottom: 1px solid #c8c8c8;
    flex-shrink: 0;

    &>div {
      padding-left: 10px;
      padding-right: 10px;
      padding-top: 2px;
      padding-bottom: 2px;
      bottom: -1px;
      position: relative;
      font-size: 0.9em;
      cursor: pointer;
      color: #777;

      &:hover {
        color: black;
      }

      &.active {
        border-top: 1px solid #c8c8c8;
        border-left: 1px solid #c8c8c8;
        border-right: 1px solid #c8c8c8;
        border-top-left-radius: 4px;
        border-top-right-radius: 4px;
        background-color: white;
        color: black;
      }
    }
  }

  .item {
    cursor: pointer;
    padding: 7px;
    padding-left: 10px;
    padding-right: 10px;
    font-size: 0.9em;
    display: flex;
    justify-content: space-between;

    &:hover,
    &.selected {
      background-color: rgba(0, 0, 0, 0.1);
    }
  }

  .options-container {
    overflow-y: auto;
    overflow-x: hidden;
    background-color: #fff;
  }
}

.count {
  display: flex;
  justify-content: flex-end;
  flex-shrink: 0;
  border-top: 1px solid #c8c8c8;
  color: #717171;
  padding-right: 5px;
  font-size: 0.7em;
}

.root {
  position: relative;

  &.column {
    .labels {
      flex-direction: column;
    }
  }

  .labels {
    flex-wrap: wrap;
    display: flex;
  }

  &.reorder {
    .labels {
      .label {
        opacity: 1;
      }

      .delete {
        width: 50px;
        right: 0;
        left: auto;
      }
    }
  }
}

.fade-enter-active,
.fade-leave-active {
  transition: max-height 0.2s, opacity 0.2s;
}

.fade-enter,
.fade-leave-to {
  max-height: 0;
  opacity: 0;
}
</style>
</file>

<file path="fronts/app/src/components/NotificationBell.vue">
<template>
  <div class="notification-bell-root" @click="open">
    <i class="fas fa-bell" aria-hidden="true"></i>
  </div>
</template>

<script setup>
import notification from '../helpers/notification'
const open = () => notification.openHistory.next()
</script>

<style lang="scss" scoped>
.notification-bell-root {
  font-size: 1.4em;
  margin-bottom: 10px;
  margin-right: 5px;
  cursor: pointer;
  transition: 300ms;
  &:hover {
    transform: scale(1.1);
  }
}
</style>
</file>

<file path="fronts/app/src/components/SectionsContainer.vue">
<template>
  <div class="sections-container-root">
    <div class="header" @click="isOpen = !isOpen; $emit('is-open', isOpen)">
      <h2>{{header}}</h2>
      <div>
        <i class="fas fa-chevron-down" aria-hidden="true"></i>
      </div>
    </div>
    <transition name="appear">
      <div v-if="isOpen" class="body">
        <slot></slot>
      </div>
    </transition>
  </div>
</template>

<script setup>
import { ref } from 'vue'

const props = defineProps({
  header: {default: ''},
  defaultIsOpen: {default: false}
})

const isOpen = ref(props.defaultIsOpen)
</script>

<style lang="scss" scoped>
.sections-container-root {
  display: flex;
  flex-direction: column;
  h2 {
    margin: 0;
  }
  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 10px;
    &:hover {
      background-color: rgba(0,0,0,0.05);
    }
  }
}
.body {
  max-height: 1000px;
  overflow: hidden;
}
.appear-enter-active, .appear-leave-active {
  transition: 0.3s;
}
.appear-enter, .appear-leave-to /* .appear-leave-active below version 2.1.8 */ {
  max-height: 0;
}
</style>
</file>

<file path="fronts/app/src/components/sidebarGroup.vue">
<template>
    <div :class="{open: _open}">
        <div class="header" @click="toggle">
            <i class="fas fa-chevron-right"></i>
            <h3 class="title">{{ header }}</h3>
        </div>
        <transition name="fade-sidebar">
        <div v-if="_open" class="slot-container" ref="slotRef">

            <slot ></slot>
        </div>
        </transition>
    </div>
</template>

<script setup>
import {ref, watch, nextTick } from 'vue'
const props = defineProps({
    header: { default: '' },
    open: { default: false },
})
const emit = defineEmits(['open', 'close'])
const _open = ref(props.open)
const slotRef = ref()
watch(() => props.open,async () => {
    _open.value = props.open
    await nextTick()
    if(slotRef.value) {
        slotRef.value.style.maxHeight = `${slotRef.value.scrollHeight}px`
    }
})

function toggle() {
    _open.value = !_open.value
    if(_open.value) emit('open')
    else emit('close')
}

</script>

<style lang="scss" scoped>
.header {
    padding: 0 10px;
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    transition: 300ms;
    &:hover {
        background-color: rgba(0,0,0,0.05);
    }
    .title {
        margin: 0;
    }
    i {
        transition: 300ms;
    }
}
.open {
    i {
        transform: rotate(90deg);
    }
}

.slot-container {
    max-height: 1000vh;
    opacity: 1;
    transform-origin: top;
}
/* we will explain what these classes do next! */
.fade-sidebar-enter-active,
.fade-sidebar-leave-active {
    transition: 300ms;
}

.fade-sidebar-enter-from,
.fade-sidebar-leave-to {
    transform: scaleY(0);
    max-height: 0 !important;
    opacity: 0;
}
</style>
</file>

<file path="fronts/app/src/components/Spinner.vue">
<template>
  <div
    class="spinner"
    :class="{noColor}"
    v-if="display"
    :style="{
      width: size + 'px',
      height: size + 'px',
    }"
  ></div>
</template>

<script setup>
defineProps({
  display: {
    type: Boolean,
    default: true,
  },
  size: {
    default: "70",
  },
  noColor: {
    type: Boolean,
    default: false,
  },
})
</script>
<style lang="scss">
.spinner {
  animation-name: spin !important;
  animation-duration: 0.8s !important;
  animation-fill-mode: forwards !important;
  animation-iteration-count: infinite !important;
  &::before {
    animation-name: pulse !important;
    animation-duration: 0.8s !important;
    animation-fill-mode: forwards !important;
    animation-iteration-count: infinite !important;
  }
}

@keyframes spin {
  0% {
    transform: rotateZ(360deg);
  }

  100% {
    transform: rotateZ(0deg);
  }
}

@keyframes pulse {
  0% {
    width: 0%;
    height: 0%;
    opacity: 1;
  }

  100% {
    width: 100%;
    height: 100%;
    opacity: 0;
  }
}
</style>
<style scoped lang="scss">
.spinner {
  border: 3px solid var(--system-accent-backgroundColor1);
  width: 70px;
  height: 70px;
  box-sizing: border-box;
  border-radius: 100%;
  border-bottom-color: transparent;
  animation-name: spin;
  animation-duration: 0.8s;
  animation-fill-mode: forwards;
  animation-iteration-count: infinite;
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  transform: translateZ(0);
  flex-shrink: 0;
  &::before {
    content: " ";
    animation-name: pulse;
    animation-duration: 0.8s;
    animation-fill-mode: forwards;
    animation-iteration-count: infinite;
    background-color: var(--system-accent-backgroundColor1);
    position: absolute;
    border-radius: 100%;
  }

  &::after {
    content: " ";
    width: 30%;
    height: 30%;
    background-color: var(--system-accent-backgroundColor1);
    position: absolute;
    border-radius: 100%;
  }

  &.noColor {
    border-color: white;
    border-bottom-color: transparent;
    &::before, &::after {
      background-color: white;
    }
  }
}

@keyframes spin {
  0% {
    transform: rotateZ(360deg);
  }

  100% {
    transform: rotateZ(0deg);
  }
}

@keyframes pulse {
  0% {
    width: 0%;
    height: 0%;
    opacity: 1;
  }

  100% {
    width: 100%;
    height: 100%;
    opacity: 0;
  }
}
</style>
</file>

<file path="fronts/app/src/components/TableGenericToolBar.vue">
<template>
  <div class="toolbar">
    <h2 v-if="headerSize == 'h2'">
      <span v-if="!$slots.headerTitle">{{headerTitle}}</span>
      <slot v-else name="headerTitle"></slot>
      <span class="row-count" v-if="rowCount > 0">{{rowCount}}</span>
    </h2>
    <h3 v-else>
      {{headerTitle}}
    </h3>
    <div class="actions">
      <div class="input-container" v-if="filterActive">
        <label for="search" class="icon"><i class="fas fa-search"></i></label>
        <input type="text" id="search" class="search" placeholder="Rechercher..." @input="updateList" :value="filterValue">
      </div>
      <slot/>
    </div>
  </div>
</template>

<script>
import debounce from 'debounce';

export default {
  props: {
    headerTitle: {default: 'Ma table', type: String},
    headerSize: {default: 'h2', type: String},
    rowCount: {default: 0, type:Number},
    filterActive: {default: false, type: Boolean},
    filterValue: {default: '', type: String},
  },
  setup(props, comp) {
    const updateList = debounce(async ($event) => {
      if ($event.target.value.length > 2) {
        comp.emit('update:filterValue', $event.target.value)
      } else {
        comp.emit('update:filterValue', '')
      }
    }, 400, null)
    return {
      updateList,
    }
  }
}
</script>

<style scoped lang="scss">
.toolbar {
  display: flex;
  justify-content: space-between;
  flex-wrap: wrap;
  align-items: center;
  margin: auto;
  margin-bottom: 20px;
  h2, h3 {
    margin: auto;
    flex-grow: 1;
    width: max-content;
  }
  .actions {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center;
    gap: 10px;
    &>* {
      margin-left: 10px;
      &:first-child {
        margin-left: 0;
      }
    }
  }
}
span.row-count {
  margin-left:15px;
  font-weight: normal;
  color:#757575;
}
</style>
</file>

<file path="fronts/app/src/helpers/config.js">
// @ts-ignore
const port = import.meta.env?.VITE_HTTP_PORT;
const baseURL = port ? `http://localhost:${port}` : '/';

export default {
  port,
  baseURL,
};
</file>

<file path="fronts/app/src/helpers/CustomObservable.js">
function CustomObservable() {
  /** @type {GenericFunction[]} */
  this.funcs = [];
}
/** @param {GenericFunction} fun */
CustomObservable.prototype.subscribe = function (fun) {
  this.funcs.push(fun);
  return {
    unsubscribe: () => this.unsubscribe(fun),
  };
};

/** @param {any[]} value */
CustomObservable.prototype.next = function (...value) {
  this.funcs.forEach((f) => f(...value));
};

/** @param {GenericFunction} fun */
CustomObservable.prototype.unsubscribe = function (fun) {
  this.funcs = [...this.funcs.filter((f) => f !== fun)];
};

export default CustomObservable;

/**
 * @typedef {(...args: any[]) => any} GenericFunction
 */
</file>

<file path="fronts/app/src/helpers/githubIssue.js">
import newGithubIssueUrl from "new-github-issue-url";

export default newGithubIssueUrl({
  user: 'runeya',
  repo: 'runeya',
  body: `
## Issue

### Plateform
\`\`\`<Windows10, Archlinux, MacOS...>\`\`\`

### Configuration file
\`\`\` javascript
<upload your configuration file but without sensitive infos>
\`\`\`

### Description
\\<Which part of this application bug...>


### Reproduction 
\\<Step to bug...>

        `
});
</file>

<file path="fronts/app/src/typings/global.d.ts">
declare module "*.png" {
  const value: string;
  export default value;
}
declare module "*.svg" {
  const value: string;
  export default value;
}
declare module "*.vue" {
  const value: import('vue').Component;
  export default value;
}
</file>

<file path="fronts/app/src/views/ImportCreate.vue">
<template>
<div class="import-export-root">
  <background-stack-chooser :low-resources="true"/>
  <left-logo/>
  <div class="import-export-container">
    <section-cmp header="Choose configuration" class="section-recent" :actions="[{label: 'Import',  icon: 'fas fa-download', click: () => openModal()}]">
      <div v-for="recent of recents" :key="recent" @click="openPath(recent)" class="recent">
        <i class="fas fa-times" aria-hidden="true" @click.stop="deleteConf(recent)"></i>
        {{recent}}
      </div>
    </section-cmp>
  </div>

  <div class="version">
    {{ System.version.value }}
  </div>
  <div class="tools" @click="$router.push({ name: 'Toolbox' })">
    <i class="fas fa-toolbox"></i>
  </div>
  <modal ref="modalRef" :noActions="true">
    <template #body>
      <explorer @file="openPath"/>
    </template>
  </modal>
</div>
</template>

<script>
import BackgroundStackChooser from '../components/BackgroundStackChooser.vue'
import Section from '../components/Section.vue'
import { onMounted, ref } from 'vue'
import Stack from '../models/stack'
import Modal from '../components/Modal.vue'
import Explorer from '../components/Explorer.vue'
import LeftLogo from '../components/LeftLogo.vue'
import System from '../models/system'
import { useRouter } from 'vue-router';

export default {
  name: 'StackChooser',
  components: {
    BackgroundStackChooser,
    SectionCmp: Section,
    Modal,
    Explorer,
    LeftLogo
  },
  setup() {
    const router = useRouter(); 
    const recents = ref([])
    onMounted(async () => {
      recents.value = await Stack.getAllConfsPath()
    })

    /** @type {import('vue').Ref<InstanceType<typeof Modal> | null>} */
    const modalRef = ref(null)
    return {
      modalRef,
      recents,
      System,
      /** @param {string} path */
      async deleteConf(path) {
        await Stack.deleteConf(path)
        recents.value = await Stack.getAllConfsPath()
      },
      openModal() {
        modalRef.value?.open().subscribe((res) => {
          if(!res) return 
        })
      },
      /** @param {string} recent */
      async openPath(recent) {
        await Stack.selectConf(recent)
        setTimeout(() => {
          router.push({name: 'stack-chooser'})
        }, 100);
      },
    }
  }
}
</script>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style scoped lang="scss">
.import-export-root {
  position: relative;
  width: 100vw;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: row;
  .import-export-container {
    display: flex;
    flex-direction: row;
    flex-grow: 2;
    flex-basis: 0;
    flex-shrink: 0;
    .section-recent {
      box-shadow: none;
      box-shadow: 0px 0px 12px 0px #000000;
      width: calc(100% - 50px);
      max-width: 600px;
      margin: auto;
      .recent {
        margin: 5px 0;
      }
      .recent:hover {
        transition: 300ms;
        background-color: rgba(0,0,0,0.05);
        cursor: pointer;

      }
    }
  }
}

  .version {
    background-color: rgb(255, 255, 255);
    border-radius: 4px;
    padding: 0px 5px;
    border: 1px solid darkgrey;
    position: fixed;
    bottom: 40px;
    right: 40px;
  }
  .tools {
    background-color: rgb(255, 255, 255);
    border-radius: 4px;
    padding: 0px 5px;
    border: 1px solid darkgrey;
    position: fixed;
    bottom: 40px;
    left: 40px;
  }
</style>
</file>

<file path="fronts/app/.gitignore">
dist
</file>

<file path="fronts/app/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="fronts/app/babel.config.js">
module.exports = {
  presets: [
    '@vue/cli-plugin-babel/preset',
  ],
};
</file>

<file path="fronts/app/index.html">
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <link rel="icon" href="/favicon.ico">
  <title>runeya</title>
  <link rel="stylesheet" href="./src/assets/fonts/Jost/Jost.css">
  <style>
    body {
      margin: 0;
      font-family: Jost, sans-serif;
      font-size: 0.9em;
      background-color: #eee;
    }

    .pre-loading {
      width: 100vw;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(10px);
      color: #0076bc;
      background-color: rgba(255,255,255,0.5);
    }

    .spinner {
      border: 3px solid #0076bc;
      width: 70px;
      height: 70px;
      box-sizing: border-box;
      border-radius: 100%;
      border-bottom-color: transparent;
      animation-name: spin;
      animation-duration: 0.8s;
      animation-fill-mode: forwards;
      animation-iteration-count: infinite;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      transform: translateZ(0);
      flex-shrink: 0;

    }
    .spinner::before {
      content: " ";
      animation-name: pulse;
      animation-duration: 0.8s;
      animation-fill-mode: forwards;
      animation-iteration-count: infinite;
      background-color: #0076bc;
      position: absolute;
      border-radius: 100%;
    }

    .spinner::after {
      content: " ";
      width: 30%;
      height: 30%;
      background-color: #0076bc;
      position: absolute;
      border-radius: 100%;
    }

    @keyframes spin {
      0% {
        transform: rotateZ(360deg);
      }

      100% {
        transform: rotateZ(0deg);
      }
    }

    @keyframes pulse {
      0% {
        width: 0%;
        height: 0%;
        opacity: 1;
      }

      100% {
        width: 100%;
        height: 100%;
        opacity: 0;
      }
    }
  </style>
</head>

<body>
  <noscript>
    <strong>We're sorry but runeya doesn't work properly without JavaScript enabled. Please enable it to
      continue.</strong>
  </noscript>
  <div id="app">
    <div class="pre-loading">
      <div
        class="spinner"
        v-if="display"
        :style="{
          width: size + 'px',
          height: size + 'px',
        }"
      ></div>
      Loading...
    </div>
  </div>
  <script type="module" src="/src/main.js"></script>
</body>

</html>
</file>

<file path="fronts/app/LICENSE">
MIT License

Copyright (c) 2020 Corentin Labroche

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
</file>

<file path="fronts/app/README.md">
# Runeya

[![DeepScan grade](https://deepscan.io/api/teams/10201/projects/12903/branches/207230/badge/grade.svg)](https://deepscan.io/dashboard#view=project&tid=10201&pid=12903&bid=207230)

[![Quality Gate Status](https://sonarcloud.io/api/project_badges/measure?project=runeya_runeya&metric=alert_status)](https://sonarcloud.io/dashboard?id=runeya_runeya)
[![Code Smells](https://sonarcloud.io/api/project_badges/measure?project=runeya_runeya&metric=code_smells)](https://sonarcloud.io/dashboard?id=runeya_runeya)
[![Bugs](https://sonarcloud.io/api/project_badges/measure?project=runeya_runeya&metric=bugs)](https://sonarcloud.io/dashboard?id=runeya_runeya)
[![Technical Debt](https://sonarcloud.io/api/project_badges/measure?project=runeya_runeya&metric=sqale_index)](https://sonarcloud.io/dashboard?id=runeya_runeya)

Launch multiples command at once. You can monitor projects.(like npm projects, git projects ...)

## Install
``` npm i -g @runeya/runeya ```

## Features
#### Command:
 - Launch multiple commands at once
 - Check in realtime logs produced by command
 - Restart process

#### Git
 - Stash / Stash pop
 - Pull if there is update in branch
 - View branches
 - Change branch
 - Reset branch 
 - Checkout file
 
#### Npm
 - Launch a script
 - Install 
 - Rebuild
 - Log of script in real time
 - Show all dependencies
 - Check if update exist for each dependency

#### Bugs
 - Check problems with typescript

#### Misc
 - Open folder in vscode
 - Open folder in explorer
 - Open Url for micro service
 - Open remote url of git

#### System
 - Show CPU percentage for global system
 - Show Mem percentage for global system
 - Show CPU percentage for each commands
 - Show Mem percentage for each commands

## Usage
Create a config file

Then, in a terminal, type:
``` bash
runeya <path/to/my/config>
```

You can type only ```runeya``` and choose your config file later.

If you change a variable in conf after execution, the corresponding service restart.

## Snippet

Add this in your vscode to print easily variables in debug output of service:
``` json
	"Print to runeya": {
		"prefix": "log",
		"body": [
			"console.log(JSON.stringify(['runeya', $1]));",
			"$2"
		],
		"description": "Print to runeya"
	}
```
Type ```log``` in vs code, it should produce something like that:
``` javascript 
console.log(JSON.stringify(['runeya', <what you want>, <and others>]));
```

Example:

if you type this somewhere in server service: 

```javascript
console.log(JSON.stringify(['runeya', "debug:", {port} ]));
```

Output should appeart in debug section of logs
</file>

<file path="fronts/docs/.vitepress/theme/custom.css">
:root {
  --vp-c-brand: #0076bc;
  --vp-c-brand-light: #0076bc;
}

/**
 * Colors Base
 *
 * These are the pure base color presets. Most of the time, you should not be
 * using these colors directly in the theme but rather use "Colors Theme"
 * instead because those are "Theme (light or dark)" dependant.
 * -------------------------------------------------------------------------- */

:root {

  --vp-c-green: #0076bc;
  --vp-c-green-light: #247eb3;
  --vp-c-green-lighter: #3d8ebd;
  --vp-c-green-dark: #035d91;
  --vp-c-green-darker: #004166;
}
</file>

<file path="fronts/docs/.vitepress/theme/index.js">
import DefaultTheme from 'vitepress/theme'
import './custom.css'

export default DefaultTheme
</file>

<file path="fronts/docs/introduction/what-is.md">
---
outline: deep
---
# What is Runeya?

Runeya is an application for developers to simplify the launch of services and provide tools to manage them.

<div class="tip custom-block" style="padding-top: 8px">

Just want to try it out? Skip to the [Quickstart](/introduction/getting-started).

</div>


## Features
### Command
 - Launch multiple commands at once
 - Check in realtime logs produced by command
 - Parse and explore logs in inline json format
 - Start/Stop/Restart services

### Git
 - Stash / Stash pop
 - Pull if there is update in branch
 - View branches
 - Change branch
 - Reset branch 
 - Checkout file
 
### Npm
 - Launch a script
 - Install 
 - Rebuild
 - Log of script in real time
 - Show all dependencies
 - Check if update exist for each dependency

### Bugs
 - Check problems with typescript

### Documentation
 - Add documentation for each services with markdown format

### Misc
 - Open folder in vscode
 - Open folder in explorer
 - Open Url for micro service
 - Open remote url of git

### ToolBox
 - Difference: show differences between two text
 - JSON: check if json is valid and explore it
 - JWT: Explore informations from Json WebToken
 - Mongo: Parse or create ObjectId
 - Node Sandbox: Test simple node script
 - Open ai: Ask something to chatGPT
 - Regex: Test your regexp
 - UUID: Generate random UUIDs

### Scripts
 - Create your own scripted pipeline to make anything you want

### System
 - Show CPU/Mem percentage for global system
 - Show CPU/Mem percentage for each commands
</file>

<file path="fronts/docs/.gitignore">
.vitepress/dist
.vitepress/cache
</file>

<file path="fronts/docs/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="fronts/docs/index.md">
---
layout: home

hero:
  name: "Runeya"
  text: ""
  tagline: Configure, share, launch and monitor all yours services in the same place for your development team
  image:
    src: /rocket.png
    alt: VitePress
  actions:
    - theme: brand
      text: Get started (Documentation under construction)
      link: /introduction/getting-started
    - theme: alt
      text: View on GitHub
      link: https://github.com/runeya/runeya

features:
  - title: Configure
    details: Agnostic language platform. Just define all your services with all your environments and launch them. If they are launchable from commandline, they are compatible with Runeya
  - title: Share
    details: Version your environments config files to let different members of your teams to fetch them and launch services in seconds
  - title: Monitor
    details: You can retrieve different feedbacks from your services like git informations, npm informations, launch scripts, change with a simple dropdown all your environments variables, and more...
---
</file>

<file path="modules/bugs/backend/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/bugs/backend/defaultJsConfig.json">
{
  "compilerOptions": {
    "target": "es2017",
    "checkJs": true,
    "moduleResolution": "node",
    "esModuleInterop": true,
    "lib": ["es6"],
    "baseUrl": "./"
  },
  "exclude": ["node_modules", "dist"],
  "include": ["./src/**/*", "tests/**/*", "./typings"]
}
</file>

<file path="modules/bugs/front/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/configuration/backend/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/configuration/front/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/dev-ops/backend/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/dev-ops/front/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/diff/backend/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/diff/backend/routes.js">
const express = require('express');

const router = express.Router();
const { v4 } = require('uuid');

module.exports = () => {
  router.get('/diff', async (req, res) => {
    res.json(v4());
  });
  return router;
};
</file>

<file path="modules/diff/front/src/Index.vue">
<template>
  <div class="diff-root">
    <h1>Differences</h1>
    <section-cmp>
      <Editor style="height: calc(100vh - 200px)"
        :diff="true"
      />
    </section-cmp>
  </div>
</template>

<script setup>
import SectionCmp from '../../../../fronts/app/src/components/Section.vue';
</script>

<style scoped lang="scss">
.diff-root,.section-content {
  display: flex;
  flex-direction: column;
  width: 100%;
}
</style>
</file>

<file path="modules/diff/front/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/documentation/backend/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/documentation/front/src/Tree.vue">
<template>
  <div class="root">
    <div v-for="leaf of tree" :key="leaf.name">
      <Leaf
        @go="$emit('go', $event)"
        :leaf="leaf"
        :activeLeaf="activeLeaf"
      />
    </div>
  </div>
</template>

<script setup>
import Leaf from './Leaf.vue';

defineEmits([
  'go',
]);

defineProps({
  tree: {
    required: true,
    /** @type {import('./Index.vue').Leaf[]} */
    // @ts-ignore
    default: () => ([]),
  },
  activeLeaf: {
    /** @type {import('./Index.vue').Leaf | null | undefined} */
    default: undefined,
  },
});
</script>

<style lang="scss" scoped>
.root {
  display: flex;
  flex-direction: column;
}
</style>
</file>

<file path="modules/documentation/front/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/finder/backend/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/finder/backend/routes.js">
const express = require('express');

const router = express.Router();
const PromiseB = require('bluebird');

/**
 *
 * @param {import('@runeya/modules-plugins-loader-front/src/views').PluginSM<any>} plugin
 */
function pluginToUrl(plugin) {
  for (let i = 0; i < plugin.placements.length; i += 1) {
    const placement = plugin.placements[i];
    if (typeof placement !== 'string') {
      if (placement.position === 'toolbox') {
        // @ts-ignore
        return `/toolbox${placement.goTo?.path || placement.goTo}`;
      }
      if (placement.position === 'sidebar') {
        // @ts-ignore
        return `${placement.goTo?.path || placement.goTo}`;
      }
    }
  }
  return '';
}

/** @param {import('@runeya/common-typings').Runeya} runeya */
const routes = (runeya) => {
  const {
    getServices,
    helpers: { searchString },
  } = runeya;
  router.get('/finder/search', async (req, res) => {
    const search = req.query.q?.toString()?.toUpperCase() || '';
    /** @type {FinderChoice[]} */
    const services = getServices()
      .filter((service) => searchString(service?.label, search))
      .map((service) => ({
        title: service.label,
        description: service.description,
        group: 'Service',
        url: `/stack-single/${service.label}`,
      }));

    const { plugins } = runeya;
    const _plugins = (await PromiseB
      .map(Object.keys(plugins), (/** @type {keyof typeof plugins} */key) => plugins[key])
      .map(async (plugin) => [
        ...(await plugin?.finder?.(search, runeya)?.catch?.(() => ([])) || []),
        ...(searchString(plugin.name, search) ? [{
          title: plugin.displayName || plugin.name,
          description: plugin.description,
          group: 'Plugin',
          icon: plugin.icon,
          url: pluginToUrl(plugin) || '',
        }] : []),
      ]))
      .flat()
      .filter((a) => a?.url);

    /** @type {FinderChoice[]} */
    const result = [
      ...services,
      ..._plugins,
    ].filter((a) => a);
    res.send(result);
  });
  return router;
};

module.exports = routes;

/**
 * @typedef {{
 *  icon?: string,
 *  title: string,
 *  group?: string,
 *  description?: string,
 *  secondaryTitle?: string
 *  secondaryDescription?: string,
 *  url: import('vue-router').RouteLocationRaw | string,
 * }} FinderChoice
 */
</file>

<file path="modules/finder/front/src/Index.vue">
<template>
  <div class="finder-root" v-show="show" @click="show = false" :class="{isComponent}">
    <div class="hint" v-if="isComponent">
      Press Ctrl+Alt+P To open it anywhere
    </div>
    <div class="finder-container" @click.stop="">
      <input type="text" autofocus v-model="search"
        placeholder="Type to find something..." ref="inputRef" @keyup="keyup">
      <div class="groups">
        <SectionCmp class="group" v-for="group of displayedGroups" :key="`${group}`">
          <h2>{{ group.label }}</h2>
          <div class="choices">
            <div class="choice" v-for="choice of group.choices" :key="`${choice}`"
              :class="{active: choice.active}" @click.stop="validate(choice)">
              <div class="left">
                <div class="icon">
                  <i :class="choice.icon || 'fas fa-cog'"></i>
                </div>
                <div>
                  <div class="title">
                    {{ choice.title }}
                  </div>
                  <div class="description">
                    {{ choice.description }}
                  </div>
                </div>
              </div>
              <div class="right">
                <div class="title">
                  {{ choice.secondaryTitle }}
                </div>
                <div class="description">
                  {{ choice.secondaryDescription }}
                </div>
              </div>
            </div>
            <div class="choice" @click.stop="">
              <div class="left">
                <div v-if="group.otherChoices?.length">
                  <div class="title">And {{group.otherChoices.length}} others...</div>
                  <div class="description">
                    {{ group
                      .otherChoices
                      .map(a => a.title)
                      .slice(0, 20)
                      .map(a => a.slice(0, 40) + '...')
                      .join(', ')
                    }} ...
                  </div>
                </div>
              </div>
            </div>
          </div>
        </SectionCmp>
      </div>
    </div>
  </div>
</template>

<script setup>
import {
  computed, nextTick, onBeforeUnmount, onMounted, ref, watch,
} from 'vue';
import debounce from 'debounce';
import { useRouter } from 'vue-router';
import axios from '../../../../fronts/app/src/helpers/axios';
import SectionCmp from '../../../../fronts/app/src/components/Section.vue';

const router = useRouter();

/** @param {KeyboardEvent} e */
const listener = async (e) => {
  if (e.ctrlKey && e.altKey && e.code === 'KeyP') {
    e.preventDefault();
    show.value = !show.value;
    search.value = '';
    await nextTick();
    inputRef.value.focus();
  }
  if (e.code === 'Escape') {
    e.preventDefault();
    show.value = false;
  }
};

window.addEventListener('keyup', listener);
onBeforeUnmount(() => window.removeEventListener('keyup', listener));

/** @type {import('vue').Ref<Record<string, {label: string, otherChoices: FinderChoice[], choices: FinderChoice[]}>>} */
const groups = ref({});
const search = ref('');
const inputRef = ref();
const show = ref(false);

const isComponent = computed(() => router.currentRoute.value.path.includes('/Finder'));

watch(() => show.value, () => {
  if (isComponent.value) show.value = true;
}, { immediate: true });

const displayedGroups = computed(() => Object.keys(groups.value).map((key) => {
  const group = groups.value[key];
  return {
    label: group.label,
    choices: group.choices?.slice(0, 4),
    otherChoices: group.choices?.slice(4, group.choices?.length),
  };
}));

async function reload() {
  const { data: _choices } = await axios.get('/finder/search', { params: { q: search.value } });
  /** @type {Record<string, {label: string, otherChoices: FinderChoice[], choices: FinderChoice[]}>} */
  const res = {};
  if (_choices[0]) _choices[0].active = true;
  _choices.map((/** @type {FinderChoice} */ choice) => {
    if (!choice.group) choice.group = 'Others';
    if (!res[choice.group]) res[choice.group] = { label: choice.group, choices: [], otherChoices: [] };
    res[choice.group].choices.push(choice);
    return null;
  });
  groups.value = res;
}
onMounted(reload);
watch(() => search.value, debounce(reload, 200));

/** @param {FinderChoice | undefined} choice */
function validate(choice) {
  if (choice?.url) {
    router.push(choice.url);
    show.value = false;
  }
}

/** @param {KeyboardEvent} $event */
async function keyup($event) {
  const choices = displayedGroups.value.flatMap((group) => group.choices);
  if (['ArrowUp', 'ArrowDown'].includes($event.code)) {
    for (let i = 0; i < choices.length; i += 1) {
      const choice = choices[i];
      if (choice.active) {
        choice.active = false;
        const fallback = $event.code === 'ArrowUp' ? choices[choices.length - 1] : choices[0];
        const previous = ($event.code === 'ArrowUp' ? choices[i - 1] : choices[i + 1]) || fallback;
        previous.active = true;
        break;
      }
    }
  }
  if ($event.code === 'Enter') {
    validate(choices.find((choice) => choice.active));
  }
}

/**
 * @typedef {(import('../../backend/routes').FinderChoice & {active?: boolean })} FinderChoice
 */
</script>

<style lang="scss" scoped>

.finder-root {
  position: fixed;
  z-index: 100000000000;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(10px);
  background-color: rgba(0,0,0,0.2);
  .hint {
    margin: 10px;
    background-color: var(--system-backgroundColor);
    color: var(--system-color);
    border: 1px solid var(--system-border-borderColor);
    box-sizing: border-box;
    border-radius: 10px;
    padding: 5px;
  }
  &.isComponent {
    position: relative;
    justify-content: flex-start;
    height: calc(100vh);
    .finder-container {
      height: auto;
      flex-grow: 1;
      .groups {
        max-height: inherit;
      }
    }
  }
  .finder-container {
    overflow: auto;
    width: 90%;
    border-radius: 10px;
    max-width: 1000px;
    height: max-content;
    background-color: var(--system-backgroundColor);
    color: var(--system-color);
    border: 1px solid var(--system-border-borderColor);
    padding: 10px;
    box-sizing: border-box;
    input {
      width: 100%;
      margin-bottom: 10px;
    }
    .choices {
      display: flex;
      flex-direction: column;
      .choice {
        display: flex;
        justify-content: space-between;
        padding: 2px 5px;
        box-sizing: border-box;
        border: 2px solid transparent;
        border-radius: 10px;
        cursor: pointer;
        &:hover {
          background-color: rgba(0,0,0,0.1);
        }
        &.active {
          border-left-color:#0076bc
        }
        .left {
          display: flex;
          align-items: center;
          .icon {
            flex-shrink: 0;
            width: 30px;
          }
        }
        .right {
          flex-shrink: 0;
          text-align: right;
        }
        .title {
          font-size: 1.02em;
        }
        .description {
          font-size: 0.8em;
          color: #777;
        }
      }
    }
  }
}
.groups {
  display: flex;
  flex-direction: column;
  overflow: auto;
  max-height: 50vh;
  gap: 20px;
  h2 {
    margin: 0;
  }
}
</style>
</file>

<file path="modules/finder/front/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/git/backend/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/git/backend/routes.js">
const express = require('express');

const router = express.Router();

/** @param {import('@runeya/common-typings').Runeya} runeya */
module.exports = (runeya) => {
  const { git } = runeya;
  router.get('/git/:service/graph', async (req, res) => {
    const graph = await git.getGraph(req.params.service, { graphOnAll: req.query.graphOnAll === 'true' });
    res.json(graph);
  });
  router.get('/git/:service/branches', async (req, res) => {
    const branches = await git.getBranches(req.params.service);
    res.json(branches);
  });
  router.get('/git/:service/status', async (req, res) => {
    const status = await git.getStatus(req.params.service);
    res.json(status);
  });
  router.get('/git/:service/diff', async (req, res) => {
    const diff = await git.getDiff(req.params.service);
    res.json(diff);
  });
  router.post('/git/:service/branch/:branchName/change', async (req, res) => {
    await git.changeBranch(req.params.service, req.params.branchName)
      .then((result) => res.json(result));
  });
  router.delete('/git/:service/branch/:branchName', async (req, res) => {
    await git.deleteBranch(req.params.service, req.params.branchName)
      .then((result) => res.json(result));
  });

  router.get('/git/:service/branch/:branchName/remote-delta', async (req, res) => {
    await git.remoteDelta(req.params.service, req.params.branchName)
      .then((result) => res.json(result));
  });

  router.post('/git/:service/fetch', async (req, res) => {
    await git.fetch(req.params.service)
      .then((result) => res.json(result));
  });

  router.delete('/git/:service/reset', async (req, res) => {
    await git.reset(req.params.service)
      .then((result) => res.json(result));
  });

  router.get('/git/:service/current-branch', async (req, res) => {
    const currentBranch = await git.getCurrentBranch(req.params.service);
    res.json(currentBranch);
  });

  router.post('/git/:service/add-branch', async (req, res) => {
    const currentBranch = await git.addBranch(req.params.service, req.body.name, !!req.body.shouldPush);
    res.json(currentBranch);
  });
  router.post('/git/:service/pull', async (req, res) => {
    await git.pull(req.params.service)
      .then((result) => res.json(result));
  });
  router.post('/git/:service/stash', async (req, res) => {
    await git.stash(req.params.service)
      .then((result) => res.json(result));
  });
  router.post('/git/:service/stash-pop', async (req, res) => {
    await git.stashPop(req.params.service)
      .then((result) => res.json(result));
  });
  router.post('/git/:service/stash-list', async (req, res) => {
    await git.stashList(req.params.service)
      .then((result) => res.json(result));
  });
  router.delete('/git/:service/checkout/:file', async (req, res) => {
    await git.checkoutFile(req.params.service, req.params.file.trim())
      .then((result) => res.json(result));
  });

  return router;
};
</file>

<file path="modules/git/front/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/github/backend/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/github/front/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/global-scripts/backend/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/global-scripts/backend/routes.js">
const express = require('express');

const router = express.Router();

/** @param {import('@runeya/common-typings').Runeya} Stack */
module.exports = (Stack) => {
  const { globalScripts } = Stack;
  router.get('/global-scripts/', async (req, res) => {
    res.json(globalScripts.getScripts());
  });

  router.get('/global-scripts/:id', async (req, res) => {
    const script = await globalScripts.getScript(req.params.id);
    res.json(script);
  });

  router.post('/global-scripts/:id', async (req, res) => {
    const communicationId = await globalScripts.launchScript(req.params.id);
    res.json(communicationId);
  });
  return router;
};
</file>

<file path="modules/global-scripts/front/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/help/backend/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/help/front/src/Index.vue">
<template>
  <iframe src="https://runeya.github.io/runeya/" width="100%" height="100%"></iframe>
</template>

<script setup>
</script>
<style lang="scss" scoped>
</style>
</file>

<file path="modules/help/front/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/json-formatter/backend/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/json-formatter/front/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/jwt/backend/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/jwt/backend/routes.js">
const express = require('express');
const jsonwebtoken = require('jsonwebtoken');

const router = express.Router();

module.exports = () => {
  router.post('/JWT/', async (req, res) => {
    const { jwt } = req.body;
    res.json(jsonwebtoken.decode(jwt));
  });
  return router;
};
</file>

<file path="modules/jwt/front/src/Index.vue">
<template>
  <div class="json-root">
    <h1>JWT</h1>
    <section-cmp>
      <div class="section-content">
        <editor v-model="code" language="json" style="height: calc(100vh - 200px)"></editor>
        <div class="json-viewer">
          <div>
            Show Raw
            <input type="checkbox" v-model="showRaw">
          </div>
          <div v-if="showRaw" class="raw">
            <pre v-html="raw"></pre>
          </div>
          <JsonTreeView v-else :maxDepth="6" :json="JSON.stringify(json)" :copyable="true"/>
        </div>
      </div>
    </section-cmp>
  </div>
</template>

<script setup>
import { ref, watchEffect } from 'vue';
import { JsonTreeView } from 'json-tree-view-vue3';
import SectionCmp from '../../../../fronts/app/src/components/Section.vue';
import axios from '../../../../fronts/app/src/helpers/axios';

const showRaw = ref(false);
const json = ref({});
const raw = ref('');
const code = ref('// Paste JWT...');

watchEffect(async () => {
  try {
    const { data: jwtData } = await axios.post('/JWT', { jwt: code.value });
    json.value = jwtData;
    raw.value = JSON.stringify(json.value, null, 2).split('\n').join('<br/>');
  } catch (error) {
  }
});
</script>

<style scoped lang="scss">
.json-root,.section-content {
  display: flex;
  flex-direction: column;
  width: 100%;
}
.section-content {
  display: flex;
  gap: 5px;
  flex-direction: row;
  height: calc(100vh - 200px);
}

.json-viewer {
  width: 50%;
  flex-shrink: 0;
  height: 100%;
}
.raw {
  padding: 10px;
  border: 1px solid #999;
  margin: auto;
  align-self: center;
  border-radius: 10px;
}
</style>

<style>
.json-viewer-tab{
  margin-left: 20px;
}
</style>
</file>

<file path="modules/jwt/front/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/kanban/backend/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/kanban/backend/Kanban.js">
/* eslint-disable max-classes-per-file */
const { v4 } = require('uuid');
const { getSave: _getSave } = require('./save');

/** @type {import('@runeya/common-typings').Runeya | null} */
let runeya = null;

function getSave() {
  if (!runeya) throw new Error('Call init before');
  const { data, save } = _getSave(runeya);
  return { data, save };
}

/** @param {import('@runeya/common-typings').Runeya} runeya */
class Board {
  /** @param {Partial<import('@runeya/common-typings').NonFunctionProperties<Board>>} board */
  constructor(board = {}) {
    /** @type {string} */
    this.id = board.id || v4();
    /** @type {string | undefined} */
    this.name = board.name;
    /** @type {string[]} */
    this.columnIds = board.columnIds || [];
  }

  /** @returns {Board[]} */
  static all() {
    const { data } = getSave();
    // @ts-ignore
    return data.boards.map((/** @type {*} */b) => (b ? new Board(b) : null)).filter((a) => a);
  }

  /** @param {string} id */
  static get(id) {
    const { data } = getSave();
    const board = data.boards.find((d) => d?.id === id);
    return board ? new Board(board) : null;
  }

  /**
   *
   * @returns {Column[]}
   */
  getColumns() {
    // @ts-ignore
    return this.columnIds.map((columnId) => Column.get(columnId)).filter((a) => a);
  }

  delete() {
    const { data, save } = getSave();
    this.getColumns().forEach((c) => c.delete());
    data.boards = data.boards.filter((b) => b?.id !== this.id);
    save();
  }

  /** @param {string} id */
  getColumn(id) {
    return this.getColumns().find((c) => c?.id === id);
  }

  /** @param {Partial<import('@runeya/common-typings').NonFunctionProperties<Column>>} column */
  addColumn(column) {
    const savedColumn = new Column({ ...column, boardId: this.id }).save();
    this.columnIds = [...new Set([...this.columnIds, savedColumn.id])];
    this.save();
    return savedColumn;
  }

  save() {
    const { data, save } = getSave();
    const existing = data.boards.find((b) => b?.id === this.id);
    if (existing) {
      Object.assign(existing, { ...this });
    } else {
      data.boards.push(this);
    }
    save();
    return this;
  }
}

class Column {
  /** @param {Partial<import('@runeya/common-typings').NonFunctionProperties<Column>>} column */
  constructor(column = {}) {
    /** @type {string} */
    this.id = column.id || v4();
    /** @type {string | undefined} */
    this.name = column.name;
    /** @type {string | undefined} */
    this.color = column.color;
    /** @type {string | undefined} */
    this.boardId = column.boardId;
    /** @type {string[]} */
    this.cardIds = column.cardIds || [];
  }

  /** @param {string} id */
  static get(id) {
    const { data } = getSave();
    const column = data.columns.find((d) => d?.id === id);
    return column ? new Column(column) : null;
  }

  /** @returns {Card[]} */
  getCards() {
    // @ts-ignore
    return this.cardIds.map((columnId) => Card.get(columnId)).filter((a) => a);
  }

  /** @param {string} id */
  getCard(id) {
    return this.getCards().find((c) => c?.id === id);
  }

  /** @param {Partial<import('@runeya/common-typings').NonFunctionProperties<Card>>} card */
  addCard(card) {
    const savedColumn = new Card({ ...card, boardId: this.boardId, columnId: this.id }).save();
    this.cardIds = [...new Set([...this.cardIds, savedColumn.id])];
    this.save();
    return savedColumn;
  }

  delete() {
    const { data, save } = getSave();
    this.getCards().forEach((c) => c.delete());
    data.columns = data.columns.filter((b) => b?.id !== this.id);
    save();
  }

  save() {
    const { data, save } = getSave();
    const existing = data.columns.find((b) => b?.id === this.id);
    if (existing) {
      Object.assign(existing, { ...this });
    } else {
      data.columns.push(this);
    }
    save();
    return this;
  }
}

class Card {
  /** @param {Partial<import('@runeya/common-typings').NonFunctionProperties<Card>>} card */
  constructor(card = {}) {
    /** @type {string} */
    this.id = card.id || v4();
    /** @type {string | undefined} */
    this.name = card.name;
    /** @type {string | undefined} */
    this.description = card.description;

    /** @type {string | undefined} */
    this.boardId = card.boardId;
    /** @type {string | undefined} */
    this.columnId = card.columnId;
  }

  /** @param {string} id */
  static get(id) {
    const { data } = getSave();
    const cards = data.cards.find((d) => d?.id === id);
    return cards ? new Card(cards) : null;
  }

  delete() {
    const { data, save } = getSave();
    data.cards = data.cards.filter((b) => b?.id !== this.id);
    save();
  }

  save() {
    const { data, save } = getSave();
    const existing = data.cards.find((b) => b?.id === this.id);
    if (existing) {
      Object.assign(existing, { ...this });
    } else {
      data.cards.push(this);
    }
    save();
    return this;
  }
}
/** @param {import('@runeya/common-typings').Runeya} _runeya */
const Kanban = (_runeya) => {
  runeya = _runeya;
  return {
    Card,
    Column,
    Board,
  };
};

module.exports = Kanban;

/** @typedef {typeof Column} ColumnType */
/** @typedef {typeof Card} CardType */
/** @typedef {typeof Board} BoardType */
</file>

<file path="modules/kanban/backend/routes.js">
const express = require('express');

const router = express.Router();

/** @param {import('@runeya/common-typings').Runeya} runeya */
module.exports = (runeya) => {
  const { Board } = require('./Kanban')(runeya);

  router.get('/kanban/boards', async (req, res) => {
    res.json(Board.all());
  });
  router.post('/kanban/boards', async (req, res) => {
    const board = new Board(req.body).save();
    res.json(board);
  });
  router.delete('/kanban/boards/:boardId', async (req, res) => {
    const board = Board.get(req.params.boardId);
    board?.delete();
    res.json(board);
  });

  router.get('/kanban/boards/:boardId/columns', async (req, res) => {
    res.json(Board.get(req.params.boardId)?.getColumns());
  });
  router.get('/kanban/boards/:boardId/columns/:columnId', async (req, res) => {
    res.json(Board.get(req.params.boardId)?.getColumn(req.params.columnId));
  });
  router.delete('/kanban/boards/:boardId/columns/:columnId', async (req, res) => {
    const column = Board.get(req.params.boardId)?.getColumn(req.params.columnId);
    column?.delete();
    res.json(column);
  });
  router.post('/kanban/boards/:boardId/columns', async (req, res) => {
    const board = Board.get(req.params.boardId)?.addColumn(req.body);
    res.json(board);
  });

  router.get('/kanban/boards/:boardId/columns/:columnId/cards', async (req, res) => {
    res.json(Board.get(req.params.boardId)?.getColumn(req.params.columnId)?.getCards());
  });
  router.delete('/kanban/boards/:boardId/columns/:columnId/cards/:cardId', async (req, res) => {
    const card = Board.get(req.params.boardId)?.getColumn(req.params.columnId)?.getCard(req.params.cardId);
    card?.delete();
    res.json(card);
  });
  router.post('/kanban/boards/:boardId/columns/:columnId/cards', async (req, res) => {
    res.json(Board.get(req.params.boardId)?.getColumn(req.params.columnId)?.addCard(req.body));
  });
  return router;
};
</file>

<file path="modules/kanban/backend/save.js">
const kanban = {
  /** @param {import('@runeya/common-typings').Runeya} runeya */
  getSave(runeya) {
    return runeya.getSave('kanban.json', {
      /** @type {Partial<import('@runeya/common-typings').NonFunctionProperties<import('./Kanban').BoardType>['prototype']>[]} */
      boards: [],
      /** @type {Partial<import('@runeya/common-typings').NonFunctionProperties<import('./Kanban').ColumnType>['prototype']>[]} */
      columns: [],
      /** @type {Partial<import('@runeya/common-typings').NonFunctionProperties<import('./Kanban').CardType>['prototype']>[]} */
      cards: [],
    }, {
      afterGet(data) {
        if (!data.boards) data.boards = [];
        if (!data.columns) data.columns = [];
        if (!data.cards) data.cards = [];
      },
      beforeSave(data) {
        if (!data.boards) data.boards = [];
        if (!data.columns) data.columns = [];
        if (!data.cards) data.cards = [];
      },
    });
  },
};
module.exports = kanban;
</file>

<file path="modules/kanban/front/src/Column.vue">
<template>
  <SectionCmp class="column-root" v-if="column">
    <div class="column-header">
      <h2>
        <input class="invisible" type="text" v-model="column.name"
          @focusout="saveColumn"
          @keypress.enter="saveColumn"
          placeholder="Name of column..."
          @input="resizeInput"
        >
      </h2>
      <div class="actions">
        <button class="small" @click.stop="deleteColumn(column)"><i class="fas fa-trash"></i></button>
      </div>
    </div>
    <div class="cards">
      <div class="add-card" @click="openCreateModal()"><i class="fas fa-plus"></i>Create a card</div>
      <draggableComponent
        v-model="cards"
        group="column"
        @start="drag=true"
        @end="drag=false"
        @change="saveColumn"
        class="droppable"
        item-key="id">
        <template #item="{element: card}">
          <div class="card" @click="openCreateModal(card)" >
            {{ card.name }}
            <button class="small" @click.stop="deleteCard(card)"><i class="fas fa-trash"></i></button>
          </div>
        </template>
      </draggableComponent>
    </div>
  </SectionCmp>

  <Modal ref="createCardModal" cancelString="No" validateString="Yes">
    <template #header="{data: card}">
      {{card?.id ? 'Update card' : 'Create card'}}
    </template>
    <template #body="{data: card}">
      <div class="input-container">
        <label>Nom</label>
        <input type="text" placeholder="Nom..." v-model="card.name">
      </div>

      <div class="input-container">
        <label>Description</label>
        <textarea placeholder="Description..." v-model="card.description"></textarea>
      </div>

    </template>
  </Modal>

  <Modal ref="deleteCardModal" cancelString="No" validateString="Yes">
    <template #header="{data: card}">
      Delete {{card.name}}
    </template>
  </Modal>
  <Modal ref="deleteColumnModal" cancelString="No" validateString="Yes">
    <template #header="{data: column}">
      Delete {{column.name}}
    </template>
  </Modal>
</template>

<script setup>
import { cloneDeep } from 'lodash';
import { ref, onMounted, watch } from 'vue';
import draggableComponent from 'vuedraggable';
import { useRoute, useRouter } from 'vue-router';
import axios from '../../../../fronts/app/src/helpers/axios';
import Modal from '../../../../fronts/app/src/components/Modal.vue';
import SectionCmp from '../../../../fronts/app/src/components/Section.vue';

const route = useRoute();
const router = useRouter();

/**
 * @param {Event} $ev
 */
function resizeInput($ev) {
  // eslint-disable-next-line prefer-destructuring
  const target = /** @type {HTMLInputElement} */($ev.target);
  if (!target) return;
  target.style.width = `${target.value.length / 2}em`;
}

const props = defineProps({
  board: {
    required: true,
    type: null,
  },
  columnId: {
    required: true,
    type: String,
  },
});
/** @type {import('vue').Ref<InstanceType<typeof Modal> | null>} */
const createCardModal = ref(null);
/** @type {import('vue').Ref<InstanceType<typeof Modal> | null>} */
const deleteCardModal = ref(null);
/** @type {import('vue').Ref<InstanceType<typeof Modal> | null>} */
const deleteColumnModal = ref(null);
const drag = ref(false);
/** @type {import('vue').Ref<InstanceType<import('../../backend/Kanban').CardType>[]>} */
const cards = ref([]);
/** @type {import('vue').Ref<import('@runeya/common-typings').NonFunctionProperties<import('../../backend/Kanban').ColumnType>['prototype'] | undefined | null>} */
const column = ref();

watch(() => route.query.cardId, () => {
  if (!route.query.cardId) return;
  const card = cards.value.find((b) => b?.id === route.query.cardId);
  if (card) openCreateModal(card);
}, { immediate: true });

onMounted(async () => {
  await refreshColumn();
  refreshCards();
});

/** @param {import('../../backend/Kanban').CardType['prototype']} card */
async function deleteCard(card) {
  deleteCardModal.value?.open(card).subscribe(async (res) => {
    if (!res) return;
    await axios.delete(`/kanban/boards/${props.board.id}/columns/${props.columnId}/cards/${card.id}`);
    await refreshColumn();
    await refreshCards();
  });
}

/** @param {import('../../backend/Kanban').ColumnType['prototype']} column */
async function deleteColumn(column) {
  deleteColumnModal.value?.open(column).subscribe(async (res) => {
    if (!res) return;
    await axios.delete(`/kanban/boards/${props.board.id}/columns/${props.columnId}/`);
    await refreshColumn();
    await refreshCards();
  });
}
async function refreshColumn() {
  const { data: _column } = await axios.get(`/kanban/boards/${props.board.id}/columns/${props.columnId}`);
  column.value = _column;
}
async function refreshCards() {
  const { data: _cards } = await axios.get(`/kanban/boards/${props.board.id}/columns/${props.columnId}/cards`);
  cards.value = _cards;
  const card = cards.value.find((b) => b?.id === route.query.cardId);
  if (card) openCreateModal(card);
}
/** @param {import('../../backend/Kanban').CardType['prototype'] | Record<any, any>} card */
async function openCreateModal(card = {}) {
  card = cloneDeep(card);
  if (card.id) {
    router.push({ query: { ...route.query, cardId: card.id } });
  }
  createCardModal.value?.open(card).subscribe(async (res) => {
    router.push({ query: { ...route.query, cardId: undefined } });
    if (!res) return;
    await axios.post(`/kanban/boards/${props.board.id}/columns/${props.columnId}/cards`, card);
    await refreshColumn();
    await refreshCards();
  });
}

/**
 *
 * @param {KeyboardEvent | FocusEvent} $ev
 */
async function saveColumn($ev) {
  // eslint-disable-next-line prefer-destructuring
  const target = /** @type {HTMLElement} */($ev.target);
  if (target) target.blur();
  if (column.value?.cardIds) column.value.cardIds = cards.value.map((c) => c.id);
  await axios.post(`/kanban/boards/${props.board.id}/columns/`, column.value);
  await refreshColumn();
}
</script>

<style scoped lang="scss">
.column-root,.section-content {
  display: flex;
  flex-direction: column;
  width: 300px;
}
.column-root {
  border: 1px solid var(--system-border-borderColor);
  height: calc(100% - 100px);
  &:hover {
    .actions {
      display: flex;
    }
  }
}
.section-content {
  display: flex;
  flex-direction: row;
  gap: 10px;
}

button.small {
  width: max-content;
  height: max-content;
  i {
    margin: 0;
  }
}
.column-header {
  display: flex;
  align-items: center;
  position: relative;
  width: 100%;
  display: flex;
  justify-content: space-between;
  h2 {
    margin: 0;
  }
}
.cards {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  gap: 10px;
  overflow: auto;
  .card {
    border-radius: 10px;
    padding: 10px;
    border: 1px solid var(--system-border-borderColor);
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;

    transition: 300ms;
  will-change: transform;
  &:hover {
    transform: scale(1.05);
    background-color: #0076bc;
    color: white;
  }
  }
}
.add-card {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  border: 1px dashed lightgrey;
  border-radius: 10px;
  color: darkgrey;
  padding: 10px;
  box-sizing: border-box;
  cursor: pointer;
  transition: 300ms;
  will-change: transform;
  &:hover {
    transform: scale(1.05);
    background-color: #0076bc;
    color: white;
  }
}

.invisible {
  border: none;
  font-size: inherit;
  font-weight: inherit;
  width: max-content;
  box-sizing: border-box;
  padding: 0;
  outline: none;
}

.input-container {
  display: flex;
  flex-direction: column;
}
.actions {
  display: none;
  position: absolute;
  right: 0;
}
.droppable {
  flex-grow: 1;
  gap: 10px;
  display: flex;
  flex-direction: column;
  overflow: auto;
  padding: 1px 9px;
}
</style>
</file>

<file path="modules/kanban/front/src/Index.vue">
<template>
  <div class="uuid-root">
    <h1>Kanban</h1>
    <div class="section-content">
      <div class="boards-container">
        <input type="text" v-model="boardToCreate" @keypress.enter="createBoard" placeholder="New Board...">
        <div class="boards">
          <div class="board" :class="{active: selectedBoard?.id === board?.id}"
          v-for="board of boards" :key="board?.id" @click="router.push({query: {boardId: board?.id}})">
            {{ board?.name }}
            <button class="small" @click="deleteBoard(board)"><i class="fas fa-trash"></i></button>
          </div>
        </div>
      </div>

      <div class="columns" v-if="selectedBoard">
        <Column
          :board="selectedBoard" v-for="columnId of selectedBoard.columnIds" :key="columnId" :column-id="columnId"
          @refresh="refreshBoards()"
        ></Column>
        <div class="add-column" @click="createColumn"><i class="fas fa-plus"></i>New column</div>
      </div>
      <div v-else>Choose a board...</div>
    </div>
  </div>
  <Modal ref="deleteBoardModal" cancelString="No" validateString="Yes">
    <template #header="{data: board}">
      Delete {{board.name}}
    </template>
  </Modal>
</template>

<script setup>
import { ref, onMounted, watch } from 'vue';
import { useRoute, useRouter } from 'vue-router';
import axios from '../../../../fronts/app/src/helpers/axios';
import Modal from '../../../../fronts/app/src/components/Modal.vue';
import Column from './Column.vue';

const route = useRoute();
const router = useRouter();

defineProps({
  plugin: {},
});
/** @type {import('vue').Ref<import('@runeya/common-typings').NonFunctionProperties<import('../../backend/Kanban').BoardType>['prototype'][]>} */
const boards = ref([]);
/** @type {import('vue').Ref<import('@runeya/common-typings').NonFunctionProperties<import('../../backend/Kanban').BoardType>['prototype'] | null>} */
const selectedBoard = ref();
const boardToCreate = ref('');
const deleteBoardModal = ref('');

watch(() => route.query.boardId, () => {
  selectedBoard.value = boards.value.find((b) => b?.id === route.query.boardId);
}, { immediate: true });

onMounted(reload);
async function refreshBoards() {
  const { data: _boards } = await axios.get('/kanban/boards');
  boards.value = _boards;
  selectedBoard.value = boards.value.find((b) => b?.id === route.query.boardId);
}
async function reload() {
  await refreshBoards();
}
/**
* @param {*} board
*/
async function deleteBoard(board) {
  // @ts-ignore
  deleteBoardModal.value.open(board).subscribe(async (/** @type {*} */res) => {
    if (!res) return;
    await axios.delete(`/kanban/boards/${board.id}`);
    await refreshBoards();
  });
}
async function createBoard() {
  if (boardToCreate.value) {
    await axios.post('/kanban/boards', { name: boardToCreate.value });
  }
  boardToCreate.value = '';
  await reload();
}

async function createColumn() {
  await axios.post(`/kanban/boards/${selectedBoard.value?.id}/columns`, {});
  await reload();
}
</script>

<style scoped lang="scss">
.uuid-root,.section-content {
  display: flex;
  flex-direction: column;
  width: 100%;
}
.section-content {
  height: 100%;
}
.section-content,.columns {
  display: flex;
  flex-direction: row;
  gap: 10px;
}

.columns {
  height: 100%;
  overflow: auto;
  .column {
    background-color: white;
    height: 100%;
  }
}

.board {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 5px 10px;
  box-sizing: content-box;
  &.active {
    border-left: 4px solid #0076bc;
    background-color: rgba(0,0,0,0.1);
  }
  &:hover {
    background-color: rgba(0,0,0,0.1);
    cursor: pointer;
  }
}

button.small {
  width: max-content;
  height: max-content;
  i {
    margin: 0;
  }
}

.add-column {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  border: 1px dashed lightgrey;
  border-radius: 10px;
  color: darkgrey;
  padding: 10px;
  box-sizing: border-box;
}
</style>
</file>

<file path="modules/kanban/front/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/logs/backend/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/logs/front/src/PassThrough.vue">
<template>
  <slot></slot>
</template>

<script setup>

</script>

<style lang="scss" scoped>

</style>
</file>

<file path="modules/logs/front/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/mongo/backend/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/mongo/backend/routes.js">
const express = require('express');
const { ObjectId } = require('mongodb');

const router = express.Router();

router.get('/mongo/generate', async (req, res) => {
  res.json(new ObjectId());
});

module.exports = () => router;
</file>

<file path="modules/mongo/front/src/Index.vue">
<template>
  <div class="uuid-root">
    <h1>MongoDB</h1>
    <div class="sections">
      <section-cmp header="ObjectId">
        <div class="section-content">
          <h2>ObjectId('{{ uuid }}')</h2>
          <button @click="generate">
            <i class="fas fa-random"></i>
            Regenerate
          </button>
        </div>
      </section-cmp>
      <section-cmp header="Decode ObjectId">
        <div class="section-content">
          <h2>{{ decodedObjectId?.date?.format?.('YYYY-MM-DD hh:mm:ss') }}</h2>
          <input type="text" v-model="uuid">
        </div>
      </section-cmp>
      <section-cmp header="Encode Date">
        <div class="section-content">
          <input type="datetime-local" v-model="date">
        </div>
      </section-cmp>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted, watchEffect } from 'vue';
import dayjs from 'dayjs';
import SectionCmp from '../../../../fronts/app/src/components/Section.vue';
import axios from '../../../../fronts/app/src/helpers/axios';

const uuid = ref();
/** @type {import('vue').Ref<{date: import('dayjs').Dayjs} | null>} */
const decodedObjectId = ref(null);
/** @type {import('vue').Ref<string | null>} */
const date = ref(null);

/** @param {string} objectId */
const dateFromObjectId = (objectId) => (dayjs(parseInt(objectId.substring(0, 8), 16) * 1000));
/** @param {Date} date */
const objectIdFromDate = (date) => (`${Math.floor(date.getTime() / 1000).toString(16)}0000000000000000`);

onMounted(generate);
async function generate() {
  const { data: _uuid } = await axios.get('/mongo/generate');
  uuid.value = _uuid;
  date.value = dateFromObjectId(_uuid).format('YYYY-MM-DDThh:mm');
  decodeObjectId(_uuid);
}

watchEffect(() => decodeObjectId(uuid.value));
watchEffect(() => {
  uuid.value = objectIdFromDate(dayjs(date.value).toDate());
});

/** @param {string} objectId */
function decodeObjectId(objectId) {
  decodedObjectId.value = {
    date: dateFromObjectId(objectId || ''),
  };
}
</script>

<style scoped lang="scss">
.sections {
  display: flex;
  flex-direction: column;
  gap: 20px;
}
.uuid-root,.section-content {
  display: flex;
  flex-direction: column;
  width: 100%;
}
.section-content {
  align-items: center;
}
</style>
</file>

<file path="modules/mongo/front/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/node-repl/backend/.gitignore">
sandbox*
</file>

<file path="modules/node-repl/backend/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/node-repl/front/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/npm/backend/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/npm/front/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/openai/backend/.gitignore">
openaiconf.json
</file>

<file path="modules/openai/backend/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/openai/front/.gitignore">
openaiconf.json
</file>

<file path="modules/openai/front/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/openapi/backend/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/openapi/backend/routes.js">
const express = require('express');
const axios = require('axios').default;

const router = express.Router();
module.exports = () => {
  router.post('/openapi/swagger.json', async (req, res) => {
    const { data } = await axios.get(req.body.url);
    res.json(data);
  });
  return router;
};
</file>

<file path="modules/openapi/front/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/plugins-loader/backend/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/plugins-loader/front/src/DynamicComponent.vue">
<template>
    <component :is="component"></component>
</template>

<script setup>
import { ref, watchEffect } from 'vue';
import { useRouter } from 'vue-router';

const router = useRouter();

const component = ref();
watchEffect(() => {
  component.value = router.currentRoute.value.params.plugin;
});
</script>
</file>

<file path="modules/plugins-loader/front/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/regex/backend/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/regex/front/src/Index.vue">
<template>
  <div class="json-root">
    <h1>Regex</h1>
    <section-cmp>
      <div class="section-content">
        <div class="editor-container">
          Inert your regex:
          <input type="text" v-model="regexString" placeholder="Regex...">
          <Editor ref="monacoRef" style="height: 400px"
            v-model="code"
          />
        </div>
        <div class="json-viewer">
          <div>
            Show Raw
            <input type="checkbox" v-model="showRaw">
          </div>
          <div v-if="showRaw" class="raw">
            <pre v-html="raw"></pre>
          </div>
          <JsonTreeView v-else :maxDepth="10" :json="JSON.stringify(json)" :copyable="true"/>
        </div>
      </div>
    </section-cmp>
  </div>
</template>

<script setup>
import { ref, watchEffect } from 'vue';
import { JsonTreeView } from 'json-tree-view-vue3';
import SectionCmp from '../../../../fronts/app/src/components/Section.vue';

const showRaw = ref(false);
const json = ref({});
const raw = ref('');
const regexString = ref('.*');
const code = ref('Place your lines to test...');

const monacoRef = ref();
/** @type {import('monaco-editor').editor.IEditorDecorationsCollection[]} */
let decorations = [];
watchEffect(async () => {
  if (!monacoRef.value?.isReady) return;
  decorations.forEach((d) => d.clear());
  decorations = [];
  try {
    /** @type {Array<{match: string, groups: string[], input: string | undefined, index: number | undefined, indices: RegExpIndicesArray | undefined}>[]} */
    const results = [];
    if (!regexString.value) {
      json.value = [];
      return;
    }
    code.value.split('\n').forEach((line, lineNumber) => {
      const regex = new RegExp(regexString.value, 'gid');
      const result = [...line.matchAll(regex)].map((result) => {
        const [match, ...groups] = result;
        const { input, index, indices } = result;
        return {
          match, groups, input, index, indices,
        };
      });
      results.push(result);
      result.forEach((r) => {
        r.indices?.forEach((range, groupNumber) => {
          const decoration = /** @type {IStandaloneCodeEditor} */(monacoRef.value?.editor)
            ?.createDecorationsCollection([
              {
                range: {
                  startLineNumber: lineNumber + 1,
                  endLineNumber: lineNumber + 1,
                  startColumn: range[0] + 1,
                  endColumn: range[1] + 1,
                },
                options: {
                  isWholeLine: false,
                  inlineClassName: `highlight-${groupNumber}`,
                },
              },
            ]);
          if (decoration) decorations.push(decoration);
        });
      });
    });

    json.value = results;
    raw.value = JSON.stringify(json.value, null, 2).split('\n').join('<br/>');
  } catch (error) {
    console.error(error);
  }
});

/**
 * @typedef {import('monaco-editor').editor.IStandaloneCodeEditor} IStandaloneCodeEditor
 */
</script>

<style scoped lang="scss">
h1 {
  flex-grow: 0 !important;
}
.json-root,.section-content {
  display: flex;
  flex: 1 1;
  flex-direction: column;
  align-items: center;
  width: 100%;
  &>* {
    flex-grow: 1;
    width: 100%;
  }
}
.section-content {
  display: flex;
  align-items: center;
  gap: 10px;
  height: calc(100vh - 100px);
  .editor-container {
    flex-grow: 0;
    input {
      margin: 0 0;
      margin-bottom: 10px;
      width: 100%;
    }
  }
  input[type="checkbox"] {
    width: auto;
  }
}

.json-viewer {
  width: 100%;
  flex-shrink: 0;
  height: 100%;
  height: calc(100vh / 2);
  overflow: auto;
}
.raw {
  padding: 10px;
  border: 1px solid #999;
  margin: auto;
  align-self: center;
  border-radius: 10px;
}

</style>

<style lang="scss">
.json-viewer-tab{
  margin-left: 20px;
}
.highlight- {
  &0 {
    background-color: rgb(187, 127, 16);
  }
  &1 {
    background-color: rgb(81, 158, 36);
  }
  &2 {
    background-color: rgb(9, 127, 143);
  }
}
</style>
</file>

<file path="modules/regex/front/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/toolbox/backend/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/toolbox/front/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/uuid/backend/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/uuid/backend/routes.js">
const express = require('express');

const router = express.Router();
const UUID = require('./UUID');

/** @param {import('@runeya/common-typings').Runeya} runeya */
module.exports = (runeya) => {
  const uuid = UUID(runeya);
  router.get('/uuid/', async (req, res) => {
    res.json(uuid.generate());
  });
  return router;
};
</file>

<file path="modules/uuid/backend/UUID.js">
const { v4 } = require('uuid');

/** @param {import('@runeya/common-typings').Runeya} runeya */
// eslint-disable-next-line @typescript-eslint/no-unused-vars
const UUID = (runeya) => ({
  generate: () => v4(),
});

module.exports = UUID;
</file>

<file path="modules/uuid/front/src/UUID.vue">
<template>
  <div class="uuid-root">
    <h1>Generate UUID</h1>
    <SectionCmp>
      <div class="section-content">
        <h2>{{ uuid }}</h2>
        <button @click="generate">
          <i class="fas fa-random"></i>
          Regenerate
        </button>
      </div>
    </SectionCmp>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue';
import SectionCmp from '../../../../fronts/app/src/components/Section.vue';
import axios from '../../../../fronts/app/src/helpers/axios';

const uuid = ref();

onMounted(generate);
async function generate() {
  const { data: _uuid } = await axios.get('/uuid');
  uuid.value = _uuid;
}
</script>

<style scoped lang="scss">
.uuid-root,.section-content {
  display: flex;
  flex-direction: column;
  width: 100%;
}
.section-content {
  align-items: center;
}

</style>
</file>

<file path="modules/uuid/front/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="servers/server/helpers/ansiconvert.js">
const ansiconvert = new (require('ansi-to-html'))({
  newline: true,
  escapeXML: false,
  bg: '#FFFFFFFF',
  fg: '#4c4c4c',
});

/** @param {string} msg */
function stripAnsi(msg) {
  return msg
    // eslint-disable-next-line no-control-regex
    .replaceAll(/[\u001b\u009b][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-ORZcf-nqry=><]/gm, '');
}
/** @param {string} msg */
function unescapeAnsi(msg) {
  return msg
    .replaceAll(/\\u001b\[/gm, '\u001b[')
    .replaceAll(/\\u009b\[/gm, '\u009b[');
}

module.exports = { ansiconvert, stripAnsi, unescapeAnsi };
</file>

<file path="servers/server/helpers/console.table.js">
const { Transform } = require('stream');
const { Console } = require('console');

/** @param {Record<string, string | number>[]} input */
function table(input) {
  // @see https://stackoverflow.com/a/67859384
  const ts = new Transform({ transform(chunk, enc, cb) { cb(null, chunk); } });
  const logger = new Console({ stdout: ts });
  logger.table(input);
  const table = (ts.read() || '').toString();
  let result = '';
  for (const row of table.split(/[\r\n]+/)) {
    let r = row.replace(/[^┬]*┬/, '┌');
    r = r.replace(/^├─*┼/, '├');
    r = r.replace(/│[^│]*/, '');
    r = r.replace(/^└─*┴/, '└');
    r = r.replace(/'/g, ' ');
    result += `${r}\n`;
  }
  console.log(result);
}

module.exports = table;
</file>

<file path="servers/server/helpers/cpuFork.js">
const os = require('os');
const osutils = require('os-utils');

function cpuUsagePromise() {
  return new Promise((resolve) => {
    osutils.cpuUsage((v) => {
      resolve(v);
    });
  });
}

async function getRam() {
  const freemem = os.freemem();
  const totalmem = os.totalmem();

  return {
    memPercentage: totalmem ? (freemem * 100) / totalmem : 0,
    totalmem,
    freemem,
  };
}

const wait = (/** @type {number} */ms) => new Promise((res) => { setTimeout(res, ms); });

async function launch() {
  try {
    const ram = await getRam();
    const cpu = await cpuUsagePromise();
    if (process.connected) {
      process?.send?.(JSON.stringify({ ram, cpu }));
    } else {
      process.exit(1);
    }
  } catch (error) { }
  await wait(500);
  launch();
}
launch();
</file>

<file path="servers/server/helpers/exec.js">
const { exec } = require('child_process');

module.exports = {
  /**
   * @param {string} cmd
   * @param {import('child_process').ExecOptions} options
   * @returns {Promise<string>}
   */
  execAsync(cmd, options) {
    return new Promise((res, rej) => {
      exec(cmd, options, (err, stdout, stderr) => {
        if (err) return rej(stderr || err);
        return res(stdout);
      });
    });
  },
  /**
   * @param {string} cmd
   * @param {import('child_process').ExecOptions} options
   * @returns {Promise<string>}
   */
  execAsyncWithoutErr(cmd, options) {
    return new Promise((res) => {
      exec(cmd, options, (err, stdout) => {
        res(stdout);
      });
    });
  },
  /**
   * @param {string} cmd
   * @param {import('child_process').ExecOptions} options
   * @returns {Promise<string>}
   */
  execAsyncGetError(cmd, options) {
    return new Promise((res) => {
      exec(cmd, options, (err, stdout, stderr) => {
        res(stderr);
      });
    });
  },
};
</file>

<file path="servers/server/helpers/exportedHelpers.js">
module.exports = {
  /**
   * @param {string} str
   * @param {string} search
   */
  searchString(str, search) {
    return str?.toUpperCase()?.includes(search);
  },
};
</file>

<file path="servers/server/helpers/isWindows.js">
module.exports = process.platform === 'win32';
</file>

<file path="servers/server/helpers/plugins.js">
const plugins = require('@runeya/modules-plugins-loader-backend');
const Stack = require('../models/stack');

/** @type {import('express').Router[]} */
const routes = [];
/** @type {PluginSM[]} */
const forService = [];
/** @type {Record<string, PluginSM[]>} */
const allPlugins = {};

Object.keys(plugins)
  .map((key) => plugins[/** @type {keyof (typeof plugins)} */(key)])
  .forEach((plugin) => {
    if (!plugin) return null;
    if (plugin.placements?.includes('service')) forService.push(plugin);
    if (plugin.routes) {
      routes.push(plugin.routes(Stack));
      delete plugin.routes;
    }
    (plugin.placements || []).forEach((p) => {
      const position = typeof p === 'string' ? p : p.position;
      if (!position) return null;
      if (!allPlugins[position]) allPlugins[position] = [];
      if (!allPlugins[position].includes(plugin)) {
        allPlugins[position].push({
          ...plugin,
          placements: (plugin.placements || []).filter((_p) => typeof _p !== 'string' && _p.position === position),
        });
      }
      return null;
    });
    return plugin;
  });
module.exports = {
  forService,
  ...allPlugins,
  routes,
};

/**
 * @typedef {import('@runeya/modules-plugins-loader-front/src/views').PluginSM<unknown>} PluginSM
 */
</file>

<file path="servers/server/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="servers/server/app.js">
// @ts-ignore
require('express-async-errors');
const { express } = require('@runeya/common-express');
const indexRouter = require('./routes/index');
const { stopCpu } = require('./helpers/cpu');
const { stopWatchers } = require('./models/stack');

const app = express();

app.use('/', indexRouter);

// @ts-ignore
app.stopWorkers = async () => {
  await stopCpu();
  stopWatchers();
};
module.exports = app;
</file>

<file path="servers/server/nodemon.json">
{
  "watch": [".", "../modules"],
  "ext": "js, css",
  "delay": "1000"
}
</file>

<file path="servers/server/tsconfig.json">
{
  "extends": "../../tsconfig.json",
  "compilerOptions": {
    "outDir": "dist",
    "noEmit": false,
  },
  "include": ["."],
  "exclude": [
    "node_modules/**/*",
    "dist/**/*"
  ]
}
</file>

<file path=".eslintignore">
/node_modules/*
/bin/*
package.json
package-lock.json
**/build/*
**/dist/*
**/node_modules/*
sandbox/*
commitlint.config.js
.eslintrc.js
**/tsup.config.ts
</file>

<file path=".eslintrc.js">
module.exports = {
  extends: [
    'eslint:recommended',
    'airbnb',
  ],
  parser: '@typescript-eslint/parser',
  plugins: ['@typescript-eslint', 'jest', 'vue'],
  settings: {
    'import/extensions': ['.js', '.jsx', '.ts', '.tsx'],
    'import/resolver': {
      node: {
        extensions: ['.js', '.jsx', '.ts', '.tsx'],
      },
    },
    'import/parsers': {
      '@typescript-eslint/parser': ['.ts', '.tsx'],
    },
    jest: {
      version: 27,
    },
  },
  parserOptions: {
    ecmaVersion: 2021,
    createDefaultProgram: false,
    project: ['./tsconfig.json', './**/tsconfig.json'],
  },
  rules: {
    "import/no-relative-packages":"off",
    "camelcase": "off",
    "no-restricted-syntax": "off",
    "class-methods-use-this": "off",
    "no-shadow": "off",
    "no-unused-vars": "off",
    "@typescript-eslint/no-unused-vars": "error",
    'linebreak-style': 0,
    "import/no-extraneous-dependencies":[
      "error",
      {
        "devDependencies":[
          "**/*.test.ts",
          "**/*.test.tsx",
          "**/*.spec.js",
          "**/*.spec.jsx",
          "**/*.spec.jsx",
          "**/*jest.config.ts",
          "**/*jest.config.js",
        ]
      }
    ],
    'import/extensions': [
      'error',
      'ignorePackages',
      {
        js: 'never',
        jsx: 'never',
        ts: 'never',
        tsx: 'never',
      },
    ],
    'no-use-before-define': 'off',
    'no-console': 'off',
    'import/no-dynamic-require': 'off',
    'max-len': ['error', {
      code: 120,
      ignorePattern: 'true',
      ignoreComments: true,
      ignoreTrailingComments: true,
      ignoreUrls: true,
      ignoreStrings: true,
      ignoreTemplateLiterals: true,
      ignoreRegExpLiterals: true,
    }],
    'no-empty': ['error', { allowEmptyCatch: true }],
    'no-param-reassign': 'off',
    'jest/no-disabled-tests': 'warn',
    'jest/no-focused-tests': 'error',
    'jest/no-identical-title': 'error',
    'jest/prefer-to-have-length': 'warn',
    'jest/valid-expect': 'error',
    '@typescript-eslint/naming-convention': 'off',
    'eslint/space-before-blocks': 'off',
    '@typescript-eslint/space-before-blocks': 'off',
    'no-underscore-dangle': 'off',
    'import/prefer-default-export': 'off',
    'global-require': 'off',
  },
  env: {
    'jest/globals': true,
  },
};
</file>

<file path=".gitignore">
bundle.js
node_modules
.DS_Store
node_modules
/dist

# local env files
.env.local
.env.*.local

# Log files
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# Editor directories and files
.idea
.vscode
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?

server/public
#Electron-builder output
/dist_electron
stats.html

test-report.xml
coverage
built

docs/.vitepress/dist
docs/.vitepress/cache
~

# yarn v2
.yarn/cache
.yarn/unplugged
.yarn/build-state.yml
.yarn/install-state.gz
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/sdks
!.yarn/versions

*.tgz



node_modules
logs-express
.env
globalConfig.json
test-report.xml
coverage
yarn-error.log
**/*.turbo
**/*dist
!**/*.turbo/config.json
!.turbo/config.json
sandbox
lerna-debug.log
.pnp.*
tsup.config.bundled*
</file>

<file path="runScriptWithEnv.js">
const dotenv = require('dotenv');
const cp = require('child_process');

dotenv.config();
const [cmd, ...cmdArgs] = process.argv.slice(2).join(' ').split(' ');
try {
  const {
    status, stderr, stdout, error,
  } = cp.spawnSync(cmd, cmdArgs, { stdio: 'inherit', env: { ...process.env } });
  if (status !== 0) {
    console.error(stderr || error || stdout);
    process.exit(1);
  }
} catch (error) {
  console.log(cmd, cmdArgs);
  console.error(error);
  process.exit(1);
}
</file>

<file path="tsconfig.json">
{
  "compilerOptions": {
    "target": "ES2021",
    "moduleResolution": "Node",
    "skipLibCheck": true,
    "removeComments": false,
    "maxNodeModuleJsDepth": 8,
    "allowSyntheticDefaultImports": true,
    "esModuleInterop": true,
    "allowJs": true,
    "checkJs": true,
    "noImplicitAny": false,
    "lib": ["ES2021.String", "es7", "DOM"],
    "declaration": true,
    "outDir": "dist",
    "strict": true,
    "noEmit": true,
    "resolveJsonModule": true,
    "types": []
  },
  "exclude": [
    ".yarn/cache",
    "node_modules",
    "node_modules/*",
    "**/*/node_modules",
    "**/*dist",
    "./.eslintrc.js"
  ],
}
</file>

<file path=".github/workflows/all-deploy.yml">
# Autogenerated by @runeya/common-workflows package
# If you must edit this file, edit files in .github/workflow-*.yml
# Then launch "yarn ci:generate"

name: Release

on:
  push:
    branches: 
      - master
      - develop
      - staging

jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
      pages: write
      id-token: write
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: "Checkout ${{ github.ref_name }}"
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js environment
        uses: actions/setup-node@v4
        with:
          node-version: 18
          cache: 'yarn'

      - name: Install dependencies
        run: yarn install --immutable

      - name: Build
        run: npm run docs:build

      - uses: actions/configure-pages@v5
      - uses: actions/upload-pages-artifact@v3
        with:
          path: fronts/docs/.vitepress/dist

      - name: Deploy
        id: deployment
        uses: actions/deploy-pages@v1
  publish:
    runs-on: ubuntu-latest
    env:
      TURBO_TOKEN: ${{ secrets.TURBO_TOKEN }}
      TURBO_TEAM: ${{ vars.TURBO_TEAM }}

    outputs:
      changed: ${{ steps.changes.outputs.changed }}
      versionType: ${{ steps.version.outputs.type }}
      lerna: ${{ steps.lerna.outputs.lernaJson }}
    steps:
    - name: "Checkout ${{ github.ref_name }}"
      uses: actions/checkout@v3
      with:
        fetch-depth: 0

    - name: Setup Node.js environment
      uses: actions/setup-node@v3
      with:
        node-version: 18
        cache: 'yarn'

    - run: npm set "//registry.npmjs.org/:_authToken" ${{ secrets.NPM_TOKEN }}

    - name: Ensure access
      run: npm whoami
      env:
        NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}

    - name: Config git user
      run: |
        git config --global user.name "${{ github.actor }}"
        git config --global user.email "${{ github.actor }}@users.noreply.github.com"

    - name: Install dependencies
      run: yarn install --immutable

    - name: Lint
      run: yarn run lint

    - name: Tests
      run: yarn run test

    - name: Build
      run: yarn run build

    - id: changes
      name: "Export list of package has changed"
      run: |
        if [ ${GITHUB_REF##*/} = develop ]; then
          echo -n changed=$(yarn turbo test --filter="...[v.dev]" --dry-run=json | jq -c '.packages') >> $GITHUB_OUTPUT
        elif [ ${GITHUB_REF##*/} = staging ]; then
          echo -n changed=$(yarn turbo test --filter="...[v.staging]" --dry-run=json | jq -c '.packages') >> $GITHUB_OUTPUT
        else
          echo -n changed=$(yarn turbo test --filter="...[v.latest]" --dry-run=json | jq -c '.packages') >> $GITHUB_OUTPUT
        fi

    - name: "Print changes"
      run: echo "${{steps.changes.outputs.changed}}"

    - name: "Version and publish ${{github.ref_name}}"
      id: version
      env:
        GH_TOKEN: ${{ secrets.NPM_TOKEN }}
        NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
      run: |
        git config user.name "${{ github.actor }}"
        git config user.email "${{ github.actor}}@users.noreply.github.com"

        if [ ${GITHUB_REF##*/} = develop ]; then
          git tag -fa v.dev -m "fix: set v.dev tag"
          git push origin v.dev -f
          echo "type=dev" >> $GITHUB_OUTPUT
        elif [ ${GITHUB_REF##*/} = staging ]; then
          git tag -fa v.staging -m "fix: set v.staging tag"
          git push origin v.staging -f
          echo "type=staging" >> $GITHUB_OUTPUT
        else
          npx lerna version --conventional-commits --conventional-graduate --yes
          npx lerna publish from-git --yes --registry https://registry.npmjs.org/:_authToken=${{ secrets.NPM_TOKEN }} --force-publish
          git tag -fa v.latest -m "fix: set v.latest tag"
          git push origin v.latest -f
          echo "type=latest" >> $GITHUB_OUTPUT
          cd servers/server
          npm run build
          cd dist
          npm publish --access public
        fi

    - id: lerna
      name: Export lerna config
      run: |
        echo lernaJson=$(cat lerna.json) >> $GITHUB_OUTPUT
</file>

<file path=".runeya/dbs/envs/Local.encrypted.json">
wfjJ7P0JvftHLKjzfXj76m/wNmnGc+GsJPDyVhQI1opydT9Gdvjuj9eI9e+Ek8789EtKuKk5KcZxSAiYSLmy+pCVGoi1vr4x5MVg3PlcjhDoz3l1P6RiTuv9U48e8iAGSHCWOFqYQw+HyVcQyciE574tIdOXF1X/cNeG4rLaFecZ8PBCWcKP6ld08pdYbXCjY6ApmwCSMLURsPEf8rthErZTIEmOHDvNhSxpLl+z1yOzR7ul6iyyLBA3Yi//GfumXSRWxguBrEGznKylgCGv7k6XQgzOqdgOS/WDS31hE9vrgfeYMmoAe6roWk/m1qu016LuVAF8Tbf7tEaGDI5VgD8u
</file>

<file path=".runeya/dbs/.gitignore">
encryption-key.json
overrides
</file>

<file path=".runeya/dbs/leafs-leafs.encrypted.json">
DZr4fWjOWe5oqZWEHSiuYTl+luJhsk8gaIby8jr3uocontI8TDpkqy0q
</file>

<file path="common/check-monorepo/src/searchForWorkspaces.js">
const fs = require('fs');
const pathfs = require('path');
const { execSync } = require('child_process');

const difference = (arr1, arr2) => arr1
  .filter((x) => !arr2.includes(x))
  .concat(arr2.filter((x) => !arr1.includes(x)));

module.exports = {
  checkIfAllWorkspacesAreLinkedToYarn,
  checkIfAllWorkspacesAreLinkedToLerna,
  getWorkspaces: (root = pathfs.resolve(__dirname, '..', '..', '..')) => exploreDir(root),
};
function checkIfAllWorkspacesAreLinkedToYarn() {
  const root = pathfs.resolve(__dirname, '..', '..', '..');
  const workspaces = exploreDir(root);
  const workspacesFromYarn = execSync('yarn workspaces list --json', { encoding: 'utf-8' })
    .trim()
    .split('\n')
    .map((line) => JSON.parse(line.trim()))
    .filter((w) => w.location !== '.')
    .map((w) => {
      w.location = pathfs.resolve(root, w.location);
      return w;
    });
  const workspacesNames = workspaces.map((w) => w.path);
  const workspacesNamesFromYarn = workspacesFromYarn.map((w) => w.location);
  const differences = difference(workspacesNames, workspacesNamesFromYarn);

  if (differences?.length) {
    throw new Error(`Difference found, these workspaces are not linked to yarn:\n${differences.join('\n')}`);
  }
}

function checkIfAllWorkspacesAreLinkedToLerna() {
  const root = pathfs.resolve(__dirname, '..', '..', '..');
  const workspaces = exploreDir(root);
  const workspacesNamesFromLerna = execSync('yarn lerna exec "pwd"', { encoding: 'utf-8', cwd: root })
    .trim()
    .split('\n')
    .map((path) => path.trim());
  const workspacesNames = workspaces.map((w) => w.path);
  const differences = difference(workspacesNames, workspacesNamesFromLerna);

  if (differences?.length) {
    throw new Error(`Difference found, these workspaces are not linked to lerna:\n${differences.join('\n')}`);
  }
}

/**
 *
 * @param {string} rootDir
 * @returns {{
 *   path: string,
 *   packageJSON: {
 *     name: string,
 *     description: string,
 *     private?: boolean,
 *     scripts?: Record<string, string>,
 *     repository?: boolean,
 *     devDependencies: Record<string, string>,
 *     dependencies: Record<string, string>,
 *   }
 * }[]}
 */
const exploreDir = (rootDir) => fs
  .readdirSync(rootDir)
  .filter((dir) => !['node_modules', 'out'].includes(dir)
      && dir[0] !== '.')
  .map((dir) => pathfs.resolve(rootDir, dir))
  .filter((dir) => fs.statSync(dir).isDirectory())
  .map((dir) => {
    const packageJSONPath = pathfs.resolve(dir, 'package.json');
    const hasPackageJson = fs.existsSync(packageJSONPath);
    if (hasPackageJson) {
      const packageJSON = require(packageJSONPath);
      return {
        path: dir,
        packageJSON,
      };
    }
    return exploreDir(dir);
  })
  .flat()
  .filter((f) => !f.packageJSON.name.startsWith('@runeya/docker'));
</file>

<file path="common/check-monorepo/jest.config.js">
const path = require('path');


module.exports = {
  ...{
    rootDir: path.resolve(),
    moduleFileExtensions: ['js', 'ts'],
    clearMocks: true,
    testMatch: ['**/src/**/*.spec.(js)', '**/?(*.)+(spec|test).[tj]s?(x)', '**/tests/**/*.spec.(js)'],
    modulePathIgnorePatterns: [],
    testPathIgnorePatterns: [
      '/node_modules/',
      '/dist/',
      '/.idea/',
      '/.build/',
    ],
    collectCoverage: process.env.coverage !== 'false',
    collectCoverageFrom: [
      '**/*.js',
      '!**/node_modules/**',
      '!**/coverage/**',
      '!**/tests/**',
      '!**/gulpfile.js',
      '!*.js',
    ],
    coveragePathIgnorePatterns: [
      '/node_modules/',
      '/dist/',
      '/.idea/',
      '/.build/',
      'testconfig.js',
      'package.json',
      'package-lock.json',
    ],
    transform: {
      '^.+\\.(t|j)sx?$': '@swc/jest',
    },
    testResultsProcessor: 'jest-sonar-reporter',
    transformIgnorePatterns: [
    ],
  },

  rootDir: path.resolve(__dirname),
  collectCoverage: false,
};
</file>

<file path="common/express-error-handler/src/index.js">
const HTTPError = require('@runeya/common-express-http-error');
const errorCodes = require('./errorCodes');

module.exports = () => (err, req, res, next) => {
  const isValidCode = (
    (
      !Number.isNaN(Number(err.code)) || typeof err.code !== 'number'
    ) && errorCodes.map((a) => a.code).includes(Math.floor(+err.code))
  );
  let httpErr;
  if (err instanceof HTTPError && isValidCode) {
    httpErr = err;
  } else {
    httpErr = (!err.code || !isValidCode)
      ? new HTTPError(err, 500, err?.errorId, err?.date, err?.stack)
      : new HTTPError(err.message, err.code, err?.errorId, err?.date, err?.stack);
  }
  console.error(httpErr);
  res.status(Math.floor(httpErr.code)).json({
    errorId: httpErr.errorId,
    date: httpErr.date,
    code: httpErr.code,
    message: httpErr.message,
    details: httpErr.details || err?.details,
    ...(err?.customCode ? { customCode: err.customCode } : {}),
  });
  next(err);
};
</file>

<file path="common/express-http-error/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/common-express-http-error

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

### Bug Fixes

* various changes ([06e6241](https://github.com/runeya/runeya/commit/06e624176595b95c4227fe684242919c7eeda192))

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))

## [1.17.10](https://github.com/runeya/runeya/compare/v1.17.9...v1.17.10) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express-http-error

## [1.17.9](https://github.com/runeya/runeya/compare/v1.17.8...v1.17.9) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express-http-error

## [1.17.8](https://github.com/runeya/runeya/compare/v1.17.7...v1.17.8) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express-http-error

## [1.17.7](https://github.com/runeya/runeya/compare/v1.17.6...v1.17.7) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express-http-error

## [1.17.6](https://github.com/runeya/runeya/compare/v1.17.5...v1.17.6) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express-http-error

## [1.17.5](https://github.com/runeya/runeya/compare/v1.17.4...v1.17.5) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express-http-error

## [1.17.4](https://github.com/runeya/runeya/compare/v1.17.3...v1.17.4) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express-http-error

## [1.17.3](https://github.com/runeya/runeya/compare/v1.11.23...v1.17.3) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express-http-error
</file>

<file path="common/express-http-error/package.json">
{
  "name": "@runeya/common-express-http-error",
  "version": "2.0.0",
  "description": "",
  "private": true,
  "repository": "https://github.com/runeya/runeya",
  "main": "src/index.js",
  "types": "src/index.js",
  "scripts": {
    "test": "echo \"no test\""
  },
  "author": "",
  "license": "ISC",
  "dependencies": {
    "dayjs": "^1.11.10",
    "uuid": "^9.0.1"
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*"
  }
}
</file>

<file path="common/retrigger-all-build/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/common-retrigger-all-build

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))

## [1.17.10](https://github.com/runeya/runeya/compare/v1.17.9...v1.17.10) (2024-02-04)

**Note:** Version bump only for package @runeya/common-retrigger-all-build

## [1.17.9](https://github.com/runeya/runeya/compare/v1.17.8...v1.17.9) (2024-02-04)

**Note:** Version bump only for package @runeya/common-retrigger-all-build

## [1.17.8](https://github.com/runeya/runeya/compare/v1.17.7...v1.17.8) (2024-02-04)

**Note:** Version bump only for package @runeya/common-retrigger-all-build

## [1.17.7](https://github.com/runeya/runeya/compare/v1.17.6...v1.17.7) (2024-02-04)

**Note:** Version bump only for package @runeya/common-retrigger-all-build

## [1.17.6](https://github.com/runeya/runeya/compare/v1.17.5...v1.17.6) (2024-02-04)

**Note:** Version bump only for package @runeya/common-retrigger-all-build

## [1.17.5](https://github.com/runeya/runeya/compare/v1.17.4...v1.17.5) (2024-02-04)

**Note:** Version bump only for package @runeya/common-retrigger-all-build

## [1.17.4](https://github.com/runeya/runeya/compare/v1.17.3...v1.17.4) (2024-02-04)

**Note:** Version bump only for package @runeya/common-retrigger-all-build

## [1.17.3](https://github.com/runeya/runeya/compare/v1.11.23...v1.17.3) (2024-02-04)

**Note:** Version bump only for package @runeya/common-retrigger-all-build
</file>

<file path="common/retrigger-all-build/package.json">
{
  "name": "@runeya/common-retrigger-all-build",
  "private": true,
  "version": "2.0.0",
  "description": "",
  "repository": "https://github.com/runeya/runeya",
  "main": "src/index.js",
  "scripts": {
    "test": "echo \"No test specified\""
  },
  "author": "",
  "license": "ISC"
}
</file>

<file path="common/socket-front/src/CustomObservable.js">
function CustomObservable() {
  /** @type {GenericFunction[]} */
  this.funcs = [];
}
/** @param {GenericFunction} fun */
CustomObservable.prototype.subscribe = function (fun) {
  this.funcs.push(fun);
  return {
    unsubscribe: () => this.unsubscribe(fun),
  };
};

/** @param {any[]} value */
CustomObservable.prototype.next = function (...value) {
  this.funcs.forEach((f) => f(...value));
};

/** @param {GenericFunction} fun */
CustomObservable.prototype.unsubscribe = function (fun) {
  this.funcs = [...this.funcs.filter((f) => f !== fun)];
};

export default CustomObservable;

/**
 * @typedef {(...args: any[]) => any} GenericFunction
 */
</file>

<file path="common/socket-server/src/CustomObservable.js">
function CustomObservable() {
  /** @type {GenericFunction[]} */
  this.funcs = [];
}
/** @param {GenericFunction} fun */
CustomObservable.prototype.subscribe = function (fun) {
  this.funcs.push(fun);
};

/** @param {any[]} value */
CustomObservable.prototype.next = function (...value) {
  this.funcs.forEach((f) => f(...value));
};

CustomObservable.prototype.off = function (fun) {
  this.funcs = this.funcs.filter((f) => f !== fun);
};

CustomObservable.prototype.destroy = function () {
  this.funcs = [];
};

module.exports = CustomObservable;

/**
 * @typedef {(...args: any[]) => any} GenericFunction
 */
</file>

<file path="common/typings/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/common-typings

## [1.17.30](https://github.com/runeya/runeya/compare/v1.17.29...v1.17.30) (2024-02-19)

### Bug Fixes

* **documentation:** add a global documentation ([0ef6b0f](https://github.com/runeya/runeya/commit/0ef6b0f15760d06380e9d7df3fc9c3a0393305d5))

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* build for npm ([0c07b41](https://github.com/runeya/runeya/commit/0c07b410a237412c1c73bbb42fe45c1f9c220482))
* no cyclic dependencies ([496f153](https://github.com/runeya/runeya/commit/496f153c9492fc25873f1498a0b1f22556601eed))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))

## [1.17.10](https://github.com/runeya/runeya/compare/v1.17.9...v1.17.10) (2024-02-04)

**Note:** Version bump only for package @runeya/common-typings

## [1.17.9](https://github.com/runeya/runeya/compare/v1.17.8...v1.17.9) (2024-02-04)

**Note:** Version bump only for package @runeya/common-typings

## [1.17.8](https://github.com/runeya/runeya/compare/v1.17.7...v1.17.8) (2024-02-04)

**Note:** Version bump only for package @runeya/common-typings

## [1.17.7](https://github.com/runeya/runeya/compare/v1.17.6...v1.17.7) (2024-02-04)

**Note:** Version bump only for package @runeya/common-typings

## [1.17.6](https://github.com/runeya/runeya/compare/v1.17.5...v1.17.6) (2024-02-04)

**Note:** Version bump only for package @runeya/common-typings

## [1.17.5](https://github.com/runeya/runeya/compare/v1.17.4...v1.17.5) (2024-02-04)

**Note:** Version bump only for package @runeya/common-typings

## [1.17.4](https://github.com/runeya/runeya/compare/v1.17.3...v1.17.4) (2024-02-04)

**Note:** Version bump only for package @runeya/common-typings

## [1.17.3](https://github.com/runeya/runeya/compare/v1.11.23...v1.17.3) (2024-02-04)

**Note:** Version bump only for package @runeya/common-typings
</file>

<file path="common/typings/package.json">
{
  "name": "@runeya/common-typings",
  "private": true,
  "version": "2.0.0",
  "description": "",
  "repository": "https://github.com/runeya/runeya",
  "types": "src/index.ts",
  "main": "src/index.ts",
  "scripts": {
    "test": "echo \"no test\""
  },
  "author": "",
  "license": "ISC",
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*"
  }
}
</file>

<file path="common/workflows/src/walker.js">
const cp = require('child_process');
const PromiseB = require('bluebird');
const pathfs = require('path');
const os = require('os');

const forks = [];
module.exports.import = async (conf = {
  paths: ['.'],
}) => {
  const paths = conf.paths.map((path) => pathfs.resolve(path));
  this.currentFile = '';
  return new PromiseB((resolve) => {
    this.status = 'import is working';
    const dirs = paths;
    let finish = 0;
    const nbCpus = os.cpus().length;
    const files = [];
    for (let i = 0; i < nbCpus; i += 1) {
      const fork = cp.fork(pathfs.resolve(__dirname, './walkerFork.js'));
      // eslint-disable-next-line func-names
      fork.on('message', function (data) {
        // @ts-ignore
        dirs.push(...(data?.dirs || []));
        // @ts-ignore
        files.push(...(data?.files || []));
        // @ts-ignore
        forks.push(this);
      });
      forks.push(fork);
    }
    const loop = setInterval(() => {
      if (dirs.length === 0 || forks.length === 0) return;
      const dir = dirs.pop();
      if (!dir) return;
      const fork = forks.pop();
      if (!fork) return;
      fork.send({ ...conf, dir });
    });
    const finishInterval = setInterval(async () => {
      if (finish === 5) {
        clearInterval(loop);
        clearInterval(finishInterval);
        forks.forEach((fork) => fork.kill('SIGKILL'));
        resolve(files);
      }
      if (dirs.length === 0 && forks.length === os.cpus().length) finish += 1;
      else finish = 0;
    }, 100);
  });
};
</file>

<file path="common/workflows/src/walkerFork.js">
const fs = require('fs/promises');
const pathfs = require('path');
const PromiseB = require('bluebird');

process.on('message', async (/** @type {Record<string, any>} */conf) => {
  const path = conf.dir;
  const dirs = [];
  const files = [];
  if (
    pathfs.basename(path).charAt(0) === '.'
    || (['node_modules'].includes(pathfs.basename(path)))
  ) return process.send?.({ dirs, npmPath: null });
  await fs
    .readdir(path)
    .then(async (_files) => {
      await PromiseB.map(_files, async (file) => {
        if (file.charAt(0) === '.' && file !== '.mirror') return;
        const absolutePath = pathfs.resolve(path, file);
        const stat = await fs.stat(absolutePath);
        if (stat.isDirectory() && file !== 'out') {
          dirs.push(absolutePath);
        } else if (stat.isFile()) {
          files.push(absolutePath);
        }
      });

      process.send?.({
        dirs, files,
      });
    });
  return null;
});
</file>

<file path="fronts/app/src/assets/theme/_a.scss">
a {
  color: var(--system-accent-backgroundColor1);
}
</file>

<file path="fronts/app/src/assets/theme/_input.scss">
input {
  padding: 3px 5px;
  border-radius: 10px;
  border: 1px solid var(--system-border-borderColor);
  box-sizing: border-box;
  background-color: var(--system-backgroundColor);
  color: var(--system-color);
}
</file>

<file path="fronts/app/src/assets/androidstudio.svg">
<?xml version="1.0" ?><!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
<svg fill="#000000" width="800px" height="800px" viewBox="0 0 32 32" id="Camada_1" version="1.1" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><style type="text/css">
	.st0{fill-rule:evenodd;clip-rule:evenodd;}
</style><path class="st0" d="M13.8,4h4.5v2.2h1.2c0.6,0,1,0.4,1,1v4.6l-0.6,0.8l6.2,10.8l0.9,3.9c0.1,0.5-0.5,0.9-0.9,0.5l-2.9-2.7l-2-3.5  C19.6,22.5,17.9,23,16,23s-3.6-0.5-5.1-1.4l-2,3.5L6,27.8c-0.4,0.4-1.1,0-0.9-0.5l0.9-3.9l2.3-4.1c-1.5-1.7-2.3-4-2.3-6.4  c0-0.4,0-0.8,0.1-1.1h3c-0.1,0.4-0.1,0.7-0.1,1.1c0,1.3,0.4,2.5,1,3.6l2.3-3.9l-0.6-0.8V7.2c0-0.6,0.4-1,1-1h1.2V4z M14.4,15.4  L12.4,19c1.1,0.6,2.3,1,3.6,1s2.6-0.4,3.6-1l-2.1-3.6l-0.8,1c-0.4,0.5-1.2,0.5-1.6,0L14.4,15.4z M14.1,11.8L14.1,11.8  c0.4,0.7,1.1,1.1,1.9,1.1c0.8,0,1.6-0.4,1.9-1.1c0.2-0.3,0.3-0.7,0.3-1.1c0-1.2-1-2.2-2.2-2.2s-2.2,1-2.2,2.2  C13.8,11.1,13.9,11.5,14.1,11.8z"/></svg>
</file>

<file path="fronts/app/src/assets/cursor.svg">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.dev/svgjs" width="260" height="260" viewBox="0 0 260 260"><image width="260" height="260" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQQAAAEECAYAAADOCEoKAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAABaWSURBVHgB7d1ZzBVVugbgD/w1QogiSAIyWE5IjEGNMZhgwiZRAty0wiXicAHRG885ide2fdfGiz7GRE9iiLY4pI2i3jigCZtEjJqo/BKNokCJCILIoCgiKGe/VXtBUeyhhlVVa3ifZP1zq81PvXutb32raoz4ZWJiBN330v0YLu3xs/0+7/fPpmaEOb+nvnaoMw6nvpZ8f6g7vDBG3KIu9Ou77y/tvg+EFyyVE8rpgBhNfL5ZHAoMmwMh6IxWZ1wncQBg8IKnJiAQNnfHxu77UCxkUyDgYr+9MxZIHASBEJkr7Iy2xAHxmlgyizA9EBAC93TG3yQOASJbtTvj3933oVAurc54tTMOdsZJDg7HxtPCF7hMWp2xQez65XJwFB0bJJ4BU0pLGAQc/o4dwhlDJBAGAQeHGk+Lp8VyFAv/Lnb9sjg46hp/l4Y0scvQEo+TkCijsDPulXhXojZjpT6YFfxL4iVCIEQ0SCDxtfIvqVFdM4RAGARERYWdsVBq6F+oY4Zwd2d8KgwDoqICia+h/5aKnSPVwnTnn51xvhBRGbiGFnc/3igVqWrJgHoBCoe3CxHphrMRKDhqPx9RRSAEErcdXy9EVJVQKqgr6A6EQFg8JKpLKJpDQWcgBMIwIKpbKBpDQVcgBMIwIGpKKJpCQUcgBMIwIGpaKBpCoWwgYDeBPQZEZsCt2xAKhXcfyjYm8UwCkTmws/e0lFCmMQknsu4TIjLJHIln7m9LAUUD4b8k7kAkIvPcLHEtYVRyKlJDCCSuG/CW50TmQh3hBslZZCwSCDuEdQMiG4QSh0LmImPeJQMOKy0WIrIBZvE4FJW5npBnhtCSuN+AiOyCrch2lh/MEwhcKhDZKZSMS4esSwZsMfIoM5GdsHQ4JhlmCVlmCIHEswMisttlMmTXIUunYmO3hCYirYZ2MQ6bIbSEhUQilwwsMA4LBBYSidzSljgUehq0ZLhHGAZErmnJgOdIDgqEu4WIXNS3Lthv27HVGQ8LOW/y5MmyfPlymTp1quzevVtOnDgh5LxA4lu5h+lv9AsEJAjvmuyw8ePHy6233ip33nmnBEEgO3fulGnTpsm4cePkyJEjDAb3oTfhP+kvjvT4wUDi+gE5au7cudGsYNKkSWd9D6EwZcqUKCC2b98u5KyWxKFwRvfiSJ8fJAddddVVsmTJkuj9ICMjI3L55ZfLJZdcEoUClhLkHITBPZ3xv8kv9goEFhMdg+XB4sWLZeHChbn+d+eff75cc8010Yxh69atcvToUSGn/E2GBAJSoyXkDMwIEASoDRSFQMDYs2dPNGNgMDijJallQzoQeIDJEVgWoGDYq05QFOoLF110EZcRbsE1/4z6JB0IC4Sshm3EFStWDK0TFKWWEagxYBmxb98+Iavhmn9GfZIOhJaQlYrWCYpCMGC3gssI67WSnyQDIRC2Klup1WrJ0qVLS9UJisIyAgOhgHBgMFgn6I4QnyQDgY1IlsGyAP0E06dPl6Zxm9JqLekuG0ZSXyQLVF0nKCpZXxgdHZVffvlFyAqnJgPJQLhOyGioEyxYsKD0NmLVEAzz5s1jfcEep659LhksgQsMywOTgyAtWV9gG7TRzpohTBQ+iclIWduNTcb6gvHU9X9IBQJnB4ZBnQBBgJmBC1R9YdasWVF9gcsI4wSdsXkk8QkZwJY6QVETJkyQ+fPns75gHkwKGAgmGXQs2TWqDRpLCNYXjBDgjQoE7jA0yIU6QRFYRrC+YIxL8SZZVKSa1d1ubCoeszZCgDdcMjREx7Fk1/CYdaMCvGEg1KyKY8mu4THrRkSrhBHhcqEWprYbm4rHrGsX9SIwECqmthFxGpHy4zHrWkWBEAhVosljya5JtkF/9913cvz4cSHtJo4IaefrNmIduE1ZqYAzBI1QJ1i2bFk0xaXqJOsLH3/8MZcR+nCGoIPr7camQjCwDVovzhBKwuEj1Am4jdgcHrPWJuAMoSDWCczD+kJ53HbMCcsD1AlcOZbsGlVfwIzhiy++4DIin0sZCBmxTmAXdDqyvpAflwwZsN3YXqoNGk+zxqDBEAiXCvU0Y8aMaHnAOoHdsIyYPXt2dLcm1hcGuogzhB54LNlNqr6gDk5xGXGWCxkIKWw3dp/apkQLNJYRDIbTGAhdrBP4Z+bMmdH9F7iMOM37QOCxZL8l26A///xzOXjwoHjM39OOPJZMSQiGG2+80fdtSj/PMrBOQP34fszaq0BguzFl5WsbtBeBwGPJVISPx6ydDgS2G5MOPh2zdjYQfHoKEtUDtQVsU6J3wdVj1s4FAusEVKWRkRGn6wvObDuy3Zjq5Ogx64ljOm9OigMeeughWb16tVAx+/fvFyrm999/lzvuuCOqMdjOmSXD+++/L9u2bZO77rpLFi1aJJTP9OnThfI5duyY/Pzzz/LSSy9FoeCCczrjYXEA1nW//vprFAxY282ZM0cmTJggRLr99ddfcvjwYTl06JDs3btXHn/88Wh24EIoOLnLsGnTpmhgprBy5UqZOnWqEOmAGcGRI0eiUIDXXntNXDJWHLZ+/Xp58MEHo/dEZWB58MMPP0SBoMIA24944XGJ04EAmNI9+uij0dFmLCeI8jhx4oT8+OOP0cDHSVgquMapGsIgqC+02+0oIK644grWF2ggzAJwuAl/b/7888+zvv/ee++dMTtwpYbg/AwhDcsH1BXWrl0bTQGJ0lAjwN+NsWN7Xx7Yon399dfFRd7MENJGR0ejJQRmCpgxEKFOsGPHjmhGcPJk//YchMGWLVvO+BpnCA5I1hc4W/BXsk4w7BAcZgcuF6m9DgQFwYBlBMKBweAP1Amwa7Bv375odpCFa9uMaQyEhGR9gdz222+/nbWNOEy6kOgiBkIPzz77bLSMYP+CezATwNLgwIEDmYNAcbWQmMRA6EPVF+677z4uIxyAix8hgDDIujxIwuzAhwNgDIQhcGCK9QV7qToBfndYJhTh8jZjGh/UkhGWD9iqxF2YcNSVzIeZAJ6zkO4wzAuFRF+Oh3OGkAOWEU888QTrC4ZTW4i92o3zQhC4XkhM8rYxqQx1zJpt0GZRx5Jx96Je7cZF4LxCltmBK41JDIQSUF949dVXo4DAcwIZDM3ZtWtX9HsoUjDsB4XEd955J9PPslORTlm3bh2PWTdEHUuGvNuIw/hSSExiIGiSbING8ZGqNehYsg4IAx/vM8lA0AzBgNkCtymrkdxG1Lk8SHL9vMIgDISKJNugcZyWylPHkhEIVcI2Y9GeBdsxECqGNmh0O7K+UJxqN8ZNTXXXCdJ822ZMYyDUgMesi0FtABdo0XbjIh555BHxGQOhRjxmnU3yWHKdW3m+nFcYhIHQACwf7r//fh6z7gFrdwRBnmPJuv69Pm4zpjEQGoICGY9Zn5Y8llzFNuIwaEDi4+wYCI1T9QVsVfq4jCh7LFkHBIHrd0LKioFgCDQz+VRf0HEsWReGwWk8/mwYH45Z6zqWrMOXX37p9TZjGmcIBnL1mPUff/xRabtxEWvWrBE6jacdDebKMWt1LBmzAl3HknXQedNUnnak2qg26CeffNK6+oJqNzatfdun26LlwUCwiE3HrFEn2Lp1ay3txkVwm7E3BoJlkm3QuEGLaZLHksePHy8m8vk04zAMBEshGHBoypRtSrWNiFlBU/0EWXGbsT8GguVMeNrU7t27Tx1LvuCCC8RkPjx9qQwGgiOaaINW7caYHZhYJ+iFhcTBGAgOqeuYNeoE27dvb7TduAgWEodjIDioqmPWyWPJ5513ntiEhcRsGAgO03nMGk03TRxL1sWnpy+VwUBwXNlj1qpOgIvJlHbjvHy/LVoebF32hGqDxtp/zpw5Q9ugVbsxGotMajcuIuvTl8pwpXWZpx09g1dKjEWLFkV1hqlTp57xfQTA2LFjo5mFjUuDNGwz4kQjZcMlg6ewfEi3QWN5gFc5W+sEvXCbMR8GgsfUNuXq1auj5iKTjiXr4OvTl8rgksFj5557rlx99dXR0WosEUw9e1AEtxmLYSB4CiGAMEAouMjnpy+VwUDwzMUXXyzXXnutXHjhheIqbjMWx0DwBJYDN9xwQxQIrvP96UtlMBAchyUBejSwRHB1eZDEpy+Vw0Bw2KxZs6LlgQ9BAHz6UnkMBAdhWYCCoQ/LgySeZiyPgeAQ1AkQBJgZ+IZPX9KDgeAA3+oEvTAM9GAgWG7atGlRncClpqK8PvnkE24zasJAsJSvdYJeXnzxRSE9GAiWSbYbE7cZdWMgWEQFga91gjQ+fUk/BoIFsCxAl6HPdYJeeFs0/RgIBvOp3TgvnleoBgPBQKwTDMdCYjUYCIZx/ViyDigkYquR9GMgGMKHY8m6sJBYHQZCw1gnyIe3RasWA6EhbDfOD0GA5QJVh4HQAN+OJevCbcbqMRBqxHbj4rjNWA8GQg0wE8CMwMdjybqsWbNGqHoMhAqxTqDHzp07o5nVuHHj5KuvvuLdlCvEQKgI2431UY9iwwwLf654PuW2bduE9GMgaIY+AiwPWCfQA2GQnBEgYPHni5kXZguYPZA+DARN2G6sH4Kg34NaVf/G5MmTuYzQiIGgAduNq5Hlqc1YRmBgCYGlBIOhHAZCCawTVAcXdp7lAEIZt5PjMqIcBkIBbDeuXpGORPV7wWzt008/ZRNTAQyEHNQ24pw5c4Sqg1f4MlN/BMP8+fOjfw7rC/kwEDJinaAex48fz1Q7yELVF/DPQ30B/2wajIEwBNuN64XioO5XdMzoEAysLwzHQOhD7XejUEX1GLTNWFayvoAzEVxG9MZASGG7cXOqCoMkBMNtt93G+kIfDIQETCvxCsJtxPrt2bOn1uk8fteY/WGJgmCgGANBWCcwwZYtW6RumAGyvnAmrwOBx5LNUHabsSxVX5g5c2bUv+DzMsLLQGCdwBxVFhLzwgzR9/qCd4HAdmOzpE8zmsDnY9beBAKPJZsn73mFOvl6zNr5QOCxZHM1UUjMy7dj1k4HAtuNzYVXXGw12sKXY9ZOBgKfgmQ+UwqJebl+zNqpQOCxZDuYWEjMI9kG/dFHH8nhw4fFFc4EwpQpU+Smm27i8sBwJhcS80IwtFqt6P/PZ599Ji4YK454++23+URgC9g+O0j75ptv5IUXXpB9+/aJC8Z0xsHOmCiOmDRpkqxatUpmzJghlN2iRYsq781AEKxfv15c8NNPP8nzzz8vX3/9tbjknM64TxwKhKNHj0bHWw8cOCDTp09nA1JGdXRt4rZox44dE5sh1N5991157rnnZO/eveKY0Nltxw8//DAaS5culSVLlgg1C+ts24tv+Pv0yiuvRC86rnK+MemNN96QDz74IAqGefPmCTXD1m1GQJ0Af49cWx70ghrCjs4IxANYQqC+gK4zOlOVNQSEgY2BgOXBunXropmBJ0KvAkHBTAHLCAbDaVUFgo2FRPw3b9y4UTZs2OD08qAHd2sIgyDxMf27+eabWV+omG0zAywP1q5dGxWlfeTtDVLwC2d9oVooItrShORTnWAQBMIh8RiCAVtI+IvAZYReNqy9sTx46623ouUBxUsGrwNBUduUrC/o0fRt0bJ48803fawTDMSbrKao+gKXEcWZdFu0XnyvEwzCQOhBLSOwply+fLnMnTtXKDtTZweuthvrhNbl2zuDTy/tAVNJHJjyoQ1aV+sygsC02oFqN37qqac4KxgsqiG4c5i7Isk2aBx3HTdunFBvpi0V2u12NNNjnSATP/sQiuI25WB1P31pEG4jFsNAyClZX3jggQe4G5Fgwk1TUSdAu7ErNyyp2WHUEK7vjJZQLpiCYjrqSn2hbA0BM4MmZwfJY8nff/+9UCFvc4ZQEmoLeDVauHCht23QTW8z4neAGRsLhuUhEEKhUjBb8Lm+0NRt0Vgn0I5FRZ1UfQGvWCtWrPCivtDETVM9PJZcG7YuVwCvWA8//LAXbdB1FhI9PpZcl5BLhgqpNmjUF9C/4Jo6n77EduN64AYpgcQ3SaEK4W7QJtcXitwgBTc+qbp2sGvXrmh5wDpBLS7jkqEmrh2zrrqQyGPJjTg0pvuBU89msAGWEBimBEOeGQIuVlyox48flyqw3bgxY9QuA2YJDIQa4S89+hds3KbE7KCKMGCdoFEh3owkPgmEapVsg165cqVceeWVYroqthl5LNkIId6oQPhWqDEIhscee8yKbUo8fUkXtY2IQKTGRaeekzMEapjpx6x13viEdQLjbMYbBoKBTG2D1nFege3GxgrxRu0y4MTjp0LGQf9CHcesh+0ylH36Eo8lG29hZ7RVIGCH4aCQsaquLwwKhDJPX2K7sTUu6oxDyW1Hbj0arMlj1kVnBvjvxdOSuY1oPHX9n3HHJBQVWkLGauKY9f79+3NvM7JOYJ3N6oNkIIwKA8EKqn8Br8DLli2rtL6Au05nxXZja42qD9IzBLIIAgGjqvpCnm1GPgXJam31wUivL5JdqnjaVNbborHd2AmnJgNjUt/AMehAyFpFj1mndxlw45Nt27b1/Xm2Gzsj7IzL1CfpW6htFAaC1XQcs8bsoF8YsE7gnHbyk5Ee37xbyHqqDbrIMet+SwW2GztpY/KT9JKBDUoOyrKMUEsGFBLTOwuoE7z88st83oGbooYk9cmYHj+AuWBLyDkIhlWrVsmMGTPO+p4KhORt0VgncF5b4pblU87p8UNIjMVCzsFUf9OmTT2fNoUnN2F2gFlA8ilIe/fuFXLWPyTVbtBrhoBlww5hG7PzsIxQbdC33HJLtFRAsRDtxqwTeAG7C2HyC2P6/OCrnXG7kPNUfWH27NlRPwGXB954pjPuTX+xXyC0JK4lEJGbouPO6S+O7fPDbWHnIpGr2tLn+h474H/0DyEiF/273zfGyGDcgiRySyiJVuW0QTME4CyByC33DvrmsEBoC2sJRK54RoZcz8OWDBAIHwZL5IKz+g7SzpHh0OeM4GgJEdkKy//Xhv1QlhkCoGsRt2kPhIhsE8qAQmLSsBqCglnCvUJENsp87WZZMiihxAefbhYissVjnfF/WX8465JB4dKByB6hZFwqKFmXDAqWDgslcUMFIjKSulZzyRsIEHbG/wgRmQy7CqHklKeGkISbKrCeQGQmhME/pYC8NYQ03jeByCzoNbhDCiobCCgy4gDU9UJETQs74wYpUeMrUkNIwr/4DimwViEirULRUPAvO0NQAolnCoEQUd1CicMglJJ0BQIEwlAgqlsomsIAdAYCBMJQIKpLKBrDAMrWENJC0fwfSEQ9Yetf+7WmOxAglLjSOfSoJREVgmurkhfeoo1Jw/zeGf8R3keBSDccVsLpxd+lAlUFgtLujMMSdzSeL0RUFLYT75eCHYhZ6S4q9hMIi41ERYVSU22uihpCL6HExzAfEyLKA9cManKh1KCuGUJSqzOeFs4WiAYJJa4VtKVGdc0QktoSzxb4zAei3nBtYFbQFs8EEt8r/iQHBwfrbEpL4mc/2PBL4+DQPTYIt+d7ukfiPxwbfokcHGXHBmEQZNISLiU43BwHJb6xUEsM1MQuQx6BxH9wdwuTlOzW7ozXJX6hM/YmxaYHQhLuzoTbtbU6Y4Gw+EJmCyUOgY0Snz2w4k7lNgVCWiDxrdtanXFd9+OJQlQ/XOw4fTjafd8WS0/82hwIvSAQEAxBd1zX/Zr6nKiIQ90Rdse33febu++deU6Ja4EwzEQ5HRDS4z2+d2Hqa0m9vpble1QtdcFm/X7682+778PE98PEz3nzYKL/ByLHX/FUYzniAAAAAElFTkSuQmCC"></image><style>@media (prefers-color-scheme: light) { :root { filter: none; } }
@media (prefers-color-scheme: dark) { :root { filter: none; } }
</style></svg>
</file>

<file path="fronts/app/src/assets/intellij.svg">
<svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>IntelliJ IDEA</title><path d="M0 0v24h24V0zm3.723 3.111h5v1.834h-1.39v6.277h1.39v1.834h-5v-1.834h1.444V4.945H3.723zm11.055 0H17v6.5c0 .612-.055 1.111-.222 1.556-.167.444-.39.777-.723 1.11-.277.279-.666.557-1.11.668a3.933 3.933 0 0 1-1.445.278c-.778 0-1.444-.167-1.944-.445a4.81 4.81 0 0 1-1.279-1.056l1.39-1.555c.277.334.555.555.833.722.277.167.611.278.945.278.389 0 .721-.111 1-.389.221-.278.333-.667.333-1.278zM2.222 19.5h9V21h-9z"/></svg>
</file>

<file path="fronts/app/src/assets/nodered.svg">
<svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Node-RED</title><path d="M3 0C1.338 0 0 1.338 0 3v6.107h2.858c1.092 0 1.97.868 1.964 1.96v.021c.812-.095 1.312-.352 1.674-.683.416-.382.69-.91 1.016-1.499.325-.59.71-1.244 1.408-1.723.575-.395 1.355-.644 2.384-.686v-.45c0-1.092.88-1.976 1.972-1.976h7.893c1.091 0 1.974.884 1.974 1.976v1.942c0 1.091-.883 2.029-1.974 2.029h-7.893c-1.092 0-1.972-.938-1.972-2.03v-.453c-.853.037-1.408.236-1.798.504-.48.33-.774.802-1.086 1.368-.312.565-.63 1.22-1.222 1.763l-.077.069c3.071.415 4.465 1.555 5.651 2.593 1.39 1.215 2.476 2.275 6.3 2.288v-.46c0-1.092.894-1.946 1.986-1.946H24V3c0-1.662-1.338-3-3-3zm10.276 5.41c-.369 0-.687.268-.687.637v1.942c0 .368.318.636.687.636h7.892a.614.614 0 0 0 .635-.636V6.047a.614.614 0 0 0-.635-.636zM0 10.448v3.267h2.858a.696.696 0 0 0 .678-.69v-1.942c0-.368-.31-.635-.678-.635zm4.821 1.67v.907A1.965 1.965 0 0 1 2.858 15H0v6c0 1.662 1.338 3 3 3h18c1.662 0 3-1.338 3-3v-1.393h-2.942c-1.092 0-1.986-.913-1.986-2.005v-.445c-4.046-.032-5.598-1.333-6.983-2.544-1.437-1.257-2.751-2.431-7.268-2.496zM21.058 15a.644.644 0 0 0-.647.66v1.942c0 .368.278.612.647.612H24V15z"/></svg>
</file>

<file path="fronts/app/src/assets/sublimetext.svg">
<svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Sublime Text</title><path d="M20.953.004a.397.397 0 0 0-.18.017L3.225 5.585c-.175.055-.323.214-.402.398a.42.42 0 0 0-.06.22v5.726a.42.42 0 0 0 .06.22c.079.183.227.341.402.397l7.454 2.364-7.454 2.363c-.255.08-.463.374-.463.655v5.688c0 .282.208.444.463.363l17.55-5.565c.237-.075.426-.336.452-.6.003-.022.013-.04.013-.065V12.06c0-.281-.208-.575-.463-.656L13.4 9.065l7.375-2.339c.255-.08.462-.375.462-.656V.384c0-.211-.117-.355-.283-.38z"/></svg>
</file>

<file path="fronts/app/src/assets/vscode-icon.svg">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg
   viewBox="0 0 100 100"
   fill="none"
   version="1.1"
   id="svg11"
   sodipodi:docname="Visual_Studio_Code_1.35_icon.svg"
   inkscape:version="1.4 (e7c3feb100, 2024-10-09)"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg">
  <sodipodi:namedview
     id="namedview11"
     pagecolor="#ffffff"
     bordercolor="#000000"
     borderopacity="0.25"
     inkscape:showpageshadow="2"
     inkscape:pageopacity="0.0"
     inkscape:pagecheckerboard="0"
     inkscape:deskcolor="#d1d1d1"
     inkscape:zoom="9.48"
     inkscape:cx="50"
     inkscape:cy="50"
     inkscape:window-width="5120"
     inkscape:window-height="1378"
     inkscape:window-x="0"
     inkscape:window-y="0"
     inkscape:window-maximized="1"
     inkscape:current-layer="svg11" />
  <mask
     id="mask0"
     mask-type="alpha"
     maskUnits="userSpaceOnUse"
     x="0"
     y="0"
     width="100"
     height="100">
    <path
       fill-rule="evenodd"
       clip-rule="evenodd"
       d="M70.9119 99.3171C72.4869 99.9307 74.2828 99.8914 75.8725 99.1264L96.4608 89.2197C98.6242 88.1787 100 85.9892 100 83.5872V16.4133C100 14.0113 98.6243 11.8218 96.4609 10.7808L75.8725 0.873756C73.7862 -0.130129 71.3446 0.11576 69.5135 1.44695C69.252 1.63711 69.0028 1.84943 68.769 2.08341L29.3551 38.0415L12.1872 25.0096C10.589 23.7965 8.35363 23.8959 6.86933 25.2461L1.36303 30.2549C-0.452552 31.9064 -0.454633 34.7627 1.35853 36.417L16.2471 50.0001L1.35853 63.5832C-0.454633 65.2374 -0.452552 68.0938 1.36303 69.7453L6.86933 74.7541C8.35363 76.1043 10.589 76.2037 12.1872 74.9905L29.3551 61.9587L68.769 97.9167C69.3925 98.5406 70.1246 99.0104 70.9119 99.3171ZM75.0152 27.2989L45.1091 50.0001L75.0152 72.7012V27.2989Z"
       fill="white"
       id="path1" />
  </mask>
  <g
     mask="url(#mask0)"
     id="g6">
    <path
       d="M 96.4614,10.7962 75.8569,0.875542 C 73.4719,-0.272773 70.6217,0.211611 68.75,2.08333 L 1.29858,63.5832 c -1.814273,1.6541 -1.812187,4.5105 0.0045,6.162 l 5.50964,5.0088 c 1.48521,1.3502 3.72198,1.4496 5.32108,0.2365 L 93.3609,13.3699 C 96.086,11.3026 100,13.2462 100,16.6667 v -0.2392 c 0,-2.401 -1.3754,-4.5897 -3.5386,-5.6313 z"
       fill="#0065a9"
       id="path2"
       style="display:inline;fill:#000000;fill-opacity:1" />
    <g
       filter="url(#filter0_d)"
       id="g3"
       style="display:inline">
      <path
         d="m 96.4614,89.2038 -20.6045,9.9207 c -2.385,1.1485 -5.2352,0.6639 -7.1069,-1.2078 L 1.29858,36.4169 c -1.814273,-1.6542 -1.812187,-4.5106 0.0045,-6.1621 L 6.81272,25.246 C 8.29793,23.8958 10.5347,23.7964 12.1338,25.0095 L 93.3609,86.6301 C 96.086,88.6974 100,86.7538 100,83.3334 v 0.2392 c 0,2.4009 -1.3754,4.5896 -3.5386,5.6312 z"
         fill="#007acc"
         id="path3"
         style="display:inline;fill:#000000;fill-opacity:1" />
    </g>
    <g
       filter="url(#filter1_d)"
       id="g4"
       style="display:inline">
      <path
         d="M 75.8578,99.1263 C 73.4721,100.274 70.6219,99.7885 68.75,97.9166 71.0564,100.223 75,98.5895 75,95.3278 V 4.67213 C 75,1.41039 71.0564,-0.223106 68.75,2.08329 70.6219,0.211402 73.4721,-0.273666 75.8578,0.873633 L 96.4587,10.7807 C 98.6234,11.8217 100,14.0112 100,16.4132 v 67.1739 c 0,2.402 -1.3766,4.5915 -3.5414,5.6325 z"
         fill="#1f9cf0"
         id="path4"
         style="display:inline;fill:#000000;fill-opacity:1" />
    </g>
    <g
       style="mix-blend-mode:overlay"
       opacity="0.25"
       id="g5">
      <path
         fill-rule="evenodd"
         clip-rule="evenodd"
         d="m 70.8511,99.3171 c 1.575,0.6135 3.371,0.5742 4.9606,-0.1907 L 96.4,89.2197 c 2.1634,-1.041 3.5392,-3.2305 3.5392,-5.6326 V 16.4133 c 0,-2.4021 -1.3757,-4.5916 -3.5391,-5.6326 L 75.8117,0.873695 C 73.7255,-0.13019 71.2838,0.115699 69.4527,1.44688 69.1912,1.63705 68.942,1.84937 68.7082,2.08335 L 29.2943,38.0414 12.1264,25.0096 C 10.5283,23.7964 8.29285,23.8959 6.80855,25.246 l -5.5063,5.0088 c -1.815584,1.6516 -1.817665,4.5079 -0.0045,6.1621 L 16.1863,50 1.29775,63.5832 c -1.813165,1.6542 -1.811084,4.5105 0.0045,6.162 l 5.5063,5.0088 c 1.4843,1.3502 3.71975,1.4496 5.31785,0.2365 L 29.2943,61.9586 68.7082,97.9167 c 0.6235,0.6238 1.3556,1.0937 2.1429,1.4004 z M 74.9544,27.2989 45.0483,50 74.9544,72.7012 Z"
         fill="url(#paint0_linear)"
         id="path5"
         style="display:none;fill:#000000;fill-opacity:1" />
    </g>
  </g>
  <defs
     id="defs11">
    <filter
       id="filter0_d"
       x="-8.39411"
       y="15.8291"
       width="116.727"
       height="92.2456"
       filterUnits="userSpaceOnUse"
       color-interpolation-filters="sRGB">
      <feFlood
         flood-opacity="0"
         result="BackgroundImageFix"
         id="feFlood6" />
      <feColorMatrix
         in="SourceAlpha"
         type="matrix"
         values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
         id="feColorMatrix6" />
      <feOffset
         id="feOffset6" />
      <feGaussianBlur
         stdDeviation="4.16667"
         id="feGaussianBlur6" />
      <feColorMatrix
         type="matrix"
         values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"
         id="feColorMatrix7" />
      <feBlend
         mode="overlay"
         in2="BackgroundImageFix"
         result="effect1_dropShadow"
         id="feBlend7" />
      <feBlend
         mode="normal"
         in="SourceGraphic"
         in2="effect1_dropShadow"
         result="shape"
         id="feBlend8" />
    </filter>
    <filter
       id="filter1_d"
       x="60.4167"
       y="-8.07558"
       width="47.9167"
       height="116.151"
       filterUnits="userSpaceOnUse"
       color-interpolation-filters="sRGB">
      <feFlood
         flood-opacity="0"
         result="BackgroundImageFix"
         id="feFlood8" />
      <feColorMatrix
         in="SourceAlpha"
         type="matrix"
         values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
         id="feColorMatrix8" />
      <feOffset
         id="feOffset8" />
      <feGaussianBlur
         stdDeviation="4.16667"
         id="feGaussianBlur8" />
      <feColorMatrix
         type="matrix"
         values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"
         id="feColorMatrix9" />
      <feBlend
         mode="overlay"
         in2="BackgroundImageFix"
         result="effect1_dropShadow"
         id="feBlend9" />
      <feBlend
         mode="normal"
         in="SourceGraphic"
         in2="effect1_dropShadow"
         result="shape"
         id="feBlend10" />
    </filter>
    <linearGradient
       id="paint0_linear"
       x1="49.9392"
       y1="0.257812"
       x2="49.9392"
       y2="99.7423"
       gradientUnits="userSpaceOnUse">
      <stop
         stop-color="white"
         id="stop10" />
      <stop
         offset="1"
         stop-color="white"
         stop-opacity="0"
         id="stop11" />
    </linearGradient>
  </defs>
</svg>
</file>

<file path="fronts/app/src/components/Editor.vue">
<template>
  <div ref="monacoRef" class="monaco"></div>
</template>

<script setup>
import { nextTick, onMounted, ref, shallowRef, watchEffect } from 'vue'
import * as monaco from 'monaco-editor';
// @ts-ignore
import editorWorker from 'monaco-editor/esm/vs/editor/editor.worker?worker';
// @ts-ignore
import jsonWorker from 'monaco-editor/esm/vs/language/json/json.worker?worker';
// @ts-ignore
import cssWorker from 'monaco-editor/esm/vs/language/css/css.worker?worker';
// @ts-ignore
import htmlWorker from 'monaco-editor/esm/vs/language/html/html.worker?worker';
// @ts-ignore
import tsWorker from 'monaco-editor/esm/vs/language/typescript/ts.worker?worker';
import monokai from './Editor-monokai.json'

const props = defineProps({
  modelValue: { default: '' },
  language: { default: 'text/plain' },
  additionalOptions: {
    /** @type {import('monaco-editor/esm/vs/editor/editor.api').editor.IStandaloneDiffEditorConstructionOptions} */
    default: {}
  },
  diff: { default: false }
})
const emit = defineEmits([
  'update:modelValue',
  'save',
  'focus',
  'blur'
])

const monacoRef = ref()
const isReady = ref(false)
/** @type {import('vue').ShallowRef<import('monaco-editor').editor.IStandaloneDiffEditor | import('monaco-editor').editor.IStandaloneCodeEditor | undefined>} */
let editor = shallowRef()

self.MonacoEnvironment = {
  getWorker(_, label) {
    if (label === 'json') {
      return new jsonWorker();
    }
    if (label === 'css' || label === 'scss' || label === 'less') {
      return new cssWorker();
    }
    if (label === 'html' || label === 'handlebars' || label === 'razor') {
      return new htmlWorker();
    }
    if (label === 'typescript' || label === 'javascript') {
      return new tsWorker();
    }
    return new editorWorker();
  },
};

onMounted(async() => {
  /** @type {import('monaco-editor/esm/vs/editor/editor.api').editor.IStandaloneDiffEditorConstructionOptions} */
  const options = {
    theme: 'monokai',
    readOnly: false,
    automaticLayout: true,
    autoIndent: 'brackets',
    formatOnPaste: true,
    formatOnType: true,
    ...(props.additionalOptions || {})
  }
  // @ts-ignore
  monaco.editor.defineTheme("monokai", monokai);
  monaco.editor.setTheme("myTheme");

  if(props.diff) {
    const _editor = monaco.editor.createDiffEditor(monacoRef.value, options)
    _editor.setModel({
      original: monaco.editor.createModel('', 'text/plain'),
      modified: monaco.editor.createModel('', 'text/plain'),
    });
    _editor.updateOptions({ readOnly: false, originalEditable: true });
    editor.value = _editor
  } else {
    const _editor = monaco.editor.create(monacoRef.value, options)

    _editor.onDidFocusEditorWidget(()=>{
      emit('focus')
    })
    _editor.onDidBlurEditorWidget(()=>{
      emit('blur')
    })
    if(props.language === 'javascript' || props.language === 'typescript') {
      monaco.languages.typescript.typescriptDefaults.setCompilerOptions({
        target: monaco.languages.typescript.ScriptTarget.ESNext,
        allowJs: true,
        checkJs: true,
        allowNonTsExtensions: true
      })
    }
    _editor.setModel(monaco.editor.createModel('', props.language));
    _editor.updateOptions({ readOnly: false });
    _editor.onDidChangeModelContent((model) => {
      emit('update:modelValue', _editor.getValue())
    })
    const KM = monaco.KeyMod;
    const KC = monaco.KeyCode;
    _editor.addCommand(KM.chord(KM.CtrlCmd, KC.KeyS), function () {
      emit('save', _editor.getValue())
    });

    editor.value = _editor
  }
  await nextTick()
  isReady.value = true
})

watchEffect(() => {
  // @ts-ignore
  if(editor.value && props.modelValue !== editor.value?.getValue?.()) {
    // @ts-ignore
    editor.value?.setValue?.(props.modelValue)
  }
})
defineExpose({
  editor,
  isReady
})
</script>


<style lang="scss" scoped>
.monaco {
  flex-grow: 1;
}
</style>
</file>

<file path="fronts/app/src/components/LeftLogo.vue">
<template>
<div class="left">
  <div class="logo">
    <img src="@/assets/rocket.png" alt="">
    Runeya
  </div>
</div>
</template>

<script>
export default {

}
</script>

<style lang="scss" scoped>
.left {
  background-color: rgba(0,0,0,0.1);
  height: 100%;
  flex-grow: 1;
  backdrop-filter: blur(10px);
  display: flex;
  justify-content: center;
  align-items: center;
  flex-shrink: 0;
  color: white;
  flex-basis: 0;
  box-shadow: 0 0 10px 0 rgba(0,0,0,0.5);
  .logo {
    font-size: 4em;
    display: flex;
    flex-direction: column;
    text-align: center;
    text-shadow:  0 10px 5px rgba(0,0,0,0.5);
    img {
      width: 200px;
      margin: auto;
    }
  }
}

</style>
</file>

<file path="fronts/app/src/components/NotifHistory.vue">
<template>
  <div class="notif-history-root">
    <modal position="right" ref="modal" width="600px" :noActions="true">
      <template #header>
        Notifications
      </template>
      <template #body>
        <div class="notifications">
          <notification v-for="notif of notifs" :key="notif.id" width="100%" :notif="notif" @click="remove(notif)" :nolimit="true">
          </notification>
        </div>
      </template>
    </modal>
  </div>
</template>

<script>
import Modal from './Modal.vue'
import { onMounted, ref } from 'vue'
import notification from '../helpers/notification'
import Notification from './Notification.vue'
export default {
  components: { Modal, Notification },
  setup() {
    const modal = ref(null) 
    onMounted(() => {
      notification.openHistory.subscribe(() => {
        // @ts-ignore
        modal.value?.open()
      })
    })
    const notifs = ref(notification.notifsHistory.value)
    return {
      notifs,
      /**
       * 
       * @param {import('../helpers/notification').Notif} notif 
       */
      remove(notif) {
        notification.removeHistory(notif, true)
      },
      modal
    }
  }
}
</script>

<style lang="scss" scoped>

.notifications {
  display: flex;
  flex-direction: column;
  gap: 5px;
}
</style>
</file>

<file path="fronts/app/src/components/Notification.vue">
<template>
<div :class="notif.type" class="notif" v-if="notif" :style="{maxWidth: width}">
  <template v-if="!notif.hover">
    <h2 v-if="notif.serviceLabel">{{notif.serviceLabel}}</h2>
  </template>
  <h2 v-else-if="notif.serviceLabel">
    <i class="fas fa-chevron-right"></i>
  </h2>
  <div class="messages">
    <div class="message" v-for="msg of notif?.msgs" :key="msg.label" :class="{glow: notif?.msgs?.length > 1, oneline: !nolimit}">
      {{msg.label}}
      <div class="badge" v-if="notif.msgs.length > 1  && msg?.nb > 1">{{msg?.nb}}</div>
    </div>
  </div>
  <div class="badge" v-if="notif?.msgs?.length===1 && notif?.msgs[0]?.nb > 1">{{notif?.msgs[0]?.nb}}</div>
</div>
</template>

<script setup>
defineProps({
  width: {default: '420px'},
  notif: { 
    /** @type {import('../helpers/notification').Notif | null} */
    default: null
  },
  nolimit: {default: false}
})
</script>

<style lang="scss" scoped>
.notif {
  max-height: 100px;
  width: 100%;
  max-width: 420px;
  text-align: center;
  color: white;
  padding: 10px;
  box-sizing: border-box;
  border-radius: 4px;
  position: relative;
  display: flex;
  flex-direction: column;
  transition: 300ms;
  transition-property: transform;
  cursor: pointer;
  &:hover {
    transform: scale(1.01);
  }
  h2 {
    margin-top: 0px;
    margin-bottom: 0px;
    font-size: 1.2em;
  }
  .messages {
    overflow: auto;
    display: flex;
    flex-direction: column;
    .message {
      &.oneline {
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 1;
        -webkit-box-orient: vertical;
      }
      position: relative;
      flex-shrink: 0;
    }
  }
  &, .badge {
    background: #11998e;  /* fallback for old browsers */
    background: -webkit-linear-gradient(right, #38ef7d, #11998e);  /* Chrome 10-25, Safari 5.1-6 */
    background: linear-gradient(to right, #1dcf61, #11998e); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
    box-shadow: 0px 0px 10px 0px #11998e;
  }
  .badge {
    position: absolute;
    top: 0;
    right: 0;
    border: 1px solid rgba(0,0,0,0.2);
    padding: 5px;
    height: 20px;
    width: 20px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    transform-origin: top;
    transform: translateX(50%) translateY(-50%);
  }
  .message .badge {
    transform: translateX(0) translateY(5px);
    height: 10px;
    width: 10px;
  }
  &.error, &.error .badge{
    background: #CB356B;  /* fallback for old browsers */
    background: -webkit-linear-gradient(right, #BD3F32, #CB356B);  /* Chrome 10-25, Safari 5.1-6 */
    background: linear-gradient(to right, #BD3F32, #CB356B); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
    box-shadow: 0px 0px 10px 0px #BD3F32;
    .glow {
      background-color: rgba(255,255,255,0.3);
      border-radius: 4px;
      padding: 5px;
      margin: 5px 0;
    }
  }
}
</style>
</file>

<file path="fronts/app/src/components/Notifications.vue">
<template>
  <div class="notifications-container">
    <div class="trash" v-if="notifs?.length" @click="trash">
      <i class="fas fa-trash"></i>
    </div>
    <transition-group tag="div" class="root-notification" name="slide">
      <notification v-for="notif of notifs" :key="notif.id"
        :notif="notif"
        @click="remove(notif, true)"
        @mouseenter="notif.hover = true"
        @mouseleave="notif.hover = false"/>
    </transition-group>
  </div>
</template>

<script>
import notification from '../helpers/notification'
import Notification from './Notification.vue'
import PromiseB from 'bluebird'
export default {
  components: { Notification },
  setup() {
    /**
     * @param {import('../helpers/notification').Notif} notif 
     * @param {boolean} hasClicked 
     */
    const remove = (notif, hasClicked) => notification.remove(notif, hasClicked)
    return {
      notifs: notification.notifs,
      remove,
      trash() {
        PromiseB.map(notification.notifs.value || [], async(n) => {
          await new Promise(resolve => setTimeout(resolve, 50))
          notification.notifs.value.map(n => remove(n, false))
        })
      }
    }
  }
}
</script>

<style lang="scss" scoped>
.notifications-container {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: max-content;
  z-index: 100000;
  margin: auto;
  display: flex;
  align-items: flex-end;
  justify-content: center;
  gap: 10px;
}
.root-notification {
  margin: auto;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 10px;
}
.trash {
  color: white;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  padding: 20px;
  display: flex;
  justify-content: center;
  align-items: center;
  background: linear-gradient(to right, #d29423, #ead007); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
  box-shadow: 0px 0px 10px 0px #9d791c;
  transition: 300ms;
  cursor: pointer;
  &:hover {
    transform: scale(1.1);
  }
}
.slide-enter-active,
.slide-leave-active {
  transition: all 300ms ease !important;
}
.slide-enter-from,
.slide-leave-to {
  opacity: 0 !important; 
  max-height: 0 !important;
  padding: 0 !important;
  margin: 0 !important;
  transform: translateY(-30px) !important;
}
</style>
</file>

<file path="fronts/app/src/components/Progress.vue">
<template>
  <span class="container">    
    <div class="progress progress-moved">
      <div class="progress-bar" :style="{width: `${(percent > 100 ? 100 : percent)}%`}">
      </div>                       
    </div> 
  </span>
</template>

<script>
export default {
  props: {
    percent: {default: 0}
  }
}
</script>

<style lang="scss" scoped>

.container {
  width: 100%;
  text-align: center;
}

.progress {
  padding: 3px;
  box-sizing: border-box;
  border-radius: 100px;
  background: #dfdfdf;  
  box-shadow: inset 0 1px 2px 2px #ccc;
}

.progress-bar {
  height: 10px;
  width: 100%;
  background-image: linear-gradient(to bottom, var(--system-accent-backgroundColor1), var(--system-accent-backgroundColor1-darkest));
  border-radius: 100px;
  overflow: hidden;
  transform: translateZ(0);
  transform-origin: left;
  transition: 0.4s linear;  
  transition-property: width;    
  background-color: #0054bc;
}


</style>
</file>

<file path="fronts/app/src/helpers/themes/base.js">
/** @type {() => import('./theme').Theme} */
export default () => ({
  rules: {
    system: { backgroundColor: '#f2f4f7', color: '#4c4c4c' },
    'system.terminal': { backgroundColor: '#ffffff00', color: '#4c4c4c', contrastRatio: 7 },
    'system.secondary': { backgroundColor: '#eaebed', color: '#4a5361' },
    'system.tertiary': { color: '#999' },
    'system.accent': {
      backgroundColor1: 'rgb(217, 111, 226)',
      backgroundColor2: 'rgb(157, 27, 209)',
      backgroundColor3: 'rgb(211, 22, 229)',
    },
    'system.border': { borderColor: '#dbdbdb' },
    'system.sidebar': { backgroundColor: 'white' },
    'system.secondary-sidebar': { backgroundColor: 'white' },
    'system.sections': { backgroundColor: '#f7f7f7', innerShadow: '#eee' },
    'git.badge': { backgroundColor: '#b1b1b1', color: 'white' },
    jsonviewer: {
      keyColor: '#0977e6',
      valueKeyColor: '#073642',
    },
  },
});
</file>

<file path="fronts/app/src/helpers/themes/baseDark.js">
/** @type {() => import('./theme').Theme} */
export default () => ({
  rules: {
    system: { backgroundColor: '#313338', color: '#ddd' },
    'system.secondary': { backgroundColor: '#2b2d31', color: '#ddd' },
    'system.tertiary': { color: '#999' },
    'system.terminal': { backgroundColor: '#00000000', color: '#ddd', contrastRatio: 7 },
    'system.border': { borderColor: '#444' },
    'system.sidebar': { backgroundColor: '#1e1f22' },
    'system.secondary-sidebar': { backgroundColor: '#2b2d31' },
    'system.sections': { backgroundColor: '#2b2d31', innerShadow: '#353535' },
    'git.badge': { backgroundColor: '#4a5361', color: '#eaebed' },
    jsonviewer: {
      keyColor: '#0977e6',
      valueKeyColor: '#64a9ba',
    },
  },
});
</file>

<file path="fronts/app/src/helpers/themes/darkBlue.js">
/** @type {() => import('./theme').Theme} */
export default () => ({
  public: true,
  name: 'Dark Blue',
  group: 'Dark',
  base: 'dark',
  preview: {
    background: { backgroundColor: '#2b2d31' },
    foreground1: { backgroundColor: 'rgb(47, 161, 182)' },
    foreground2: { backgroundColor: 'rgb(10 ,206 ,213)' },
    foreground3: { backgroundColor: 'rgb(211, 22, 229)' },
    foreground4: { backgroundColor: 'rgb(229, 139, 22)' },
  },
  rules: {
    'system.accent': {
      'backgroundColor1-secondary': 'rgb(217, 111, 226)',
      'backgroundColor2-secondary': 'rgb(157, 27, 209)',
      'backgroundColor3-secondary': 'rgb(211, 22, 229)',

      'backgroundColor1-tertiary': 'rgb(255, 123, 0)',
      'backgroundColor2-tertiary': 'rgb(229, 156, 45)',
      'backgroundColor3-tertiary': 'rgb(229, 139, 22)',

      backgroundColor1: 'rgb(47, 161, 182)',
      backgroundColor2: 'rgb(10 ,206 ,213)',
      backgroundColor3: 'rgb(47, 161, 182)',
    },
  },
});
</file>

<file path="fronts/app/src/helpers/themes/darkOrange.js">
/** @type {() => import('./theme').Theme} */
export default () => ({
  public: true,
  name: 'Dark Orange',
  group: 'Dark',
  base: 'dark',
  preview: {
    background: { backgroundColor: '#2b2d31' },
    foreground1: { backgroundColor: 'rgb(255, 123, 0)' },
    foreground2: { backgroundColor: 'rgb(10 ,206 ,213)' },
    foreground3: { backgroundColor: 'rgb(211, 22, 229)' },
    foreground4: { backgroundColor: 'rgb(229, 139, 22)' },
  },
  rules: {
    'system.accent': {
      'backgroundColor1-tertiary': 'rgb(217, 111, 226)',
      'backgroundColor2-tertiary': 'rgb(157, 27, 209)',
      'backgroundColor3-tertiary': 'rgb(211, 22, 229)',

      backgroundColor1: 'rgb(255, 123, 0)',
      backgroundColor2: 'rgb(229, 156, 45)',
      backgroundColor3: 'rgb(229, 139, 22)',

      'backgroundColor1-secondary': 'rgb(47, 161, 182)',
      'backgroundColor2-secondary': 'rgb(10 ,206 ,213)',
      'backgroundColor3-secondary': 'rgb(47, 161, 182)',
    },
  },
});
</file>

<file path="fronts/app/src/helpers/themes/darkPurple.js">
/** @type {() => import('./theme').Theme} */
export default () => ({
  public: true,
  name: 'Dark Purple',
  group: 'Dark',
  base: 'dark',
  preview: {
    background: { backgroundColor: '#2b2d31' },
    foreground1: { backgroundColor: 'rgb(217, 111, 226)' },
    foreground2: { backgroundColor: 'rgb(10 ,206 ,213)' },
    foreground3: { backgroundColor: 'rgb(211, 22, 229)' },
    foreground4: { backgroundColor: 'rgb(229, 139, 22)' },
  },
  rules: {
    'system.accent': {
      backgroundColor1: 'rgb(217, 111, 226)',
      backgroundColor2: 'rgb(157, 27, 209)',
      backgroundColor3: 'rgb(211, 22, 229)',

      'backgroundColor1-secondary': 'rgb(255, 123, 0)',
      'backgroundColor2-secondary': 'rgb(229, 156, 45)',
      'backgroundColor3-secondary': 'rgb(229, 139, 22)',

      'backgroundColor1-tertiary': 'rgb(47, 161, 182)',
      'backgroundColor2-tertiary': 'rgb(10 ,206 ,213)',
      'backgroundColor3-tertiary': 'rgb(47, 161, 182)',
    },
  },
});
</file>

<file path="fronts/app/src/helpers/themes/lightBlue.js">
/** @type {() => import('./theme').Theme} */
export default () => ({
  public: true,
  name: 'Light Blue',
  group: 'Light',
  base: 'light',
  preview: {
    background: { backgroundColor: '#f2f4f7' },
    foreground1: { backgroundColor: 'rgb(47, 161, 182)' },
    foreground2: { backgroundColor: 'rgb(10 ,206 ,213)' },
    foreground3: { backgroundColor: 'rgb(211, 22, 229)' },
    foreground4: { backgroundColor: 'rgb(229, 139, 22)' },
  },
  rules: {
    'system.accent': {
      'backgroundColor1-secondary': 'rgb(217, 111, 226)',
      'backgroundColor2-secondary': 'rgb(157, 27, 209)',
      'backgroundColor3-secondary': 'rgb(211, 22, 229)',

      'backgroundColor1-tertiary': 'rgb(255, 123, 0)',
      'backgroundColor2-tertiary': 'rgb(229, 156, 45)',
      'backgroundColor3-tertiary': 'rgb(229, 139, 22)',

      backgroundColor1: 'rgb(47, 161, 182)',
      backgroundColor2: 'rgb(10 ,206 ,213)',
      backgroundColor3: 'rgb(47, 161, 182)',
    },
  },
});
</file>

<file path="fronts/app/src/helpers/themes/lightOrange.js">
/** @type {() => import('./theme').Theme} */
export default () => ({
  public: true,
  name: 'Light Orange',
  group: 'Light',
  base: 'light',
  preview: {
    background: { backgroundColor: '#f2f4f7' },
    foreground1: { backgroundColor: 'rgb(255, 123, 0)' },
    foreground2: { backgroundColor: 'rgb(10 ,206 ,213)' },
    foreground3: { backgroundColor: 'rgb(211, 22, 229)' },
    foreground4: { backgroundColor: 'rgb(229, 139, 22)' },
  },
  rules: {
    'system.accent': {
      'backgroundColor1-tertiary': 'rgb(217, 111, 226)',
      'backgroundColor2-tertiary': 'rgb(157, 27, 209)',
      'backgroundColor3-tertiary': 'rgb(211, 22, 229)',

      backgroundColor1: 'rgb(255, 123, 0)',
      backgroundColor2: 'rgb(229, 156, 45)',
      backgroundColor3: 'rgb(229, 139, 22)',

      'backgroundColor1-secondary': 'rgb(47, 161, 182)',
      'backgroundColor2-secondary': 'rgb(10 ,206 ,213)',
      'backgroundColor3-secondary': 'rgb(47, 161, 182)',
    },
  },
});
</file>

<file path="fronts/app/src/helpers/themes/lightPurple.js">
/** @type {() => import('./theme').Theme} */
export default () => ({
  public: true,
  name: 'Light Purple',
  group: 'Light',
  base: 'light',
  preview: {
    background: { backgroundColor: '#f2f4f7' },
    foreground1: { backgroundColor: 'rgb(217, 111, 226)' },
    foreground2: { backgroundColor: 'rgb(10 ,206 ,213)' },
    foreground3: { backgroundColor: 'rgb(211, 22, 229)' },
    foreground4: { backgroundColor: 'rgb(229, 139, 22)' },
  },
  rules: {
    'system.accent': {
      backgroundColor1: 'rgb(217, 111, 226)',
      backgroundColor2: 'rgb(157, 27, 209)',
      backgroundColor3: 'rgb(211, 22, 229)',

      'backgroundColor1-secondary': 'rgb(255, 123, 0)',
      'backgroundColor2-secondary': 'rgb(229, 156, 45)',
      'backgroundColor3-secondary': 'rgb(229, 139, 22)',

      'backgroundColor1-tertiary': 'rgb(47, 161, 182)',
      'backgroundColor2-tertiary': 'rgb(10 ,206 ,213)',
      'backgroundColor3-tertiary': 'rgb(47, 161, 182)',
    },
  },
});
</file>

<file path="fronts/app/src/helpers/themes/theme.d.ts">
export interface Theme {
  public?: boolean,
  name?: string,
  group?: string,
  base?: string,
  preview?: {
    background: Partial<{ backgroundColor: string }>,
    foreground1: Partial<{ backgroundColor: string }>,
    foreground2: Partial<{ backgroundColor: string }>,
    foreground3: Partial<{ backgroundColor: string }>,
    foreground4: Partial<{ backgroundColor: string }>,
  },
  rules: Partial<{
    system: Partial<{ backgroundColor: string, color: string }>,
    'system.terminal': Partial<{ backgroundColor: string, color: string, contrastRatio: number }>,
    'system.secondary': Partial<{ backgroundColor: string, color: string }>,
    'system.tertiary': Partial<{ color: string }>,
    'system.accent': Partial<{
      backgroundColor1: string,
      backgroundColor2: string,
      backgroundColor3: string,
      'backgroundColor1-secondary': string,
      'backgroundColor2-secondary': string,
      'backgroundColor3-secondary': string,
      'backgroundColor1-tertiary': string,
      'backgroundColor2-tertiary': string,
      'backgroundColor3-tertiary': string,
    }>,
    'system.border': Partial<{ borderColor: string }>,
    'system.sidebar': Partial<{ backgroundColor: string }>,
    'system.secondary-sidebar': Partial<{ backgroundColor: string }>,
    'system.sections': Partial<{ backgroundColor: string, innerShadow: string }>,
    'git.badge': Partial<{ backgroundColor: string, color: string }>,
    jsonviewer: Partial<{
      keyColor: string,
      valueKeyColor: string,
    }>,
  }>
}
</file>

<file path="fronts/app/src/helpers/notification.js">
import { ref , watch} from 'vue';
import { v4 as uuid } from 'uuid';
import Observable from './CustomObservable';
import router from '../router/router';

class Notification {
  constructor() {
    /** @type {import('vue').Ref<Notif[]>} */
    this.notifs = ref([]);
    /** @type {import('vue').Ref<Notif[]>} */
    this.notifsHistory = ref([]);
    this.openHistory = new Observable();
    this.mutedNotifications = ref(JSON.parse(localStorage.getItem('muted-notifications') || JSON.stringify({error: {}})))
    watch(() => this.mutedNotifications.value,() => {
      localStorage.setItem('muted-notifications', JSON.stringify(this.mutedNotifications.value))
    }, {deep: true})
  }

  /**
   *
   * @param {'error' | 'success'} type
   * @param {string} msg
   * @param {string | undefined} serviceLabel
   * @param {string | null} commandId
   * @param {Notif[] | null} notifAggregator
   */
  next(type, msg, serviceLabel = undefined, notifAggregator = null, commandId = null) {
    if (this.mutedNotifications.value[type]?.['MUTED_ALL']) return
    if (commandId && this.mutedNotifications.value[type]?.[commandId]) return 
    if (!notifAggregator) {
      this.next(type, msg, serviceLabel, this.notifsHistory.value, commandId);
      notifAggregator = this.notifs.value;
    }
    let notif = notifAggregator.find((n) => n.type === type && n.serviceLabel === serviceLabel && serviceLabel);
    if (notif) {
      const existingMsg = notif.msgs.find((n) => n.label === msg);
      const newMsg = existingMsg || {
        label: msg,
        nb: 0,
      };
      newMsg.nb += 1;
      if (!existingMsg) {
        notif.msgs.unshift(newMsg);
      }
    } else {
      const existingNotifWithLabel = notifAggregator
        .find((n) => n.type === type && !n.serviceLabel && n.msgs.find((_n) => _n.label === msg));
      notif = existingNotifWithLabel || {
        id: uuid(),
        type,
        msgs: [],
        serviceLabel,
        nb: 0,
      };
      const existingMsg = notif.msgs.find((n) => n.label === msg);
      const newMsg = existingMsg || {
        label: msg,
        nb: 0,
      };
      newMsg.nb += 1;
      if (!existingMsg) {
        notif.msgs.unshift(newMsg);
      }
      if (!existingNotifWithLabel) {
        notifAggregator.unshift(notif);
      }
    }
    // @ts-ignore
    clearTimeout(notif.timeout);
    notif.timeout = setTimeout(() => {
      if (notif) this.remove(notif);
    }, 5000);
  }

  /**
   * @param {Notif} notif
   * @param {boolean} hasClicked
   */
  remove(notif, hasClicked = false) {
    const index = this.notifs.value.indexOf(notif);
    if (index > -1) this.notifs.value.splice(index, 1);
    if (hasClicked && notif.serviceLabel) router.push({ name: 'stack-single', params: { label: notif.serviceLabel } });
  }

  /**
   * @param {Notif} notif
   * @param {boolean} hasClicked
   */
  removeHistory(notif, hasClicked) {
    const index = this.notifsHistory.value.indexOf(notif);
    if (index > -1) this.notifsHistory.value.splice(index, 1);
    if (hasClicked && notif.serviceLabel) router.push({ name: 'stack-single', params: { label: notif.serviceLabel } });
  }
}

/**
 * @typedef {{
 *  id: string,
 *  msgs: {
 *    label: string,
 *    nb: number
 *  }[],
 *  nb: number,
 *  type: string,
 *  hover?: boolean,
 *  serviceLabel?: string,
 *  timeout?: NodeJS.Timer
 * }} Notif
 */
export default new Notification();
</file>

<file path="fronts/app/src/models/currentEditor.js">
import { computed, onBeforeUnmount, onMounted, ref } from 'vue'
import vscodeIcon from '@/assets/vscode-icon.svg'
import intellijIcon from '@/assets/intellij.svg'
import androidstudioIcon from '@/assets/androidstudio.svg'
import cursorIcon from '@/assets/cursor.svg'
import sublimeIcon from '@/assets/sublimetext.svg'
import Stack from '../models/stack'

function useCurrentEditor(service) {
  /** @type {import('vue').Ref<string[]>} */
  const availableEditors = ref([])
  const changeEditor = ref(0)
  const loading = ref(false)
  const allEditors = ref({
    code: {
      icon: vscodeIcon,
      title: 'Open in Visual Studio Code'
    },
    intellij: {
      icon: intellijIcon,
      title: 'Open in Intellij'
    },
    androidstudio: {
      icon: androidstudioIcon,
      title: 'Open in Android Studio'
    },
    cursor: {
      icon: cursorIcon,
      title: 'Open in Cursor'
    },
    sublime: {
      icon: sublimeIcon,
      title: 'Open in Sublime text'
    },
  })
  onMounted(async () => {
    try {
      loading.value = true
      availableEditors.value = await Stack.getAvailableEditors()
    } finally {
      loading.value = false
    }
  })
  const currentEditor = computed(() => {
    changeEditor.value
    let editor = service
      ? localStorage.getItem('default-editor-' + service?.label) || localStorage.getItem('default-editor') || ''
      : localStorage.getItem('default-editor') || ''
    if (!availableEditors.value.includes(editor)) editor = ''
    return {
      key: editor,
      ...allEditors.value[editor]
    }
  })
  function setDefaultEditor(editor) {
    if (service) localStorage.setItem('default-editor-' + service.label, editor)
    else localStorage.setItem('default-editor', editor)
    if (!localStorage.getItem('default-editor')) localStorage.setItem('default-editor', editor)
    changeEditor.value++
    location.reload()
  }
  return {
    availableEditors,
    loading,
    allEditors,
    currentEditor,
    setDefaultEditor,
  }
}
export { useCurrentEditor };
</file>

<file path="fronts/app/src/models/fs.js">
import axios from '../helpers/axios';

export default {
  /** @param {string} path */
  async outdated(path) {
    const { data } = await axios.get(`/fs/outdated?path=${path}`);
    return data;
  },
  async homeDir() {
    const { data } = await axios.get('/fs/home-dir');
    return data;
  },
  /** @param {string} path */
  async ls(path) {
    const { data } = await axios.get(`/fs/ls?path=${path}`);
    return data;
  },
};
</file>

<file path="fronts/app/src/models/git.js">
import axios from '../helpers/axios';

export default {
  async isEnabled() {
    const { data } = await axios.get('/git/is-enabled');
    return data;
  },
};
</file>

<file path="fronts/app/src/models/Parsers.js">
import axios from '../helpers/axios';

export default {
  async delete(id) {
    await axios.delete(`/parsers/${id}`);
  },
  async all() {
    const { data } = await axios.get('/parsers');
    return data;
  },
  async update(parser) {
    const { data } = await axios.put(`/parsers/${parser.id}`, parser);
    return data;
  },
  async create(parser) {
    const { data } = await axios.post('/parsers', parser);
    return data;
  },
};
</file>

<file path="fronts/app/src/router/router.js">
import { createRouter, createWebHashHistory } from 'vue-router';
import plugins from '@runeya/modules-plugins-loader-front/src/views';
import stack from '../models/stack';

/**
 * @type {import('vue-router').RouteRecordRaw[]}
 */
// @ts-ignore
const pluginsRoutes = plugins.map((p) => p.routes).filter((f) => f).flat();

/** @type {import('vue-router').RouteRecordRaw[]} */
const routes = [
  {
    path: '/stack-chooser',
    name: 'stack-chooser',
    // @ts-ignore
    component: () => import('../views/StackChooser.vue'),
  },
  {
    path: '/stack-single/:label',
    name: 'stack-single',
    // @ts-ignore
    component: () => import('../views/StackSingle.vue'),
  },
  {
    path: '/stack-single',
    name: 'stack-single-no-view',
    // @ts-ignore
    component: () => import('../views/StackSingle.vue'),
  },
  {
    path: '/overview',
    name: 'overview',
    // @ts-ignore
    component: () => import('../views/Overview.vue'),
  },
  {
    path: '/stack-multiple',
    name: 'stack-multiple',
    // @ts-ignore
    component: () => import('../views/StackMultiple.vue'),
  }, {
    path: '/import-create',
    name: 'import-create',
    // @ts-ignore
    component: () => import('../views/ImportCreate.vue'),
  }, {
    path: '/settings',
    name: 'settings-no-view',
    // @ts-ignore
    component: () => import('../views/Settings.vue'),
    children: [
      {
        path: ':setting',
        name: 'settings',
        // @ts-ignore
        component: () => import('../views/Settings.vue'),
      },
    ],
  }, {
    path: '/init',
    name: 'init',
    // @ts-ignore
    component: () => import('../views/Init.vue'),
  },
  ...pluginsRoutes,
  {
    name: 'not-found',
    path: '/:pathMatch(.*)*',
    redirect: { name: 'stack-chooser' },
  },
];

const router = createRouter({
  history: createWebHashHistory(),
  // @ts-ignore
  routes,

});
router.beforeEach(async (to, from) => {
  if (to.name !== 'settings' || to.params.setting !== 'crypto') {
    const shouldSetup = await stack.shouldSetup();
    if (shouldSetup) return { name: 'settings', params: { setting: 'crypto' }, query: { wrongKey: 'true' } };
  }
});

export default router;
</file>

<file path="fronts/app/src/views/settings/Environments/Variables.vue">
<template>
  <div>
    coucouddd
  </div>
</template>

<script setup>

</script>

<style lang="scss" scoped>

</style>
</file>

<file path="fronts/app/src/views/settings/General.vue">
<template>
  <SectionCmp header="Editor" :scroll="false">
    <div class="line">
      Default editor
      <CurrentEditor direction="right" :dark="true"></CurrentEditor>
    </div>
  </SectionCmp>

</template>

<script setup>
import SectionCmp from '../../components/Section.vue';
import CurrentEditor from '../../components/CurrentEditor.vue'
</script>

<style lang="scss" scoped>
.line {
  display: flex;
  align-items: center;
  gap: 20px;
}
</style>
</file>

<file path="fronts/app/src/views/settings/Notifications.vue">
<template>
  <Tabs :value="tab" @update:value="changeTab($event)">
      <TabList>
          <Tab :value="tab.key" v-for="tab of tabs">{{tab.label}}</Tab>
      </TabList>
  </Tabs>
  <div class="sections">
    <SectionCmp header="All">
      <div class="line">
        <div class="actions">
          <Button :severity="mutedNotifications[tab]['MUTED_ALL'] ? 'danger' : 'secondary'" icon="fas fa-bell-slash" @click="mute('MUTED_ALL')"></Button>
          <Button :severity="mutedNotifications[tab]['MUTED_ALL'] ? 'secondary' : 'success'" icon="fas fa-bell" @click="unmute('MUTED_ALL')"></Button>
        </div>
        All
      </div>
    </SectionCmp>
    <SectionCmp header="By services">
      <div class="services">
        <div v-for="service of Stack.services.value">
          <h4>{{service.label}}</h4>
          <div class="commands">
            <div v-for="command of service.commands" class="command">
              <div class="actions">
                <Button :severity="mutedNotifications[tab].MUTED_ALL || mutedNotifications[tab][command.id] ? 'danger' : 'secondary'" icon="fas fa-bell-slash" @click="mute(command.id)"></Button>
                <Button :severity="mutedNotifications[tab].MUTED_ALL || mutedNotifications[tab][command.id] ? 'secondary' : 'success'" icon="fas fa-bell" @click="unmute(command.id)"></Button>
              </div>
              {{command.spawnCmd}} {{command.spawnArgs?.join(' ') || ''}}
            </div>
          </div>
        </div>
      </div>
    </SectionCmp>
  </div>
</template>

<script setup>
import { onMounted, ref } from 'vue';
import SectionCmp from '../../components/Section.vue';
import Button from 'primevue/button';
import Stack from '../../models/stack';
import notification from '../../helpers/notification';
import Tabs from 'primevue/tabs';
import TabList from 'primevue/tablist';
import Tab from 'primevue/tab';
const tab =ref('')
const tabs =ref([{
  label: 'Hide errors',
  key: 'error',
}])
const mutedNotifications = notification.mutedNotifications

function changeTab(_tab) {
  if(!mutedNotifications.value[_tab]) mutedNotifications.value[_tab] = {}
  tab.value = _tab
}
changeTab('error')
function mute(label) {
  mutedNotifications.value[tab.value][label] = true
}
function unmute(label) {
  delete mutedNotifications.value[tab.value][label]
}

</script>

<style lang="scss" scoped>
.line {
  display: flex;
  align-items: center;
  gap: 10px
}
h2,h4 {
  margin: 0
}
.command {
  display: flex;
  align-items: center;
  gap: 10px
}
.services {
  display: flex;
  flex-direction: column;
  gap: 20px;
}
.actions {
  display: flex;
  gap: 3px;
  Button  {
    font-size: 0.5rem;
    width: 25px;
    height: 25px;
    margin: 0
  }
}
.commands {
  display: flex;
  flex-direction: column;
  gap: 2px
}
.sections {
  display: flex;
  flex-direction: column;
  gap: 20px
}
</style>
</file>

<file path="fronts/app/src/views/Init.vue">
<template>
  <div>
    <h1>Configure</h1>
    
  </div>
</template>

<script setup>

</script>

<style lang="scss" scoped>

</style>
</file>

<file path="fronts/app/src/views/Overview.vue">
<template>
  <div class="overview-root column">
    <SectionCmp class="home-container">
      <h2><i class="fas fa-home"></i>Mes services</h2>
      <ul>
        <li v-for="service of services" :key="service.label" class="service" :class="{enabled: service.enabled}">
          <div v-if="service.enabled" class="spinner-container" >
            <Spinner size="10"></Spinner>
          </div>  
          <i v-else class="fas" :class="{'fa-pause': !service.enabled}"></i>
          {{ service.label }}
        </li>
      </ul>
    </SectionCmp>
    <StackChooser class="stack-chooser" :embed="true"></StackChooser>

    <Documentation v-if="docEnabled" class="doc-container"></Documentation>
  </div>
</template>

<script setup>
import { computed, onMounted, ref } from 'vue'
import SectionCmp from '../components/Section.vue'
import stack from '../models/stack'
import StackChooser from '../components/StackChooser.vue'
import Spinner from '../components/Spinner.vue';
import axios from '../helpers/axios';

/** @type {import('vue').Ref<import('../models/service').default[]>} */
const services = computed(() => {
  return stack.services.value.slice().sort((a,b) => b.enabled - a.enabled)
})

const docEnabled = ref(false)

onMounted(async () => {
  const { data } = await axios.get(`/documentation/service/global/is-available`);
  docEnabled.value = !!data
})

</script>

<style lang="scss" scoped>
.overview-root {
  padding: 20px;
  box-sizing: border-box;
  width: 100%;
  height: 100%;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-template-rows: repeat(2, 1fr);
  grid-gap: 10px;


  .section {
    width: 100%;
    height: 100%;
    min-width: 100px;
    overflow: auto;
  }
  .column {
    display: flex;
    flex-direction: column;
    height: 100%;
    gap: 20px;
  }
  .home-container {
    grid-column: 1 / span 1;
    grid-row: 1;
    min-width: 300px;
    justify-content: center;
    max-height: 50vh;
    h1 {
      text-align: center;
      margin: 0;
    }
    h2 {
      margin: 0;
      display: flex;
      align-items: center;
      gap: 10px;
      i {
        font-size: 20px;
      }
    }
    ul {
      overflow: auto;
      list-style: none;
      padding: 0;
      i, .spinner-container {
        width: 22px;
        text-align: center;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .service {
        display: flex;
        align-items: center;
        gap: 10px;
      }
    }
  }

  .doc-container {
    display: flex;
    grid-column: 1 / span 3;
    grid-row: 2;
  }
  
  .stack-chooser {
    grid-column: 2 / span 2;
    grid-row: 1;
  }
}
</style>
</file>

<file path="fronts/app/src/views/StackChooser.vue">
<template>
<div class="stack-chooser-root" >
  <background-stack-chooser :lowResources="true"></background-stack-chooser>
  <left-logo/>
  <div class="right">
    <StackChooserCmp class="stack-chooser"></StackChooserCmp>
  </div>
  <div class="version">
    {{System.version.value}}
  </div>

  <div class="tools" @click="router.push({name: 'Toolbox'})">
    <i class="fas fa-toolbox"></i>
  </div>
</div>
</template>

<script setup>
import System from '../models/system'
import BackgroundStackChooser from '../components/BackgroundStackChooser.vue'
import StackChooserCmp from '../components/StackChooser.vue'
import LeftLogo from '../components/LeftLogo.vue'
import {useRouter} from 'vue-router'
const router = useRouter();

</script>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style scoped lang="scss">
.stack-chooser-root {
  width: 100vw;
  height: 100vh;
  display: flex; 
  justify-content: space-between;
  align-items: center;
  position: relative;
  .right {
    flex-grow: 2;
    flex-basis: 0;
    flex-shrink: 0;
  }
  .version {
    background-color: rgb(255, 255, 255);
    border-radius: 4px;
    padding: 0px 5px;
    border: 1px solid darkgrey;
    position: fixed;
    bottom: 40px;
    right: 40px;
  }
  .tools {
    background-color: rgb(255, 255, 255);
    border-radius: 4px;
    padding: 0px 5px;
    border: 1px solid darkgrey;
    position: fixed;
    bottom: 40px;
    left: 40px;
  }
  .stack-chooser {
    max-width: 400px;
    max-height: calc(100vh - 50px);
  }
}
</style>
</file>

<file path="fronts/docs/.vitepress/config.mjs">
import { defineConfig } from 'vitepress'

export default defineConfig({
  title: "Runeya",
  vite: {
    server: {
      port: process.env.PORT
    } 
  },
  description: "Configure, share, launch and monitor all yours services in the same place for your development team",
  base: '/runeya/',
  locales: {
    root: {
      label: 'English',
      lang: 'en'
    },
    // fr: {
    //   label: 'French',
    //   lang: 'fr', 
    // }
  },
  themeConfig: {
    search: {
      provider: 'local',
      options: {}
    },
    logo: '/rocket.png',
    nav: [
      { text: 'Home', link: '/' },
      { text: 'Getting started', link: '/introduction/getting-started' },
    ],

    sidebar: [
      {
        text: 'Introduction',
        items: [
          { text: 'What is Runeya', link: '/introduction/what-is' },
          { text: 'Getting started', link: '/introduction/getting-started' },
        ]
      }, {
        text: 'Guide',
        items: [
          { text: 'First launch', link: '/guide/first-launch.md' },
          { text: 'Create your first service', link: '/guide/create-new-service.md' }
        ]
      }, {
        text: 'Reference',
        items: [
          { text: 'Global environments variables', link:'/reference/global-environment-variables.md'}
        ]
      }, {
        text: 'Integration',
        items: [
          { text: 'Visual Studio Code', link: '/integration/vscode' },
        ]
      },{
        text: 'Other',
        items: [
          { text: 'Screenshots', link: '/screenshots/screenshots' },
        ]
      }
    ],

    socialLinks: [
      { icon: 'github', link: 'https://github.com/runeya/runeya' }
    ]
  }
})
</file>

<file path="fronts/docs/guide/create-new-service.md">
---
outline: deep
---

# Create a Service

To create a new service, go to the "Single view" tab in the sidebar and enter the name of the new service in the "Add new service..." field.

You will land on the service configuration page.

![Create New Service](/introduction/imgs/launched.png)

The service construction page is structured as follows:

- **General**
  - **Description**: Used to display at the top of the service, providing more context
  - **URL**: The link to your application
  - **Root Path**: The root from which the service commands will be launched
- **Health Check**: [Reference](/reference/health-check)
- **Groups**: A list to categorize services
- **Git**: [Reference](/reference/git)
- **Parsers**: [Reference](/reference/parsers)
- **OpenAPI URL**: [Reference](/reference/openapi)
- **Docker**: [Reference](/reference/docker)
- **Metadata**: [Reference](/reference/metadata)
- **Commands**: [Reference](/reference/commands)
</file>

<file path="fronts/docs/guide/first-launch.md">
# First Launch

When you connect for the first time, **Runeya** will initialize files in a folder named `.runeya` at the location you specified.

## Example

By running the following command:

```bash
runeya /home/myuser/Project/awesome-project
```

The configurations will be written to:

```
/home/myuser/Project/awesome-project/.runeya
```

## Security

Each file managed by Runeya is encrypted with a key. You can find this key at:

```
/home/myuser/Project/awesome-project/.runeya/dbs/encryption-key.json
```

Alternatively, you can access it via the web interface under:

```
/settings -> Encryption
```

For more information about the security measures used, visit the [security reference](/reference/security).

## Collaboration

This folder can be shared in the repository or by any other means with your team. This allows for the sharing of configurations necessary to launch your application, as well as all environment variables required for the launch.

## Next Steps

After initialization, Runeya will open a web interface, allowing you to create your first service.
```

This version uses headings, code blocks, and links to make the information clear and easy to navigate.
</file>

<file path="fronts/docs/integration/vscode.md">
---
outline: deep
---
# Vscode

## Snippet

Add this in your vscode to print variables easily in debug output of service:
``` json
"Print to runeya": {
  "prefix": "log",
  "body": [
    "console.log(JSON.stringify(['runeya', $1]));",
    "$2"
  ],
  "description": "Print to runeya"
}
```

Type ```log``` in vs code, it should produce something like that:

``` javascript 
console.log(JSON.stringify(['runeya', <what you want>, <and others>]));
```
</file>

<file path="fronts/docs/introduction/getting-started.md">
---
outline: deep
---
# Getting Started

## Installation

### Prerequisites

- [Node.js](https://nodejs.org/) version 16 or higher.
- Terminal for launching Runeya (CLI).
- Git to enable git capabilities.

To install in a git project:
::: code-group
```sh [npm]
$ npm install -D @runeya/runeya
```

```sh [pnpm]
$ pnpm add -D @runeya/runeya
```

```sh [yarn]
$ yarn add -D @runeya/runeya
```
:::

To install in global:
::: code-group

```sh [npm]
$ npm install -g @runeya/runeya
```

```sh [yarn]
$ yarn global add @runeya/runeya
```
:::


### Launch

In project installation, you can launch it by adding a script to your package.json:

```json [json]
{
  "name": "...",
  "version": "...",
  "description": "...",
  "main": "src/stack.js",
  "license": "...",
  "author": "...",
  "scripts": {
    "serve": "cross-env RUNEYA_HTTP_PORT=6872 runeya ./src/stack.js"
  }
}
```
Runeya ships with a command line. After global installation, start it by running:

```sh [bash]
$ runeya <config-directory>
```

It will launch a web interface to write and monitor all your services

![launched](./imgs/launched.png)
</file>

<file path="fronts/docs/reference/commands.md">
# Envs

Nothing for the moment
</file>

<file path="fronts/docs/reference/envs.md">
# Metada

Nothing for the moment
</file>

<file path="fronts/docs/reference/git.md">
# Git Configuration

The Git system allows you to enable Git features across your service. Here is a guide to configure the different fields:

![Git Configuration](/reference/imgs/git-service-config.png)

## Configuration Fields

1. **Home**
- Field: HTTP link to your repository. This enables an icon in your service to access your repository in one click.

2. **Remote**
- Field: The most important part. The remote SSH URL to your repository. It will enable the Git tab in your service.
</file>

<file path="fronts/docs/reference/global-environment-variables.md">
---
outline: deep
---

# Global Environment Variables

Runeya can be launched with environment variables that modify its behavior or add features.

Ca peut vous permettre de les overrider depuis un .env par exemple 

Here is a table listing them:

| Name              | Default Value           | Description                                    |
|-------------------|-------------------------|------------------------------------------------|
| `HTTP_PORT_SERVER` | Random available port  | Launch Runeya on the specified port.    |
| `RUNEYA_DEFAULT_ENVIRONMENT` | LOCAL  | Launch Runeya with specified environment    |
| `RUNEYA_GH_APIKEY` |   | Enable github features     |
| `RUNEYA_OPENAI_APIKEY` |   | Enable openai features     |
</file>

<file path="fronts/docs/reference/metadata.md">
# Metada

Nothing for the moment
</file>

<file path="fronts/docs/reference/openapi.md">
# OpenAPI

If you enter a URL in the service settings, you will activate a Swagger UI in its tabs.

This URL should serve an OpenAPI file. Specifically, it is the URL field of the library [Swagger UI Configuration](https://github.com/swagger-api/swagger-ui/blob/HEAD/docs/usage/configuration.md).
</file>

<file path="fronts/docs/reference/parsers.md">
# Parsers Configuration

A parser defines how the logs produced by your commands will be parsed and displayed.

## Configuration

To configure a parser, you can go to `Settings > Parsers`.

A parser is a JavaScript script that takes as input the line produced by a command and returns it modified. JSDoc is written on the parser to guide you on the available options.

For example, let's say I want to parse lines containing a 400 error and convert it to JSON:
```javascript
module.exports = (line) => {
  if (line.raw.includes('400')) {
    line.json = { code: 400, error: line.raw.replaceAll('400', '')}
    line.source = 'stderr'
  }
  return line;
}
```

When I load this into the service settings, it should look like this:
![Error Parser Configuration](/reference/imgs/error-parser.png)

Feel free to unleash your imagination!
</file>

<file path="fronts/docs/reference/security.md">
# Data Security: How Your Information Is Protected

We have implemented a robust encryption solution to ensure the security of your data. Here’s how it works:

## Generating a Secure Encryption Key
The application uses a single, securely generated encryption key to protect your data. This key is created using the **AEGIS-256** algorithm, recognized for its strength and reliability, and is securely stored within the application.

## Encrypting Data
When data is encrypted, we follow these steps:

1. **Creating a Unique Nonce**: Each encryption operation uses a unique value called a *nonce*. This ensures that encrypting the same data multiple times will never produce identical results. The uniqueness of the nonce adds an additional layer of security.

2. **Secure Encryption**: The data is encrypted using the **SecretBox** algorithm from libsodium, which combines symmetric encryption with authentication. This guarantees both the confidentiality and integrity of your data.

The encrypted output includes the nonce and the encrypted content, ensuring that decryption is secure and reliable.

## Decrypting Data
To decrypt your data, the application uses the single encryption key in combination with the unique nonce generated during the encryption process.  
1. We extract the nonce stored with the encrypted content.
2. We use the encryption key to restore your original data. If the nonce or encrypted content has been tampered with, decryption will automatically fail, ensuring the integrity of your data.

## Key Benefits of This Approach
- **Simplicity and Security**: Using a single encryption key simplifies management while maintaining robust security.
- **Unique Nonces**: Each encryption operation is unique, ensuring that no data can be "replayed" or encrypted identically.
- **Tamper Detection**: Any attempt to modify encrypted data will be detected and rejected.

In summary, our solution uses a single encryption key in combination with state-of-the-art cryptographic techniques to effectively protect your sensitive information.
</file>

<file path="modules/bugs/backend/checkJsFork.js">
const pathfs = require('path');
const { readFileSync, existsSync } = require('fs');
const ts = require('typescript');

process.on('message', (/** @type {string} */cwd) => {
  const tsConfigPath = pathfs.resolve(cwd, 'tsconfig.json');
  const jsConfigPath = pathfs.resolve(cwd, 'jsconfig.json');
  let configPath = pathfs.resolve(__dirname, 'defaultJsConfig.json');
  if (existsSync(tsConfigPath)) {
    configPath = tsConfigPath;
  } else if (existsSync(jsConfigPath)) {
    configPath = jsConfigPath;
  }
  const tsconfigFile = ts.readJsonConfigFile(configPath, (path) => readFileSync(path, { encoding: 'utf-8' }));
  const config = ts.parseJsonSourceFileConfigFileContent(
    tsconfigFile,
    {
      useCaseSensitiveFileNames: true,
      readDirectory: ts.sys.readDirectory,
      readFile: ts.sys.readFile,
      fileExists: ts.sys.fileExists,
    },
    cwd,
  );
  if (existsSync(pathfs.resolve(cwd, 'node_modules', '@types'))) {
    if (!config.options.typeRoots) config.options.typeRoots = [];
    config.options.typeRoots.push(pathfs.resolve(cwd, 'node_modules', '@types'));
  }
  const typescriptProgram = ts.createProgram(config.fileNames, {
    ...config.options,
    noEmit: true,
    resolveJsonModule: true,
    checkJs: true,
  });

  const errCodeMapping = {
    [ts.DiagnosticCategory.Error]: 'error',
    [ts.DiagnosticCategory.Warning]: 'warning',
    [ts.DiagnosticCategory.Suggestion]: 'info',
  };
  const errorTypes = Object.keys(errCodeMapping).map((key) => +key);
  const errorFilter = (/** @type {ts.Diagnostic} */result) => errorTypes.includes(result.category)
    && !result.file?.fileName?.includes('node_modules')
    && !result.file?.fileName?.includes('.spec.');
  const results = ts.getPreEmitDiagnostics(typescriptProgram)
    .filter(errorFilter)
    .map((err) => {
      if (!err.file) return null;
      const start = err.start || 0;
      const lines = err.file.text.substring(0, start).split('\n');
      const line = lines.length;
      const column = start - lines.slice(0, lines.length - 1).join().length;
      return {
        code: err.code,
        // @ts-ignore
        category: errCodeMapping[err.category],
        fileName: err.file.fileName.replace(cwd, ''),
        line,
        column,
        path: `${err.file.fileName}:${line}:${column}`,
        messageText: typeof err.messageText === 'string'
          ? err.messageText
          : err.messageText.messageText,
      };
    })
    .filter((a) => a);
  process.send?.(results);
});
</file>

<file path="modules/bugs/front/src/Bugs.vue">
<template>
  <Select v-model="cwd" :options="npmPaths" :style="{marginBottom: '10px'}"/>
  <section-cmp
    v-if="service" :key="service.label"
    :header="'Bugs(' + (bugs?.length || 0) + ')'"
    class="bug-root"
    :style="{maxHeight: isInMultiMode ? '400px' : 'inherit' }"
    :actions="[{label: 'Launch', icon: 'fas fa-play', click: () => launch(), hidden: loading}]"
    >
    <div v-if="loading" class="loading">
      <spinner  :size="40"></spinner>
      Analyse en cours
    </div>
    <div v-else class="bugs">
      <div class="bug" :class="bug.category" v-for="bug of bugs" :key="bug">
        <div class="path" @click="openInVsCode(bug)">{{bug.fileName}}({{bug.line}},{{bug.column}})</div>
        <div class="message">{{bug.messageText}}</div>
      </div>
    </div>
  </section-cmp>
</template>

<script>
import { onMounted, ref, watch } from 'vue';
import Service from '../../../../fronts/app/src/models/service';
import SectionVue from '../../../../fronts/app/src/components/Section.vue';
import SpinnerVue from '../../../../fronts/app/src/components/Spinner.vue';
import notification from '../../../../fronts/app/src/helpers/notification';
import Select from 'primevue/select';

export default {
  components: {
    sectionCmp: SectionVue,
    spinner: SpinnerVue,
    Select
  },
  props: {
    service: {
      /** @type {import('../../../../fronts/app/src/models/service').default | null} */
      default: null,
      required: true,
      type: Service,
    },
    isInMultiMode: {
      type: Boolean,
    },
  },
  setup(props) {
    const bugs = ref([]);
    const loading = ref(false);
    const npmPaths = ref([]);
    const cwd = ref();
    const reload = async () => {
      if (props.service) {
        npmPaths.value = await props.service.getNpmPaths();
        if(!cwd.value) cwd.value = npmPaths.value[0]
      }
    };
    onMounted(reload);
    watch(() => props.service, reload);
    const launch = async () => {
      bugs.value = [];
      loading.value = true;
      bugs.value = await props.service.getBugs(cwd.value)
        .catch((err) => {
          if (err?.response?.data?.code === 'TSC_NOT_FOUND') {
            notification.next('error', 'Please "npm i -g typescript"');
          }
          if (err?.response?.data?.code === 'JSCONFIG_NOT_FOUND') {
            notification.next('error', 'Please create a jsconfig.json in project');
          }
          return [];
        })
        .finally(() => {
          loading.value = false
        })
    }

    return {
      reload,
      launch,
      npmPaths,
      cwd,
      loading,
      bugs,
      /**
       *
       * @param {{
       *  code: string,
       *  category: string,
       *  fileName: string,
       *  line: string,
       *  path: string,
       *  messageText: string,
       * }} bug
       */
      openInVsCode(bug) {
        props.service.openLinkInVsCode(bug.path);
      },
    };
  },
};
</script>
<style lang="scss" scoped>
.loading {
  display: flex;
  align-items: center;
  .spinner {
    margin-right: 10px;
  }
}
.bug {
  margin-top: 10px;
  padding: 5px 10px;
  box-sizing: border-box;
  color: #555;
  &.error {
    border-left: 2px solid #d62b2b;
    .path {color: #d62b2b }
  }
  &.info {
    border-left: 2px solid #1d93d9;
    .path {color: #1d93d9 }
  }
  &.warning {
    border-left: 2px solid #f27601;
    .path {color: #f27601 }
  }
  .path {
    font-size: 0.8em;
    cursor: pointer;
    &:hover {
      text-decoration: underline;
    }
  }
}
</style>
</file>

<file path="modules/configuration/backend/index.js">
/** @type {import('@runeya/modules-plugins-loader-front/src/views').PluginSM<null>} */
const plugin = {
  enabled: true,
  name: 'Configuration',
  displayName: 'Configuration',
  description: 'Show all configurations used to launch the given service',
  icon: 'fas fa-cog',
  export: null,
  placements: ['service'],
  order: 5,
};
module.exports = plugin;
</file>

<file path="modules/configuration/backend/routes.js">
const express = require('express');

const router = express.Router();
const pathfs = require('path');
const { fork } = require('child_process');
const EnvironmentPersitence = require('@runeya/servers-server/models/Environment');

/** @param {import('@runeya/common-typings').Runeya} runeya */
module.exports = (runeya) => {
  router.get('/configuration/services/:service/envs', async (req, res) => {
    const service = runeya.findService(req.params.service);
    if (!service) return res.status(404).send('SERVICE_NOT_FOUND');

    res.json(EnvironmentPersitence.all());
  });
  return router;
};

/**
 * @typedef {{
 * [key:string]: {
 *    label: string
 *    color?: string
 *    bgColor?: string
 *    env: {
 *      [key:string]: string | {value: string, override: string}
 *    }
 * }
 * }} Environment
 */
</file>

<file path="modules/dev-ops/backend/index.js">
/** @type {import('@runeya/modules-plugins-loader-front/src/views').PluginSM<null>} */
const plugin = {
  enabled: false,
  name: 'DevOps',
  displayName: 'Dev ops',
  description: 'Choose a tool used for dev ops purposes',
  icon: 'fas fa-hard-hat',
  order: 7,
  export: null,
  placements: [{
    position: 'sidebar',
    label: 'DevOps',
    icon: 'fas fa-hard-hat',
    goTo: { path: '/DevOps' },
    active: 'DevOps',
  }],
};
module.exports = plugin;
</file>

<file path="modules/dev-ops/front/src/Index.vue">
<template>
  <div class="toolbox">
    <div class="sidebar">
      <ul>
        <input type="text" ref="searchToolRef" placeholder="Search tool..." v-model="searchToolTerm" autofocus="true" @keypress.enter="chooseFirst">
        <li v-for="plugin of buttonsPlugins" :key="plugin?.name" class="sidebar-item"
          @click="plugin?.click?.()"
          :class="{ active: isActive(plugin) }">
          <div class="item">
            <i class="icon" :class="plugin?.icon" v-if="plugin?.icon"></i>
            <span class="icon" v-if="plugin?.iconText">{{ plugin?.iconText }}</span>
            {{ plugin?.text }}
          </div>
        </li>
      </ul>
    </div>
    <div class="container">
      <router-view v-if="router.currentRoute.value.fullPath !== '/DevOps'"/>
      <div v-else class="no-tools">
        <div>
          <i class="fas fa-toolbox"></i>
        </div>
        <div>
          Choisissez un outils
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { useRouter } from 'vue-router';

import { onMounted, ref, computed } from 'vue';
import axios from '../../../../fronts/app/src/helpers/axios';

const router = useRouter();
/** @type {import('vue').Ref<import('../../../plugins-loader/front/src/views').PluginSM<null>[]>} */
const plugins = ref([]);
const searchToolTerm = ref('');
const searchToolRef = ref();
onMounted(async () => {
  /** @type {{data: import('../../../plugins-loader/front/src/views').PluginSM<null>[]}} */
  const { data: _plugins } = await axios.get('/plugins/dev-ops');
  plugins.value = _plugins?.flat() || [];
  searchToolRef.value?.focus();
});

const buttonsPlugins = computed(() => ([
  ...plugins.value.map((plugin) => plugin.placements.map((/** @type {any} */placement) => {
    if (typeof placement === 'string') return null;
    return {
      ...plugin,
      text: placement.label,
      icon: placement.icon,
      iconText: placement.iconText,
      click: placement.goTo ? () => {
        if (typeof placement.goTo === 'string') router.push({ path: placement.goTo });
        else {
          router.push({
            ...placement.goTo,
            path: `/DevOps${(placement.goTo?.path || placement.goTo)}`,
          });
        }
      } : () => { },
      active: placement.active,
    };
  })).flat().filter((f) => f?.text?.toUpperCase().includes(searchToolTerm.value?.toUpperCase())) || [],
]));

function chooseFirst() {
  buttonsPlugins.value?.[0]?.click();
}
/** @param {import('../../../plugins-loader/front/src/views').PluginSM<null> | undefined | null} plugin */
function isActive(plugin) {
  return router.currentRoute.value.params.plugin === plugin?.name;
}

</script>

<style scoped lang="scss">
input {
  width: 90%;
  box-sizing: border-box;
  margin: 5px auto;
  justify-self: center;
}
.toolbox {
  display: flex;
  min-width: 0;
  width: 100%;
  align-items: center;
}
.sidebar {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    box-shadow: 0px 0px 4px 0px black;
    width: 150px;
    background-color: var(--system-secondary-sidebar-backgroundColor);
    color: var(--system-sidebar-secondary-color);
    height: 100%;
    flex-shrink: 0;
    z-index: 3;
    ul {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
    }
  }

.progress-container {
  display: flex;
  align-items: center;
  label {
    width: 60px;
  }
}

.sidebar-item {
  cursor: pointer;
  transform: translateZ(0);
  transition: background-color 300ms;
  padding: 5px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  .item {
    display: flex;
    align-items: center;
    gap: 5px;
  }
  .icon {
    width: 20px;
    transition: 300ms;
    display: flex;
    justify-content: center;

  }
  &:hover {
    background-color: var(--system-backgroundColor);
    color: var(--system-color);
    i {
      opacity: 1;
    }
  }
  &.active {
    font-weight: bold;
    border-left: 5px solid var(--system-accent-backgroundColor1)
  }
  &.disabled {
    color: #999;
  }
}
.container {
  display: flex;
  flex-grow: 1;
  min-width: 0;
  padding: 5px 10px;
  box-sizing: border-box;
  height: 100%;
}
.no-tools {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  width: 100%;
  font-size: 2em;
  color: #999;
}
</style>
</file>

<file path="modules/diff/backend/index.js">
/** @type {import('@runeya/modules-plugins-loader-front/src/views').PluginSM<null>} */
const plugin = {
  enabled: true,
  name: 'Diff',
  displayName: 'Differences',
  description: 'Find differences between two strings',
  icon: 'fas fa-columns',
  export: null,
  placements: [
    {
      position: 'toolbox',
      label: 'Diff',
      icon: 'fas fa-columns',
      goTo: { path: '/Diff' },
      active: 'Diff',
    },
  ],
  order: 6,
  routes: require('./routes'),
};
module.exports = plugin;
</file>

<file path="modules/docker/backend/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/docker/front/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/documentation/backend/Leaf.js">
const PromiseB = require('bluebird');
const { randomUUID } = require('crypto');
const dbs = require('../../../servers/server/helpers/dbs');
const { v4 } = require('uuid');
const dbLeafTree = dbs.getDb(`leafs-leafs`, {encrypted: true, defaultData: []}).alasql
class Leaf {
  /**
   * @param {import('@runeya/common-typings').NonFunctionProperties<Leaf>} leaf
   */
  constructor(leaf) {
    /** @type {string} */
    this.id = leaf.id || v4();
    /** @type {string} */
    this.docId = leaf.docId || '';
    /** @type {string} */
    this.serviceId = leaf.serviceId || '';
    /** @type {string} */
    this.label = leaf.label || '';
    /** @type {number} */
    this.position = leaf.position || -1;
    /** @type {string} */
    this.text = leaf.text || '';
    /** @type {string} */
    this.parentId = leaf.parentId || '';
  }

  static async getTree(serviceLabel) {
    const leafs = await dbLeafTree.read(`Select * from ${dbLeafTree.table} ${serviceLabel ? `where serviceId = '${serviceLabel}'` : `where serviceId=''`}`)
    return leafs
  }
  toStorage() {
    return {
      docId: this.docId,
      position: this.position,
      serviceId: this.serviceId,
      label: this.label,
      text: this.text,
      parentId: this.parentId,
    }
  }

  async remove() {
    return dbLeafTree.write(`DELETE from ${dbLeafTree.table} where id = '${this.id}'`)
  }

  static async find({id}) {
    const [leaf] = await dbLeafTree.read(`Select * from ${dbLeafTree.table} where id='${id}'`)
    return leaf ? new Leaf(leaf) : null
  }

  async save() {
    const leafExists = await Leaf.find({id: this.id})
    const storage = this.toStorage()
    const set = dbLeafTree.buildUpdateQuery(storage)
    await leafExists
      ? dbLeafTree.write(`update ${dbLeafTree.table} set ${set} where id='${this.id}'`)
      : dbLeafTree.write(`insert into ${dbLeafTree.table} values ${JSON.stringify({
        ...this.toStorage(),
        id: this.id,
      })}`)
    return this
  }

}

module.exports = Leaf;
</file>

<file path="modules/documentation/backend/routes.js">
const express = require('express');
const Leaf = require('./Leaf');
const PromiseB = require('bluebird')

const router = express.Router();

/** @param {import('@runeya/common-typings').Runeya} runeya */
module.exports = (runeya) => {
  const { findService } = runeya;

  router.get('/documentation/tree', async (req, res) => {
    const service = findService(req.query.serviceId?.toString() || '');
    const result = await Leaf.getTree(service?.label)
    return res.send(result);
  });
  router.post('/documentation/tree/sort', async (req, res) => {
    const leafs = await PromiseB.mapSeries(req.body, async (_leaf, index) => {
      const leaf = await Leaf.find({ id: _leaf.id})
      if(!leaf) return
      leaf.position = index
      await leaf.save()
      return leaf
    })
    return res.send(leafs);
  });
  router.post('/documentation/tree', async (req, res) => {
    const result = await new Leaf({
      ...req.body,
    }).save()
    return res.send(result);
  });
  router.post('/documentation/tree/:key', async (req, res) => {
    const result = await new Leaf({
      ...req.body,
      id: req.params.key,
    }).save()
    return res.send(result);
  });

  router.delete('/documentation/tree/:key', async (req, res) => {
    const result = await Leaf.find({
      id: req.params.key,
    })
    if (result) return res.send(await result.remove())
    return res.send();
  });
  return router;
};
</file>

<file path="modules/finder/backend/index.js">
const commandExists = require('command-exists');

/** @type {import('@runeya/modules-plugins-loader-front/src/views').PluginSM<null>} */
const plugin = {
  enabled: true,
  name: 'Finder',
  displayName: 'Finder',
  description: 'Find all you want inside this app',
  icon: 'fab fa-git-alt',
  export: null,
  order: -1,
  placements: ['global', {
    position: 'sidebar',
    label: 'Finder',
    icon: 'fas fa-search',
    goTo: { path: '/Finder' },
    active: 'Finder',
  }],
  hidden: () => commandExists('git').then(() => false).catch(() => true),
  routes: require('./routes'),
};
module.exports = plugin;
</file>

<file path="modules/git/front/src/Git.vue">
<template>
  <div class="git-root">
    <div class="git-section" v-if="service.git">
      <section-cmp v-if="git && git.branches" class="section-branches"
        :key="service.label"
        header="Branches"
        :noStyle="noStyle"
        :actions="[
          { hover: 'Create branch', label: '', click: () => addBranch(), icon: 'fas fa-plus', small: true },
          { hover: 'Fetch all', label: '', click: () => gitFetch(), icon: 'fas fa-sync' },
          {
            hover: 'Pull',
            label: pullLabel,
            hidden: git.delta != null && git.delta >= 0,
            click: () => pull(),
            icon: 'fas fa-download'
          }
        ]">
        <div>
          <input type="text" placeholder="Search branch..." v-model="searchBranch">
        </div>
        <div>
          <input type="checkbox" v-model="displayOnlyLocalBranches">
          Display only local branches
        </div>
        <ul class="branches">
          <li v-for="(branch, i) of displayBranches" :key="'branch' +i"
            @click="branch?.name ? changeBranch(branch.name) : null" :class="{
            active: branch?.name === service?.git?.currentBranch,
            merged: branch?.merged
          }">
            <div class="actions">
              <div v-if="branch?.merged" title="Already merged into develop">
                <i class="fas fa-object-group" aria-hidden="true"></i>
              </div>
              <div v-if="branch?.isRemote" title="Is in remote not local">
                <i class="fas fa-cloud-download-alt" aria-hidden="true"></i>
              </div>
              {{branch?.name}}
            </div>
            <div class="actions">
              <button class="small" @click.stop="branch?.name ? deleteBranch(branch.name) : null" v-if="branch.canDelete">
                <i class="fas fa-trash" aria-hidden="true"></i>
              </button>
            </div>
          </li>
        </ul>
      </section-cmp>
      <section-cmp v-if="git?.status" class="section-status" header="Status" :noStyle="noStyle" :animateActions="true" :actions="[
        {small: true, hover: 'Stash', click: () => stash(), icon: 'fas fa-sun',hidden: !git.status.filter(a =>a).length},
        {small: true, hover: 'Unstash', click: () => stashPop(), icon: 'far fa-sun', hidden: !git.stash},
        {small: true, hover: 'Reset', click: () => reset(), icon: 'fas fa-eraser'},
        {small: true, hover: 'Review from AI', click: () => openReview(), icon: 'fas fa-brain'}
        ]">
        <ul v-if="git.status.filter(a =>a).length">
          <li v-for="(status, i) of git.status" :key="'status-' + i">
            <span v-html="colorStatus(status)"></span>
            <div class="actions">
              <i class="fas fa-external-link-alt" aria-hidden="true" @click.stop="openInVsCode(status)"></i>
              <i class="fas fa-times" aria-hidden="true" @click.stop="checkoutFile(status)"></i>
            </div>
          </li>
        </ul>
        <div v-else class="check">
          <i class="fas fa-check" aria-hidden="true"></i>
        </div>
      </section-cmp>
    </div>
    <div class="loader" v-if="loader">
      <i class="fas fa-spinner"></i>
    </div>
    <section-cmp class="section-history">
      <div>
        Display all branches:
        <input type="checkbox" v-model="graphOnAll" @change="updateGraph">
      </div>
      <div class="input-container">
        <i class="fas fa-search"></i>
        <input type="text" v-model="search" placeholder="Search..." @keypress.enter="nextSearch">
        <div>
          <button @click="previousSearch"><i class="fas fa-chevron-up"></i></button>
          <button @click="nextSearch"><i class="fas fa-chevron-down"></i></button>
        </div>
      </div>
      <div ref="terminalRef"></div>
    </section-cmp>
  </div>

  <modal ref="resetModal" cancelString="No" validateString="Yes">
    <template #header>
      Reset
    </template>
    <template #body>
      Do you really want to launch "git reset --hard" on this repository ?
    </template>
  </modal>
  <modal ref="checkoutModal" cancelString="No" validateString="Yes">
    <template #header>
      Checkout
    </template>
    <template #body="{data: file}">
      Do you really want to launch "git checkout {{file}}" on this repository ?
    </template>
  </modal>
  <modal ref="branchModal" cancelString="No" validateString="Yes">
    <template #header>
      Branch change
    </template>
    <template #body="{data:branchName}">
      Do you really want to change branch to "{{branchName}}" on this repository ?
    </template>
  </modal>
  <modal ref="addBranchModal" cancelString="Cancel" validateString="Validate">
    <template #header>
      Add Branch
    </template>
    <template #body="{data:model}">
      <input type="text" v-model="model.name" placeholder="Name of branch">
      <div>
        <input type="checkbox" v-model="model.shouldPush" placeholder="Name of branch">
        Push this branch after creation ?
      </div>
    </template>
  </modal>
    <modal ref="branchDeleteModal" cancelString="No" validateString="Yes">
    <template #header>
      Branch delete
    </template>
    <template #body="{data:branchName}">
      Do you really want to delete branch "{{branchName}}" on this repository ?
    </template>
  </modal>
  <modal ref="reviewModal" cancelString="No" validateString="Yes">
    <template #header>
      Review from AI
    </template>
    <template #body="{data: tokens}">
      Are you sure ? This have a cost of ~{{ tokens.price }}$
    </template>
  </modal>

  <modal ref="reviewResult" cancelString="OK" :noValidate="true">
    <template #header>
      Review from AI
    </template>
    <template #body="{data: result}">
      <pre>
        {{result?.trim()}}
      </pre>
    </template>
  </modal>
</template>

<script setup>
import { Terminal } from 'xterm';
import { FitAddon } from 'xterm-addon-fit';
import { CanvasAddon } from 'xterm-addon-canvas';
import { SearchAddon } from 'xterm-addon-search';
import notification from '../../../../fronts/app/src/helpers/notification';
import Service from '../../../../fronts/app/src/models/service';
import modal from '../../../../fronts/app/src/components/Modal.vue';
import sectionCmp from '../../../../fronts/app/src/components/Section.vue';
import Theme from '../../../../fronts/app/src/helpers/Theme';
import { useCurrentEditor } from '../../../../fronts/app/src/models/currentEditor';
import { computed, onBeforeUnmount, onMounted, ref } from 'vue';

const props = defineProps({
  noStyle: { default: false },
  customGit: { default: null },
  service: {
    /** @type {import('../../../../fronts/app/src/models/service').default | null} */
    default: null,
    required: true,
    type: Service,
  },
})

const {
  currentEditor
} = useCurrentEditor(props.service)

/** @type {import('vue').Ref<number | null>} */
const interval = ref(null)
/** @type {import('vue').Ref<number | null>} */
const longInterval = ref(null)
/** @type {import('vue').Ref<import('xterm').Terminal | null>} */
const terminal = ref(null)
const loader = ref(false)
const graphOnAll = ref(false)
/** @type {import('vue').Ref<string | null>} */
const defaultBranch = ref(null)
const search = ref('')
/** @type {import('vue').Ref<import('xterm-addon-search').SearchAddon | null>} */
const terminalSearch = ref(null)
const displayOnlyLocalBranches = ref(true)
const searchBranch = ref('')
const observable = ref(null)

const git = computed(() => {
  return props.service.git;
})
/** @return {string} */
const pullLabel = computed(() => {
  if (git.value?.delta == null) return 'Refresh...';
  return `Pull (${git.value.delta || 0})`;
})
const displayBranches = computed(() => {
  return (git.value?.branches || [])
    .filter((branch) => branch.name.toUpperCase().includes(searchBranch.value.toUpperCase()))
    .filter((branch) => {
      if (displayOnlyLocalBranches.value) return !branch.isRemote;
      return true;
    });
})
const terminalRef = ref()
onMounted(async () => {
 if (props.customGit) return;
  const commandRef = /** @type {HTMLElement} */(terminalRef.value);
  if (!commandRef) return;
  // @ts-ignore
  interval.value = setInterval(() => props.service.updateGit(), 1000);
  // @ts-ignore
  longInterval.value = setInterval(() => gitFetch(), 1000 * 60);
  await props.service.updateGit();
  if (!defaultBranch.value) {
    const branchNames = props.service.git?.branches?.map((/** @type {*} */a) => a.name) || [];
    if (branchNames.includes('develop')) defaultBranch.value = 'develop';
    else if (branchNames.includes('dev')) defaultBranch.value = 'dev';
    else if (branchNames.includes('master')) defaultBranch.value = 'master';
    else if (branchNames.includes('main')) defaultBranch.value = 'main';
  }
  await loadTerminal();

  observable.value = Theme.observableCurrentTheme.subscribe(async () => {
    loadTerminal();
    await updateGraph();
    await gitFetch();
  });
  await updateGraph();
  await gitFetch();
})

onBeforeUnmount(() => {
  clearInterval(interval.value || undefined);
  clearInterval(longInterval.value || undefined);
  observable.value?.unsubscribe?.();
})
function loadTerminal() {
  const commandRef = /** @type {HTMLElement} */(terminalRef.value);
  if (!commandRef) return;
  commandRef.innerHTML = '';
  terminal.value = new Terminal({
    smoothScrollDuration: 100,
    fontFamily: 'MesloLGS NF, monospace',
    convertEol: true,
    disableStdin: true,
    fontSize: 13,
    allowTransparency: true,
    minimumContrastRatio: Theme.get('system.terminal/contrastRatio'),
    theme: {
      background: Theme.get('system.terminal/backgroundColor'),
      foreground: Theme.get('system.terminal/color'),
      selectionBackground: '#1d95db',
      selectionForeground: 'white',
    },
  });
  const fitAddon = new FitAddon();
  if (terminal.value) {
    terminal.value.loadAddon(fitAddon);
    terminal.value.loadAddon(new CanvasAddon());
    const searchAddon = new SearchAddon();
    terminalSearch.value = searchAddon;
    terminal.value.loadAddon(searchAddon);
    terminal.value.open(commandRef);
    fitAddon.activate(terminal.value);
    fitAddon.fit();
  }
}
/** @param {KeyboardEvent | MouseEvent} ev */
async function  nextSearch(ev) {
  if (ev.shiftKey) {
    return previousSearch();
  }
  if (terminalSearch.value) {
    terminalSearch.value.findNext(search.value);
  }
  return null;
}
async function  previousSearch() {
  if (terminalSearch.value) {
    terminalSearch.value.findPrevious(search.value);
  }
}
/** @param {string} line */
function openInVsCode(line) {
  const path = line.trim().split(' ').slice(1).join(' ');
  props.service.openLinkInVsCode(path, currentEditor.value.key);
}
async function gitFetch() {
  try {
    if (!props.service.git) return;
    props.service.git.delta = null;
    await props.service.gitFetch()
      .catch((/** @type {*} */err) => notification.next('error', err?.response?.data || err?.message || err));
    const currentBranch = await props.service.getCurrentBranch();
    if (!currentBranch) return;
    props.service.git.delta = await props.service.gitRemoteDelta(currentBranch);
  } catch (error) {
    console.error(error);
    if (props.service.git) props.service.git.delta = 0;
  }
}

const addBranchModal = ref()
async function addBranch() {
  const model = {
    name: '',
    shouldPush: false,
  };
  // @ts-ignore
  const res = await addBranchModal.value.open(model).promise;
  if (res) {
    if (!model.name) return notification.next('error', 'Branch name cannot be empty');
    await props.service.addBranch(model.name, model.shouldPush);
    if (model.shouldPush) await gitFetch();
  }
  return null;
}

async function updateGraph() {
  const graph = await props.service.getGraph(graphOnAll.value)
    .catch((/** @type {*} */err) => notification.next('error', err?.response?.data || err?.message || err));
  if (graph && terminal.value) {
    terminal.value.clear();
    terminal.value.writeln(graph.join('\n'));
    setTimeout(() => {
      if (!terminal.value) return;
      terminal.value.scrollToTop();
    });
  }
}
/** @param {string} status */
function colorStatus(status) {
  status = status.trim();
  if (status.charAt(0) === 'D') {
    status = `<span style="color: #ff7f7f; font-weight: bold">D</span>${status.slice(1)}`;
  }
  if (status.charAt(0) === 'M') {
    status = `<span style="color: #ffe47f; font-weight: bold">M</span>${status.slice(1)}`;
  }
  if (status.charAt(0) === '?') {
    status = `<span style="color: #7fe1ff; font-weight: bold">??</span>${status.slice(2)}`;
  }
  return status;
}

const branchModal = ref()
/** @param {string} branchName */
async function changeBranch(branchName) {
  loader.value = true;
  try {
    branchName = branchName.trim();
    // @ts-ignore
    const res = await branchModal.value.open(branchName).promise;
    if (res) {
      await props.service.changeBranch(branchName)
        .then(() => notification.next('success', `Branch is now on ${branchName}`))
        .catch((/** @type {*} */err) => notification.next('error', err.response.data));
    }
    updateGraph();
  } catch (error) {

  } finally {
    loader.value = false;
    await props.service.updateGit();
    await gitFetch();
  }
}

const branchDeleteModal = ref()
/** @param {string} branchName */
async function deleteBranch(branchName) {
  loader.value = true;
  try {
    branchName = branchName.trim();
    // @ts-ignore
    const res = await branchDeleteModal.value.open(branchName).promise;
    if (res) {
      await props.service.deleteBranch(branchName)
        .then(() => notification.next('success', `Branch ${branchName} is deleted`))
        .catch((/** @type {*} */err) => notification.next('error', err.response.data));
    }
    await props.service.updateGit();
    updateGraph();
  } catch (error) {

  } finally {
    loader.value = false;
    await props.service.updateGit();
    await gitFetch();
  }
}
const checkoutModal = ref()
/** @param {string} fileStatus */
async function checkoutFile(fileStatus) {
  const file = fileStatus.split(' ').slice(1).join(' ');
  // @ts-ignore
  const res = await checkoutModal.value.open(file).promise;
  if (res) {
    await props.service.checkoutFile(file)
      .then(() => notification.next('success', `Changes on ${file} are deleted`))
      .catch((/** @type {*} */err) => notification.next('error', err.response.data));
    await updateGraph();
  }
}

const resetModal = ref()
async function reset() {
  // @ts-ignore
  const res = await resetModal.value.open().promise;
  if (res) {
    await props.service.reset()
      .then(() => notification.next('success', 'All changes are lost'))
      .catch((/** @type {*} */err) => notification.next('error', err.response.data));
    await updateGraph();
  }
}

const reviewModal = ref()
const reviewResult = ref()
async function openReview() {
  const diff = await props.service.getDiff();
  const tokens = await Service.getTokens(diff);
  // @ts-ignore
  const res = await reviewModal.value.open(tokens).promise;
  if (res) {
    const review = await Service.reviewFromAi(diff);
    // @ts-ignore
    await reviewResult.value.open(review).promise;
  }
}
async function stash() {
  await props.service.stash()
    .then(() => notification.next('success', 'All changes is in stash'))
    .catch((/** @type {*} */err) => notification.next('error', err.response.data));
  return props.service.updateGit();
}
async function stashPop() {
  await props.service.stashPop()
    .then(() => notification.next('success', 'All changes unstashed'))
    .catch((/** @type {*} */err) => notification.next('error', err.response.data));
  return props.service.updateGit();
}
async function pull() {
  await props.service.pull()
    .then(() => notification.next('success', 'Branch is now up to date'))
    .catch((/** @type {*} */err) => notification.next('error', err.response.data));
  await props.service.updateGit();
  await updateGraph();
  await gitFetch();
}
</script>

<style lang="scss" scoped>
.git-root {
  display: flex;
  flex-direction: column;
  gap: 20px;
  box-sizing: border-box;
}
button {
  position: relative;
  z-index: 2;
}
.section-branches {
  z-index: 1;
  flex-grow: 1;
  width: auto;
  flex-shrink: 0;
  max-width: 100%;
}
.section-status {
  z-index: 1;
  flex-grow: 2;
  width: auto;
  flex-shrink: 0;
  max-width: 100%;
}
.git-section {
  display: flex;
  justify-content: space-between;
  flex-wrap: wrap;
  align-items: stretch;
  margin: auto;
  height: 100%;
  width: 100%;
  flex-grow: 1;
  gap: 20px;
  z-index: 100;
  &>* {
    max-height: 400px;
  }
  .check {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100%;
    font-size: 1.5em;
    color: green;
  }
  ul {
    margin: 0;
    padding: 0;
    li {
      border-left: 1px solid lightgrey;
      padding: 0;
      padding-left: 10px;
      transition: 300ms;
      display: flex;
      justify-content: space-between;
      align-items: center;
      list-style: none;
      margin: 0;
      cursor: pointer;
      .actions {
        display: flex;
        gap: 10px;
      }
      &.active {
        border-left: 3px solid #0076bc;
      }
      button {
        width: max-content;
        transition: 300ms;
        opacity: 0;
        margin: 0 3px
      }
      &:hover {
        background-color: rgba(0,0,0,0.05);
        button {
          opacity: 1;
        }
      }
    }
  }
}
.loader {
  position: absolute;
  top: 0;
  left: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  width: 100%;
  height: 100%;
  z-index: 100000;
  backdrop-filter: blur(10px);
  i {
    font-size: 50px;
    animation: rotation 2s infinite linear;
  }
}
@keyframes rotation {
  0% {
    transform: rotateZ(0);
  }
  100% {
    transform: rotateZ(360deg);
  }
}

.input-container {
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  gap: 10px;

  input {
    border-radius: 10px;
    padding: 5px;
  }

  button {
    height: auto;
    padding: 5px 10px;
  }
}
</style>
</file>

<file path="modules/git/front/src/NotUpToDate.vue">
<template>
  <div class="git-section">
    <h1>Git</h1>
    <div class="sections">
      <section-cmp class="section" v-if="servicesToPull?.length || checkUpdatePending" :actions="[
        {label: 'Pull all', icon:'fas fa-download', click: pullAll, hidden: checkUpdatePending}
      ]">
        <template #header>
          <div class="custom-header">
            <div class="loader" v-if="checkUpdatePending">
              <Spinner size="15"></Spinner>
            </div>
            Services to pull
            <div class="loader" v-if="checkUpdatePending">
              ({{nbServiceChecked}}/{{ groups?.length }})
              {{ currentServiceChecking }}
            </div>
          </div>
        </template>
        <table>
          <caption>All services to pull</caption>
          <tr v-for="services of servicesToPull" :key="services[0].label">
            <td>
              <template v-for="service of services">
                <h3>{{ service.label }}
                <i class="fas fa-external-link-alt" @click="router.push({
                  name: 'stack-single', params: {label: service.label}
                })"></i></h3>
              </template>
            </td>
            <td><div class="badge">{{ services[0].git?.currentBranch }}</div></td>
            <td>
              <button @click="pull(services[0])" :disabled="checkUpdatePending || !!services[0].git?.status?.length">
                <i class="fas fa-download"></i>
                {{ 'Pull ' + '(' + (services[0].git?.delta || 0) + ')' }}
              </button>
            </td>
            <td>
              <div class="line" v-if="services[0].git">
                <div v-if="services[0].git.status?.length">
                  <i class="fas fa-exclamation-triangle"></i>
                  Pending changes... Pull may not work. Stash or reset your changes before.
                </div>
                <button class="small" :disabled="checkUpdatePending || !services[0].git?.status?.filter(a => a).length"
                  @click="stash(services[0])">
                  <i class="fas fa-sun"></i>
                  Stash
                </button>
                <button class="small" :disabled="checkUpdatePending || !services[0].git.stash" @click="stashPop(services[0])">
                  <i class="far fa-sun"></i>
                  Unstash
                </button>
              </div>
            </td>
          </tr>
        </table>
      </section-cmp>

      <section-cmp class="section" v-if="servicesToPush?.length || checkUpdatePending">
        <template #header>
          <div class="custom-header">
            <div class="loader" v-if="checkUpdatePending">
              <Spinner size="15"></Spinner>
            </div>
            Services to push
            <div class="loader" v-if="checkUpdatePending">
              ({{nbServiceChecked }}/{{ groups?.length }})
            </div>
          </div>
        </template>
        <table>

          <caption>All services to push</caption>
          <tr v-for="services of servicesToPush" :key="services[0]?.label">
            <td>
              <template v-for="service of services">
                <h3>{{ service.label }}
                <i class="fas fa-external-link-alt" @click="router.push({
                  name: 'stack-single', params: {label: service.label}
                })"></i></h3>
              </template>
            </td>
            <td><div class="badge">{{ services[0].git?.currentBranch }}</div></td>
            <td>
              <template v-if="servicesWithError[services[0].label] === 'BRANCH_TO_PUSH'">
                Branch not on remote
              </template>
              <template v-else>
                {{ services[0].git?.delta }} commits to push
              </template>
            </td>
          </tr>
        </table>
      </section-cmp>

      <section-cmp header="Services">
        Change all branches to:
        <select @input="// @ts-ignore
                        changeAllBranches($event?.target?.value ||'')" :disabled="checkUpdatePending">
          <option default></option>
          <option v-for="branch of allBranches" :key="branch?.name" :value="branch?.name">{{ branch?.name }}</option>
        </select>
        <table>
          <caption>Manage all services</caption>
          <tr v-for="service of services.filter(s => s.git?.currentBranch)" :key="service?.label">
             <td>
              <h3>
                {{ service.label }}
                <i class="fas fa-external-link-alt" @click="router.push({
                  name: 'stack-single', params: {label: service.label}
                })"></i>
              </h3>
            </td>
            <template v-if="servicesWithError[service.label] && servicesWithError[service.label] !== 'BRANCH_TO_PUSH'">
              <td colspan="3">
                {{ servicesWithError[service.label] }}
              </td>
            </template>
            <template v-else>
              <td><div class="badge">{{ service.git?.currentBranch }}</div></td>
              <td>
                <select @input="changeBranch(// @ts-ignore
                  service, $event.target.value)"
                  v-if="service.git?.branches?.filter(a => a?.name !== service.git?.currentBranch)?.length"
                  :disabled="checkUpdatePending">
                  <option default></option>
                  <option v-for="branch of service.git?.branches?.filter(a => a?.name !== service.git?.currentBranch)"
                    :key="branch?.name" :value="branch?.name">{{ branch?.name }}</option>
                </select>
                <div v-else>
                  Unique branch, cannot change branch for this service
                </div>
              </td>
              <td>
                <div class="line">
                  <button class="small" :disabled="checkUpdatePending || !service.git?.status?.filter(a => a).length"
                    @click="stash(service)">
                    <i class="fas fa-sun"></i>
                    Stash
                  </button>
                  <button class="small" :disabled="checkUpdatePending || !service.git?.stash" @click="stashPop(service)">
                    <i class="far fa-sun"></i>
                    Unstash
                  </button>
                </div>
              </td>
            </template>
          </tr>
        </table>
      </section-cmp>
    </div>
  </div>
</template>

<script setup>
import { computed, onMounted, ref } from 'vue';
import { useRouter } from 'vue-router';
import PromiseB from 'bluebird';
import SectionCmp from '../../../../fronts/app/src/components/Section.vue';
import stack from '../../../../fronts/app/src/models/stack';
import notification from '../../../../fronts/app/src/helpers/notification';
import Spinner from '../../../../fronts/app/src/components/Spinner.vue';

const router = useRouter();

/** @type {import('vue').Ref<import('../../../../fronts/app/src/models/service').default[]>} */
const services = ref(stack.services.value.sort((a, b) => a.label?.localeCompare(b?.label || '') || 0));
/** @type {import('vue').Ref<import('../../../../fronts/app/src/models/service').default[][]>} */
const servicesToPull = ref([]);
/** @type {import('vue').Ref<import('../../../../fronts/app/src/models/service').default[][]>} */
const servicesToPush = ref([]);
/** @type {import('vue').Ref<{[key: string]: string}>} */
const servicesWithError = ref({});
async function updateGit() {
  const result = await PromiseB.map(stack.services.value, async (service) => {
    await service.updateGit();
    return service;
  }, { concurrency: 6 });
  services.value = result.sort((a, b) => a.label?.localeCompare(b?.label || '') || 0);
}
onMounted(async () => {
  await stack.loadServices();
  await updateGit();
  await checkUpdates();
});
/**
 * @param {*[]} arr
 * @param {string[]} properties
 */
const getUniqueItemsByProperties = (arr, properties) => (
  arr.filter((v, i, a) => a.findIndex((v2) => properties.every((k) => v2[k] === v[k])) === i)
);

const allBranches = computed(() => {
  const array = services.value.flatMap((service) => service.git?.branches).filter((a) => a);
  return getUniqueItemsByProperties(array, ['name']).sort((a, b) => a?.name?.localeCompare(b?.name));
});

const checkUpdatePending = ref(false);
const nbServiceChecked = ref(0);
const currentServiceChecking = ref('');

const groups = computed(() => {
  /**
   * @type {{[key: string]: import('../../../../fronts/app/src/models/service').default[]}}
   */
  const record = (stack?.services.value || []).reduce((agg, service) => {
    if(!agg[service.rootPath]) agg[service.rootPath] = []
    agg[service.rootPath].push(service)
    return agg
  }, {})
  console.log(record)
  return Object.keys(record).map(rootPath => ({
    rootPath, services: record[rootPath]
  }))
})

const checkUpdates = async () => {
  checkUpdatePending.value = true;
  nbServiceChecked.value = 0;
  currentServiceChecking.value = '';
  servicesToPull.value = [];
  servicesToPush.value = [];
  servicesWithError.value = {}
  console.log(groups.value)
  await PromiseB.map(groups.value, async ({rootPath, services}) => {
    console.log(services)
    const [service] = services
    try {
      currentServiceChecking.value = service.label || '';
      await service.updateGit();
      const currentBranch = await service.getCurrentBranch().catch(err => {
        servicesWithError.value[service.label] = err.response.data?.message
        throw err
      });
      if (service.git && currentBranch) {
        service.git.delta = await service.gitRemoteDelta(currentBranch).catch(err => {
          if(err.response.data?.code === 500.12578) {
            servicesToPush.value.push(services)
            servicesWithError.value[service.label] = 'BRANCH_TO_PUSH'
          } else {
            servicesWithError.value[service.label] = err.response.data?.message
          }
          throw err
        });
        if (service.git.delta) {
          if (service.git.delta < 0) {
            servicesToPull.value.push(services);
          }
          if (service.git.delta > 0) {
            servicesToPush.value.push(services);
          }
        }
      }
      return service;
    } catch (error) {
      console.error(error);
    } finally {
      nbServiceChecked.value += 1;
    }
    return null;
  }, { concurrency: 6 })
    .finally(() => {
      checkUpdatePending.value = false;
      currentServiceChecking.value = '';
    });
};

/** @param {import('../../../../fronts/app/src/models/service').default} service */
async function pull(service) {
  checkUpdatePending.value = true;
  await service.pull()
    .catch((err) => notification.next('error', err.response.data));
  await service.updateGit();
  await checkUpdates();
  notification.next('success', 'Branch is now up to date');
}
async function pullAll() {
  checkUpdatePending.value = true;
  try {
    await PromiseB.map(servicesToPull.value, async (services) => {
      await services[0].pull()
        .catch((err) => notification.next('error', err.response.data));
    }, { concurrency: 6 });
    await checkUpdates();
    notification.next('success', 'All branches are pulled');
  } catch (error) {
    console.error(error);
  } finally {
    checkUpdatePending.value = false;
  }
}

/** @param {string} branchName */
async function changeAllBranches(branchName) {
  if (!branchName) return;
  checkUpdatePending.value = true;
  await PromiseB.map(services.value, async (service) => {
    await service.changeBranch(branchName)
      .catch((err) => notification.next('error', err.response.data));
  }, { concurrency: 6 });
  await updateGit();
  await checkUpdates();
}

/**
 * @param {import('../../../../fronts/app/src/models/service').default} service
 * @param {string} branchName
*/
async function changeBranch(service, branchName) {
  if (!branchName) return;
  checkUpdatePending.value = true;
  await service.changeBranch(branchName)
    .catch((err) => notification.next('error', err.response.data));
  await updateGit();
  await checkUpdates();
}
/** @param {import('../../../../fronts/app/src/models/service').default} service */
async function stash(service) {
  await service.stash()
    .then(() => notification.next('success', 'All changes is in stash'))
    .catch((err) => notification.next('error', err.response.data));
  return service.updateGit();
}
/** @param {import('../../../../fronts/app/src/models/service').default} service */
async function stashPop(service) {
  await service.stashPop()
    .then(() => notification.next('success', 'All changes unstashed'))
    .catch((err) => notification.next('error', err.response.data));
  return service.updateGit();
}
</script>

<style lang="scss" scoped>
.git-section {
  overflow: auto;
  height: 100%;
  width: 100%;
  padding: 20px;
  box-sizing: border-box;
}
.sections {
  display: flex;
  flex-direction: column;
  gap: 20px;
}
.custom-header {
  display: flex;
  gap: 10px;
}
table {
  caption {
    display: none;
  }
}
h3, h1 {
  margin: 0;
}
h3 {
  i {
    cursor: pointer;
  }
}
.line {
  display: flex;
  align-items: center;
}
.badge {
  background: var(--git-badge-backgroundColor);
  color: var(--git-badge-color);
  padding: 5px 10px;
  border-radius: 10px;
  width: max-content;
}
.section {
  width: 100%;
}
tr {
  transition: 300ms;
  &:hover {
    background-color: rgba(0,0,0, 0.05);
  }
  td {
    text-align: left;
    vertical-align: middle;
  }
}
select {
  width: 100%;
  background-color: var(--system-secondary-backgroundColor);
  color: var(--system-secondary-color);
}
button.small {
  width: max-content;
}
.loader {
  display: flex;
  align-items: center;
  gap: 10px;
}
</style>
</file>

<file path="modules/github/backend/index.js">
/** @type {import('@runeya/modules-plugins-loader-front/src/views').PluginSM<null>} */
const plugin = {
  enabled: true,
  name: 'Github',
  displayName: 'Github',
  description: 'View pull requests for a given service',
  icon: 'fab fa-github',
  export: null,
  placements: ['service'],
  order: 3,
  /** @param {import('../../../servers/server/models/Service')} service */
  hidden: async (service) => {
    if (!service) return true;
    return !service.git?.remote?.includes('github.com');
  },
  routes: require('./routes'),
};
module.exports = plugin;
</file>

<file path="modules/github/backend/routes.js">
const express = require('express');
const { Octokit } = require('fix-esm').require('@octokit/core');
const { restEndpointMethods } = require('fix-esm').require('@octokit/plugin-rest-endpoint-methods');

const router = express.Router();

const MyOctokit = Octokit.plugin(restEndpointMethods);

/** @type {Octokit & import('@octokit/plugin-rest-endpoint-methods').Api | null} */
let octokit = process.env.RUNEYA_GH_APIKEY
  ? new MyOctokit({ auth: process.env.RUNEYA_GH_APIKEY })
  : null;

/** @param {import('@runeya/common-typings').Runeya} runeya */
module.exports = (runeya) => {
  const { findService } = runeya;

  router.get('/github/service/:label/ready', async (req, res) => {
    requirements();
    if (!octokit) return null;
    const { data: { login } } = await octokit.rest.users.getAuthenticated();
    return res.send(login);
  });

  router.post('/github/service/:label/apikey', async (req, res) => {
    const { apikey } = req.body;
    if (!apikey) return res.status(400).send('apikey not found in body');
    const _octokit = new Octokit.Octokit({ auth: apikey });
    const { data: { login } } = await _octokit.rest.users.getAuthenticated();
    octokit = _octokit;
    return res.send(login);
  });

  router.get('/github/service/:label/whoami', async (req, res) => {
    requirements();
    if (!octokit) return;
    const { data: { login } } = await octokit.rest.users.getAuthenticated();
    res.json({ loggedAs: login });
  });

  router.get('/github/service/:label/pull-requests', async (req, res) => {
    const service = findService(req.params.label);
    if (!service) return res.status(404).send('Service not found');
    const [owner, repo] = `${new URL(service.git.home).pathname.replace('.git', '')}`.split('/').slice(-2);
    requirements();
    if (!octokit) return null;
    const { data } = await octokit.rest.pulls.list({ owner, repo });
    return res.json(data);
  });

  return router;
};

function requirements() {
  if (!octokit && !process.env.RUNEYA_GH_APIKEY) {
    throw new Error('github api is not initialized');
  } else if (!octokit) {
    octokit = new MyOctokit({ auth: process.env.RUNEYA_GH_APIKEY });
  }
}
</file>

<file path="modules/github/front/src/Index.vue">
<template>
  <section-cmp v-if="service" :key="service.label">
    <div class="header">
      <h2>Github</h2>
    </div>
    <div class="container" v-if="isReady">
      <div>
        Logged as:
        {{ loggedAs }}
      </div>
      <div class="chooser" v-if="!currentPr">
        <div>
          <input type="checkbox" v-model="onlyToReview">
          Display only to review
        </div>
        <div>
          <input type="checkbox" v-model="onlyOwned">
          Display only owned
        </div>
        <TableGeneric :headers="[
          { id: 'state', label: 'State', width: '70px', },
          { id: 'title', label: 'Title' },
          { id: 'assignees', label: 'Owner',width: '100px', },
          { id: 'requested_reviewers', label: 'Reviewers', width: '100px', }
        ]" :value="prToDisplay" @row-click="currentPr = $event.row">
          <template #assignees="{item: assignees}">
            <div class="avatars">
              <img v-for="user of assignees" class="avatar"
              :src="user.avatar_url" :alt="user.login" :title="user.login">
            </div>
          </template>
          <template #requested_reviewers="{item: requested_reviewers }">
            <div class="avatars">
              <img v-for="user of requested_reviewers" class="avatar"
              :src="user.avatar_url" :alt="user.login" :title="user.login">
            </div>
          </template>
        </TableGeneric>
      </div>
      <div class="content" v-if="currentPr">
        <div @click="currentPr = null">
          <i class="fas fa-chevron-left"></i>
          Return
        </div>
        <h2>{{ currentPr.title }}</h2>
        <div class="section">
          <h3><i class="fas fa-globe"></i>Urls</h3>
          <ul>
            <li><a :href="currentPr.html_url">Home url</a></li>
            <li><a :href="currentPr.diff_url">Diff url</a></li>
            <li><a :href="currentPr.comments_url">Comment url</a></li>
          </ul>
        </div>
        <div class="section">
          <h3><i class="fas fa-users"></i>Assignees</h3>
          <ul>
            <li v-for="user of currentPr.assignees" class="avatars">
              <a :href="user.html_url">
                <img class="avatar" :src="user.avatar_url" alt=""/>{{ user.login }}
              </a>
            </li>
          </ul>
        </div>
        <div class="section">
          <h3><i class="fas fa-users"></i>Reviewers</h3>
          <ul>
            <li v-for="user of currentPr.requested_reviewers" class="avatars">
              <a :href="user.html_url">
                <img class="avatar" :src="user.avatar_url" alt=""/>{{ user.login }}
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="container" v-else>
      <div>
        To use this module you need to provide a valid apikey from github in the
        RUNEYA_GH_APIKEY environment variable.
        <a href="https://github.com/settings/tokens/new" target="_blank">See here.</a>
      </div>
    </div>
  </section-cmp>
</template>

<script setup>
import { computed, onMounted, ref } from 'vue';
import Service from '../../../../fronts/app/src/models/service';
import SectionCmp from '../../../../fronts/app/src/components/Section.vue';
import axios from '../../../../fronts/app/src/helpers/axios';
import notification from '../../../../fronts/app/src/helpers/notification';
import TableGeneric from '../../../../fronts/app/src/components/TableGeneric.vue';

const props = defineProps({
  service: {
    default: null,
    required: true,
    type: Service,
  },
});

const apikey = ref('');
const onlyToReview = ref(false);
const onlyOwned = ref(false);
const isReady = ref(false);
const loggedAs = ref('');
/** @type {import('vue').Ref<PR[]>} */
const prs = ref([]);
/** @type {import('vue').Ref<PR | null>} */
const currentPr = ref(null);
onMounted(async () => {
  await reload();
});

async function getIsReady() {
  const { data: _isReady } = await axios.get(`/github/service/${props.service.label}/ready`);
  return !!_isReady;
}

async function getLoggedAs() {
  const { data: login } = await axios.get(`/github/service/${props.service.label}/whoami`);
  return login.loggedAs;
}
async function getPRs() {
  const { data: prs } = await axios.get(`/github/service/${props.service.label}/pull-requests`);
  return prs;
}
async function reload() {
  try {
    isReady.value = await getIsReady();
    if (!isReady.value) return;
    loggedAs.value = await getLoggedAs();
    prs.value = await getPRs();
  } catch (error) {
    notification.next('error', 'Something not works');
    console.error(error);
  }
}

const prToDisplay = computed(() => {
  let res = prs.value;
  if (onlyToReview.value) {
    res = res.filter((pr) => (
      pr.requested_reviewers.find((user) => user.login === loggedAs.value)
    ));
  }
  if (onlyOwned.value) res = res.filter((pr) => pr.assignees.find((user) => user.login === loggedAs.value));
  return res;
});

async function validateApikey() {
  await axios.post(`/github/service/${props.service.label}/apikey`, { apikey: apikey.value })
    .catch((err) => {
      notification.next('error', err?.response?.data || err?.message || err);
    });
  apikey.value = '';
  await reload();
}
/**
 * @typedef {{
 *  url: string,
 *  id: number,
 *  node_id: string,
 *  html_url: string,
 *  diff_url: string,
 *  patch_url: string,
 *  issue_url: string,
 *  number: number,
 *  state: string,
 *  locked: boolean,
 *  title: string,
 *  user: {
 *   login: string,
 *   id: number,
 *   node_id: string,
 *   avatar_url: string,
 *   gravatar_id: string,
 *   url: string,
 *   html_url: string,
 *   followers_url: string,
 *   following_url: string,
 *   gists_url: string,
 *   starred_url: string,
 *   subscriptions_url: string,
 *   organizations_url: string,
 *   repos_url: string,
 *   events_url: string,
 *   received_events_url: string,
 *   type: string,
 *   site_admin: boolean
 *  },
 *  body: string,
 *  created_at: string,
 *  updated_at: string,
 *  closed_at: string,
 *  merged_at: string,
 *  merge_commit_sha: string,
 *  assignee: string,
 *  assignees: {
 *    login: string,
 *    id: number,
 *    node_id: string,
 *    avatar_url: string,
 *    gravatar_id: string,
 *    url: string,
 *    html_url: string,
 *    followers_url: string,
 *    following_url: string,
 *    gists_url: string,
 *    starred_url: string,
 *    subscriptions_url: string,
 *    organizations_url: string,
 *    repos_url: string,
 *    events_url: string,
 *    received_events_url: string,
 *    type: string,
 *    site_admin: boolean
 *  }[],
 *  requested_reviewers:  {
 *    login: string,
 *    id: number,
 *    node_id: string,
 *    avatar_url: string,
 *    gravatar_id: string,
 *    url: string,
 *    html_url: string,
 *    followers_url: string,
 *    following_url: string,
 *    gists_url: string,
 *    starred_url: string,
 *    subscriptions_url: string,
 *    organizations_url: string,
 *    repos_url: string,
 *    events_url: string,
 *    received_events_url: string,
 *    type: string,
 *    site_admin: boolean
 *  }[],
 *  requested_teams: string[],
 *  labels: {
 *    id: number,
 *    node_id:string,
 *    url:string,
 *    name:string,
 *    color:string,
 *    default: boolean,
 *    description: string
 *  }[],
 *  milestone: string,
 *  draft: boolean,
 *  commits_url: string,
 *  review_comments_url: string,
 *  review_comment_url: string,
 *  comments_url: string,
 *  statuses_url: string,
 *  head: {
 *    label: string,
 *    ref: string,
 *    sha: string,
 *  },
 *  base: {
 *    label: string,
 *    ref: string,
 *    sha: string,
 *  },
 * _links: {
 *    self: {
 *      href: string
 *    },
 *    html: {
 *      href: string
 *    },
 *    issue: {
 *      href: string
 *    },
 *    comments: {
 *      href: string
 *    },
 *    review_comments: {
 *      href: string
 *    },
 *    review_comment: {
 *      href: string
 *    },
 *    commits: {
 *      href: string
 *    },
 *    statuses: {
 *      href: string
 *    }
 *  },
 * }} PR
 */
</script>
<style lang="scss" scoped>
h2,
h3 {
  margin: 0;
  display: flex;
  gap: 10px;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.chooser {
  .avatars {
    display: flex;
    flex-direction: row;
    .avatar {
      width: 30px;
      height: 30px;
      object-fit: cover;
      border-radius: 50%;
    }
  }
}
.content {
  .avatars>a {
    display: flex;
    align-items: center;
    gap: 10px;
    .avatar {
      width: 30px;
      height: 30px;
      object-fit: cover;
      border-radius: 50%;
    }
  }
}
ul {
  margin: 0;
}
</style>
</file>

<file path="modules/global-scripts/backend/GlobalScripts.js">
const { v4 } = require('uuid');

/** @type {GlobalScript[]} */
const globalScripts = [];
/** @type {Record<string, TrackStep>} */
const currentScriptsByCommunicationId = {};

/** @param {import('@runeya/common-typings').Runeya} runeya */
const GlobalScripts = (runeya) => {
  const { Socket } = runeya;
  return {
    /** @param {GlobalScript} script */
    addScript(script) {
      const index = globalScripts.findIndex((s) => s.label === script.label);
      if (index >= 0) {
        globalScripts.splice(index, 1);
      }
      globalScripts.push(script);
      runeya.Socket.emit('reloadScripts');
    },
    getScripts() {
      return globalScripts;
    },
    /** @param {string} label */
    getScript(label) {
      const scripts = this.getScripts();
      const script = scripts.find((s) => s.label === label);
      return script;
    },
    /**
     * @param {string} scriptId
     * @param {string} stepLabel
     */
    getStep(scriptId, stepLabel) {
      const script = this.getScript(scriptId);
      if (!script) return null;
      const step = script.pipeline.find((st) => st.id === stepLabel);
      if (!step) return null;
      return step;
    },
    /** @param {string} id */
    launchScript(id) {
      const script = this.getScript(id);
      if (!script) throw new Error(`Script ${id} not found`);
      const communicationId = v4();

      /** @type {TrackStep} */
      const track = {
        scriptId: script.label,
        currentStep: script.pipeline[0].id,
        loadingStep: script.pipeline[0].id,
        steps: {},
        output: {},
        prompts: {},
      };
      currentScriptsByCommunicationId[communicationId] = track;
      /** @param {import("./GlobalScripts").GlobalScript['pipeline'][number]} step */
      function getStepIndex(step) {
        return (script?.pipeline || []).indexOf(step);
      }
      Socket.on(communicationId, async (
      /** @type {import('ws').WebSocket} */ socket,
        /** @type {string} */ event,
        /** @type {any} */ data,
      ) => {
        /** @type {ScriptStep | null} */
        let step = null;
        // eslint-disable-next-line no-cond-assign
        while (step = this.getStep(script.label, track.currentStep)) {
          const index = getStepIndex(step);
          const nextStep = index >= 0 ? script.pipeline[index + 1]?.id : '';
          track.loadingStep = step.id;
          track.steps[track.currentStep] = {
            ...track.steps[track.currentStep],
            isValidated: false,
            error: undefined,
            printData: undefined,
          };
          socket.emit(communicationId, 'track', track);

          try {
            if (step.skip) {
              const shouldSkip = await step.skip(track.output, track.prompts);
              if (shouldSkip) {
                track.steps[track.currentStep].skipped = true;
                track.loadingStep = '';
                track.currentStep = nextStep;
                socket.emit(communicationId, 'track', track);
                continue;
              }
            }
          } catch (error) {
            console.error('Script error');
            console.error(error);
            track.steps[track.currentStep].error = error.message || error;
            break;
          }

          const shouldBreak = await prompt(step, track, event, data);
          if (shouldBreak) break;
          if (event === 'validate-prompt') event = '';

          if (step.script) {
            try {
              track.output[track.currentStep] = await step.script(track.output, track.prompts);
            } catch (error) {
              console.error('Script error');
              console.error(error);
              track.steps[track.currentStep].error = error.message || error;
              break;
            }
          }

          if (step.print) {
            try {
              track.steps[track.currentStep].printData = await step.print(track.output, track.prompts);
              await new Promise((resolve) => setTimeout(() => { resolve(null); }, 0)); // It will not pass to next step without this if step is very fast
            } catch (error) {
              console.error('Print error');
              console.error(error);
              track.steps[track.currentStep].error = error.message || error;
              break;
            }
          }

          track.steps[track.currentStep].isValidated = true;
          track.currentStep = nextStep;
        }
        track.loadingStep = '';
        socket.emit(communicationId, 'track', track);
      });
      return communicationId;
    },
  };
};

module.exports = GlobalScripts;

/**
 *
 * @param {ScriptStep} step
 * @param {TrackStep} track
 * @param {string} event
 * @param {any} data
 * @returns
 */
async function prompt(step, track, event, data) {
  if (!step.prompt) return false;
  if (event === 'validate-prompt') {
    if (step.prompt?.validation) {
      try {
        const msgError = await step.prompt.validation(data);
        if (msgError) {
          track.steps[track.currentStep].error = msgError;
          return true;
        }
        track.prompts[track.currentStep] = data;
      } catch (error) {
        console.error('Script error');
        console.error(error);
        track.steps[track.currentStep].error = error.message || error;
        return true;
      }
    } else {
      track.prompts[track.currentStep] = data;
    }
    return false;
  }
  if (step.prompt.defaultValue) {
    try {
      const defaultValue = await step.prompt.defaultValue(track.output);
      track.steps[track.currentStep].promptValue = defaultValue;
    } catch (error) {
      console.error('Script error');
      console.error(error);
      track.steps[track.currentStep].error = error.message || error;
      return true;
    }
  }
  if (step.prompt.options) {
    try {
      const options = await step.prompt.options(track.output);
      track.steps[track.currentStep].promptOptions = options;
    } catch (error) {
      console.error('Script error');
      console.error(error);
      track.steps[track.currentStep].error = error.message || error;
      return true;
    }
  }

  return true;
}

/**
 * @typedef {{
 *    label: string,
 *    id: string,
 *    skip?: (output: Record<string, any>, prompts: Record<string, any>) => boolean | Promise<boolean>
 *    prompt?:{
 *      question: string,
 *      options?: (output: Record<string, any>) => ({label: string, value: string}[]) | Promise<{label: string, value: string}[]>,
 *      defaultValue?: (output: Record<string, any>) => any,
 *      type?: 'string' | 'number' | 'boolean' | 'array' | 'select'| 'multi-select',
*       validation?: (value: any) => (string | null) | Promise<string | null>
 *    },
 *    script?: (output: Record<string, any>,prompts: Record<string, any>) => any,
 *    print?: (output: Record<string, any>, prompts: Record<string, any>) => any,
 *  }} ScriptStep
 */

/**
 * @typedef {{
 *  label: string,
 *  pipeline: ScriptStep[]}} GlobalScript
 */

/**
 * @typedef {{
 *  scriptId: string,
 *  currentStep: string,
 *  loadingStep: string,
 *  steps: Record<string, {
 *    error?: string,
 *    isValidated: boolean,
 *    skipped?: boolean,
 *    printData?: string,
 *    promptValue?: string,
 *    promptOptions?: {label: string, value: string}[],
 *  }>
 *  output: Record<string, any>
 *  prompts: Record<string, any>
 * }} TrackStep
 */
</file>

<file path="modules/global-scripts/backend/index.js">
const GlobalScripts = require('./GlobalScripts');

/** @type {import('@runeya/modules-plugins-loader-front/src/views').PluginSM<GlobalScripts>} */
const plugin = {
  enabled: true,
  name: 'Global scripts',
  displayName: 'Global scripts',
  description: 'Launch scripts and rule the world',
  icon: 'fas fa-columns',
  export: GlobalScripts,
  placements: [
    {
      position: 'dev-ops',
      label: 'Global scripts',
      iconText: '{}',
      goTo: { path: '/GlobalScripts' },
      active: 'GlobalScripts',
    },
  ],
  finder: (search, runeya) => {
    const scripts = runeya.globalScripts.getScripts()
      .filter((/** @type {*} */script) => script.label.toUpperCase()?.includes(search?.toUpperCase()));
    return [
      ...scripts.map((/** @type {*} */script) => ({
        icon: 'fas fa-cog',
        title: script.label,
        group: 'Global scripts',
        description: '',
        secondaryTitle: '',
        url: { path: '/DevOps/GlobalScripts', query: { script: script.label } },
      })),
    ];
  },
  routes: require('./routes'),
};
module.exports = plugin;
</file>

<file path="modules/help/backend/index.js">
/** @type {import('@runeya/modules-plugins-loader-front/src/views').PluginSM<null>} */
const plugin = {
  enabled: true,
  name: 'Help',
  displayName: 'Help',
  description: 'Show help',
  icon: 'fa-question-circle',
  export: null,
  placements: [{
    position: 'sidebar',
    label: 'Help',
    icon: 'fas fa-question-circle',
    goTo: { path: '/Help' },
    active: 'Help',
  }],
  order: Infinity,
};
module.exports = plugin;
</file>

<file path="modules/json-formatter/backend/index.js">
/** @type {import('@runeya/modules-plugins-loader-front/src/views').PluginSM<null>} */
const plugin = {
  enabled: true,
  name: 'JSONFormatter',
  displayName: 'Json Formatter',
  description: 'View json validity and explore it',
  icon: 'fas fa-random',
  export: null,
  placements: [
    {
      position: 'toolbox',
      label: 'JSON',
      iconText: '{}',
      goTo: { path: '/JSONFormatter' },
      active: 'JSON-formatter',
    },
  ],
  order: 6,
};
module.exports = plugin;
</file>

<file path="modules/json-formatter/front/src/Index.vue">
<template>
  <div class="json-root">
    <h1>JSON</h1>
    <section-cmp>
      <div class="section-content">
        <editor
          v-model="code"
          language="json"
          style="height:calc(100vh - 200px)"
        />
        <div class="json-viewer">
          <div class="valid" v-if="isValid">Valid JSON</div>
          <div class="invalid" v-else>Invalid JSON</div>
          <div>
            Show Raw
            <input type="checkbox" v-model="showRaw">
          </div>
          <div class="line">
            <button class="small" @click="openDiagram">
              Tree view
            </button>
            <button class="small" @click="copy(JSON.stringify(repairedJSON))">
              Copy minified json
            </button>
            <button class="small" @click="copy(JSON.stringify(repairedJSON, null, 2))">
              Copy json
            </button>
          </div>
          <div v-if="showRaw" class="raw">
            <pre v-html="raw"></pre>
          </div>
          <JsonTreeView v-else :maxDepth="6" :json="stringifiedJSON" :copyable="true"/>
        </div>
      </div>
    </section-cmp>
    <Modal ref="jsonCrackRef" validateString="Ok" :noCancel="true">
      <template #header="">
        JSON crack
      </template>
      <template #body="" >
        <div class="jsoncrack-container">
          <iframe width="100%" height="100%" ref="jsoncrackEmbed" id="jsoncrackEmbed" :src="`https://jsoncrack.com/widget`" />
        </div>
      </template>
    </Modal>
  </div>

</template>

<script setup>
import { computed, ref, nextTick } from 'vue';
import { JsonTreeView } from 'json-tree-view-vue3';
import { useRouter } from 'vue-router';
import { jsonrepair } from 'jsonrepair';
import SectionCmp from '../../../../fronts/app/src/components/Section.vue';
import notification from '../../../../fronts/app/src/helpers/notification';
import Modal from '../../../../fronts/app/src/components/Modal.vue';

const router = useRouter();

const initialJSON = router.currentRoute.value.query.json?.toString();
const showRaw = ref(false);
const jsonCrackRef = ref();
const jsoncrackEmbed = ref();
const openDiagram = async () => {
  jsonCrackRef.value.open();
  await nextTick();
  jsoncrackEmbed.value.onload = () => {
    jsoncrackEmbed.value.contentWindow.postMessage({
      json: stringifiedJSON.value,
    }, '*');
  };
};
const repairedJSON = computed(() => {
  try {
    return JSON.parse(code.value);
  } catch (error) {
    try {
      return JSON.parse(jsonrepair(code.value));
    } catch (error) {
      return {};
    }
  }
});

const stringifiedJSON = computed(() => {
  try {
    return JSON.stringify(repairedJSON.value);
  } catch (error) {
    return '{}';
  }
});

const raw = computed(() => {
  try {
    return JSON.stringify(repairedJSON.value, null, 2).split('\n').join('<br/>');
  } catch (error) {
    return '';
  }
});

const code = ref(initialJSON || '{}');

const isValid = computed(() => {
  try {
    JSON.parse(code.value);
    return true;
  } catch (error) {
    return false;
  }
});

/** @param {string} data */
function copy(data) {
  navigator.clipboard.writeText(data)
    .then(() => notification.next('success', 'Data copied to clipboard'));
}
</script>

<style scoped lang="scss">
.line {
  display: flex;
}
.json-root,.section-content {
  display: flex;
  flex-direction: column;
  width: 100%;
}
.section-content {
  display: flex;
  gap: 5px;
  flex-direction: row;
  height: calc(100vh - 200px);
}

.json-viewer {
  width: 50%;
  flex-shrink: 0;
  height: 100%;
}
.invalid {
  width: 100%;
  background-color: red;
  padding: 10px;
  box-sizing: border-box;
  color: white;
}
.valid {
  width: 100%;
  background-color: green;
  padding: 10px;
  box-sizing: border-box;
  color: white;
}
.raw {
  padding: 10px;
  border: 1px solid #999;
  margin: auto;
  align-self: center;
  border-radius: 10px;
}
.jsoncrack-container {
  height: 80vh;
}
</style>

<style>
.json-viewer-tab{
  margin-left: 20px;
}
</style>
</file>

<file path="modules/jwt/backend/index.js">
/** @type {import('@runeya/modules-plugins-loader-front/src/views').PluginSM<null>} */
const plugin = {
  enabled: true,
  name: 'JWT',
  displayName: 'JWT',
  description: 'View a json web token',
  icon: 'fas fa-key',
  export: null,
  placements: [
    {
      position: 'toolbox',
      label: 'JWT',
      icon: 'fas fa-key',
      goTo: { path: '/JWT' },
      active: 'JWT',
    },
  ],
  order: 6,
  routes: require('./routes'),
};
module.exports = plugin;
</file>

<file path="modules/kanban/backend/index.js">
const Kanban = require('./Kanban');

/** @type {import('@runeya/modules-plugins-loader-front/src/views').PluginSM<import('./Kanban')>} */
const plugin = {
  enabled: true,
  name: 'kanban',
  displayName: 'Kanban',
  description: 'Manage your project with cards',
  icon: 'fas fa-columns',
  placements: [
    {
      position: 'toolbox',
      label: 'Kanban',
      icon: 'fas fa-columns',
      goTo: { path: '/kanban' },
      active: 'kanban',
    },
  ],
  finder: (/** @type {*} */search, /** @type {*} */runeya) => {
    const boards = Kanban(runeya).Board.all().filter((board) => (
      runeya.helpers.searchString(board?.name || '', search)
    ));
    const cards = Kanban(runeya).Board.all()
      .flatMap((b) => b?.getColumns())
      ?.flatMap((c) => c?.getCards())
      ?.filter((board) => (
        runeya.helpers.searchString(board?.name || '', search)
      ));
    return [
      ...boards.map((board) => ({
        icon: 'fas fa-columns',
        title: board?.name || '',
        group: 'Kanban',
        description: 'Manage your project with cards',
        secondaryTitle: 'Board',
        url: { path: '/toolbox/kanban', query: { boardId: board?.id } },
      })),
      ...cards.map((card) => ({
        icon: 'fas fa-columns',
        title: card?.name || '',
        group: 'Kanban',
        description: 'Manage your project with cards',
        secondaryTitle: 'Card',
        url: { path: '/toolbox/kanban', query: { boardId: card?.boardId, cardId: card?.id } },
      })),
    ];
  },
  export: Kanban,
  order: 6,
  routes: require('./routes'),
};

module.exports = plugin;
</file>

<file path="modules/logs/backend/index.js">
const dayjs = require('dayjs');

/** @type {import('@runeya/modules-plugins-loader-front/src/views').PluginSM<null>} */
const plugin = {
  enabled: true,
  name: 'Logs',
  displayName: 'Logs',
  description: 'Show, parse and communicate with logs produced by yours commands',
  icon: 'fas fa-terminal',
  export: null,
  placements: ['service'],
  order: 1,
  /**
   * @param {*} search
   * @param {import('@runeya/common-typings').Runeya} runeya
   */
  finder: (search, runeya) => {
    const services = runeya.getServices()
      ?.flatMap((s) => (s.store?.slice(-300).reverse().map((line) => ({ log: line, service: s }))))
      ?.filter(({ log }) => runeya.helpers.searchString(log.raw, search));
    return [
      ...services.map((service) => ({
        icon: 'fas fa-terminal',
        title: service.log.raw,
        group: 'Logs',
        description: `Log from ${service.service.label}`,
        secondaryTitle: service.service.label,
        secondaryDescription: dayjs(service.log.timestamp).format('YYYY-DD-MM HH:mm:ss'),
        url: { path: `/stack-single/${encodeURIComponent(service.service.label)}`, query: { tab: 'Logs' } },
      })),
    ];
  },
  routes: require('./routes'),
};
module.exports = plugin;
</file>

<file path="modules/mongo/backend/index.js">
/** @type {import('@runeya/modules-plugins-loader-front/src/views').PluginSM<null>} */
const plugin = {
  enabled: true,
  name: 'Mongo',
  displayName: 'Mongo',
  description: 'Make some operation on mongo objectid',
  icon: 'fab fa-envira',
  export: null,
  placements: [
    {
      position: 'toolbox',
      label: 'Mongo',
      icon: 'fab fa-envira',
      goTo: { path: '/Mongo' },
      active: 'Mongo',
    },
  ],
  order: 6,
  routes: require('./routes'),
};
module.exports = plugin;
</file>

<file path="modules/node-repl/backend/index.js">
/** @type {import('@runeya/modules-plugins-loader-front/src/views').PluginSM<null>} */
const plugin = {
  enabled: true,
  name: 'NodeREPL',
  displayName: 'Node REPL',
  description: 'Create nodejs scripts for test purposes',
  icon: 'fab fa-node',
  export: null,
  placements: [
    {
      position: 'toolbox',
      label: 'Node Sandbox',
      icon: 'fab fa-node',
      goTo: { path: '/NodeREPL' },
      active: 'NodeREPL',
    },
  ],
  order: 6,
  routes: require('./routes'),
};
module.exports = plugin;
</file>

<file path="modules/node-repl/front/src/Index.vue">
<template>
  <div class="node-repl-root">
    <h1>{{ room }}</h1>
    <div class="content">
      <div class="rooms">
        <input type="text" placeholder="New room..." :style="{ width: '100%' }" @change="// @ts-ignore
        newRoom($event.target?.value, $event)">
        <div class="room" :class="{ active: room === _room }" v-for="_room of rooms" :key="_room"
        @click="changeRoom(_room)">
          <div>{{ _room }}</div>
          <button class="small" @click.stop="deleteRoom(_room)">
            <i class="fas fa-trash"></i>
          </button>
        </div>
      </div>
      <div class="chat-container" v-if="room">
        <section-cmp header="Input">
          <Editor v-model="code" language="javascript" style="height: 400px" @save="write"></Editor>
          <button @click="write()">Send</button>
        </section-cmp>
        <section-cmp header="Output">
          <div ref="terminalRef"></div>
        </section-cmp>
      </div>
    </div>
  </div>
</template>

<script setup>
import { nextTick, onMounted, ref } from 'vue';
import { Terminal } from 'xterm/lib/xterm';
import { FitAddon } from 'xterm-addon-fit';
import axios from '../../../../fronts/app/src/helpers/axios';
import Socket from '../../../../fronts/app/src/helpers/Socket';
import SectionCmp from '../../../../fronts/app/src/components/Section.vue';
// @ts-ignore

const defaultCode = `
;(async () => {
  // Code...
})()
  .then(console.log)
  .catch(console.error)
`;

/** @type {import('vue').Ref<HTMLElement | undefined>} */
const terminalRef = ref();
/** @type {import('vue').Ref<string[]>} */
const rooms = ref([]);
/** @type {import('vue').Ref<Room>} */
const room = ref('');
/** @type {import('vue').Ref<{result?: string}>} */
const messages = ref({});
const terminal = ref();
const code = ref(defaultCode);

onMounted(async () => {
  Socket.on('node-repl:update', ({ msg, clear }) => {
    if (clear) terminal.value.clear();
    if (!msg) return;
    msg.trim().split('\n')
      .filter((/** @type {string} */a) => a)
      .forEach((/** @type {string} */line) => {
        terminal.value.writeln(line);
      });
  });
  await reload();
});

async function write() {
  await axios.post(`/node-repl/chat/${room.value}`, {
    script: code.value,
  });
}
async function reload() {
  const { data: _rooms } = await axios.get('/node-repl/rooms');
  rooms.value = _rooms;
  if (!room.value) {
    await changeRoom(rooms.value?.[0]);
  }
  const { data: _room } = await axios.get(`/node-repl/chat/${room.value}`);
  messages.value = _room;
  if (_room.script) code.value = _room.script;
}

/** @param {Room} _room */
async function deleteRoom(_room) {
  await axios.delete(`/node-repl/rooms/${_room}`);
  await reload();
}

/**
 *
 * @param {Room} room
 * @param {Event} $event
 */
async function newRoom(room, $event) {
  await axios.post('/node-repl/rooms', { room });
  await reload();
  // @ts-ignore
  if ($event) $event.target.value = '';
  await changeRoom(room);
}

/** @param {Room} _room */
async function changeRoom(_room) {
  if (!_room) return;
  room.value = _room;
  messages.value = {};
  code.value = defaultCode;
  await reload();
  await nextTick();
  const commandRef = terminalRef.value;
  if (terminalRef.value) terminalRef.value.innerHTML = '';
  terminal.value = new Terminal({
    experimentalCharAtlas: 'static',
    convertEol: true,
    disableStdin: true,
    fontSize: 14,
    height: 'calc(100vh)',
    theme: {

    },
  });
  const fitAddon = new FitAddon();
  terminal.value.loadAddon(fitAddon);
  terminal.value.open(commandRef);
  fitAddon.activate(terminal.value);
  fitAddon.fit();
  if (messages.value?.result) {
    terminal.value?.clear();
    messages.value?.result.trim().split('\n').filter((a) => a).forEach((line) => {
      terminal.value.writeln(line);
    });
  }
}
/**
 * @typedef {{}} Room
 */
</script>

<style scoped lang="scss">
.node-repl-root,.section-content {
  width: 100%;
}

$leftSize: 200px;
.node-repl-root {
  display: flex;
  flex-direction: column;
  gap: 10px;
  height: 100%;
  width: 100%;
  .content {

  box-sizing: border-box;
  display: flex;
  gap: 10px;
  }
    .rooms {
      width: $leftSize;
      flex-shrink: 0;
      gap: 5px;
      display: flex;
      flex-direction: column;
      .room {
        border-left: 1px solid black;
        padding: 5px;
        box-sizing: border-box;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 0 10px 0 rgba(0,0,0,0.2);

        cursor: pointer;
        &:hover {
          background-color: rgba(0,0,0,0.05);
        }
        button {
          width: max-content;
          justify-content: center;
          i {
            margin: 0;
          }
        }
        &.active {
          border-left: 4px solid #1d95db;
        }
      }
      input {
        box-sizing: border-box;
        height: 35px;
        border-radius: 20px;
        border: none;
        box-shadow: 0 0 10px 0 rgba(0,0,0,0.2);
        padding: 0 10px;

      }
    }
    .chat-container {
      width: calc(100% - $leftSize);
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        .toolbar {
          display: flex;
          &>div {
            display: flex;
            flex-direction: column;
          }
        }
      }
    }

}
</style>
</file>

<file path="modules/npm/backend/routes.js">
const express = require('express');

const router = express.Router();
const Npm = require('./Npm');

/** @param {import('@runeya/common-typings').Runeya} runeya */
module.exports = (runeya) => {
  const { findService } = runeya;

  router.get('/npm/:service', async (req, res) => {
    const service = findService(req.params.service);
    const npm = new Npm(service);
    const isNpm = await npm.isNpm(req.query.cwd);
    res.json(isNpm);
  });
  router.get('/npm/:service/paths', async (req, res) => {
    const service = findService(req.params.service);
    const npm = new Npm(service);
    const paths = await npm.getNpmPaths();
    res.json(paths);
  });

  router.get('/npm/:service/packagejson', async (req, res) => {
    const service = findService(req.params.service);
    const npm = new Npm(service);
    const packagejson = await npm.packageJSON(req.query.cwd);
    res.json(packagejson);
  });

  router.get('/npm/:service/outdated', async (req, res) => {
    const service = findService(req.params.service);
    const npm = new Npm(service);
    const packagejson = await npm.outdated(req.query.cwd);
    res.json(packagejson);
  });

  return router;
};
</file>

<file path="modules/openapi/backend/index.js">
/** @type {import('@runeya/modules-plugins-loader-front/src/views').PluginSM<null>} */
const plugin = {
  enabled: true,
  name: 'OpenApi',
  displayName: 'OpenApi',
  export: null,
  description: 'Open an open api json into swagger',
  icon: 'fas fa-network-wired',
  placements: ['service'],
  order: 4,
  hidden: (service) => {
    if (!service) return false;
    return !service?.openapiURL;
  },
  routes: require('./routes'),
};
module.exports = plugin;
</file>

<file path="modules/openapi/front/src/Index.vue">
<template>
  <section-cmp :key="service?.label">
    <div :id="id" :class="{dark}"></div>
  </section-cmp>
</template>

<script setup>
import SwaggerUi from 'swagger-ui';
import {
  ref, onMounted, onUnmounted,
} from 'vue';
import 'swagger-ui/dist/swagger-ui.css';
import { v4 } from 'uuid';
import Service from '../../../../fronts/app/src/models/service';
import SectionCmp from '../../../../fronts/app/src/components/Section.vue';
import Theme from '../../../../fronts/app/src/helpers/Theme';
import axios from '../../../../fronts/app/src/helpers/axios';

function uuid() {
  return `a${v4().replaceAll('-', '')}`;
}
const id = ref(uuid());
const dark = ref(false);
const observable = Theme.observableCurrentTheme.subscribe(async (_, theme) => {
  dark.value = theme === 'dark';
});
onUnmounted(() => {
  observable?.unsubscribe?.();
});
const props = defineProps({
  service: {
    default: null,
    type: Service,
  },
});
onMounted(async () => {
  id.value = uuid();
  dark.value = Theme.currentTheme === 'dark';
  const { data: spec } = await axios.post('/openapi/swagger.json', { url: props.service.openapiURL });
  SwaggerUi({
    dom_id: `#${id.value}`,
    url: props.service.openapiURL,
    spec,
    explorer: false,
    deepLinking: false,
    defaultModelsExpandDepth: -1,
    displayRequestDuration: true,
    persistAuthorization: true,
    filter: true,
    syntaxHighlight: {
      theme: 'monokai',
    },
    plugins: [
    ],
    layout: 'BaseLayout',
  });
});

</script>

<style lang="scss" scoped>
::v-deep {
  .swagger-ui {
    padding: 10px 0;
    border-radius: 5px;
    .information-container {
      display: none;
    }
  }
}
</style>

<style lang="scss">
.swagger-ui .scheme-container {
    background-color: transparent;
    box-shadow: none;
}

.swagger-ui .dialog-ux .modal-ux {
    background: var(--system-sections-backgroundColor);
}
.swagger-ui .dialog-ux .modal-ux,
.swagger-ui .dialog-ux .modal-ux button,
.swagger-ui label,
.swagger-ui .tab li,
.swagger-ui .model,
.swagger-ui .dialog-ux .modal-ux-content p,
.swagger-ui .dialog-ux .modal-ux-header h3,
.swagger-ui .dialog-ux .modal-ux-content h4 {
    color: var(--system-color);
}
.swagger-ui select,
.swagger-ui input[type=email], .swagger-ui input[type=file], .swagger-ui input[type=password], .swagger-ui input[type=search], .swagger-ui input[type=text], .swagger-ui textarea,
.swagger-ui .filter .operation-filter-input {
    background: var(--system-background);
    color: var(--system-color);
    border-color: var(--system-sections-innerShadow);
    &::placeholder {
        color: var(--system-color);

    }
}
.swagger-ui .dialog-ux .modal-ux,
.swagger-ui .auth-container,
.swagger-ui .dialog-ux .modal-ux-header {
    border-color: var(--system-sections-innerShadow-lighter);
}

.swagger-ui .dialog-ux .modal-ux button {
    box-shadow: none;
}

.swagger-ui,
.swagger-ui .btn,
.swagger-ui .response-col_links,
.swagger-ui .response-col_status,
.swagger-ui .parameter__name,
.swagger-ui .parameter__type,
.swagger-ui section h3,
.swagger-ui .responses-inner h4, .swagger-ui .responses-inner h5,
.swagger-ui .opblock .opblock-section-header h4,
.swagger-ui table thead tr td, .swagger-ui table thead tr th,
.swagger-ui .opblock-description-wrapper p, .swagger-ui .opblock-external-docs-wrapper p, .swagger-ui .opblock-title_normal p,
.swagger-ui .opblock-description-wrapper, .swagger-ui .opblock-external-docs-wrapper, .swagger-ui .opblock-title_normal, 
.swagger-ui .opblock .opblock-summary-description, .swagger-ui .opblock-tag, .swagger-ui .opblock .opblock-summary-operation-id, .swagger-ui .opblock .opblock-summary-path, .swagger-ui .opblock .opblock-summary-path__deprecated {
    color: var(--system-color)
}
.swagger-ui .opblock .opblock-summary .view-line-link.copy-to-clipboard {
    display: none;
}
.swagger-ui .model-box-control:focus, .swagger-ui .models-control:focus, .swagger-ui .opblock-summary-control:focus {
    outline: none;
}
.swagger-ui button {
    box-shadow: none;
    outline: none;
}
.swagger-ui .opblock .opblock-section-header {
    background: var(--system-sections-backgroundColor);
    color: var(--system-sections-color);
}
</style>
</file>

<file path="modules/regex/backend/index.js">
/** @type {import('@runeya/modules-plugins-loader-front/src/views').PluginSM<null>} */
const plugin = {
  enabled: true,
  name: 'Regex',
  displayName: 'Regex',
  description: 'Test your regular expression',
  icon: 'fas fa-key',
  export: null,
  placements: [
    {
      position: 'toolbox',
      label: 'Regex',
      icon: 'fas fa-key',
      goTo: { path: '/Regex' },
      active: 'Regex',
    },
  ],
  order: 6,
};
module.exports = plugin;
</file>

<file path="modules/toolbox/backend/index.js">
/** @type {import('@runeya/modules-plugins-loader-front/src/views').PluginSM<null>} */
const plugin = {
  enabled: true,
  name: 'Toolbox',
  displayName: 'Toolbox',
  description: 'Choose from a bunch of tool',
  icon: 'fas fa-plus',
  export: null,
  placements: [{
    position: 'sidebar',
    label: 'Toolbox',
    icon: 'fas fa-toolbox',
    goTo: '/toolbox',
    active: 'toolbox',
  }],
  order: 6,
};
module.exports = plugin;
</file>

<file path="modules/toolbox/front/src/Toolbox.vue">
<template>
  <div class="toolbox">
    <div class="sidebar">
      <ul>
        <input type="text" ref="searchToolRef" placeholder="Search tool..." v-model="searchToolTerm" autofocus="true" @keypress.enter="chooseFirst">
        <li v-for="plugin of buttonsPlugins" :key="plugin?.name" class="sidebar-item"
          @click="plugin?.click?.()"
          :class="{ active: isActive(plugin) }">
          <div class="item">
            <i class="icon" :class="plugin?.icon" v-if="plugin?.icon"></i>
            <span class="icon" v-if="plugin?.iconText">{{ plugin?.iconText }}</span>
            {{ plugin?.text }}
          </div>
        </li>
      </ul>
    </div>
    <div class="container">
      <router-view v-if="router.currentRoute.value.fullPath !== '/toolbox'"/>
      <div v-else class="no-tools">
        <div>
          <i class="fas fa-toolbox"></i>
        </div>
        <div>
          Choisissez un outils
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { useRouter } from 'vue-router';
import { onMounted, ref, computed } from 'vue';
import axios from '../../../../fronts/app/src/helpers/axios';

const router = useRouter();
/** @type {import('vue').Ref<import('../../../plugins-loader/front/src/views').PluginSM<undefined>[]>} */
const plugins = ref([]);
const searchToolTerm = ref('');
const searchToolRef = ref();
onMounted(async () => {
  /** @type {{data: import('../../../plugins-loader/front/src/views').PluginSM<undefined>[]}} */
  const { data: _plugins } = await axios.get('/plugins/toolbox');
  plugins.value = _plugins?.flat() || [];
  searchToolRef.value?.focus();
});

const buttonsPlugins = computed(() => ([
  ...plugins.value.map((plugin) => plugin.placements.map((placement) => {
    if (typeof placement === 'string') return null;
    return {
      ...plugin,
      text: placement.label,
      icon: placement.icon,
      iconText: placement.iconText,
      click: placement.goTo ? () => {
        if (typeof placement.goTo === 'string') router.push({ path: placement.goTo });
        else {
          router.push({
            ...placement.goTo,
            // @ts-ignore
            path: `/toolbox${(placement.goTo?.path || placement.goTo)}`,
          });
        }
      } : () => { },
      active: placement.active,
    };
  })).flat().filter((f) => f?.text?.toUpperCase().includes(searchToolTerm.value?.toUpperCase())),
]));

function chooseFirst() {
  buttonsPlugins.value?.[0]?.click();
}
/** @param {import('../../../plugins-loader/front/src/views').PluginSM<undefined> | undefined | null} plugin */
function isActive(plugin) {
  return router.currentRoute.value.params.plugin === plugin?.name;
}

</script>

<style scoped lang="scss">
input {
  width: 90%;
  box-sizing: border-box;
  margin: 5px auto;
  justify-self: center;
}
.toolbox {
  display: flex;
  min-width: 0;
  width: 100%;
  align-items: center;
}
.sidebar {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    box-shadow: 0px 0px 4px 0px black;
    width: 150px;
    background-color: var(--system-secondary-sidebar-backgroundColor);
    color: var(--system-sidebar-secondary-color);
    height: 100%;
    flex-shrink: 0;
    z-index: 3;
    ul {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
    }
  }

.progress-container {
  display: flex;
  align-items: center;
  label {
    width: 60px;
  }
}

.sidebar-item {
  cursor: pointer;
  transform: translateZ(0);
  transition: background-color 300ms;
  padding: 5px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-left: 5px solid transparent;

  .item {
    display: flex;
    align-items: center;
    gap: 5px;
  }
  .icon {
    width: 20px;
    transition: 300ms;
    display: flex;
    justify-content: center;

  }
  &:hover {
    background-color: var(--system-backgroundColor);
    color: var(--system-color);
    i {
      opacity: 1;
    }
  }
  &.active {
    font-weight: bold;
    border-left: 5px solid var(--system-accent-backgroundColor1)
  }
  &.disabled {
    color: #999;
  }
}
.container {
  display: flex;
  flex-grow: 1;
  min-width: 0;
  padding: 5px 10px;
  box-sizing: border-box;
  height: 100%;
}
.no-tools {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  width: 100%;
  font-size: 2em;
  color: #999;
}
</style>
</file>

<file path="modules/uuid/backend/index.js">
/** @type {import('@runeya/modules-plugins-loader-front/src/views').PluginSM<import('./UUID')>} */
const plugin = {
  enabled: true,
  name: 'UUID',
  displayName: 'UUID',
  description: 'Generate an UUID',
  icon: 'fas fa-random',
  placements: [
    {
      position: 'toolbox',
      label: 'UUID',
      icon: 'fas fa-random',
      goTo: { path: '/UUID' },
      active: 'UUID',
    },
  ],
  export: require('./UUID'),
  order: 6,
  routes: require('./routes'),
};

module.exports = plugin;
</file>

<file path="modules/vscode/backend/.gitignore">
*.vsix
</file>

<file path="modules/vscode/backend/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/vscode/extension/src/helpers/decorationManager.js">
// eslint-disable-next-line import/no-unresolved
const vscode = require('vscode');
// eslint-disable-next-line import/no-unresolved
const { window } = require('vscode');

module.exports = class DecorationManager {
  constructor() {
    /** @type {import('vscode').DecorationOptions[]} */
    this.decorations = [];
    this.decorationType = window.createTextEditorDecorationType({ after: { margin: '0 0 0 0.5rem' } });
  }

  /**
   * @param {import('vscode').DecorationOptions[]} decorations
   * @param {import('vscode').DecorationOptions} decoration
   */
  updateDecoration(decorations, decoration) {
    const { line } = decoration.range.start;
    decorations = decorations.filter((dec) => dec.range.start.line !== line);
    decorations.push(decoration);
    return decorations;
  }

  /**
   * @param {import('vscode').TextEditorSelectionChangeEvent} e
   * @param {number[]} lines
   * @param {string} message
   */
  renderWaitDecorations(e, lines, message) {
    const decorations = lines.map((line) => this.setDecorations(e, line, message));
    this.renderDecorations(e, decorations);
    return decorations;
  }

  /**
   *
   * @param {import('vscode').TextEditorSelectionChangeEvent} e
   * @param {number} line
   * @param {string} text
   * @param {('error' | 'info') | undefined} [type]
   * @returns
   */
  setDecorations(e, line, text, type) {
    let color = '#888';
    if (type === 'error') { color = '#F40'; }
    if (type === 'info') { color = '#79F'; }
    /** @type {import('vscode').DecorationOptions} */
    const decoration = {
      renderOptions: { after: { contentText: text, color } },
      range: new vscode.Range(new vscode.Position(line, 1024), new vscode.Position(line, 1024)),
    };
    return decoration;
  }

  /**
   *
   * @param {import('vscode').TextEditorSelectionChangeEvent} e
   * @param {import('vscode').DecorationOptions[]} decorations
   */
  renderDecorations(e, decorations) {
    e.textEditor.setDecorations(this.decorationType, decorations);
  }
};
</file>

<file path="modules/vscode/extension/src/helpers/exec.js">
const { exec } = require('child_process');

module.exports = {
  /**
   * @param {string} cmd
   * @param {import('child_process').ExecOptions} options
   * @returns {Promise<string>}
   */
  execAsync(cmd, options) {
    return new Promise((res, rej) => {
      exec(cmd, options, (err, stdout, stderr) => {
        if (err) return rej(stderr || err);
        return res(stdout);
      });
    });
  },
  /**
   * @param {string} cmd
   * @param {import('child_process').ExecOptions} options
   * @returns {Promise<string>}
   */
  execAsyncWithoutErr(cmd, options) {
    return new Promise((res) => {
      exec(cmd, options, (err, stdout) => {
        res(stdout);
      });
    });
  },
  /**
   * @param {string} cmd
   * @param {import('child_process').ExecOptions} options
   * @returns {Promise<string>}
   */
  execAsyncGetError(cmd, options) {
    return new Promise((res) => {
      exec(cmd, options, (err, stdout, stderr) => {
        res(stderr);
      });
    });
  },
};
</file>

<file path="modules/vscode/extension/src/networks/axios.js">
// eslint-disable-next-line import/no-unresolved
const axios = require('axios');

const getAxios = (context) => axios.create({ baseURL: `http://localhost:${context.globalState.get('runeyaPort')}` });

/** @param {import('vscode').ExtensionContext} context */
module.exports = {
  getAxios,
  restart: async (label, context) => getAxios(context).get(`/stack/${label}/restart`),
  start: async (label, context) => getAxios(context).get(`/stack/${label}/start`),
  stop: async (label, context) => getAxios(context).get(`/stack/${label}/stop`),
  openUrl: async (url, context) => getAxios(context).get('/vscode/open-url', { params: { url } }),
  isAvailable: async (context) => {
    const { data: version } = await getAxios(context).get('/version').catch((error) => { console.error(error); return { data: null }; });
    return !!version;
  },

};
</file>

<file path="modules/vscode/extension/src/providers/TreeProvider.js">
/* eslint-disable max-classes-per-file */
// eslint-disable-next-line import/no-unresolved
const vscode = require('vscode');
const fs = require('fs');
const path = require('path');

const findPackageJson = (_path) => {
  if (path.resolve(_path) === path.resolve('/')) return '';
  if (fs.existsSync(path.resolve(_path, 'package.json'))) return _path;
  return findPackageJson(path.resolve(_path, '..'));
};

module.exports = class NodeDependenciesProvider {
  constructor(workspaceRoot) {
    this.workspaceRoot = findPackageJson(workspaceRoot);
  }

  getTreeItem(element) {
    return element;
  }

  async getChildren(element) {
    if (!this.workspaceRoot) {
      vscode.window.showInformationMessage('No dependency in empty workspace');
      return [];
    }

    if (element) {
      return [
        ...await this.getDepsInPackageJson(
          path.join(this.workspaceRoot, 'node_modules', element.label, 'package.json'),
        ) || [],
        ...await this.getDepsInPackageJson(
          path.join(vscode.workspace.workspaceFolders[0].uri.path, 'node_modules', element.label, 'package.json'),
        ) || [],
      ];
    }
    const packageJsonPath = path.join(this.workspaceRoot, 'package.json');
    if (this.pathExists(packageJsonPath)) {
      return this.getDepsInPackageJson(packageJsonPath);
    }
    const packageJsonPathRoot = path.join(vscode.workspace.workspaceFolders[0].uri.path, 'package.json');
    if (this.pathExists(packageJsonPathRoot)) {
      return this.getDepsInPackageJson(packageJsonPathRoot);
    }
    vscode.window.showInformationMessage('Workspace has no package.json');
    return [];
  }

  /**
   * Given the path to package.json, read all its dependencies and devDependencies.
   */
  getDepsInPackageJson(packageJsonPath) {
    if (this.pathExists(packageJsonPath)) {
      const toDep = (moduleName, version) => {
        if (this.pathExists(path.join(this.workspaceRoot, 'node_modules', moduleName))) {
          return new Dependency(
            moduleName,
            version,
            vscode.TreeItemCollapsibleState.Collapsed,
          );
        }
        if (this.pathExists(path.join(vscode.workspace.workspaceFolders[0].uri.path, 'node_modules', moduleName))) {
          return new Dependency(
            moduleName,
            version,
            vscode.TreeItemCollapsibleState.Collapsed,
          );
        }
        return new Dependency(moduleName, version, vscode.TreeItemCollapsibleState.None);
      };

      const packageJson = JSON.parse(fs.readFileSync(packageJsonPath, 'utf-8'));

      const deps = packageJson.dependencies
        ? Object.keys(packageJson.dependencies).map((dep) => toDep(dep, packageJson.dependencies[dep]))
        : [];
      const devDeps = packageJson.devDependencies
        ? Object.keys(packageJson.devDependencies).map((dep) => toDep(dep, packageJson.devDependencies[dep]))
        : [];
      return deps.concat(devDeps);
    }
    return [];
  }

  pathExists(p) {
    try {
      fs.accessSync(p);
    } catch (err) {
      return false;
    }
    return true;
  }
};

class Dependency extends vscode.TreeItem {
  constructor(
    label,
    version,
    collapsibleState,
  ) {
    super(label, collapsibleState);
    this.tooltip = `${this.label}-${this.version}`;
    this.version = version;
    this.description = this.version;
  }
}
</file>

<file path="modules/vscode/extension/src/schedule/heartbeat.js">
// eslint-disable-next-line import/no-unresolved
const vscode = require('vscode');
const { editor } = require('../views/views');
const { isAvailable } = require('../networks/axios');
const { isConnectInProgress } = require('../helpers/initialize');

module.exports = {
  /** @type {import('vscode').ExtensionContext | null} */
  context: null,
  async heartBeat() {
    const { context } = module.exports;
    if (!isConnectInProgress() && !await isAvailable(context)) {
      vscode.commands.executeCommand('setContext', 'runeyaAvailable', false);
    } else if (isConnectInProgress() && !await isAvailable(context)) {
      vscode.commands.executeCommand('setContext', 'runeyaAvailable', false);
    } else {
      vscode.commands.executeCommand('setContext', 'runeyaAvailable', true);
      editor.update();
    }
  },
  launchHeartBeat(context) {
    module.exports.context = context;
    setInterval(module.exports.heartBeat, 1000);
  },
};
</file>

<file path="modules/vscode/extension/test/extension.test.js">
const assert = require('assert');

// You can import and use all API from the 'vscode' module
// as well as import your extension to test it
const vscode = require('vscode');
// const myExtension = require('../extension');

suite('Extension Test Suite', () => {
	vscode.window.showInformationMessage('Start all tests.');

	test('Sample test', () => {
		assert.strictEqual(-1, [1, 2, 3].indexOf(5));
		assert.strictEqual(-1, [1, 2, 3].indexOf(0));
	});
});
</file>

<file path="modules/vscode/extension/.gitignore">
out
.vscode-test
</file>

<file path="modules/vscode/extension/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/vscode/extension/.vscode-test.mjs">
import { defineConfig } from '@vscode/test-cli';

export default defineConfig({
	files: 'test/**/*.test.js',
});
</file>

<file path="modules/vscode/extension/.vscodeignore">
.vscode/**
.vscode-test/**
test/**
.gitignore
.yarnrc
vsc-extension-quickstart.md
**/jsconfig.json
**/*.map
**/.eslintrc.json
**/.vscode-test.*
</file>

<file path="modules/vscode/extension/.yarnrc">
--ignore-engines true
</file>

<file path="modules/vscode/extension/build.js">
const { execSync } = require('child_process');

const path = require('path');

const {
  cpSync, existsSync, mkdirSync, readFileSync,
  writeFileSync,
  rmSync,
} = require('fs');

if (existsSync(path.resolve(__dirname, './out'))) {
  rmSync(path.resolve(__dirname, './out'), { recursive: true, force: true });
}
if (!existsSync(path.resolve(__dirname, './out'))) {
  mkdirSync(path.resolve(__dirname, './out'));
}
if (!existsSync(path.resolve(__dirname, './out/src'))) {
  mkdirSync(path.resolve(__dirname, './out/src'));
}
execSync('esbuild ./src/extension.js --bundle --outfile=out/src/main.js --external:vscode --format=cjs --platform=node', { stdio: 'inherit', cwd: __dirname });
cpSync(path.resolve(__dirname, './package.json'), path.resolve(__dirname, './out/package.json'));
cpSync(path.resolve(__dirname, './resources'), path.resolve(__dirname, './out/resources'), { recursive: true });
let packageJSON = readFileSync(path.resolve(__dirname, './out/package.json'), 'utf-8');
packageJSON = packageJSON
  .replaceAll('"main": "./src/extension.js",', '"main": "./src/main.js",')
  .replaceAll('"name": "@runeya/modules-vscode-extension",', '"name": "runeya",');

writeFileSync(path.resolve(__dirname, './out/package.json'), packageJSON, 'utf-8');
writeFileSync(path.resolve(__dirname, './out/LICENSE'), 'MIT', 'utf-8');
execSync('npm i --omit=dev', { stdio: 'inherit', cwd: path.resolve(__dirname, './out') });
execSync('vsce package -o runeya.vsix', { stdio: 'inherit', cwd: path.resolve(__dirname, './out') });
if (existsSync(path.resolve(__dirname, '../backend'))) {
  cpSync(path.resolve(__dirname, './out/runeya.vsix'), path.resolve(__dirname, '../backend/runeya.vsix'));
}
</file>

<file path="modules/vscode/extension/jsconfig.json">
{
	"compilerOptions": {
		"module": "Node16",
		"target": "ES2022",
		"checkJs": true,  /* Typecheck .js files. */
		"lib": [
			"ES2022"
		]
	},
	"exclude": [
		"node_modules"
	]
}
</file>

<file path="modules/vscode/extension/README.md">
# runeya README

This is the README for your extension "runeya". After writing up a brief description, we recommend including the following sections.

## Features

Describe specific features of your extension including screenshots of your extension in action. Image paths are relative to this README file.

For example if there is an image subfolder under your extension project workspace:

\!\[feature X\]\(images/feature-x.png\)

> Tip: Many popular extensions utilize animations. This is an excellent way to show off your extension! We recommend short, focused animations that are easy to follow.

## Requirements

If you have any requirements or dependencies, add a section describing those and how to install and configure them.

## Extension Settings

Include if your extension adds any VS Code settings through the `contributes.configuration` extension point.

For example:

This extension contributes the following settings:

* `myExtension.enable`: Enable/disable this extension.
* `myExtension.thing`: Set to `blah` to do something.

## Known Issues

Calling out known issues can help limit users opening duplicate issues against your extension.

## Release Notes

Users appreciate release notes as you update your extension.

### 1.0.0

Initial release of ...

### 1.0.1

Fixed issue #.

### 1.1.0

Added features X, Y, and Z.

---

## Working with Markdown

You can author your README using Visual Studio Code.  Here are some useful editor keyboard shortcuts:

* Split the editor (`Cmd+\` on macOS or `Ctrl+\` on Windows and Linux)
* Toggle preview (`Shift+Cmd+V` on macOS or `Shift+Ctrl+V` on Windows and Linux)
* Press `Ctrl+Space` (Windows, Linux, macOS) to see a list of Markdown snippets

## For more information

* [Visual Studio Code's Markdown Support](http://code.visualstudio.com/docs/languages/markdown)
* [Markdown Syntax Reference](https://help.github.com/articles/markdown-basics/)

**Enjoy!**
</file>

<file path="modules/vscode/extension/vsc-extension-quickstart.md">
# Welcome to your VS Code Extension

## What's in the folder

* This folder contains all of the files necessary for your extension.
* `package.json` - this is the manifest file in which you declare your extension and command.
  * The sample plugin registers a command and defines its title and command name. With this information VS Code can show the command in the command palette. It doesn’t yet need to load the plugin.
* `extension.js` - this is the main file where you will provide the implementation of your command.
  * The file exports one function, `activate`, which is called the very first time your extension is activated (in this case by executing the command). Inside the `activate` function we call `registerCommand`.
  * We pass the function containing the implementation of the command as the second parameter to `registerCommand`.

## Get up and running straight away

* Press `F5` to open a new window with your extension loaded.
* Run your command from the command palette by pressing (`Ctrl+Shift+P` or `Cmd+Shift+P` on Mac) and typing `Hello World`.
* Set breakpoints in your code inside `extension.js` to debug your extension.
* Find output from your extension in the debug console.

## Make changes

* You can relaunch the extension from the debug toolbar after changing code in `extension.js`.
* You can also reload (`Ctrl+R` or `Cmd+R` on Mac) the VS Code window with your extension to load your changes.

## Explore the API

* You can open the full set of our API when you open the file `node_modules/@types/vscode/index.d.ts`.

## Run tests

* Install the [Extension Test Runner](https://marketplace.visualstudio.com/items?itemName=ms-vscode.extension-test-runner)
* Open the Testing view from the activity bar and click the Run Test" button, or use the hotkey `Ctrl/Cmd + ; A`
* See the output of the test result in the Test Results view.
* Make changes to `test/extension.test.js` or create new test files inside the `test` folder.
  * The provided test runner will only consider files matching the name pattern `**.test.js`.
  * You can create folders inside the `test` folder to structure your tests any way you want.

## Go further

 * [Follow UX guidelines](https://code.visualstudio.com/api/ux-guidelines/overview) to create extensions that seamlessly integrate with VS Code's native interface and patterns.
 * [Publish your extension](https://code.visualstudio.com/api/working-with-extensions/publishing-extension) on the VS Code extension marketplace.
 * Automate builds by setting up [Continuous Integration](https://code.visualstudio.com/api/working-with-extensions/continuous-integration).
</file>

<file path="modules/vscode/front/src/Index.vue">
<template>
  <div class="vscode-root" >
    <template v-if="view === 'default'">
      <h1>
        It seems you use Visual Studio Code
      </h1>
      <div>Do you want to install / update extension for it ?</div>
      <br>
      <button @click="udpate">
        <i class="fas fa-download"></i>
        Install / Udpate
      </button>
      or
      <button class="danger" @click="uninstall">
        <i class="fas fa-trash"></i>
        Uninstall
      </button>
    </template>
    <template v-else-if="view === 'reload'">
      <h1>Success !</h1>
      <div>Open the command palette (Ctrl + Shift + P) and execute the command >Reload Window</div>
      <br>
      <button @click="view = 'default'">
        <i class="fas fa-chevron-left"></i>
        Back
      </button>
    </template>
    <template v-else-if="view === 'error'">
      <h1>Sorry an error was occured</h1>
      <br>
      <div>{{ error }}</div>
      <br>
      <button @click="view = 'default'">
        <i class="fas fa-chevron-left"></i>
        Back
      </button>
    </template>
  </div>
</template>

<script setup>
import { ref } from 'vue';
import axios from '../../../../fronts/app/src/helpers/axios';

const view = ref('default');
const error = ref('');

async function udpate() {
  await axios.post('/vscode/install')
    .then(() => {
      view.value = 'reload';
    })
    .catch((err) => {
      error.value = err?.message || err;
      view.value = 'error';
    });
}
async function uninstall() {
  await axios.delete('/vscode/uninstall')
    .then(() => {
      view.value = 'reload';
    })
    .catch((err) => {
      error.value = err?.response?.data?.message || err?.message || err;
      view.value = 'error';
    });
}
</script>

<style lang="scss" scoped>

.vscode-root {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  flex-grow: 1;
}
</style>
</file>

<file path="modules/vscode/front/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/workflows/backend/nodes/manual-launcher/index.html">
<script type="text/javascript">
  RED.nodes.registerType('sm-manual-launcher', {
    category: 'Runeya',
    color: '#83e183',
    defaults: {
      name: { value: "" },
      launchType: { value: "services" },
      services: { value: "" }
    },
    async oneditprepare(){
      const services = await (await fetch('/stack/services')).json()
      const $type = $("#node-input-launch-type")
      const $groupType = $("#node-group-launch-type")
      const $services = $("#node-input-services")
      const $groupServices = $("#node-group-services")

      $type.typedInput({
        types: [
          {
            value: "services",
            disabled: true,
            options: [
              { value: 'services', label: 'Services'},
            ]
          }
        ]
      })
      $type.on('change', () => {
        $groupServices.hide()
        if($type[0].value === 'services') $groupServices.show()
      })

      $services.typedInput({
        types: [
          {
            value: "",
            multiple: 'true',
            options: [
              ...services.map(service => ({
                value: service.label,
                label: service.label
              }))
            ]
          }
        ]
      })
    },
    inputs: 0,
    outputs: 1,
    icon: "inject.svg",
    paletteLabel: "Manual launcher",
    label: function () {
      return this.name || `[SM]${this.launchType==='services' ? `[services]` :''} Manual launcher ${this.launchType === 'services' ? `[${this.services}]` : ''}`;
    }
  });
</script>

<script type="text/html" data-template-name="sm-manual-launcher">
  <h2>Manual Launcher</h2>
  <p>
    Provide a shortcut inside the application to launch this workflow.
    <br> For services, shortcuts are provided for use on the terminal view alongside others.
  </p>
  <div class="form-row" id="node-group-name">
    <label for="node-input-name"><i class="fa fa-filter"></i> Name</label>
    <input type="text" id="node-input-name" placeholder="Name">
  </div>
  <div class="form-row" id="node-group-launch-type">
    <label for="node-input-name"><i class="fa fa-filter"></i> Type</label>
    <input type="text" id="node-input-launch-type" placeholder="Type">
  </div>
  <div class="form-row" id="node-group-services">
    <label for="node-input-name"><i class="fa fa-filter"></i> Services</label>
    <input type="text" id="node-input-services" placeholder="Services">
  </div>
</script>

<script type="text/html" data-help-name="sm-manual-launcher">
    <p>Just a passthrough node to launch from runeya</p>
</script>
</file>

<file path="modules/workflows/backend/nodes/manual-launcher/index.js">
/** @param {import('node-red')} RED */
module.exports = function (RED) {
  const controller = function (config) {
    RED.nodes.createNode(this, config);
    const node = this;
    const { sockets, stack } = RED.settings.functionGlobalContext.runeya
    sockets.on(config.id, async (eventConfig, data) => {
      node.status({ fill: "green", shape: "dot", text: `${new Date().toISOString()} - ${eventConfig.launchType} - ${data}` });
      node.send({
        payload: {
          ...(eventConfig.launchType === 'services'
              ? {
                service: stack.getServices().find(s => s.label === data)
              }
              : {}
          ),
        }
      })
    })
  }

  RED.nodes.registerType("sm-manual-launcher", controller)
}
</file>

<file path="modules/workflows/backend/nodes/popup/index.html">
<script type="text/javascript">
  RED.nodes.registerType('sm-popup', {
    category: 'Runeya',
    color: '#eaeab6',
    defaults: {
      name: { value: "[SM] Popup" },
      header: { value: "" },
    },
    inputs: 1,
    outputs: 1,
    icon: "envelope.svg",
    paletteLabel: "Popup",
    label: function () {
      return this.name || "[SM] Popup";
    }
  });
</script>

<script type="text/html" data-template-name="sm-popup">
  <h2>Popup</h2>
  <p>
    Popup to display data of your flow in your runeya. Html should be placed on msg.payload.toDisplay
  </p>
  <div class="form-row">
    <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
    <input type="text" id="node-input-name" placeholder="Name...">
  </div>
  <div class="form-row">
    <label for="node-input-header"><i class="fa fa-tag"></i> Header</label>
    <input type="text" id="node-input-header" placeholder="Header...">
  </div>
</script>

<script type="text/html" data-help-name="sm-popup">
    <p>A simple node to display data in runeya</p>
</script>
</file>

<file path="modules/workflows/backend/nodes/run-command/index.html">
<script type="text/javascript">
  RED.nodes.registerType('sm-run-command', {
    category: 'Runeya',
    color: '#50c4f6',
    defaults: {
      name: { value: "[SM] Run command" },
      commandId: { value: "" },
    },
    async oneditprepare(){
      const services = await (await fetch('/stack/services')).json()
      const $command = $("#node-input-commandId")
      $command.typedInput({
        types: [
          {
            // value: "STACK_LOAD_FROM_INPUT",
            options: [
              {label: 'Choose...', value: '', disabled: true},
              // {label: 'Load from input node', value: 'STACK_LOAD_FROM_INPUT'},
              ...services.map(service => ([
                ...service.commands.map((command) => ({
                  value: command.id,
                  label: `[${service.label}] ${command.spawnCmd} ${command.spawnArgs.join(' ')}`
                })),
                ...service.shortcuts.map((command) => ({
                  value: command.id,
                  label: `[${service.label}] ${command.label || `${command.spawnCmd} ${command.spawnArgs.join(' ')}`}`
                }))
              ])).flat(10).filter(a => a)
            ]
          }
        ]
      })
    },
    inputs: 1,
    outputs: 1,
    icon: "bridge.svg",
    paletteLabel: "Run command",
    label: function () {
      return this.name || `[SM] Run command`;
    }
  });
</script>

<script type="text/html" data-template-name="sm-run-command">
    <h2>Run command</h2>
    <p>
      This node run a predefined command.
    </p>
    <p class="form-tips" style="max-width: 100%;">
      <!-- In case you choose "Load from input node", service will be loaded from the msg.payload.commandId or the msg.commandId as  -->
    </p>
  <div class="form-row" id="node-group-name">
    <label for="node-input-name"><i class="fa fa-filter"></i> Name</label>
    <input type="text" id="node-input-name" placeholder="Name">
  </div>
  <div class="form-row" id="node-group-commands">
    <label for="node-input-commandId"><i class="fa fa-filter"></i> Command</label>
    <input type="text" id="node-input-commandId" placeholder="Command...">
  </div>
</script>

<script type="text/html" data-help-name="sm-run-command">
    <p>Run a predefined command from runeya</p>
</script>
</file>

<file path="modules/workflows/backend/nodes/service-action/index.html">
<script type="text/javascript">
  RED.nodes.registerType('sm-service-action', {
    category: 'Runeya',
    color: '#50c4f6',
    defaults: {
      name: { value: "[SM] Service action" },
      service: { value: "" },
      action: { value: "" }
    },
    async oneditprepare(){
      const services = await (await fetch('/stack/services')).json()
      const $service = $("#node-input-service")
      $service.typedInput({
        type: 'STACK_LOAD_FROM_INPUT',
        default: 'STACK_LOAD_FROM_INPUT',
        types: [
          {
            value: "STACK_LOAD_FROM_INPUT",
            options: [
              {label: 'Load from input node', value: 'STACK_LOAD_FROM_INPUT'},
              ...services.map(service => ({
                value: service.label,
                label: service.label
              }))
            ]
          }
        ]
      })
      const $action = $("#node-input-action")
      $action.typedInput({
        types: [
          {
            value: "start",
            options: [
              {value: 'start', label: 'Start' },
              { value: 'stop', label: 'Stop'},
            ]
          }
        ]
      })
    },
    inputs: 1,
    outputs: 1,
    icon: "bridge.svg",
    paletteLabel: "Service action",
    label: function () {
      return this.name || `[SM] Service action`;
    }
  });
</script>

<script type="text/html" data-template-name="sm-service-action">
    <h2>Service action</h2>
    <p>
      This node make an action on your selected service.
    </p>
    <p class="form-tips" style="max-width: 100%;">
      In case you choose "Load from input node", service will be loaded from the msg.payload.service.label or the msg.service.label
    </p>
  <div class="form-row" id="node-group-name">
    <label for="node-input-name"><i class="fa fa-filter"></i> Name</label>
    <input type="text" id="node-input-name" placeholder="Name">
  </div>
  <div class="form-row" id="node-group-services">
    <label for="node-input-name"><i class="fa fa-filter"></i> Service</label>
    <input type="text" id="node-input-service" placeholder="Service">
  </div>
  <div class="form-row" id="node-group-action">
    <label for="node-input-name"><i class="fa fa-filter"></i> Action</label>
    <input type="text" id="node-input-action" placeholder="Action" value="STACK_LOAD_FROM_INPUT">
  </div>
</script>

<script type="text/html" data-help-name="sm-service-action">
    <p>Make an action to a service</p>
</script>
</file>

<file path="modules/workflows/backend/nodes/service-action/index.js">
/** @param {import('node-red')} RED */
module.exports = function (RED) {
  const controller = function (config) {
    RED.nodes.createNode(this, config);
    const node = this;
    if (!config.action) config.action = 'start'
    if (!config.service) config.service = 'STACK_LOAD_FROM_INPUT'
    const { sockets, stack } = RED.settings.functionGlobalContext.runeya
    node.on('input', async function (msg) {
      const service = stack.getServices().find(s => {
        if (config.service === 'STACK_LOAD_FROM_INPUT') return s.label === (msg?.payload?.service?.label || msg?.service?.label)
        return s.label === config.service
      })
      if(!service) {
        node.status({ fill: "red", shape: "ring", text: "No service found" });
        return
      }
      if (config.action === 'start') {
        node.status({ fill: "green", shape: "dot", text: 'Restart ' + service.label + '...' });
        await service.restart()
        node.status({ fill: "green", shape: "dot", text: service.label + ' restarted' });
        return node.send(msg)
      } else if (config.action === 'stop') {
        node.status({ fill: "green", shape: "dot", text: 'Stop ' + service.label + '...' });
        await service.kill()
        node.status({ fill: "green", shape: "dot", text: service.label + ' Stopped' });
        return node.send(msg)
      } else {
        return node.status({ fill: "red", shape: "ring", text: `Action ${config.action} not available` });
      }

    })
  }

  RED.nodes.registerType("sm-service-action", controller)
}
</file>

<file path="modules/workflows/backend/nodes/service-selector/index.html">
<script type="text/javascript">
  RED.nodes.registerType('sm-service-selector', {
    category: 'Runeya',
    color: '#eaeab6',
    defaults: {
      name: { value: "[SM] Service selector" },
      serviceEnabled: { value: false },
    },
    inputs: 1,
    outputs: 1,
    icon: "envelope.svg",
    paletteLabel: "Service selector",
    label: function () {
      return this.name || "[SM] Service selector";
    }
  });
</script>

<script type="text/html" data-template-name="sm-service-selector">
    <h2>Services Selector</h2>
    <p>
      This node opens a modal to select a service from Runeya and loads it into msg.payload.service
    </p>
    <div class="form-row">
      <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
      <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
      <label for="node-input-serviceEnabled"><i class="fa fa-filter"></i> Only enabled services</label>
      <input type="checkbox" id="node-input-serviceEnabled" placeholder="Only enabled services">
    </div>
</script>

<script type="text/html" data-help-name="sm-service-selector">
    <p>A simple node to choose your service</p>
</script>
</file>

<file path="modules/workflows/backend/nodes/service-selector/index.js">
const { askUiFor } = require('../helpers/socket');

/** @param {import('node-red')} RED */
module.exports = function (RED) {
  const serviceSelector = function (config) {
    RED.nodes.createNode(this, config);
    var node = this;
    node.on('input', async function (msg) {
      const { stack } = RED.settings.functionGlobalContext.runeya

      if (!msg.payload) msg.payload = {}
      const service = await askUiFor('selector', {
        ui: {
          header: 'Service Selector',
          optionLabel: "label",
          optionValue: "",
        },
        data: config.serviceEnabled ? stack.getEnabledServices() : stack.getServices()
      }, RED);
      if(!service) {
        node.status({ fill: "red", shape: "ring", text: "No service selected by user" });
        return 
      }
      node.status({ fill: "green", shape: "dot", text: service.label });
      const isObject = obj => obj === Object(obj) && !Array.isArray(obj);
      if(isObject(msg.payload)) msg.payload.service = service
      else msg.payload = {service}
      node.send(msg);
    });
  }
  RED.nodes.registerType("sm-service-selector", serviceSelector);
}
</file>

<file path="modules/workflows/backend/nodes/services-events-launcher/index.html">
<script type="text/javascript">
  RED.nodes.registerType('sm-services-events-launcher', {
    category: 'Runeya',
    color: '#83e183',
    defaults: {
      name: { value: "[SM] Service events" },
      events: { value: "" },
      services: { value: "" }
    },
    async oneditprepare(){
      const services = await (await fetch('/stack/services')).json()
      $("#node-input-services").typedInput({
        types: [
          {
            value: "",
            multiple: "true",
            options: services.map(service => ({
              value: service.label,
              label: service.label
            }))
          }
        ]
      })
      const events =  [
        ['service:start', 'Start'],
        ['service:crash', 'Crash'],
        ['service:exit', 'Exit'],
        ['service:healthcheck:down', 'Health check down'],
        ['service:healthcheck:up', 'Health check up'],
      ]
      $("#node-input-events").typedInput({
        types: [
          {
            value: "",
            multiple: "true",
            options: events.map(([value, label]) => ({value,label}))
          }
        ]
      })
    },
    inputs: 0,
    outputs: 1,
    icon: "feed.svg",
    paletteLabel: "Service events",
    label: function () {
      return this.name || "[SM] Service events";
    }
  });
</script>

<script type="text/html" data-template-name="sm-services-events-launcher">
  <h2>Services Events</h2>
  <p>
    This service injects a msg.payload.service when selected events are triggered by the chosen services.
  </p>
  <p class="form-tips" style="max-width: 100%;">
    If no services or events are selected, the injection applies to all by default.
  </p>
  <div class="form-row">
    <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
    <input type="text" id="node-input-name" placeholder="Name">
  </div>
  <div class="form-row">
    <label for="node-input-name"><i class="fa fa-tag"></i> Events</label>
    <input type="text" id="node-input-events" placeholder="Events">
  </div>
  <div class="form-row">
    <label for="node-input-name"><i class="fa fa-filter"></i> Services</label>
    <input type="text" id="node-input-services" placeholder="Services">
  </div>
</script>

<script type="text/html" data-help-name="sm-services-events-launcher">
    <p>Just a passthrough node to launch from runeya</p>
</script>
</file>

<file path="modules/workflows/backend/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/workflows/backend/index.js">
const Workflows = require('./Workflows');

/** @type {import('@runeya/modules-plugins-loader-front/src/views').PluginSM<Workflows>} */
const plugin = {
  enabled: true,
  name: 'Workflows',
  displayName: 'Workflows',
  description: 'Make workflows based on events or manual triggers',
  icon: 'fas fa-sitemap',
  export: Workflows,
  order: 10,
  placements: [
    {
      position: 'sidebar-top',
      label: 'Workflows',
      icon: 'fas fa-sitemap',
      goTo: { path: '/Workflows' },
      active: 'Workflows',
    },
  ],
  finder: (search, runeya) => {
    return []
  },
  routes: require('./routes'),
};
module.exports = plugin;
</file>

<file path="modules/workflows/backend/Workflows.js">
/** @param {import('@runeya/common-typings').Runeya} runeya */
const NodeRed = (runeya) => {
  
}

module.exports = NodeRed
</file>

<file path="modules/workflows/front/src/helpers/socket.js">
import { onBeforeUnmount } from 'vue';
import Socket from '../../../../../fronts/app/src/helpers/Socket'

export const reactTo = (label, cb) => {
  Socket.on('node-red-' + label, async ({ respondTo, data }) => {
    const result = await cb(data)
    Socket.socket.emit(respondTo, result);
  });
  onBeforeUnmount(() => { Socket.off('node-red-' + label, cb) })
}
</file>

<file path="modules/workflows/front/src/modals/Modals.vue">
<template>
  <SelectorNodeRed />
  <PopupNodeRed/>
</template>

<script setup>
import SelectorNodeRed from './Selector.vue';
import PopupNodeRed from './Popup.vue';
</script>

<style scoped lang="scss">
</style>
</file>

<file path="modules/workflows/front/src/modals/Popup.vue">
<template>
  <Modal-Cmp ref="overrideModalRef" :noCancel="true" validateString="Ok">
    <template #header>
      {{ ui.header }}
    </template>
    <template #body>
      <div v-html="ui.html"></div>
    </template>
  </Modal-Cmp>
</template>

<script setup>
import { ref } from 'vue';
import ModalCmp from '../../../../../fronts/app/src/components/Modal.vue';
import {reactTo} from '../helpers/socket';

const overrideModalRef = ref()
const selected = ref()
const ui = ref({
  header: '',
  html: '',
})
reactTo('displayPopup', async ({ui: _ui}) => {
  ui.value = _ui
  const res = await overrideModalRef.value.open().promise
  if(!res) return
  return selected.value
})
</script>

<style lang="scss" scoped>

</style>
</file>

<file path="modules/workflows/front/src/modals/Selector.vue">
<template>
  <Modal-Cmp ref="overrideModalRef" cancelString="Cancel" validateString="Ok">
    <template #header>
      {{ ui.header }}
    </template>
    <template #body>
      <Select
        v-model="selected"
        :options="data"
        :option-label="ui.optionLabel"
        :option-value="ui.optionValue"
      />
    </template>
  </Modal-Cmp>
</template>

<script setup>
import { ref } from 'vue';
import ModalCmp from '../../../../../fronts/app/src/components/Modal.vue';
import Select from 'primevue/select';
import {reactTo} from '../helpers/socket';

const overrideModalRef = ref()
const selected = ref()
const ui = ref({
  header: '',
  optionValue: '',
  optionLabel: '',
})
const data = ref([])

reactTo('selector', async ({data: _data, ui: _ui}) => {
  data.value = _data
  ui.value = _ui
  const res = await overrideModalRef.value.open().promise
  if(!res) return
  return selected.value
})
</script>

<style lang="scss" scoped>

</style>
</file>

<file path="modules/workflows/front/src/Index.vue">
<template>
  <iframe ref="iframe" src="/red" width="100%" />
</template>

<script setup>
import { onMounted, onUnmounted, ref } from 'vue';
import Socket from '../../../../fronts/app/src/helpers/Socket';

const iframe = ref()
const onStart = () => {
  iframe.value.contentWindow.location.reload();
}

Socket.on('scenarios:start', onStart)
onUnmounted(() => {
  Socket.off('scenarios:start', onStart)
})
</script>
</file>

<file path="modules/workflows/front/.npmrc">
@runeya:registry=https://npm.pkg.github.com
</file>

<file path="modules/workflows/front/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

# [2.1.0](https://github.com/runeya/runeya/compare/v2.0.17...v2.1.0) (2025-01-31)

### Features

* **nodered:** add nodered into app ([f897eb2](https://github.com/runeya/runeya/commit/f897eb2c4a9128e0d4615f6765d3ef0ce1d2ca3e))
</file>

<file path="servers/server/helpers/cpu.js">
const os = require('os');
const { fork } = require('node:child_process');
const path = require('path');
const { sockets } = require('@runeya/common-socket-server');

const nbCpus = os.cpus().length;

/** @type {AbortController | null} */
let controller = null;
/** @type { import('child_process').ChildProcess | null } */
let child = null;
controller = new AbortController();
const { signal } = controller;
child = fork(path.resolve(__dirname, './cpuFork.js'), [], { signal });
child.on('message', (message) => {
  const { ram, cpu } = JSON.parse(message.toString());
  sockets.emit('infos:global', {
    nbCpus,
    memPercentage: ram.memPercentage,
    totalmem: ram.totalmem,
    freemem: ram.freemem,
    cpu,
  });
});

module.exports = {
  stopCpu: async () => {
    child?.kill('SIGKILL');
  },
};
</file>

<file path="servers/server/helpers/readline.js">
const { EventEmitter } = require('events');

module.exports = class extends EventEmitter {
  /**
   *
   * @param {{input?: import('stream').Readable, emitAfterNoDataMs?: number}} options
   */
  constructor(options = {}) {
    super();
    this.options = options;
    if (options.input) this.linkToInput(options.input);
    /** @type {string[]} */
    this.all = [];
    /** @type {NodeJS.Timeout|undefined} */
    this.timeout = undefined;
  }

  /**
   *
   * @param {import('stream').Readable} readStream
   */
  linkToInput(readStream) {
    readStream.on('data', (data) => {
      clearTimeout(this.timeout);
      data = data.toString('utf-8');
      const dataLen = data.length;
      for (let i = 0; i < dataLen; i += 1) {
        const char = data[i];
        if (char === '\n' || char === '\r\n') {
          this.#emit();
        } else {
          this.all.push(char);
        }
      }
      if (this.options.emitAfterNoDataMs) {
        this.timeout = setTimeout(() => {
          this.#emit();
        }, this.options.emitAfterNoDataMs);
      }
    });
  }

  #emit() {
    if (!this.all.length) return;
    const line = this.all.splice(0, this.all.length).join('');
    this.emit('line', line);
  }
};
</file>

<file path="servers/server/helpers/reencrypt-nodered.js">
const crypto = require('crypto');
const { readFile, writeFile } = require('fs/promises');

var encryptionAlgorithm = "aes-256-ctr";

module.exports = async function decryptCreds(oldSecret, newScret, path) {
  const oldKey = crypto.createHash('sha256').update(oldSecret).digest();
  const newKey = crypto.createHash('sha256').update(newScret).digest();
  const cipher = JSON.parse(await readFile(path, 'utf-8'))
  let flows = cipher["$"];
  const vector = Buffer.from(flows.substring(0, 32), 'hex');
  flows = flows.substring(32);
  const decipher = crypto.createDecipheriv(encryptionAlgorithm, oldKey, vector);
  const decrypted = decipher.update(flows, 'base64', 'utf8') + decipher.final('utf8');
  const newVector = crypto.randomBytes(16);
  const newCipher = crypto.createCipheriv(encryptionAlgorithm, newKey, newVector);
  const encrypted = newCipher.update(decrypted, 'utf8', 'base64') + newCipher.final('base64');
  await writeFile(path, JSON.stringify({
    "$": newVector.toString('hex') + encrypted
  }, null, 2), 'utf-8')
}
</file>

<file path="servers/server/helpers/specialCaracters.helper.js">
module.exports = {};
module.exports.specialCaracters = [
  ['à', '&agrave;', 'agrave'],
  ['À', '&Agrave;', 'agrave'],
  ['á', '&aacute;', 'aacute'],
  ['Á', '&Aacute;', 'aacute'],
  ['â', '&acirc;', 'acirc'],
  ['Â', '&Acirc;', 'acirc'],
  ['ã', '&atilde;', 'atilde'],
  ['Ã', '&Atilde;', 'atilde'],
  ['ä', '&auml;', 'auml'],
  ['Ä', '&Auml;', 'auml'],
  ['å', '&aring;', 'aring'],
  ['Å', '&Aring;', 'aring'],
  ['æ', '&aelig;', 'aelig'],
  ['Æ', '&AElig;', 'aelig'],
  ['è', '&egrave;', 'egrave'],
  ['È', '&Egrave;', 'egrave'],
  ['é', '&eacute;', 'eacute'],
  ['É', '&Eacute;', 'eacute'],
  ['ê', '&ecirc;', 'ecirc'],
  ['Ê', '&Ecirc;', 'ecirc'],
  ['ë', '&euml;', 'euml'],
  ['Ë', '&Euml;', 'euml'],
  ['ì', '&igrave;', 'igrave'],
  ['Ì', '&Igrave;', 'igrave'],
  ['í', '&iacute;', 'iacute'],
  ['Í', '&Iacute;', 'iacute'],
  ['î', '&icirc;', 'icirc'],
  ['Î', '&Icirc;', 'icirc'],
  ['ï', '&iuml;', 'iuml'],
  ['Ï', '&Iuml;', 'iuml'],
  ['ò', '&ograve;', 'ograve'],
  ['Ò', '&Ograve;', 'ograve'],
  ['ó', '&oacute;', 'oacute'],
  ['Ó', '&Oacute;', 'oacute'],
  ['ô', '&ocirc;', 'ocirc'],
  ['Ô', '&Ocirc;', 'ocirc'],
  ['õ', '&otilde;', 'otilde'],
  ['Õ', '&Otilde;', 'otilde'],
  ['ö', '&ouml;', 'ouml'],
  ['Ö', '&Ouml;', 'ouml'],
  ['ø', '&oslash;', 'oslash'],
  ['Ø', '&Oslash;', 'oslash'],
  ['ù', '&ugrave;', 'ugrave'],
  ['Ù', '&Ugrave;', 'ugrave'],
  ['ú', '&uacute;', 'uacute'],
  ['Ú', '&Uacute;', 'uacute'],
  ['û', '&ucirc;', 'ucirc'],
  ['Û', '&Ucirc;', 'ucirc'],
  ['ü', '&uuml;', 'uuml'],
  ['Ü', '&Uuml;', 'uuml'],
  ['ñ', '&ntilde;', 'ntilde'],
  ['Ñ', '&Ntilde;', 'ntilde'],
  ['ç', '&ccedil;', 'ccedil'],
  ['Ç', '&Ccedil;', 'ccedil'],
  ['ý', '&yacute;', 'yacute'],
  ['Ý', '&Yacute;', 'yacute'],
  ['ß', '&szlig;', 'szlig'],
  ['«', '&laquo;'],
  ['»', '&raquo;'],
  ['&', '&amp;'],
  ['<', '&lt;'],
  ['>', '&gt;'],
  ['"', '&quot;'],
  ['§', '&para;'],
  ['©', '&copy;'],
];
</file>

<file path="servers/server/helpers/version.js">
const { existsSync, readFileSync } = require('fs');
const path = require('path');

const file = {
  version: '0.0.0',
};
if (existsSync(path.resolve(__dirname, './package.json'))) {
  file.version = JSON.parse(readFileSync(path.resolve(__dirname, './package.json'), { encoding: 'utf-8' })).version;
} else if (existsSync(path.resolve(__dirname, '../package.json'))) {
  file.version = JSON.parse(readFileSync(path.resolve(__dirname, '../package.json'), { encoding: 'utf-8' })).version;
} else if (existsSync(path.resolve(__dirname, '../../../lerna.json'))) {
  file.version = JSON.parse(readFileSync(path.resolve(__dirname, '../../../lerna.json'), { encoding: 'utf-8' })).version;
}

module.exports = {
  version: file.version,
};
</file>

<file path="servers/server/models/.gitignore">
temp-docker
</file>

<file path="servers/server/models/editors.js">
const commandExists = require("command-exists").sync

const codeArgsBuilder = ({ link, command, cwd, line, column }) => (
  `${command} ${link ? `--goto ${link}${line ? `:${line}${column ? `:${column}` : ''}` : ''}` : ''} ${cwd}`
)
const intellijArgsBuilder = ({ link, command, cwd, line, column }) => {
  return `${command} ${cwd}  ${column ? `--column ${column}` : ''} ${line ? `--line ${line}` : ''}  ${link}`
}
const editors = {
  code: {
    commands: ['code', 'code-insiders'],
    args: codeArgsBuilder
  },
  cursor: {
    commands: ['cursor'],
    args: codeArgsBuilder
  },
  intellij: {
    commands: ['idea'],
    args: intellijArgsBuilder
  },
  androidstudio: {
    commands: ['android-studio'],
    args: intellijArgsBuilder
  },
  sublime: {
    commands: ['subl'],
    args: ({ link, command, cwd, line, column }) => (
      link 
        ? `${command} ${link ? `${link}${line ? `:${line}${column ? `:${column}`: ''}`: ''}` : ''}`
        : `${command} ${cwd}`
    )
  }
}

module.exports.allEditors =  Object.keys(editors)
module.exports.availableEditors = module.exports.allEditors
  .filter(key => editors[key].commands.find((command) => commandExists(command)))

module.exports.getCommandLine = (editorLabel, {cwd = '.', link = '', line = 0, column = 0} = {}) => {
  const editor = editors[editorLabel]
  if (!editor) return null
  const command = editor.commands.find((command) => commandExists(command))
  if (command) {
    return editor.args({cwd, command, line, column, link})
  }
  return
}
</file>

<file path="servers/server/models/myConfs.js">
const pathfs = require('path');
const os = require('os');
const {
  existsSync, mkdirSync, writeFileSync, readFileSync,
} = require('fs');

const persistencePath = pathfs.resolve(os.homedir(), '.runeya');

if (!existsSync(persistencePath)) mkdirSync(persistencePath, { recursive: true });
const confsPath = pathfs.resolve(persistencePath, 'confs');
if (!existsSync(confsPath)) writeFileSync(confsPath, JSON.stringify([]), 'utf-8');
const store = JSON.parse(readFileSync(confsPath, 'utf-8'));

module.exports = {
  /** @type {string[]} */
  confs: store,
  /** @param {string} conf */
  async add(conf) {
    if (!store.includes(conf)) {
      store.push(conf);
      await writeFileSync(confsPath, JSON.stringify(store), 'utf-8');
    }
  },
  /** @param {string} conf */
  async remove(conf) {
    store.splice(store.indexOf(conf), 1);
    await writeFileSync(confsPath, JSON.stringify(store), 'utf-8');
  },
};
</file>

<file path="servers/server/models/ports.js">
module.exports = {
  http: process.env.RUNEYA_HTTP_PORT || 0,
  /** @param {number} port */
  setHttpPort(port) {
    if (!this.http) this.http = port;
  },
};
</file>

<file path="servers/server/models/saves.js">
const pathfs = require('path');
const homedir = require('os').homedir();
const {
  existsSync, mkdirSync, writeFileSync, readFileSync,
} = require('fs');

const confDir = pathfs.resolve(homedir, '.runeya');

/**
 * @param {string} file
 * @param {T} initialData
 * @param {{
 *  beforeSave?: (data: T) => void
 *  afterGet?: (data: T) => void
 * }} options
 * @template T
 */
function getSave(file, initialData, options = {}) {
  if (!existsSync(confDir)) mkdirSync(confDir);
  const dataConfPath = pathfs.resolve(confDir, file);
  if (!existsSync(dataConfPath)) writeFileSync(dataConfPath, JSON.stringify(initialData), 'utf-8');
  const data = JSON.parse(readFileSync(dataConfPath, 'utf-8'));
  options?.afterGet?.(data);
  return {
    /** @type {T} */
    data,
    save() {
      options?.beforeSave?.(data);
      writeFileSync(dataConfPath, JSON.stringify(data), 'utf-8');
    },
  };
}

module.exports = getSave;
</file>

<file path="servers/server/models/Service.spec.js">
const Service = require('./Service');
const EncryptionKey = require('./EncryptionKey');
const args = require('../helpers/args');
const path = require('path');
const { rmSync } = require('fs');
const Environment = require('./Environment');


beforeAll(async () => {
  args.rootPath = path.resolve(__dirname)
  rmSync(path.resolve(args.rootPath, '.runeya'), { force: true, recursive: true })
  const key = await EncryptionKey.generateKey()
  await EncryptionKey.saveKey(key, {noReload: true})
})
afterAll(async() => {
  rmSync(path.resolve(args.rootPath, '.runeya'), { force: true, recursive: true })
})
function getService(spawnOptions) {
  return {
    commands: [
      { id: '1234', spawnCmd: 'echo', spawnArgs: ['hello'], spawnOptions }
    ]
  }
}
describe('Service', () => {
  it('check envs', async () => {
    await new Environment({
      label: 'local',
      envs: {
        sameValue: 'sameValueForLocal',
        localValue: 'localValue',
        localValueOverride: 'localValueOverride',
        localValueOverride_RUNEYA_OVERRIDE: 'localValueOverride_RUNEYA_OVERRIDE',
      },
    }).save()
    await new Environment({
      label: 'dev',
      extends: ['local'],
      envs: {
        sameValue: 'sameValueForDev',
        devValue: 'devValue',
      },
    }).save()
    const spawnOptions = {
      envs: {
        local: {
          envs: [
            { key: 'rawValue', value: 'rawValue' },
            { key: 'sameValue', value: '{{sameValue}}' },
            { key: 'rawOverride', value: 'rawValue', override: 'rawOverride' },
            { key: 'localValue', value: '{{localValue}}' },
            { key: 'localValueOverride', value: '{{localValueOverride}}', override: '{{localValueOverride_RUNEYA_OVERRIDE}}', },
            { key: 'localValueOverrideWithPrefixSuffix', value: '{{localValueOverride}}', override: '{{localValueOverride_RUNEYA_OVERRIDE}}', prefix: 'prefix/', suffix: '/suffix' },
            { key: 'localValueWithPrefixSuffix', value: '{{localValue}}', prefix: 'prefix/', suffix:'/suffix' },
            { key: 'devValue', value: '{{devValue}}' },
          ], extends: []
        },
        dev: {
          envs: [
            { key: 'rawValue', value: 'rawValueForDev' },
            { key: 'devValue', value: '{{devValue}}' },
            { key: 'sameValue', value: '{{sameValue}}' },
          ], extends: []
        }
      }
    }
    const service = await new Service(getService(spawnOptions), {})
    const resForLocal = await service.buildEnvs('local', spawnOptions)
    const resForDev = await service.buildEnvs('dev', spawnOptions)
    expect(resForLocal.rawValue).toEqual('rawValue')
    expect(resForLocal.rawOverride).toEqual('rawOverride')
    expect(resForLocal.localValue).toEqual('localValue')
    expect(resForLocal.localValueOverride).toEqual('localValueOverride_RUNEYA_OVERRIDE')
    expect(resForLocal.devValue).toEqual(undefined)
    expect(resForLocal.localValueWithPrefixSuffix).toEqual('prefix/localValue/suffix')
    expect(resForLocal.localValueOverrideWithPrefixSuffix).toEqual('prefix/localValueOverride_RUNEYA_OVERRIDE/suffix')
    expect(resForLocal.sameValue).toEqual('sameValueForLocal')

    expect(resForDev.rawValue).toEqual('rawValueForDev')
    expect(resForDev.devValue).toEqual('devValue')
    expect(resForDev.localValue).toEqual('localValue') // Not exists in dev but herits from local
    expect(resForDev.localValueWithPrefixSuffix).toEqual('prefix/localValue/suffix') // Not exists in dev but herits from local
    expect(resForDev.localValueOverrideWithPrefixSuffix).toEqual('prefix/localValueOverride_RUNEYA_OVERRIDE/suffix') // Not exists in dev but herits from local
    expect(resForDev.sameValue).toEqual('sameValueForDev')
    service.stopQueue = true
  })

});
</file>

<file path="servers/server/parser/debug.js">
const jsonParser = require('./json');
/** @type {import("../models/Service").Parser} */
const parser = {
  id: 'runeya-parser-debug',
  label: 'Runeya debug',
  readonly: true,
  transform: (line, ...rest) => {
    if (!line.json) line = jsonParser.transform(line, ...rest);
    if (!line.json) return line;
    if (/** @type {Array<any>} */(line?.json)?.[0] === 'runeya') {
      line.debug = line.json.length === 2 ? /** @type {Array<any>} */(line?.json)?.[1] : line.json.slice(1);
    }
    return line;
  },
};
module.exports = parser;
</file>

<file path="servers/server/parser/json.js">
/** @type {import("../models/Service").Parser} */
const parser = {
  id: 'runeya-parser-jsons',
  label: 'Parse jsons',
  readonly: true,
  transform: (line) => {
    if (!line.raw) return line;
    const firstChar = line.raw.trim().charAt(0);
    if (firstChar === '[' || firstChar === '{') {
      try { line.json = JSON.parse(line.raw); } catch (error) { }
    }
    return line;
  },
};
module.exports = parser;
</file>

<file path="servers/server/parser/link.js">
const urlRegex = /(http|ftp|https):\/\/([\w_-]+(?:(?:\.[\w_-]+)+))([\w.,@?^=%&:/~+#-]*[\w@?^=%&/~+#-])/gi;

/** @type {import("../models/Service").Parser} */
const parser = {
  id: 'runeya-parser-links',
  label: 'Parse links',
  readonly: true,
  transform: (line) => {
    line.msg = line.msg.replaceAll(urlRegex, (url) => `<a href="${url}" target="_blank">${url}</a>`);
    return line;
  },
};

module.exports = parser;
</file>

<file path="servers/server/routes/editors.js">
const { express } = require('@runeya/common-express');
const { availableEditors, getCommandLine } = require('../models/editors');
const { replaceEnvs } = require('../helpers/stringTransformer.helper');
const Stack = require('../models/stack');
const { exec } = require('child_process');
const { findService } = Stack;

const router = express.Router();

router.get('/available-editors', (req, res) => {
  res.send(availableEditors);
});

router.get('/:service/open-in-vs-code', (req, res) => {
  const service = findService(req.params.service);
  const commandLine = getCommandLine(req.query.editor)
  if(!commandLine) return res.status(400).send('Editor not found')
  exec(commandLine, { cwd: replaceEnvs(service.rootPath) || replaceEnvs(req.query.path?.toString() || '.'), env: process.env });
  res.send('ok');
});

router.get('/:service/open-link-in-vs-code', (req, res) => {
  const service = findService(req.params.service);
  const commandLine = getCommandLine(req.query.editor, { link: req.query.link?.toString() || '' })
  if (!commandLine) return res.status(400).send('Editor not found')
  const cwd = replaceEnvs(service.rootPath) || replaceEnvs(req.query.path?.toString() || '.')
  exec(commandLine, { cwd, env: process.env });
  res.send({ commandLine, cwd});
});

module.exports = router
</file>

<file path="servers/server/routes/fs.js">
const { express } = require('@runeya/common-express');

const router = express.Router();
const pathfs = require('path');
const PromiseB = require('bluebird');
const os = require('os');
const { sort } = require('fast-sort');
const { readdir, readFile, stat } = require('fs/promises');

router.get('/home-dir', async (req, res) => {
  res.send(os.homedir());
});
router.get('/ls', async (req, res) => {
  const path = req.query.path?.toString() || __dirname;
  const dir = await readdir(path);
  const parentDirectory = {
    absolutePath: pathfs.resolve(path, '..'),
    name: '..',
    isDirectory: true,
  };
  let dirs = [parentDirectory];
  await PromiseB.map(dir, async (entry) => {
    try {
      if (entry.charAt(0) === '.') return null;
      const absolutePath = pathfs.resolve(path, entry);
      const entryStat = await stat(absolutePath);
      /** @type {Entry} */
      const entryInfos = {
        absolutePath,
        name: entry,
        isDirectory: entryStat.isDirectory(),
        npmInfos: null,
        isStack: false,
      };
      if (entryInfos.isDirectory) {
        entryInfos.npmInfos = await getNpmInfos(entryInfos.absolutePath);
      } else if (pathfs.extname(absolutePath) === '.js') {
        try {
          const stack = require(absolutePath);
          if (Array.isArray(stack) && stack.length && stack[0].label && stack[0].spawnCmd) {
            entryInfos.isStack = true;
          }
          // eslint-disable-next-line no-empty
        } catch (error) {
          console.error(error);
        }
      }
      dirs.push(entryInfos);
      return null;
    } catch (error) {
      console.error(error);
      return null;
    }
  });
  // @ts-ignore
  dirs = sort(dirs).asc((d) => d.name.toUpperCase());
  res.json(dirs);
});

/**
 *
 * @param {string} path
 */
async function getNpmInfos(path) {
  const dir = await readdir(path);
  if (dir.includes('package.json')) {
    const packageJSON = JSON.parse(await readFile(pathfs.resolve(path, 'package.json'), 'utf-8'));
    /** @type {NpmInfos} */
    return {
      path,
      packageJSON,
      version: packageJSON.version,
      name: packageJSON.name,
      author: packageJSON.author,
    };
  }
  return null;
}
module.exports = router;

/**
 * @typedef {{
 * absolutePath: string
 * name: string
 * isDirectory: boolean
 * npmInfos?: NpmInfos | null
 * isStack: boolean
 * }} Entry
 */

/**
 * @typedef {{
 * path: string,
 * packageJSON: Record<string, any>,
 * version: string,
 * name: string,
 * author: string
 * }} NpmInfos
 */
</file>

<file path="servers/server/routes/parsers.js">
const { express } = require('@runeya/common-express');
const Parser = require('../models/Parser');

const router = express.Router();

router.post('/', async (req, res) => {
  delete req.body.id;
  const parser = new Parser(req.body);
  await parser.save();
  res.json(parser.toStorage());
});
router.put('/:id', async (req, res) => {
  const parser = await Parser.find(req.params.id);
  if (!parser) return res.status(404).send('Parser not found');
  await parser.update(req.body);
  res.json(parser.toStorage());
});
router.delete('/:id', async (req, res) => {
  const parser = await Parser.find(req.params.id);
  if (!parser) return res.status(404).send('Parser not found');
  await parser?.delete();
  res.json('ok');
});

router.get('/', async (req, res) => {
  const parsers = await Parser.all();
  res.json(parsers);
});

module.exports = router;
</file>

<file path="servers/server/jest.config.js">
module.exports = {
  "transformIgnorePatterns": [
  ],
  "transform": {
      "\\.[jt]sx?$": "babel-jest",
  }
}
</file>

<file path="knip.js">
/** @type {import('knip').KnipConfig} */
module.exports = {
  workspaces: {
    '.': {
      entry: ['./runScriptWithEnv.js', './watch.js', './stack.js'],
    },
    'fronts/app': {
      vue: true,
      ignore: ['node_modules/**/*'],
      ignoreDependencies: [
        '@fortawesome/fontawesome-free',
      ],
      entry: ['src/**/*.ts!', 'src/**/*.vue!', 'src/**/*.js!', 'babel.config.js'],
      project: ['**/*.ts!', '**/*.vue!', '**/*.js!'],
    },
    'modules/bugs/backend': {
      entry: ['checkJsFork.js'],
      project: ['**/*.ts!', '**/*.js!'],
    },
    'servers/server': {
      ignore: ['node_modules', 'bin/www'],
      entry: ['src/{index,cli,server}.js!', 'src/{index,cli,server}.ts!', '**/*.spec.(js|ts)', '**/*.test.(js|ts)', 'tsup.config.ts', '**/*/bin/www', 'helpers/cpuFork.js', 'tests/**/*.js'],
      project: ['**/*.ts!', '**/*.js!', '**/*/bin/www'],
    },
    'common/*': {
      entry: ['src/{index,cli,server}.js!', 'src/{index,cli,server}.ts!', '**/*.spec.(js|ts)', '**/*.test.(js|ts)', 'tsup.config.ts', 'src/walkerFork.js'],
      project: ['**/*.ts!', '**/*.js!'],
    },
    'modules/*/front': {
      vue: true,
      ignore: ['node_modules/**/*'],
      entry: ['src/**/*.vue'],
      project: ['**/*.ts!', '**/*.vue!', '**/*.js!'],
    },
  },
  ignoreDependencies: [
    '@runeya/common-retrigger-all-build',
    '@types/*',
    'vue-router',
    'knip',
    '@lerna-lite/*',
    'turbo',
    '@commitlint/*',
    'vue',
  ],
  ignore: [
    '**/*/jest.config.js',
  ],
  ignoreWorkspaces: [
    'common/jest',
    'fronts/docs',
  ],
};
</file>

<file path=".github/workflow-template-deploy.yml">
name: Release

on:
  push:
    branches: 
      - master
      - develop
      - staging

jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
      pages: write
      id-token: write
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: "Checkout ${{ github.ref_name }}"
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js environment
        uses: actions/setup-node@v4
        with:
          node-version: 18
          cache: 'yarn'

      - name: Install dependencies
        run: yarn install --immutable

      - name: Build
        run: npm run docs:build

      - uses: actions/configure-pages@v5
      - uses: actions/upload-pages-artifact@v3
        with:
          path: fronts/docs/.vitepress/dist

      - name: Deploy
        id: deployment
        uses: actions/deploy-pages@v1
  publish:
    runs-on: ubuntu-latest
    env:
      TURBO_TOKEN: ${{ secrets.TURBO_TOKEN }}
      TURBO_TEAM: ${{ vars.TURBO_TEAM }}

    outputs:
      changed: ${{ steps.changes.outputs.changed }}
      versionType: ${{ steps.version.outputs.type }}
      lerna: ${{ steps.lerna.outputs.lernaJson }}
    steps:
    - name: "Checkout ${{ github.ref_name }}"
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Setup Node.js environment
      uses: actions/setup-node@v4
      with:
        node-version: 18
        cache: 'yarn'

    - run: npm set "//registry.npmjs.org/:_authToken" ${{ secrets.NPM_TOKEN }}

    - name: Ensure access
      run: npm whoami
      env:
        NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}

    - name: Config git user
      run: |
        git config --global user.name "${{ github.actor }}"
        git config --global user.email "${{ github.actor }}@users.noreply.github.com"

    - name: Install dependencies
      run: yarn install --immutable

    - name: Lint
      run: yarn run lint

    - name: Tests
      run: yarn run test

    - name: Build
      run: yarn run build

    - id: changes
      name: "Export list of package has changed"
      run: |
        if [ ${GITHUB_REF##*/} = develop ]; then
          echo -n changed=$(yarn turbo test --filter="...[v.dev]" --dry-run=json | jq -c '.packages') >> $GITHUB_OUTPUT
        elif [ ${GITHUB_REF##*/} = staging ]; then
          echo -n changed=$(yarn turbo test --filter="...[v.staging]" --dry-run=json | jq -c '.packages') >> $GITHUB_OUTPUT
        else
          echo -n changed=$(yarn turbo test --filter="...[v.latest]" --dry-run=json | jq -c '.packages') >> $GITHUB_OUTPUT
        fi

    - name: "Print changes"
      run: echo "${{steps.changes.outputs.changed}}"

    - name: "Version and publish ${{github.ref_name}}"
      id: version
      env:
        GH_TOKEN: ${{ secrets.NPM_TOKEN }}
        NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
      run: |
        git config user.name "${{ github.actor }}"
        git config user.email "${{ github.actor}}@users.noreply.github.com"

        if [ ${GITHUB_REF##*/} = develop ]; then
          git tag -fa v.dev -m "fix: set v.dev tag"
          git push origin v.dev -f
          echo "type=dev" >> $GITHUB_OUTPUT
        elif [ ${GITHUB_REF##*/} = staging ]; then
          git tag -fa v.staging -m "fix: set v.staging tag"
          git push origin v.staging -f
          echo "type=staging" >> $GITHUB_OUTPUT
        else
          npx lerna version --conventional-commits --conventional-graduate --yes
          npx lerna publish from-git --yes --registry https://registry.npmjs.org/:_authToken=${{ secrets.NPM_TOKEN }} --force-publish
          git tag -fa v.latest -m "fix: set v.latest tag"
          git push origin v.latest -f
          echo "type=latest" >> $GITHUB_OUTPUT
          cd servers/server
          npm run build
          cd dist
          npm publish --access public
        fi

    - id: lerna
      name: Export lerna config
      run: |
        echo lernaJson=$(cat lerna.json) >> $GITHUB_OUTPUT
</file>

<file path=".runeya/dbs/services/Front.encrypted.json">
9wGi/um0huX3ajcrMuMjcOni/Ula98XxGqIbSf9FHB6fmbhcaAgzYqST0T0oOgI8LZnW8W3PEO7CdghoRSTffys8eZ4v1tw7t0HySZSrgpDltH2Al923rMiJ7ggVLzvBuX7MKyIoRcagtnkUVKtmUvUIuEHcJxDADiEdAq+z7A5EcbPg6Lfbc1Z0q6K7aqM2Gkc4z74K2/nfjuKCvtQR8atU9pjfdGEamzYRT7blQvWHnUR0taCn+5vVcjBJsvvFUHcoIYYOyIfqlPZZxpyKCqjw8rUHgiBsqgRGjN6xRytJJQ+KjP3bGS0xHmIHPu9rLXMiL/+MAHL8U9vGQpkfnQEbXEQ2GS0d7QhIuXHkjwNDSoeshAyVquMUFEDUgQzOGvLSxn2ajHKJY8afh384WZ0hzJ+gRurnjSMAJ34RK0Xk0cvY0oVOOdO2hRq5e7JxvUMe69iddUES9kw4K75cjEw0Qep17ayPPFay2MwSnX3mnOOndE9EQRrIOKlPfGdm/IeNO0NOYiLn2l0q14xnycqRB1NHK5XsINyRNny4n5XMQE+NsE1PGoYMupwVHitzKrNLh8PJmylJJ28so1Levfet1HR5TJDWp0hvkoNtQWM3qibYx1AgQZgtTy2vZqOC/gotDyRAUIP0lGbFTvpaFDd94eA6GxanR46GeNrO5HvwmtiNitKtPJsutAU16rBXMex5v3tFIj9f75e1013QilVb4eARZsH1gpsdYUJK/0c/fXNnvjyo3366+VrHJMBTk6puehri1+gMVVDCYAFDHQfPOg1KSx5s8bckQTE8Ln958KelpwzTSbLM1oqPa4xVKv112spe/Lx83fnKo2aDdk6I2oXIZN1RePXZmvnrxBzgZt46nGdocs5WTpoOkxo4jQDWAoQuzNkyz6OZMGOVXntaaMu2bKGUrEYmvrFNBtDdviwKydWfdrHoSW9Q7KlNu57FZ5NqNt+5EQsXiU0TNkq3NNcU9OxdGDej6TRmy5J8fb8Gxf7hL0JPqe6ic30TAUTB5iWTC5HkW4QjAObFeKwBrkgqnMRfjQbMHIiEywxtG9upPE01DLZ5apZx1qKN//rBOo6h4CzjgXKnWts4SciyjSrlDDpYvV+sY8WjFgEpxq2Z12h7dwpLm9ty4nzOCq2PLweUT9czPpM1i5hZO1WkN0b3bGbpwOrSSR/1h6o+JSjBl2N97jpHPRyXQeEVa492TWW8GvzRPTDR37VIKPr+ksabC2F/hnwd8RsMS5czPLkFME5DGYz8RspVHiGxBjkloVghFJCBOi+eIeucf+bqs2DjnOjl6CeIJDla8n6/cWNO7qdtfd8KunJ8fv8DkdkJTb7h4NPaBq/MBKJgmgYJIQ4qc+XrV3SMPAh0VE+atbuAgnvshQ7egPfm0rmKFnhmv9UGwKJZJV1ndIxKhqN1glFtpojGMVf0LXBlwTVP/nU5DHKGDhdJDRGIc14t1UObUy3cWxtEnbXr8JEBV+cNJruFKE4Cjh0d8kZjJ7XwQ8aJRFdOQGBTVDpOExKJZnNlzVPGrPaeCJALK+KlH4xvMOaLNCrJyPLq0fh1jyGYG3ZPGyHKrTpKzUnIMwGQkbiCn0lhicQQwlCZAOcgYobELawLrMo/1/0qfjBZMQY0r1D+KCmyQOLDoVgchL3L+qMYGcagPIVzgE0BazgZpUn93Ok+fhCMqbMyVjYISRFFYrlFA/poWClCqW/HT+tBt4oV2qOu/IFKQTa81e81x4QMxdAgU6voLqH2V3QgeZuA7wdIfxvcN6Gjtu9zi1SpExz+NzESJyhWDwWI4DA3NVuF/US2j5P8JjsIbUOnHwN8nEeMUIafU5L6kohtF6xiYHeqD73tMKtoDYKI48gNVyGy+O3bauBnEuuj8RO4I1ioNMVgRoXEGVh4DSi/Gh/rR7mImf4aGHueGQpBhQ5pPBbbbzD3Cj27zjwUiwHRVctilBEihZqMKfO5UxYpLOQ2Gt/l7IPPDdnPtdssTd7tytPFzYV4LYtwiBK9jOB1lzTNwfxAQ9C1iHizoSmHg1pDuqlltyVqUQ+L50KmbWwGH4J4BWiJyYQRelo3MzV/P35ezeu8t0Ex/dVErgIkrWXIujEb9+XeX+v4dPRjbq9ILxUV1ylMYULFjCFjd8v1LWL+9Z76BZeEO2icGbI4Fo5z8O3mBQWwoPbalKX2nO0qhnXGKjN3J4LHLsRzYoRvXWIfEi15jISUaQ7l1BvzM7Yp/OtsmVt7jM/aII5ga8ehZPSKmqyXwzs//jC+ClZsQI3BkxCKpbZPRf5VfB2YuvbAgUoNdtLIrk+AXnVX2EVxcT/kK3pKAgZ1gPmUWKhQIwUjkLG+PW5/wf+zON8rZY4yBrxUs6nZaC4YcGltdjvFwgETBBLuc/+pat4rvO9RLuh70eW86TkNq4/GW3MOd37cQPk0KLHS0oZCHC0PlVcKF5Nb8Wy0PSkwvCjPze6z93BQm+26UmnwSYhjuKfUuPNuvnugbX6OsNljxiYDmpCDsYv2bKQNu/tIJ1vTnTnleaGsWdUX+7I2VAp4YNPCGKXxJLzSWLgj3/CCYXimiPRCcqCjVTib1D/Zp65QiR9nX9P1V/bylo+ZIedIRYIs/FN1hNTVWmVWliMFVsXkXgzmNZ2m+43Lfo7B5RY7l9greT9HqRKpOSthNTrw6JNt7/BCQm0AIqynEFJ/LxlM+7jlFueDX/PWHog=
</file>

<file path="common/check-monorepo/src/index.spec.js">
const pathfs = require('path');
const fse = require('fs');
const { checkIfAllWorkspacesAreLinkedToYarn, checkIfAllWorkspacesAreLinkedToLerna, getWorkspaces } = require('./searchForWorkspaces');

describe('Workspaces binding', () => {
  it('All workspaces should be bind to Yarn', () => {
    checkIfAllWorkspacesAreLinkedToYarn();
  });
  it('All workspaces should be bind to Lerna', () => {
    checkIfAllWorkspacesAreLinkedToLerna();
  });
});

describe('Workspaces naming', () => {
  it('All packages should have correct names', () => {
    const rootDir = pathfs.resolve(__dirname, '../../..');
    getWorkspaces().forEach((workspace) => {
      const expectedName = workspace.path
        .replace(`${rootDir}/`, '')
        .split('/')
        .join('-');
      const rootName = require(pathfs.resolve(rootDir, 'package.json')).name;
      const prefix = rootName.split('/').length === 2 // If is a scoped package
        ? rootName.split('/')[0]
        : null;
      if (prefix) {
        expect(workspace.packageJSON.name).toBe(`${prefix}/${expectedName}`);
      } else {
        expect(workspace.packageJSON.name).toBe(expectedName);
      }
    });
  });
});

describe('Dependencies', () => {
  describe('All packages should inherit from the retrigger-all-build package', () => {
    const workspaces = getWorkspaces();
    const retriggerAllPackage = workspaces.find((w) => w.packageJSON.name.includes('retrigger-all-build'));
    if (!retriggerAllPackage) return;
    workspaces
      .filter((workspace) => ![retriggerAllPackage.packageJSON.name, '@runeya/modules-vscode-extension'].includes(workspace.packageJSON.name))
      .forEach((workspace) => {
        it(`${workspace.packageJSON.name} should have a devDependencies section`, () => {
          if (!fse.readdirSync(workspace.path).includes('.independant')) {
            expect(workspace.packageJSON.devDependencies).not.toBeFalsy();
          }
        });
        it(`${workspace.packageJSON.name} should inherit from the retrigger-all-build package`, () => {
          if (!fse.readdirSync(workspace.path).includes('.independant')) {
            expect(workspace.packageJSON.devDependencies).toMatchObject({
              [retriggerAllPackage.packageJSON.name]: 'workspace:*',
            });
          }
        });
      });
  });
  describe('All packages should have a test script', () => {
    const workspaces = getWorkspaces();
    const retriggerAllPackage = workspaces.find((w) => w.packageJSON.name.includes('retrigger-all-build'));
    if (!retriggerAllPackage) return;
    workspaces
      .filter((workspace) => workspace.packageJSON.name !== retriggerAllPackage.packageJSON.name)
      .forEach((workspace) => {
        it(`${workspace.path} should have a test script`, () => {
          if (!fse.readdirSync(workspace.path).includes('.independant')) {
            expect(workspace.packageJSON.scripts?.test).toEqual(expect.any(String));
          }
        });
      });
  });
});

describe('Files', () => {
  describe('All packages should have a npmrc to the root of package', () => {
    getWorkspaces().forEach((workspace) => {
      it(`${workspace.packageJSON.name} should have a npmrc to the root of package`, () => {
        const hasNpmRC = fse.existsSync(pathfs.resolve(workspace.path, '.npmrc'));
        expect(hasNpmRC).toBe(true);
      });
    });
  });
  describe('All packages should not have a packagelock to the root of package', () => {
    getWorkspaces().forEach((workspace) => {
      it(`${workspace.packageJSON.name} should not have a packagelock to the root of package`, () => {
        const hasPackageLock = fse.existsSync(pathfs.resolve(workspace.path, 'package-lock.json'));
        expect(hasPackageLock).toBe(false);
      });
    });
  });
});

describe('Publish config', () => {
  getWorkspaces().filter((workspace) => fse.existsSync(pathfs.resolve(workspace.path, 'package.json'))).forEach((workspace) => {
    it(`${workspace.packageJSON.name} should be in private mode`, () => {
      if (!workspace.packageJSON.private) {
        expect(`${workspace.path}/package.json`).toBe('to be in private mode');
      }
    });
    it(`${workspace.packageJSON.name} should have a repository field`, () => {
      if (!workspace.packageJSON.repository) {
        expect(undefined).toBe('"repository": "https://github.com/runeya/runeya",');
      }
      expect(workspace.packageJSON.repository).toBe('https://github.com/runeya/runeya');
    });
  });
});
// "postinstall": "yarn workspaces foreach --since exec npx check-peer-dependencies --yarn --install || true",
</file>

<file path="common/express-404/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* remove some dependencies ([5667402](https://github.com/runeya/runeya/commit/5667402d57add874a89ba029ce62b16b3bbed9e0))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/common-express-404

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

**Note:** Version bump only for package @runeya/common-express-404

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))

## [1.17.10](https://github.com/runeya/runeya/compare/v1.17.9...v1.17.10) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express-404

## [1.17.9](https://github.com/runeya/runeya/compare/v1.17.8...v1.17.9) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express-404

## [1.17.8](https://github.com/runeya/runeya/compare/v1.17.7...v1.17.8) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express-404

## [1.17.7](https://github.com/runeya/runeya/compare/v1.17.6...v1.17.7) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express-404

## [1.17.6](https://github.com/runeya/runeya/compare/v1.17.5...v1.17.6) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express-404

## [1.17.5](https://github.com/runeya/runeya/compare/v1.17.4...v1.17.5) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express-404

## [1.17.4](https://github.com/runeya/runeya/compare/v1.17.3...v1.17.4) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express-404

## [1.17.3](https://github.com/runeya/runeya/compare/v1.11.23...v1.17.3) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express-404
</file>

<file path="common/express-health-check/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* remove some dependencies ([5667402](https://github.com/runeya/runeya/commit/5667402d57add874a89ba029ce62b16b3bbed9e0))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/common-express-health-check

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))

## [1.17.10](https://github.com/runeya/runeya/compare/v1.17.9...v1.17.10) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express-health-check

## [1.17.9](https://github.com/runeya/runeya/compare/v1.17.8...v1.17.9) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express-health-check

## [1.17.8](https://github.com/runeya/runeya/compare/v1.17.7...v1.17.8) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express-health-check

## [1.17.7](https://github.com/runeya/runeya/compare/v1.17.6...v1.17.7) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express-health-check

## [1.17.6](https://github.com/runeya/runeya/compare/v1.17.5...v1.17.6) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express-health-check

## [1.17.5](https://github.com/runeya/runeya/compare/v1.17.4...v1.17.5) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express-health-check

## [1.17.4](https://github.com/runeya/runeya/compare/v1.17.3...v1.17.4) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express-health-check

## [1.17.3](https://github.com/runeya/runeya/compare/v1.11.23...v1.17.3) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express-health-check
</file>

<file path="common/socket-front/src/Socket.js">
export default {
  events: new Map(),
  connected: false,
  /** @type {WebSocket | null} */
  socket: null,
  reconnectAttempts: 0,
  maxReconnectAttempts: 10,
  reconnectDelay: 100,
  maxReconnectDelay: 1000,
  reconnecting: false,

  reconnectWebSocket(url) {
    if (this.connected || this.reconnecting) {
      return;
    }

    if (this.reconnectAttempts >= this.maxReconnectAttempts) {
      this.trigger('maxReconnectAttemptsReached');
      return;
    }

    this.reconnecting = true;
    this.reconnectAttempts += 1;
    const delay = Math.min(this.reconnectDelay * 2 ** this.reconnectAttempts, this.maxReconnectDelay);

    setTimeout(() => {
      this.init(url)
        .then(() => {
          this.reconnecting = false;
        })
        .catch((error) => {
          this.reconnecting = false;
          this.reconnectWebSocket(url);
        });
    }, delay);
  },

  async init(url) {
    return new Promise((resolve, reject) => {
      if (this.socket) {
        this.socket.close();
        this.connected = false;
      }

      const socket = new WebSocket(url);

      socket.onopen = () => {
        this.socket = socket;
        this.connected = true;
        this.reconnectAttempts = 0;
        this.reconnecting = false;
        this.trigger('connect');
        resolve('ok');
      };

      socket.onmessage = (event) => {
        const { channel, data } = JSON.parse(event.data);
        (this.events.get(channel) || []).forEach((cb) => cb(...data));
      };

      socket.onerror = (error) => {
        reject(error);
      };

      socket.onclose = () => {
        this.connected = false;
        this.trigger('disconnect');
        this.reconnectWebSocket(url);
      };
    });
  },

  trigger(event, ...data) {
    (this.events.get(event) || []).forEach((cb) => cb(...data));
  },

  on(event, cb) {
    const store = this.events.get(event) || [];
    store.push(cb);
    this.events.set(event, store);
  },

  off(event, cb) {
    let store = this.events.get(event) || [];
    store = store.filter((_cb) => _cb !== cb);
    this.events.set(event, store);
  },
  emit(channel, ...data) {
    if (this.connected && this.socket) {
      this.socket.send(JSON.stringify({ channel, data }));
    } else {
      console.warn('Socket non connecté, impossible d\'émettre un message.');
    }
  }

};
</file>

<file path="fronts/app/src/assets/theme/_button.scss">
button {
  padding: 10px;
  margin: 3px;
  border-radius: 4px;
  transition: 300ms;
  @include card-darker();
  color: white;
  font-weight: bold;
  border: none;
  cursor: pointer;
  transition: 300ms;

  &:hover {
    @include card-darkest();
  }

  &.bordered {
    border: 1px solid #074971;
    color: #074971;
    background: none;
  }

  &.small {
    padding: 5px;
    font-size: 0.7em;
    width: 100px;
    display: flex;
    justify-content: flex-start;
    align-items: center;

    i {
      margin-right: 5px;
    }

    .text {
      flex-grow: 1;
      text-align: center;
    }
  }
}

button.success {
  background-color: #41d143;

  &:hover {
    background-color: #258d27;
  }
}

button[disabled] {
  background: none;
  color: #a1a1a1;
  box-shadow: none;
  border: 1px solid #a1a1a1;

  &:hover {
    box-shadow: none;
  }
}
</file>

<file path="fronts/app/src/assets/theme/_reset.scss">
/* http://meyerweb.com/eric/tools/css/reset/ 
   v2.0 | 20110126
   License: none (public domain)
*/

html, body, div, span, applet, object, iframe, p, blockquote, pre,
a, abbr, acronym, address, big, cite, code,
del, dfn, em, img, ins, kbd, q, s, samp,
small, strike, strong, sub, sup, tt, var,
b, u, i, center,
dl, dt, dd, ol, ul, li,
fieldset, form, label, legend,
table, caption, tbody, tfoot, thead, tr, th, td,
article, aside, canvas, details, embed, 
figure, figcaption, footer, header, hgroup, 
menu, nav, output, ruby, section, summary,
time, mark, audio, video, input {
	margin: 0;
	padding: 0;
	border: 0;
	vertical-align: baseline;
}

/* HTML5 display-role reset for older browsers */
article, aside, details, figcaption, figure, 
footer, header, hgroup, menu, nav, section {
	display: block;
}
ol, ul {
	list-style: none;
}
blockquote, q {
	quotes: none;
}
blockquote:before, blockquote:after,
q:before, q:after {
	content: '';
	content: none;
}
table {
	border-collapse: collapse;
	border-spacing: 0;
}
body {
  margin: 0;
  width: 100vw;
  height: 100vh;
  background-color: var(--system-backgroundColor);
  color: var(--system-color);
  transition: 300ms;
  font-size: 0.9em;
  font-family: JOST, sans-serif;
}
ul {
  margin: 0;
  padding: 0;
  li {
    margin: 0;
    list-style-type: none;
  }
}

pre {
  white-space: pre-wrap;
  /* Since CSS 2.1 */
  white-space: -moz-pre-wrap;
  /* Mozilla, since 1999 */
  white-space: -pre-wrap;
  /* Opera 4-6 */
  white-space: -o-pre-wrap;
  /* Opera 7 */
  word-wrap: break-word;
  /* Internet Explorer 5.5+ */
}

.p-select-overlay.p-component {
  z-index: 10000 !important;
}
.p-autocomplete-overlay {
  z-index: 1000000000 !important;
}
.p-autocomplete-dropdown {
  margin: 0;
  border-top-left-radius: 0;
  border-bottom-left-radius: 0;
}
</file>

<file path="fronts/app/src/assets/theme/index.scss">
@import "reset";
@import "font";
@import "a";
@import "var";
@import "mixin";
@import "input";
@import "button";
@import "scrollbar";
</file>

<file path="fronts/app/src/components/CurrentEditor.vue">
<template>
  <Popover trigger="mouseenter" appendTo="parent" :style="{display: 'inline-block', width: 'max-content'}" triggerHeight="18px" :placement="direction" v-if="!loading">
    <template #trigger>
      <img :class="{['filter-dark']: dark}" v-if="currentEditor?.icon" :src="currentEditor?.icon" alt="editor icon"  aria-hidden="true" :title="currentEditor?.title" @click="$emit('openEditor', currentEditor.key)"/>
      <span v-else>Choose your default editor</span>
    </template>
    <template #content>
      <div class="icons">
        <img
          v-for="editor of availableEditors"
          :alt="`Editor icon: ${editor}`"
          :src="allEditors[editor]?.icon"
          :style="{width: '35px', height: '35px'}"
          @click="setDefaultEditor(editor)"
          class="filter-dark"/>
      </div>
    </template>
  </Popover>
  <Spinner v-else size="18" :noColor="true"/>
</template>

<script setup>
import Popover from './Popover.vue';
import {useCurrentEditor} from '../models/currentEditor.js';
import Spinner from './Spinner.vue';

const props = defineProps({
  service: {
    /** @type {import('../models/service').default | undefined} */
    default: undefined
  },
  direction: {default: 'bottom'},
  dark: {default: false},
})

const {
  availableEditors, loading, allEditors, setDefaultEditor, currentEditor
} = useCurrentEditor(props.service)
</script>


<style scoped lang="scss">
img {
  width: 18px;
  height: 18px;
  filter: invert(1);
  &.filter-dark {
    filter:  grayscale(1) opacity(0.7)
  }
  cursor: pointer;
}
.icons {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}
</style>
</file>

<file path="fronts/app/src/components/Markdown.vue">
<template>
  <div class="markdown">
    <div class="actions">
      <i class="fas fa-edit" v-if="!edit" @click="openEditMode"></i>
      <i class="fas fa-times" v-else @click="edit = false"></i>
    </div>
    <div class="sidebyside">
      <Textarea @blur="edit=false" v-if="edit" :value="localValue" @input="update($event.target.value)" autoResize />
      <div v-html="markdown"></div>
    </div>
  </div>
</template>

<script setup>
import {computed, ref} from 'vue'
import markdownIt from 'markdown-it'
import hljs from 'highlight.js'
import 'highlight.js/styles/monokai.min.css'
import Textarea from 'primevue/textarea'
const md = markdownIt({
  highlight: function (str, lang) {
    if (lang && hljs.getLanguage(lang)) {
      try {
        return '<pre><code class="hljs">' +
              hljs.highlight(str, { language: lang, ignoreIllegals: true }).value +
              '</code></pre>';
      } catch (__) {}
    }
    return '<pre><code class="hljs">' + md.utils.escapeHtml(str) + '</code></pre>';
  }
})
const edit = ref(false)
const props = defineProps({
  modelValue: {default: ''}
})
const localValue = ref(props.modelValue)
const openEditMode = () => {
  localValue.value = props.modelValue
  edit.value = true
}
const emits = defineEmits(['update:modelValue'])
function update(value) {
  localValue.value = value
  emits('update:modelValue', value)
}
const markdown = computed(() => md.render(props.modelValue || ''))
</script>

<style lang="scss" scoped>
.markdown {
  position: relative;
}
.actions {
  display: flex;
  justify-content: flex-end;
  position: absolute;
  right: 0;
  i {
    font-size: 1.2rem;
    cursor: pointer;
    padding: 10px;
  }
}
.sidebyside {
  display: flex;
  gap: 5px;
  textarea {
    width: 50%;
  }
}
</style>
</file>

<file path="fronts/app/src/components/Popover.vue">
<template>
  <div class="popover-root" v-if="!disable" :class="{fullWidth}">
    <div ref="refTrigger" class="trigger" :style="{height: triggerHeight}">
      <slot name="trigger" ></slot>
    </div>
    <div ref="refContent" class="content" :style="{maxHeight, overflow: maxHeight !== 'auto' ? 'auto' : 'inherit'}">
      <slot name="content"/>
    </div>
  </div>
  <div class="popover-root" v-else>
    <slot name="trigger"/>
  </div>
</template>

<script>
import { onMounted, ref } from 'vue'
import tippy from 'tippy.js'
import 'tippy.js/dist/tippy.css'; // optional for styling
import 'tippy.js/dist/svg-arrow.css'
import 'tippy.js/themes/light-border.css';
import 'tippy.js/dist/backdrop.css';
import 'tippy.js/animations/shift-away.css';

export default {
  props: {
    triggerHeight: {default: 'auto'},
    maxHeight: { default: 'auto' },
    maxWidth: { default: '100vh'},
    trigger: { default: 'click' },
    placement: { default: 'bottom' },
    appendTo: {default: 'parent'},
    disable: {default: false},
    fullWidth: {default: false},
    showOnCreate: {default: false}
  },
  setup(props) {
    /** @type {import('vue').Ref<Element | import('tippy.js').MultipleTargets | null>} */
    const refTrigger = ref(null)
    const refContent = ref(null)
    const tippyInstance = ref()
    onMounted(() => {
      if(!refTrigger.value) return
      tippyInstance.value = tippy(refTrigger.value, {
        trigger: props.trigger,
        maxWidth: props.maxWidth,
        content: refContent.value,
        placement: props.placement,
        interactive: true,
        allowHTML: true,
        appendTo: props.appendTo || document.querySelector('body'),
        arrow: true,
        hideOnClick: true,
        animation: 'shift-away',
        theme: 'light-border',
        showOnCreate: props.showOnCreate,
      })
    })
    return {
      tippyInstance,
      refTrigger,
      refContent,
      tippy
    }
  }
}
</script>

<style scoped lang="scss">
.fullWidth {

  &.popover-root,
  .trigger {
    width: 100%;
  }
}
</style>
<style lang="scss">
.tippy-content {
  background-color: var(--system-sidebar-backgroundColor);
  color: var(--system-color);
}
.tippy-box[data-theme~=light-border][data-placement^=right]>.tippy-arrow:before{
  border-right-color: var(--system-sidebar-backgroundColor) !important;
}

.tippy-box[data-theme~=light-border][data-placement^=left]>.tippy-arrow:before{
  border-left-color: var(--system-sidebar-backgroundColor) !important;
}
.tippy-box[data-theme~=light-border][data-placement^=top]>.tippy-arrow:before{
  border-top-color: var(--system-sidebar-backgroundColor) !important;
}
.tippy-box[data-theme~=light-border][data-placement^=bottom]>.tippy-arrow:before{
  border-bottom-color: var(--system-sidebar-backgroundColor) !important;
}
</style>
</file>

<file path="fronts/app/src/components/Tabs.vue">
<template>
  <div class="tabs" :class="{[direction]: true}" :style="{
    height
  }">
    <div class="buttons" :class="{invert:invertColor}">
      <template v-for="tab of availableTabs" :key="tab.label" >
        <Popover appendTo="parent" trigger="mouseenter" placement="right" :fullWidth="true">
          <template #trigger>
            <button @click="currentTab = tab;save()" :class="{active: tab?.id === currentTab?.id}">
              <div v-if="tab.label && !tab.icon">{{tab.label}}</div>
              <i v-if="tab.icon" :class="tab.icon" aria-hidden="true"></i>
              <label v-if="showLabels">{{tab?.data?.value?.length || tab?.data?.length || 0}}</label>
              <div v-if="tab?.warning" class="badge warning">{{ tab.warning }}</div>
            </button>
          </template>
          <template #content>
            {{ tab.label }}
          </template>
        </Popover>
      </template>
    </div>
    <div class="content" :style="contentCss">
      <slot :key="currentTab?.id" :data="currentTab?.data?.value || currentTab?.data" :tab="currentTab" v-if="currentTab"/>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted, computed, watch } from 'vue'
import { useRouter } from 'vue-router';
import Popover from './Popover.vue';

const router = useRouter(); 


const props = defineProps({
  tabs: {
    /** @type {Tab[]} */
    default: []
  },
  height: {
    default: 'calc(100vh - 220px)'
  },
  direction: {default: ''},
  showLabels: {default: true},
  contentCss: {default: () => ({})},
  invertColor: {default: false}
})
/** @type {import('vue').Ref<Tab | undefined>} */
const currentTab = ref()
const load = () => {
  if(props.tabs) {
    const tabId = localStorage.getItem('tab')
    currentTab.value = props.tabs.find(tab => tab.id === tabId) || props.tabs[0]
  }
}
onMounted(() => {
  if(router.currentRoute.value.query.tab) {
    localStorage.setItem('tab', router.currentRoute.value.query.tab?.toString())
  }
  load()
})
watch(() => props.tabs, ()=> {
  if(!currentTab.value && props.tabs?.[0]) {
    load()
  }
})
watch(() => router.currentRoute.value, ()=> {
  const goTo = router.currentRoute.value.query.tab
  if(goTo) currentTab.value = props.tabs?.find(t => t.id === goTo)
}, {immediate: true})

const save = () => {
  const toSave = currentTab.value?.id ? currentTab.value.id : ''
  localStorage.setItem('tab', toSave)
  router.push({path: router.currentRoute.value.fullPath, query: Object.assign({}, router.currentRoute.value.query || {},  {tab: toSave})})

}

const availableTabs = computed(() => {
  return props.tabs.filter((tab) => !tab.hidden)
})

defineExpose({
  currentTab: currentTab
})

/**
 * @typedef {{
 * id: string,
 * hidden: boolean,
 * label: string,
 * icon: string,
 * data?: any,
 * warning?: number
 * }} Tab
 */
</script>

<style lang="scss" scoped>

.tabs {
  margin-top: 10px;
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  height: calc(100vh - 220px);
  &.left {
    flex-direction: row;
    justify-content: flex-start;
    align-items: flex-start;
    .buttons {
      flex-direction: column;
      height: auto;
      align-items: flex-start;
      justify-content: flex-start;
      width: max-content;
      height: max-content;
      max-height: 100%;
      position: sticky;
      top: 40px;
      margin: 0;
      button {
        height: 45px;
        width: 100%;
        &.active {
          background-color: rgba(0,0,0,0.5);
          color: white;
          border: 0;
          @include card()
        }
      }
    }
  }
}
.buttons {
  display: flex;
  justify-content: center;
  top: 0;
  border-radius: 5px;
  align-items: flex-end;
  margin: auto;
  margin-bottom: 10px;
  flex-shrink: 0;
  width: max-content;
  gap: 5px;
  background-color: var(--system-sections-backgroundColor);
  z-index: 1;
  border: 1px solid var(--system-border-borderColor);
  button {
    position: relative;
    outline: none;
    margin: 0;
    color: var(--system-tertiary-color);
    transition: 200ms;
    border-bottom: 0;
    height: 40px;
    padding: 0 20px;
    display: flex;
    justify-content: center;
    align-items: center;
    background: transparent;
    font-size: 1em;
    box-shadow: none;
    i {
      font-size: 1.2em;
    }
    &.active {
      border-radius: 0;
      color: #777;
      @include card()

    }
    label {
      background-color: #fff;
      margin-left: 10px;
      color: #0076bc;
      display: flex;
      justify-content: center;
      align-items: center;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      padding-top: 2px;
      box-sizing: border-box;
    }
  }
}
.content {
  position: relative;
  flex-grow: 1;
  overflow-x: hidden;
}
.badge {
  position: absolute;
  right: 0px;
  top: 0px;
  transform: translateX(50%) translateY(-50%);
  z-index: 1;
  padding: 0;
  width: 20px;
  height: 20px;
  display: flex;
  justify-content: center;
  align-items: center;
  &.warning {
    background-color: #e5b100;
  }
}
</style>
</file>

<file path="fronts/app/src/helpers/axios.js">
import Axios from 'axios';

const axios = Axios.create({
  baseURL: '/',
});

export default axios;
</file>

<file path="fronts/app/src/helpers/ServiceError.js">
import Socket from "./Socket"
import notif from "./notification"

Socket.on('alert', _notif => {
  notif.next(_notif.type || 'error', _notif.message, _notif.label, null, _notif.commandId)
})

export default {}
</file>

<file path="fronts/app/src/views/settings/Crypto.vue">
<template>
  <SectionCmp header="Encryption">
    Key used to encrypt most of the data
    <div class="line">
      <Password v-model="newKey" :feedback="false" toggleMask style="width: 100%;" fluid
        @blur="saveKey"
        @keypress.enter="saveKey"
      ></Password>
      <Button icon="fas fa-refresh" @click="getNewKey"></Button>
    </div>
  </SectionCmp>

  <Modal ref="overrideModalRef" cancelString="Cancel" validateString="Ok">
    <template #header>
      Destructive
    </template>
    <template #body>
      Are you sure to replace the encryption key. Data like environments can be lost.
      <br>
      Save your data before.
    </template>
  </Modal>


  <Modal ref="wrongKeyModalRef" :no-cancel="true" validateString="Ok">
    <template #header>
      Wrong key
    </template>
    <template #body>
      It appears that Runeya is already configured with an encryption key.
      <br>
      Please replace the existing key with the correct one to unlock the encrypted files.
    </template>
  </Modal>
</template>

<script setup>
import { onMounted, ref } from 'vue';
import SectionCmp from '../../components/Section.vue';
import axios from '../../helpers/axios';
import Button from 'primevue/button';
import Password from 'primevue/password';
import notification from '../../helpers/notification';
import Modal from '../../components/Modal.vue';
import { useRouter } from 'vue-router';

const router = useRouter()
const key = ref('')
const newKey = ref('')
const overrideModalRef = ref()
const wrongKeyModalRef = ref()

onMounted(async() => {
  reload()
})
async function reload(noPopupCheckKey) {
  if(router.currentRoute.value.query.wrongKey && !noPopupCheckKey) wrongKeyModalRef.value.open()
  const {data: _key} = await axios.get('/crypto/encryption-key')
  key.value = _key
  newKey.value = _key
}
async function saveKey() {
  if(key.value === newKey.value) return
  const result = await overrideModalRef.value.open().promise
  if(!result) return reload(true)
  await axios.post('/crypto/encryption-key', {key: newKey.value})
      .then(() => notification.next('success', 'Key saved'))
      .catch(() => notification.next('error', 'Key cant be saved'));
  return reload(true)
}
async function getNewKey() {
  const result = await overrideModalRef.value.open().promise
  
  if(!result) return reload(true) 
  const {data: _key} = await axios.get('/crypto/generate-key')
  await axios.post('/crypto/encryption-key', {key: _key})
      .then(() => notification.next('success', 'Key saved'))
      .catch(() => notification.next('error', 'Key cant be saved'));
  return reload(true) 
}
</script>

<style lang="scss" scoped>
.line {
  display: flex;
  align-items: center;
}
</style>
</file>

<file path="fronts/app/src/views/StackMultiple.vue">
<template>
  <div class="stack-multiple">
    <tabs :tabs="tabs" :showLabels="false" ref="tabRef" height="100%">
      <template #default="{tab}">
          <div class="tab" >
            <draggableVue v-model="services"
              v-bind="{animation: 300}"
              :setData="setData"
              item-key="label"
              class="services">
              <template #item="{element: service}">
                <section-cmp
                  class="service-container"
                  :headerBold="true"
                  :noBodyPadding="true"
                  :header="service.label"
                  :actions="[
                    {click: () => goTo(service.git.home), icon: 'fab fa-github'},
                    {click: () => goTo(service.url), icon: 'fas fa-globe'},
                    // {click: () => openInVsCode(service), icon: 'fas fa-file-code'},
                    {click: () => openFolder(service), icon: 'fas fa-folder'},
                  ]">
                  <component :is="tab.id" :service="service" :key="service.label" :isInMultiMode="true"  :noStyle="true"></component>
                </section-cmp>
              </template>
            </draggableVue>
          </div>
      </template>
    </tabs>
  </div>
</template>

<script>
import { ref, onMounted, watch } from 'vue'
import Section from '../components/Section.vue'
import stack from '../models/stack'
import Tabs from '../components/Tabs.vue'
import draggableVue from 'vuedraggable'
import PromiseB from 'bluebird'
import axios from '../helpers/axios'

export default {
  components: {
    SectionCmp: Section,
    Tabs,
    draggableVue,
  },
  name: 'StackSingle',
  setup() {
    /** @type {import('vue').Ref<import('../models/service').default[]>} */
    const services = ref([])
    /** @type {import('vue').Ref<Tab[]>} */
    const tabs = ref([])
    /** @type {import('vue').Ref<InstanceType<typeof Tabs> | null>} */
    const tabRef = ref(null)
    onMounted(async () => {
      /** @type {{data: import('@runeya/modules-plugins-loader-front/src/views').PluginSM<null>[]}} */
      const {data: plugins} = await axios.get('/plugins/services')
      tabs.value = plugins
        .sort((a,b) => ((a.order || 0) - (b.order || 0)))
        .map(plugin => /** @type {Tab}*/({label: plugin.name, id: plugin.name, icon: plugin.icon}))
      watch(() => tabRef.value?.currentTab?.id , async ()=> {
        if(!tabRef.value?.currentTab?.id) return 
        services.value = await PromiseB.filter(stack.services.value, async service => {
          if(tabRef?.value?.currentTab?.id) {
            const currentPlugin = tabRef.value.currentTab.id
            if(!service.enabled) return false
            /** @type {{data: import('@runeya/modules-plugins-loader-front/src/views').PluginSM<null>[]}} */
            const {data: plugins} = await axios.get('/plugins/services/'+ service.label)
            const availablePlugins = plugins.map(a => a.name)
            const plugin = availablePlugins.find(plugin => plugin === currentPlugin)
            return !!plugin
          }
          return false
        })
      })
    })
    
    
    return {
      tabRef,
      services,
      tabs,
      setData: function(dataTransfer, element) {
        dataTransfer.setDragImage(document.createElement('div'), 100 ,100)
      },
      /** @param {import('../models/service').default} service */
      async restart(service) {
        await service.restart()
      },
      /** @param {import('../models/service').default} service */
      async stop(service) {
        await service.stop()
      },
      /** @param {string} url */
      goTo(url) {
        window.open(url, '_blank')?.focus();
      },
      /** @param {import('../models/service').default} service */
      async openInVsCode(service) {
        service.openInVsCode()
      },
      /** @param {import('../models/service').default} service */
      async openFolder(service) {
        service.openFolder()
      },
    }
  }
}
/**
 * @typedef {{
 * id: string,
 * hidden: boolean,
 * label: string,
 * icon: string,
 * data?: any
 * }} Tab
 */
</script>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style scoped lang="scss">
.single-button {
  position: absolute;
  top: 10px;
  left: 10px;

  box-shadow: 2px 2px 5px rgba(0,0,0,0.2),
    -2px -2px 5px rgba(255,255,255,0.2);
  &:hover {
    box-shadow: -2px -2px 5px rgba(0,0,0,0.2),
    2px 2px 5px rgba(255,255,255,0.2);
  }
}
.stack-multiple {
  height: 100%;
  width: 100%;
}
.tab {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  align-items: stretch;
  overflow: auto;
  height: calc(100vh - 65px);
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
}
.services {
  display: grid;
  gap: 20px;
  width: calc(100vw - 90px);
  grid-template-columns: repeat(2, 1fr);
  height: max-content;
  .service-container {
    min-width: 300px;
    height: 500px;
    overflow: auto;
    width: 100%;
  }
}
</style>
</file>

<file path="fronts/app/src/main.js">
import PrimeVue from 'primevue/config';
import Aura from '@primevue/themes/aura';
import Socket from './helpers/Socket';
import Tooltip from 'primevue/tooltip';

(async () => {
  console.log('Init Socket...');
  await Socket.init('/socket');

  const { default: router } = await import('./router/router');
  const { createApp } = await import('vue');
  const { default: App } = await import('./App.vue');
  const { default: system } = await import('./models/system');
  const { default: views } = await import('@runeya/modules-plugins-loader-front/src/views');
  const { default: Editor } = await import('./components/Editor.vue');
  const { default: Section } = await import('./components/Section.vue');
  const { default: Markdown } = await import('./components/Markdown.vue');

  system.getVersion().catch((err) => {
    console.error(err);
  });

  const app = createApp(App)
    .component('Editor', Editor)
    .component('SectionCmp', Section)
    .use(Markdown)
    .use(PrimeVue, {
      theme: {
        preset: Aura,
        options: {
          darkModeSelector: '.theme-dark',
        },
      },
    })
    .use(router)
    .directive('tooltip', Tooltip);
  views.forEach((cmp) => app.component(cmp.name, cmp.cmp));
  app.mount('#app');
})();
</file>

<file path="fronts/app/vite.config.mjs">
import { defineConfig } from 'vite';
import vue from '@vitejs/plugin-vue';
import path from 'path';
import { createHtmlPlugin } from 'vite-plugin-html';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url); // get the resolved path to the file
const __dirname = path.dirname(__filename); // get the name of the directory
// https://vitejs.dev/config/
export default defineConfig({
  plugins: [
    vue({}),
    createHtmlPlugin({
      minify: true,
      entry: 'src/main.js',
      template: './index.html',
    }),
  ],
  build: {
    outDir: path.resolve(__dirname, 'dist'),
    // watch: {
    //   include: [
    //     'src/**',
    //     '../modules/**'
    //   ]
    // }
  },

  server: {
    port: 5173,
    host: '0.0.0.0',
    cors: false,
    hmr: {
      host: '0.0.0.0',
      port: 5173,
      protocol: 'ws',
      clientPort: 5173,
    },
  },

  resolve: {
    alias: [{
      find: /~(.+)/,
      replacement: path.join(__dirname, '../../node_modules/$1'),
    }, {
      find: /@\//,
      replacement: `${path.join(__dirname, 'src')}/`,
    }, {
      find: /&\//,
      replacement: `${path.join(__dirname, 'modules')}/`,
    }],
  },
  css: {
    preprocessorOptions: {
      scss: {
        additionalData: '@import "@/assets/theme/_mixin";',
      },
    },
  },
});
</file>

<file path="fronts/docs/reference/health-check.md">
# Health Check Configuration

The Health Check system allows you to monitor the availability and health of your service by configuring automatic checks. Here is a guide to configure the different fields:

![healthcheck](/reference/imgs/health-check.png)

## Configuration Fields

1. **Enable/Disable**
- "Disabled" button: Enables or disables the Health Check system. When disabled, no health checks will be performed.

2. **HTTP Method**
- Field: Select the HTTP method to use (e.g., GET, POST, PUT, DELETE). Default: GET.

3. **URL**
- Field: Specify the URL to check. Example: `http://localhost:8080/health`.

4. **Expected Response Code**
- Field: Set the expected HTTP code to consider the check successful. Default: 200.

5. **Expected Response Text**
- Field (optional): Specify the expected text in the response for the service to be considered healthy. Leave empty to skip this check.

6. **Interval (ms)**
- Field: Set the time interval (in milliseconds) between successive checks. Example: 5000 (5 seconds).

7. **Timeout (ms)**
- Field: Specify the maximum time (in milliseconds) to receive a response before a check fails. Example: 2000 (2 seconds). Default: 0 (no timeout).

8. **Startup Delay (ms)**
- Field: Specify the time to wait (in milliseconds) after the service starts before starting the checks. Example: 1000 (1 second). Default: 0 (immediate start).

## Configuration Example

For an application listening on `http://localhost:8080/health`, you can configure:

- HTTP Method: GET
- URL: `http://localhost:8080/health`
- Expected Response Code: 200
- Interval: 5000
- Timeout: 2000
- Startup Delay: 1000

## Notes

- Ensure that the provided URL is accessible from the system performing the checks.
- Make sure the interval and timeout are suitable for your application to avoid unexpected failures.
</file>

<file path="modules/bugs/backend/routes.js">
const express = require('express');

const router = express.Router();
const pathfs = require('path');
const { fork } = require('child_process');

/** @param {import('@runeya/common-typings').Runeya} runeya */
module.exports = (runeya) => {
  router.get('/bugs/:service', async (req, res) => {
    const service = runeya.findService(req.params.service);
    if (!service) return res.status(404).send('SERVICE_NOT_FOUND');
    const ts = fork(pathfs.resolve(__dirname, 'checkJsFork'));
    ts.on('message', (results) => {
      res.json(results);
      ts.kill('SIGKILL');
    });
    ts.send(req.query.cwd || service.getRootPath() || __dirname);
    return null;
  });
  return router;
};
</file>

<file path="modules/diff/front/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-diff-front

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

### Bug Fixes

* link front to backend deps ([66b3135](https://github.com/runeya/runeya/commit/66b313523d99765b692208de0043303dcb6a0914))
* link front to backend deps ([54fcbf3](https://github.com/runeya/runeya/commit/54fcbf371cf03dc4f51a7196de15fe5d352088e9))

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-diff-front

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/docker/backend/routes.js">
const express = require('express');
const { execAsync } = require('../../../servers/server/helpers/exec');

const router = express.Router();

/** @param {import('@runeya/common-typings').Runeya} runeya */
module.exports = (runeya) => {
  router.get('/docker/:service', async (req, res) => {
    const service = runeya.findService(req.params.service);
    if (!service) return res.status(404).send('Service not found');
    const isAlive = await execAsync(`docker inspect --format {{.State.Pid}} ${service.container.name}`, {})
      .catch(() => null);
    const dockerInfos = await execAsync(`docker inspect ${service.container.name}`, {})
      .then((data) => {
        try {
          return JSON.parse(data)[0];
        } catch (error) {
          console.error(error);
          return '';
        }
      })
      .catch(() => null);
    let dockerImage = null;
    if (dockerInfos) {
      dockerImage = await execAsync(`docker history --no-trunc --human --format json ${dockerInfos.Image}`, {})
        .then((data) => {
          try {
            return data.trim().split('\n').map((a) => JSON.parse(a)).sort((a, b) => {
              if (a && b) return a.CreatedAt.localeCompare(b.CreatedAt);
              return 0;
            })
              .map((a) => `${a.Size} ${a.CreatedBy}    `);
          } catch (error) {
            console.error(error);
            return '';
          }
        })
        .catch(() => null);
    }
    res.json([
      { label: 'containerName', value: service.container.name },
      { label: 'isAlive', value: !!isAlive },
      { label: 'pid', value: isAlive },
      { label: 'dockerInfos', value: dockerInfos, type: 'json' },
      { label: 'image', value: dockerImage, type: 'json' },
    ]);
    return null;
  });
  return router;
};
</file>

<file path="modules/documentation/backend/Documentation.js">
const PromiseB = require('bluebird');
const { randomUUID } = require('crypto');
const dbs = require('../../../servers/server/helpers/dbs');
const db = dbs.getDb(`documentations`)
const dbDocumentationTree = dbs.getDb(`documentations-tree`, {encrypted: true, defaultData: []}).alasql
class Documentation {
  /**
   * @param {import('@runeya/common-typings').NonFunctionProperties<Documentation>} documentation
   */
  constructor(documentation) {
    /** @type {string} */
    this.id = documentation.id || '';
    /** @type {string} */
    this.text = documentation.text || '';
  }

  static async load(id) {
  }

  static async all() {
    return db.alasql.select('Select * from ?')
  }

  static async find(envId) {
    const documentations = await this.all();
    return documentations.find((env) => env.id === envId);
  }

  async save() {
    const obj = this.toStorage();
    await dbs.getDb(`documentations/${this.id}`).write(obj);
    return this;
  }

  async update(env) {
    this.transform = env.transform;
    this.label = env.label;
    await dbs.getDb(`documentations/${this.id}`).write(this.toStorage());
  }

  async delete() {
    await dbs.getDb(`documentations/${this.id}`).delete();
  }

  toStorage() {
    return {
      id: this.id,
      label: this.label,
      transform: this.transform,
    };
  }
}

module.exports = Documentation;
</file>

<file path="modules/finder/front/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-finder-front

## [1.17.29](https://github.com/runeya/runeya/compare/v1.17.28...v1.17.29) (2024-02-15)

### Bug Fixes

* **theme:** add black theme ([bee4697](https://github.com/runeya/runeya/commit/bee469731be182ac929298dc13fe1c230eccb7ba))

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

### Bug Fixes

* various changes ([06e6241](https://github.com/runeya/runeya/commit/06e624176595b95c4227fe684242919c7eeda192))

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

### Bug Fixes

* link front to backend deps ([66b3135](https://github.com/runeya/runeya/commit/66b313523d99765b692208de0043303dcb6a0914))
* link front to backend deps ([54fcbf3](https://github.com/runeya/runeya/commit/54fcbf371cf03dc4f51a7196de15fe5d352088e9))

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-finder-front

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/git/backend/Git.js">
const { existsSync } = require('fs');
const pathfs = require('path');
const { execAsync, execAsyncWithoutErr } = require('../../../servers/server/helpers/exec');
const HTTPError = require('@runeya/common-express-http-error');

/** @param {import('@runeya/common-typings').Runeya} runeya */
const Git = (runeya) => {
  const { findService } = runeya;
  const searchGit = (path) => {
    if (existsSync(pathfs.resolve(path, '.git'))) return path;
    const parentPath = pathfs.resolve(path, '..');
    if (parentPath === pathfs.resolve('/')) return null;
    return searchGit(parentPath);
  };
  /** @param {import('../../../servers/server/models/Service')} service */
  const getGitRootPath = (service) => searchGit(service.getRootPath());
  /** @param {import('../../../servers/server/models/Service')} service */
  async function requirements(service) {
    if (!service) throw new Error('Git Error: Service not found');
    if (!service.git) throw new Error(`Git Error - ${service?.label}: Git option not set`);
    const path = getGitRootPath(service);
    if (!path) return false;
    if (!existsSync(path)) return false;
    return true;
  }
  return {
    /**
     * @param {string} serviceName
     * @param {{graphOnAll?: boolean}} param1
     */
    async getGraph(serviceName, { graphOnAll } = {}) {
      const service = findService(serviceName);
      if (!await requirements(service)) return [];
      const cmd = `git -c color.ui=always log  --decorate=full --oneline --graph ${(graphOnAll ? '--all' : '')} -500`;
      const result = await execAsync(cmd, { cwd: getGitRootPath(service), env: process.env });
      return result.split('\n');
    },
    /** @param {string} serviceName */
    async getBranches(serviceName, fetch = false) {
      const service = findService(serviceName);
      if (!await requirements(service)) return [];
      if (fetch) await this.fetch(serviceName);
      const origin = await this.getOrigin(serviceName);
      const unmergeableBranches = ['dev', 'develop', 'main', 'master'];
      const currentBranch = await this.getCurrentBranch(service.label);
      const mergedBranches = await execAsyncWithoutErr('git branch --no-color --merged develop', { cwd: getGitRootPath(service) })
        .then((branches) => branches.trim().split('\n').map((a) => a.replace('*', '').trim()));
      const localBranches = await execAsyncWithoutErr('git branch --no-color', { cwd: getGitRootPath(service) })
        .then((res) => res.toString().trim().split('\n').map((branch) => {
          const name = branch.replace('*', '').trim();
          return {
            name,
            isRemote: false,
            isCurrentBranch: currentBranch === name,
            canDelete: !unmergeableBranches.includes(name) && currentBranch !== name,
            merged: mergedBranches.includes(name) && !unmergeableBranches.includes(name) && currentBranch !== name,
          };
        }));
      const remoteBranches = await execAsyncWithoutErr('git branch --no-color -r', { cwd: getGitRootPath(service) })
        .then((res) => res.toString().trim().split('\n').map((branch) => {
          const name = branch.replace('*', '').trim();
          return {
            name: name.replace(`${origin}/`, ''),
            isRemote: true,
            canDelete: false,
            merged: false,
          };
        })
          .filter((remoteBranch) => !localBranches.find((localBranch) => remoteBranch.name === localBranch.name)));
      return [
        ...localBranches,
        ...remoteBranches,
      ];
    },
    /** @param {string} serviceName */
    async getCurrentBranch(serviceName) {
      const service = findService(serviceName);
      if (!await requirements(service)) return '';
      return (await execAsync('git rev-parse --abbrev-ref HEAD', { cwd: getGitRootPath(service) }).catch(err => {}))?.trim();
    },
    /**
     *
     * @param {string} serviceName
     * @param {string} branchName
     * @param {boolean} shouldPush
     * @returns
     */
    async addBranch(serviceName, branchName, shouldPush = false) {
      if (!branchName) throw new Error('Branch name is empty');
      const service = findService(serviceName);
      if (!await requirements(service)) return '';
      const res = (await execAsync(`git checkout -b ${branchName}`, { cwd: getGitRootPath(service) }))?.trim();
      if (shouldPush) await this.push(serviceName);
      return res;
    },
    /** @param {string} serviceName */
    async getStatus(serviceName) {
      const service = findService(serviceName);
      if (!await requirements(service)) return [];
      return execAsyncWithoutErr('git -c color.status=no status -s', { cwd: getGitRootPath(service) })
        .then((res) => res.toString().trim().split('\n')?.filter((a) => a));
    },
    /** @param {string} serviceName */
    async getDiff(serviceName) {
      const service = findService(serviceName);
      if (!await requirements(service)) return '';
      return execAsync('git diff --minimal', { cwd: getGitRootPath(service) });
    },
    /**
     * @param {string} serviceName
     * @param {string} branchName
     */
    async changeBranch(serviceName, branchName) {
      const service = findService(serviceName);
      if (!await requirements(service)) return 'ko';
      await execAsync(`git checkout ${branchName}`, { cwd: getGitRootPath(service) });
      return 'ok';
    },
    /**
     * @param {string} serviceName
     * @param {string} branchName
     */
    async deleteBranch(serviceName, branchName) {
      const service = findService(serviceName);
      if (!await requirements(service)) return 'ko';
      await execAsync(`git branch --delete ${branchName}`, { cwd: getGitRootPath(service) });
      return 'ok';
    },
    /**
     * @param {string} serviceName
     * @param {string} branchName
     */
    async remoteDelta(serviceName, branchName) {
      const service = findService(serviceName);
      if (!await requirements(service)) return 0;
      const upstream = await execAsync('git rev-parse --abbrev-ref --symbolic-full-name @{u}', { cwd: getGitRootPath(service) }).catch(() => {});
      if (!upstream) {
        throw new HTTPError('BRANCH_NOT_PUSHED', 500.12578)
      }
      await execAsync(`git fetch origin ${branchName}`, { cwd: getGitRootPath(service) });
      const localCommit = await execAsync(`git log --oneline ${branchName}`, { cwd: getGitRootPath(service) });
      const remoteCommit = await execAsync(`git log --oneline origin/${branchName}`, { cwd: getGitRootPath(service) });
      return localCommit.trim().split('\n').length - remoteCommit.trim().split('\n').length;
    },
    /** @param {string} serviceName */
    async fetch(serviceName) {
      const service = findService(serviceName);
      if (!await requirements(service)) return 'ko';
      await execAsync('git fetch', { cwd: getGitRootPath(service) });
      return 'ok';
    },
    /** @param {string} serviceName */
    async reset(serviceName) {
      const service = findService(serviceName);
      if (!await requirements(service)) return 'ko';
      await execAsync('git reset --hard', { cwd: getGitRootPath(service) });
      return 'ok';
    },
    /** @param {string} serviceName */
    async pull(serviceName) {
      const service = findService(serviceName);
      if (!await requirements(service)) return 'ko';
      const origin = await this.getOrigin(serviceName);
      const currentBranch = await this.getCurrentBranch(service.label);
      await execAsync(`git pull ${origin} ${currentBranch}`, { cwd: getGitRootPath(service) });
      return 'ok';
    },
    /** @param {string} serviceName */
    async getOrigin(serviceName) {
      const service = findService(serviceName);
      if (!await requirements(service)) return '';
      return (await execAsync('git remote -v', { cwd: getGitRootPath(service) })).trim().split('\n').find((a) => a?.includes('fetch'))?.split('\t')[0]?.trim() || '';
    },
    /** @param {string} serviceName */
    async push(serviceName) {
      const service = findService(serviceName);
      if (!await requirements(service)) return 'ko';
      const origin = await this.getOrigin(serviceName);
      const currentBranch = await this.getCurrentBranch(service.label);
      await execAsync(`git push ${origin} ${currentBranch}`, { cwd: getGitRootPath(service) });
      return 'ok';
    },
    /** @param {string} serviceName */
    async stash(serviceName) {
      const service = findService(serviceName);
      if (!await requirements(service)) return 'ko';
      await execAsync('git add .', { cwd: getGitRootPath(service) });
      await execAsync('git stash', { cwd: getGitRootPath(service) });
      return 'ok';
    },
    /** @param {string} serviceName */
    async stashPop(serviceName) {
      const service = findService(serviceName);
      if (!await requirements(service)) return 'ko';
      await execAsync('git stash pop', { cwd: getGitRootPath(service) });
      await execAsync('git reset HEAD', { cwd: getGitRootPath(service) });
      return 'ok';
    },
    /** @param {string} serviceName */
    async stashList(serviceName) {
      const service = findService(serviceName);
      if (!await requirements(service)) return '';
      const list = await execAsync('git stash show', { cwd: getGitRootPath(service) })
        .catch(() => '');
      return list;
    },
    /**
     * @param {string} serviceName
     * @param {string} filePath
     */
    async checkoutFile(serviceName, filePath) {
      const service = findService(serviceName);
      if (!await requirements(service)) return 'ko';
      await execAsync(`git checkout ${filePath}`, { cwd: getGitRootPath(service) });
      return 'ok';
    },
  };
};

module.exports = Git;
</file>

<file path="modules/github/front/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* remove some dependencies ([5667402](https://github.com/runeya/runeya/commit/5667402d57add874a89ba029ce62b16b3bbed9e0))
* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-github-front

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

### Bug Fixes

* cosmetic changes ([a18735e](https://github.com/runeya/runeya/commit/a18735e5b5cec706f3cdf4c4f4ca22482ce7ea0f))

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

### Bug Fixes

* link front to backend deps ([66b3135](https://github.com/runeya/runeya/commit/66b313523d99765b692208de0043303dcb6a0914))
* link front to backend deps ([54fcbf3](https://github.com/runeya/runeya/commit/54fcbf371cf03dc4f51a7196de15fe5d352088e9))

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-github-front

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/global-scripts/front/src/Index.vue">
<template>
  <div class="diff-root">
    <h1>GlobalScripts</h1>
    <div class="content">
      <div class="rooms">
        <div class="room" :class="{ active: currentScript?.label === script.label }"
        v-for="script of globalScripts" :key="script.label" @click="selectScript(script)">
          <div>{{ script.label }}</div>
        </div>
      </div>
      <div class="chat-container" v-if="currentScript">
        <SectionCmp :header="currentScript.label" :actions="[
          {label: 'Launch', icon: 'fas fa-play', click: launch}
        ]">
          <div class="pipelines">
            <div
              v-for="step of displayedSteps" :key="step.label"
              class="pipeline" :class="{
                valid: track.steps[step.id]?.isValidated,
                error: !!track.steps[step.id]?.error,
                current: track.currentStep === step.id,
                loading: track.loadingStep === step.id,
                skipped: track.steps[step.id]?.skipped === true,
              }"
            >
              <div v-if="!!track.steps[step.id]?.error" class="badge error"><i class="fas fa-times-circle"></i></div>
              <Spinner size="30" v-else-if="track.loadingStep === step.id" class="badge loading"></Spinner>
              <div v-else-if="track.currentStep === step.id" class="badge current"><i class="fas fa-play"></i></div>
              <div v-else-if="track.steps[step.id]?.isValidated" class="badge valid"><i class="fas fa-check"></i></div>
              <div v-else-if="track.steps[step.id]?.skipped === true" class="badge skipped"><i class="fas fa-stop-circle"></i></div>
              <h2>{{ step.label }}</h2>
              <template v-if="track.currentStep === step.id && step.prompt && step.id !== track.loadingStep">
                <div>{{ step.prompt.question }}</div>
                <input v-if="step.prompt.type === 'boolean'" type="checkbox"
                v-model="track.steps[track.currentStep].promptValue">
                <input v-else-if="step.prompt.type === 'number'" type="number"
                v-model="track.steps[track.currentStep].promptValue">
                <Multiselect v-else-if="step.prompt.type === 'select'"
                    :options="track.steps[track.currentStep].promptOptions"
                    customLabel="label"
                    :single="true"
                    :initialValue="track.steps[track.currentStep].promptValue
                      ? [track.steps[track.currentStep].promptValue]
                      : []"
                    @update:value="track.steps[track.currentStep].promptValue = $event[0]?.value"
                  />
                <Multiselect v-else-if="step.prompt.type === 'multi-select'"
                  :options="track.steps[track.currentStep].promptOptions"
                  customLabel="label"
                  :initialValue="track.steps[track.currentStep].promptValue"
                  @update:value="track.steps[track.currentStep].promptValue = (
                    $event.map((/**@type {{value: any}}*/a) => a?.value)
                  )"
                />
                <input type="text" v-else v-model="track.steps[track.currentStep].promptValue">
                <button @click="validatePrompt">Validate</button>
              </template>
              <template v-else-if="step.id === track.loadingStep">
                <Spinner></Spinner>
              </template>
              <div v-if="track.steps[step.id]?.error" v-html="track.steps[step.id].error"></div>
              <div v-if="track.steps[step.id]" v-html="track.steps[step.id].printData"></div>
            </div>
          </div>
        </SectionCmp>
      </div>
    </div>
  </div>
</template>

<script setup>
import {
  computed, onMounted, ref, watch,
} from 'vue';
import { useRouter, useRoute } from 'vue-router';
import SectionCmp from '../../../../fronts/app/src/components/Section.vue';
import axios from '../../../../fronts/app/src/helpers/axios';
import Socket from '../../../../fronts/app/src/helpers/Socket';
import Spinner from '../../../../fronts/app/src/components/Spinner.vue';
import Multiselect from '../../../../fronts/app/src/components/Multiselect.vue';

const router = useRouter();
const route = useRoute();

/** @type {import('vue').Ref<GlobalScript[]>} */
const globalScripts = ref([]);

/** @type {import('vue').Ref<import('../../backend/GlobalScripts').TrackStep>} */
const track = ref({
  currentStep: '',
  loadingStep: '',
  steps: {},
  output: {},
  prompts: {},
  scriptId: '',
});

const communicationId = ref('');

/** @type {import('vue').Ref<GlobalScript | null>} */
const currentScript = ref(null);

onMounted(reload);
watch(route, () => {
  const currentQueryScript = router.currentRoute.value.query.script;
  if (currentQueryScript) {
    selectScript(globalScripts.value.find((script) => script.label === currentQueryScript) || globalScripts.value[0]);
  }
});
Socket.on('reloadScripts', reload);
async function reload() {
  const { data: scripts } = await axios.get('/global-scripts/');
  globalScripts.value = scripts || [];
  if (!currentScript.value && globalScripts.value?.length) {
    const currentQueryScript = router.currentRoute.value.query.script;
    if (currentQueryScript) {
      await selectScript(
        globalScripts.value.find((script) => script.label === currentQueryScript)
        || globalScripts.value[0],
      );
    } else {
      await selectScript(globalScripts.value[0]);
    }
  }
}

const displayedSteps = computed(() => {
  const index = (currentScript.value?.pipeline || []).findIndex((s) => s.id === track.value.currentStep);
  return (currentScript.value?.pipeline || [])
    .filter((s, i) => (
      (index === -1 || i < index + 1)
      && !track.value.steps[s.id]?.skipped
    ));
});

/** @param {GlobalScript} script */
async function selectScript(script) {
  router.push({ query: { script: script.label } });
  currentScript.value = script;
  track.value = {
    currentStep: '',
    loadingStep: '',
    steps: {},
    output: {},
    prompts: {},
    scriptId: '',
  };
}

async function launch() {
  if (!currentScript.value?.label) return;
  const { data: _communicationId } = await axios.post(`/global-scripts/${currentScript.value.label}`);
  Socket.on(_communicationId, (/** @type {string} */ ev, /** @type {any} */data) => {
    if (ev === 'track') track.value = data;
  });
  communicationId.value = _communicationId;
  Socket.socket.emit(communicationId.value, 'launch');
}

async function validatePrompt() {
  Socket.socket.emit(communicationId.value, 'validate-prompt', track.value.steps[track.value.currentStep].promptValue);
}

/**
 * @typedef {import('../../backend/GlobalScripts').GlobalScript} GlobalScript
 */
</script>

<style scoped lang="scss">
$leftSize: 200px;
.diff-root,.section-content {
  display: flex;
  flex-direction: column;
  width: 100%;
  overflow: auto;
}

  .content {
    display: flex;
    gap: 10px;
    height: 100%;
    .rooms {
      width: $leftSize;
      flex-shrink: 0;
      gap: 5px;
      display: flex;
      flex-direction: column;
      .room {
        border-left: 1px solid black;
        padding: 5px;
        box-sizing: border-box;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 0 10px 0 rgba(0,0,0,0.2);

        cursor: pointer;
        &:hover {
          background-color: rgba(0,0,0,0.05);
        }
        button {
          width: max-content;
          justify-content: center;
          i {
            margin: 0;
          }
        }
        &.active {
          border-left: 4px solid #1d95db;
        }
      }
      input {
        box-sizing: border-box;
        height: 35px;
        border-radius: 20px;
        border: none;
        box-shadow: 0 0 10px 0 rgba(0,0,0,0.2);
        padding: 0 10px;

      }
    }
    .chat-container {
      width: 0;
      flex-grow: 1;
      height: 100%;
      &>* {
        height: 100%;
        margin: 0;
      }
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        .toolbar {
          display: flex;
          &>div {
            display: flex;
            flex-direction: column;
          }
        }
      }
    }
  }

  .pipelines {
    display: flex;
    flex-direction: column;
    gap: 20px;
    .pipeline {
      position: relative;
      &::after {
        content: '⇓';
        position: absolute;
        top: 100%;
        width: 100%;
        text-align: center;
      }
      &:last-of-type {
        &::after {
          display: none;
        }
      }
      padding: 10px;
      box-sizing: border-box;
      border-left: 3px solid #000000;
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      border-color: #adabab;
      background: var(--system-backgroundColor);
      border: 1px solid var(--system-sections-innerShadow);
      .badge {
        position: absolute;
        right: 10px;
        &.valid {
          background: rgb(50, 173, 54);
        }
        &.current {
          background: rgb(41, 117, 184);
        }
        &.loading {
          background-color: transparent;
        }
        &.error {
          background: rgb(196, 57, 57);
        }
      }

      h2 {
        margin: 0;
      }
    }

  }
</style>
</file>

<file path="modules/help/front/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-help-front

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

### Bug Fixes

* add link to runeya help ([62c1d4e](https://github.com/runeya/runeya/commit/62c1d4e07455759e6468133b2ee7fa4ed1cb8cb6))

## [1.17.24](https://github.com/runeya/runeya/compare/v1.17.23...v1.17.24) (2024-02-11)

### Bug Fixes

* link front to backend deps ([351abfd](https://github.com/runeya/runeya/commit/351abfd8f8cde96bce80d5202a78dd1daabbf6bb))

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

### Bug Fixes

* link front to backend deps ([66b3135](https://github.com/runeya/runeya/commit/66b313523d99765b692208de0043303dcb6a0914))
* link front to backend deps ([54fcbf3](https://github.com/runeya/runeya/commit/54fcbf371cf03dc4f51a7196de15fe5d352088e9))

## [1.17.22](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.22) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-configuration-front

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-configuration-front

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/jwt/front/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-jwt-front

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

### Bug Fixes

* link front to backend deps ([66b3135](https://github.com/runeya/runeya/commit/66b313523d99765b692208de0043303dcb6a0914))
* link front to backend deps ([54fcbf3](https://github.com/runeya/runeya/commit/54fcbf371cf03dc4f51a7196de15fe5d352088e9))

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-jwt-front

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/kanban/front/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-kanban-front

## [1.17.29](https://github.com/runeya/runeya/compare/v1.17.28...v1.17.29) (2024-02-15)

### Bug Fixes

* **theme:** add black theme ([bee4697](https://github.com/runeya/runeya/commit/bee469731be182ac929298dc13fe1c230eccb7ba))

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

### Bug Fixes

* various changes ([06e6241](https://github.com/runeya/runeya/commit/06e624176595b95c4227fe684242919c7eeda192))

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

### Bug Fixes

* link front to backend deps ([66b3135](https://github.com/runeya/runeya/commit/66b313523d99765b692208de0043303dcb6a0914))
* link front to backend deps ([54fcbf3](https://github.com/runeya/runeya/commit/54fcbf371cf03dc4f51a7196de15fe5d352088e9))

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-kanban-front

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* build for npm ([0c07b41](https://github.com/runeya/runeya/commit/0c07b410a237412c1c73bbb42fe45c1f9c220482))
* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/mongo/front/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-mongo-front

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

### Bug Fixes

* cosmetic changes ([a18735e](https://github.com/runeya/runeya/commit/a18735e5b5cec706f3cdf4c4f4ca22482ce7ea0f))

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

### Bug Fixes

* link front to backend deps ([66b3135](https://github.com/runeya/runeya/commit/66b313523d99765b692208de0043303dcb6a0914))
* link front to backend deps ([54fcbf3](https://github.com/runeya/runeya/commit/54fcbf371cf03dc4f51a7196de15fe5d352088e9))

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-mongo-front

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/node-repl/backend/routes.js">
const express = require('express');
const { v4 } = require('uuid');
const { mkdir, writeFile } = require('fs/promises');
const { writeFileSync, readFileSync, unlinkSync } = require('fs');
const pathfs = require('path');
const { mkdirSync, existsSync } = require('fs');
const { spawn } = require('child_process');

const router = express.Router();
const homedir = require('os').homedir();

const confDir = pathfs.resolve(homedir, '.runeya');

if (!existsSync(confDir)) mkdirSync(confDir);
const confPath = pathfs.resolve(confDir, 'node-repl');
if (!existsSync(confPath)) writeFileSync(confPath, '{}', 'utf-8');
const conf = JSON.parse(readFileSync(confPath, 'utf-8'));

/** @param {import('@runeya/common-typings').Runeya} runeya */
module.exports = (runeya) => {
  const { Socket } = runeya;
  router.post('/node-repl/chat/:room', async (req, res) => {
    const { room } = req.params;
    const { script } = req.body;
    if (!conf.chat?.[room]) {
      if (!conf.chat) conf.chat = {};
      if (!conf.chat?.[room]) conf.chat[room] = {};
    }
    conf.chat[room].script = script;
    const uuid = v4();
    const filePath = pathfs.resolve(__dirname, 'sandbox-node-repl', uuid);
    if (!existsSync(pathfs.dirname(filePath))) {
      await mkdir(pathfs.dirname(filePath));
    }
    await writeFile(filePath, script);
    const spawnCmd = spawn('node', [filePath], {
      env: { ...process.env },
      cwd: pathfs.resolve(__dirname),
    });
    let result = '';
    Socket.emit('node-repl:update', { clear: true });
    spawnCmd.stdout.on('data', (data) => {
      Socket.emit('node-repl:update', { msg: data.toString('utf-8') });
      result += data.toString('utf-8');
    });
    spawnCmd.stderr.on('data', (data) => {
      Socket.emit('node-repl:update', { msg: data.toString('utf-8') });
      result += data.toString('utf-8');
    });
    spawnCmd.on('close', () => {
      Socket.emit('node-repl:update', { close: true });
      conf.chat[room].result = result;
      unlinkSync(filePath);
      save();
    });
    save();
    res.json(uuid);
  });

  router.get('/node-repl/rooms', async (req, res) => {
    res.json(Object.keys(conf?.chat || {}));
  });
  router.post('/node-repl/rooms', async (req, res) => {
    const { room } = req.body;
    if (!conf?.chat?.[room]) {
      if (!conf?.chat) conf.chat = {};
      if (!conf?.chat?.[room]) conf.chat[room] = {};
    }
    save();
    res.json(Object.keys(conf?.chat || {}));
  });

  router.delete('/node-repl/rooms/:room', async (req, res) => {
    const { room } = req.params;
    if (conf?.chat?.[room]) delete conf.chat[room];
    save();
    res.json(Object.keys(conf?.chat || {}));
  });

  router.get('/node-repl/chat/:room', async (req, res) => {
    res.json(conf?.chat?.[req.params.room]);
  });

  function save() {
    writeFileSync(confPath, JSON.stringify(conf), 'utf-8');
  }
  return router;
};
</file>

<file path="modules/npm/front/src/Npm.vue">
<template>
  <Select v-model="cwd" :options="npmPaths" :style="{marginBottom: '10px'}"/>
  <div class="npm-root" v-if="npmPaths?.length && packageJson">
    <section-cmp class="scripts-container" :key="service.label" header="Scripts">
      <div class="command-container">
        <div class=button-container>
          <button @click="run('install')">
            <i class="fas fa-play" aria-hidden="true"></i>
          </button>
          install
        </div>
      </div>
      <div class="command-container">
        <div class=button-container>
          <button @click="run('rebuild')">
            <i class="fas fa-play" aria-hidden="true"></i>
          </button>
          rebuild
        </div>
      </div>
      <div v-for="(script, command) of packageJson.scripts" :key="command" :title="script">
        <div>
          <button @click="run(command)">
            <i class="fas fa-play" aria-hidden="true"></i>
          </button>
          {{command}}
        </div>
      </div>
    </section-cmp>
    <section-cmp class="dependencies-container" :key="service.label" v-if="!isInMultiMode">
      <div class="categ"
      v-for="categ of ['dependencies','devDependencies'].filter(categ => packageJson[categ])"
      :key="categ">
        <h2 class="dep-header">{{categ.charAt(0).toUpperCase() + categ.slice(1)}}</h2>
        <div class="dependecies">
          <table>
            <caption>{{categ}} Table</caption>
            <tr>
              <th scope="name">name</th>
              <th class="version" scope="version">version</th>
              <th class="version" scope="wanted">wanted</th>
              <th class="version" scope="latest">latest</th>
            </tr>
            <tr v-for="(version, name) of packageJson[categ]" :key="name">
              <td>{{name}}</td>
              <td>{{version}}</td>
              <td :class="{
                success: outdated && !outdated?.[name]?.wanted,
                error: outdated?.[name]?.wanted && outdated?.[name]?.current !== outdated?.[name]?.wanted
              }">
                <spinner :size="20" v-if="!outdated"/>
                <div v-else-if="!outdated?.[name]">
                  <i class="fas fa-check" aria-hidden="true"/>
                </div>
                <div v-else>
                  <i class="fas fa-times" aria-hidden="true"/>
                  {{outdated?.[name]?.wanted}}
                </div>
              </td>
              <td :class="{
                success: outdated && !outdated?.[name]?.wanted,
                error: outdated?.[name]?.latest && outdated?.[name]?.current !== outdated?.[name]?.latest
              }">
                <spinner :size="20" v-if="!outdated"/>
                <div v-else-if="!outdated?.[name]">
                  <i class="fas fa-check" aria-hidden="true"/>
                </div>
                <div v-else>
                  <i class="fas fa-times" aria-hidden="true"/>
                  {{outdated?.[name]?.latest}}
                </div>
              </td>
            </tr>
          </table>
        </div>
      </div>
    </section-cmp>
  </div>

</template>

<script>
import { onMounted, ref, watch } from 'vue';
import { useRouter } from 'vue-router';
import Service from '../../../../fronts/app/src/models/service';
import SectionVue from '../../../../fronts/app/src/components/Section.vue';
import Spinner from '../../../../fronts/app/src/components/Spinner.vue';
import Select from 'primevue/select';

export default {
  components: {
    sectionCmp: SectionVue,
    Spinner,
    Select
  },
  props: {
    service: {
      /** @type {import('../../../../fronts/app/src/models/service').default | null} */
      default: null,
      required: true,
      type: Service,
    },
    isInMultiMode: {
      type: Boolean,
    },
  },
  setup(props) {
    const router = useRouter();
    const npmPaths = ref([]);
    const cwd = ref();
    /** @type {import('vue').Ref<Record<string, any> | null>} */
    const packageJson = ref(null);
    /** @type {import('vue').Ref<import('../../backend/index').Outdated | null>} */
    const outdated = ref(null);
    const reload = async () => {
      if (props.service) {
        npmPaths.value = await props.service.getNpmPaths();
        if(!cwd.value) cwd.value = npmPaths.value[0]
        packageJson.value = await props.service.getPackageJSON(cwd.value);
        outdated.value = await props.service.outdatedNpm(cwd.value);
      }
    };
    onMounted(reload);
    watch(() => ([props.service, cwd.value]), reload);
    return {
      cwd,
      npmPaths,
      packageJson,
      outdated,
      /** @param {string} command */
      async run(command) {
        if (props.service) {
          if (['install', 'build', 'rebuild'].includes(command)) {
            await props.service.sendTerminalPrompt({
              command: {
                spawnCmd: `npm ${command}`,
                spawnOptions: {
                  cwd: cwd.value
                }
              },
            });
          } else {
            await props.service.sendTerminalPrompt({
              command: {
                spawnCmd: `npm run ${command}`,
                spawnOptions: {
                  cwd: cwd.value
                }
              },
            });
          }
          router.push({ path: router.currentRoute.value.fullPath, query: { ...router.currentRoute.value.query || {}, tab: 'Logs' } });
        }
      },
    };
  },
};
</script>
<style lang="scss" scoped>
.npm-root {
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
}
.scripts-container {
  flex-grow: 1;
  width: auto;
  height: max-content;
  min-width: 300px;
}
.dependencies-container {
  flex-grow: 4;
  width: auto;
}
button {
  width: 20px;
  height: 20px;
  font-size: 0.7em;
  padding: 0;
}
.fa-spinner {
  animation-name: spin;
  animation-duration: 1000ms;
  animation-iteration-count: infinite;
  animation-timing-function: linear;
  &, ::before {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 12px;
    height: 12px;
  }
}
@keyframes spin {
    from {
        transform:rotate(0deg);
    }
    to {
        transform:rotate(360deg);
    }
}
.categ {
  &:first-of-type{
    .dep-header {
      margin-top: 0;
    }
  }
  .dep-header {
    margin-top: 40px;
    margin-bottom: 0;
  }
  tr {
    &.success td {
      color: green;
    }
  }
}
table caption {
  display: none;
}
table {
  width: 100%;
  th {
    text-align: left;
    &.version {
      width: 150px;
    }
  }
  tr {
    transition: 300ms;
    td.error{
      color: red;
    }
    td.success{
      color: green;
    }
    &:hover {
      background-color: rgba(0,0,0,0.05);
    }
  }
}
</style>
</file>

<file path="modules/openai/backend/index.js">
/** @type {import('@runeya/modules-plugins-loader-front/src/views').PluginSM<null>} */
const plugin = {
  enabled: true,
  name: 'OpenAI',
  displayName: 'Open A.I.',
  description: 'Just chat with Chat GPT',
  icon: 'fas fa-brain',
  export: null,
  placements: [
    {
      position: 'toolbox',
      label: 'OpenAi',
      icon: 'fas fa-brain',
      goTo: { path: '/OpenAI' },
      active: 'OpenAI',
    },
  ],
  order: 6,
  routes: require('./routes'),
};
module.exports = plugin;

/**
 * @typedef {Partial<
 * import('openai').OpenAI.ChatCompletionMessage &
 * import('openai').OpenAI.CompletionUsage &
 * {
 *  url?:string
 *  contentId?:string
 *  revised_prompt?:string
 *  created_at: string,
 * _id: string
 * }
 * >} OpenAiChat
 */
</file>

<file path="modules/openai/front/src/Chat.vue">
<template>
  <SectionCmp class="chat">
    <div class="messages" ref="messagesRef">
      <div v-for="message of messages" :key="message._id" class="message-container"
        :class="{ 'me': message.role === 'user' }">
        <template v-if="message.url">
            <img :src="message.url" :alt="message.revised_prompt" :download="message.revised_prompt"/>
        </template>
        <template v-else>
          <div class="bubble" v-html="message?.content?.trim()?.replaceAll('\n', '<br/>')">
          </div>
        </template>
        <div class="infos">
          <div>
            {{ dayjs(message.created_at).fromNow() }}
          </div>
          <div v-if="message.total_tokens">{{ message.total_tokens }} tokens</div>
          <div v-if="message.revised_prompt">{{ message.revised_prompt }}</div>
        </div>
      </div>
      <div v-if="loading" class="message-container" >
        <div class="bubble">
          I'm thinking...
        </div>
        <div class="infos">
        </div>
      </div>
    </div>
    <div class="input-container">
      <textarea v-model="messageToSend" @keypress.enter="sendEnter" placeholder="Ecrivez votre message..."
        @input="input"></textarea>
      <button @click="send"><i class="fas fa-envelope"></i></button>
    </div>
  </SectionCmp>
</template>

<script setup>
import {
  onBeforeUnmount, onMounted, ref, watch,
} from 'vue';
import relativeTime from 'dayjs/plugin/relativeTime';
import duration from 'dayjs/plugin/duration';
import dayjs from 'dayjs';
import SectionCmp from '../../../../fronts/app/src/components/Section.vue';

dayjs.extend(relativeTime);
dayjs.extend(duration);
dayjs.locale('fr');

const props = defineProps({
  messages: {
    /** @type {import('../../backend/index').OpenAiChat[]} */
    default: [],
    required: true,
  },
  loading: { type: Boolean },
});

const emit = defineEmits([
  'send',
]);

const messagesRef = ref();
const messageToSend = ref('');

let firstMount = true;
onMounted(reload);
async function reload() {
  const shouldScroll = messagesRef.value.scrollTop + messagesRef.value.clientHeight === messagesRef.value.scrollHeight;
  setTimeout(() => {
    if (firstMount || shouldScroll) messagesRef.value.scrollTop = messagesRef.value.scrollHeight;
    firstMount = false;
  }, 0);
}
watch(() => props.messages, async () => {
  await reload();
}, { deep: true });

/** @param {KeyboardEvent} ev */
async function sendEnter(ev) {
  if (ev.ctrlKey) await send(ev);
}
/** @param {Event} ev */
async function input(ev) {
  if (ev.target) {
    /** @type {HTMLElement} */(ev.target).style.height = 'calc(1em + 15px)';
    /** @type {HTMLElement} */(ev.target).style.height = `${/** @type {HTMLElement} */(ev.target).scrollHeight}px`;
  }
}
/** @param {Event} ev */
async function send(ev) {
  if (messageToSend.value) {
    await emit('send', messageToSend.value);
    if (ev.target) {
      /** @type {HTMLElement} */(ev.target).style.height = 'calc(1em + 15px)';
      /** @type {HTMLElement} */(ev.target).style.height = `${/** @type {HTMLElement} */(ev.target).scrollHeight}px`;
    }
    messagesRef.value.scrollTop = messagesRef.value.scrollHeight;
    messageToSend.value = '';
    await reload();
  }
}

/** @type {NodeJS.Timer} */
let interval;
onMounted(() => {
  interval = setInterval(reload, 1000);
});
// @ts-ignore
onBeforeUnmount(() => clearInterval(interval));
</script>

<style lang="scss" scoped>
.chat {
  display: flex;
  flex-direction: column;
  width: 100%;
  height: calc(100vh - 200px);
}

.messages {
  display: flex;
  flex-direction: column;
  gap: 20px;
  overflow: auto;
  padding: 10px;
  box-sizing: border-box;

  .message-container {
    box-sizing: border-box;
    width: max-content;
    max-width: 75%;
    display: flex;
    flex-direction: column;

    .bubble {
      width: max-content;
      max-width: 100%;
      color: white;
      border-radius: 10px;
      background-color: darkgrey;
      padding: 10px 10px;
    }

    .infos {
      display: flex;
      flex-direction: column;
      color: grey;
      padding-top: 5px;
      font-size: 0.8em;
    }

    &.me {
      align-self: flex-end;

      .bubble {
        align-self: flex-end;
        $gradient: 50deg, var(--system-accent-backgroundColor1-darkest) 0%, var(--system-accent-backgroundColor3) 100%;
        background: -webkit-linear-gradient($gradient);
        background: linear-gradient($gradient);
        color: white;
      }
      .infos {
        justify-content: flex-end;
      }
    }
  }
}

.input-container {
  display: flex;
  align-items: center;
  gap: 10px;
  box-shadow: 0 0 10px 0 rgba(0,0,0,0.2);
  border-radius: 10px;
  padding: 10px;
  box-sizing: border-box;
  background: white;
  width: calc(100% - 10px);
  margin: auto;
  margin-bottom: 5px;
  textarea {
    height: max-content;
    height: calc(1em + 15px);
    flex-grow: 1;
    border: none;
  }
}
img {
  max-width: 750px;
  max-height: 750px;
}
</style>
</file>

<file path="modules/regex/front/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-regex-front

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

### Bug Fixes

* cosmetic changes ([a18735e](https://github.com/runeya/runeya/commit/a18735e5b5cec706f3cdf4c4f4ca22482ce7ea0f))

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

### Bug Fixes

* link front to backend deps ([66b3135](https://github.com/runeya/runeya/commit/66b313523d99765b692208de0043303dcb6a0914))
* link front to backend deps ([54fcbf3](https://github.com/runeya/runeya/commit/54fcbf371cf03dc4f51a7196de15fe5d352088e9))

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-regex-front

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/uuid/front/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-uuid-front

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

### Bug Fixes

* various changes ([06e6241](https://github.com/runeya/runeya/commit/06e624176595b95c4227fe684242919c7eeda192))

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

### Bug Fixes

* link front to backend deps ([66b3135](https://github.com/runeya/runeya/commit/66b313523d99765b692208de0043303dcb6a0914))
* link front to backend deps ([54fcbf3](https://github.com/runeya/runeya/commit/54fcbf371cf03dc4f51a7196de15fe5d352088e9))

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-uuid-front

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/vscode/extension/src/networks/Socket.js">
Object.assign(global, { WebSocket: require('ws') });

module.exports = {
  events: new Map(),
  connected: false,
  reconnectAttempts: 0,
  maxReconnectAttempts: 10,
  reconnectDelay: 100,
  maxReconnectDelay: 1000,
  reconnecting: false,

  reconnectWebSocket(url) {
    if (this.connected || this.reconnecting) {
      return;
    }

    if (this.reconnectAttempts >= this.maxReconnectAttempts) {
      this.trigger('maxReconnectAttemptsReached');
      return;
    }

    this.reconnecting = true;
    this.reconnectAttempts += 1;
    const delay = Math.min(this.reconnectDelay * 2 ** this.reconnectAttempts, this.maxReconnectDelay);

    setTimeout(() => {
      this.init(url)
        .then(() => {
          this.reconnecting = false;
        })
        .catch(() => {
          this.reconnecting = false;
          this.reconnectWebSocket(url);
        });
    }, delay);
  },

  async init(url) {
    return new Promise((resolve, reject) => {
      if (this.socket) {
        this.socket.close();
        this.connected = false;
      }

      const socket = new WebSocket(url);

      socket.onopen = () => {
        this.socket = socket;
        this.connected = true;
        this.reconnectAttempts = 0;
        this.reconnecting = false;
        this.trigger('connect');
        resolve('ok');
      };

      socket.onmessage = (event) => {
        const { channel, data } = JSON.parse(event.data);
        (this.events.get(channel) || []).forEach((cb) => cb(...data));
      };

      socket.onerror = (error) => {
        reject(error);
      };

      socket.onclose = () => {
        this.connected = false;
        this.trigger('disconnect');
        this.reconnectWebSocket(url);
      };
    });
  },

  trigger(event, ...data) {
    (this.events.get(event) || []).forEach((cb) => cb(...data));
  },

  on(event, cb) {
    const store = this.events.get(event) || [];
    store.push(cb);
    this.events.set(event, store);
  },

  off(event, cb) {
    let store = this.events.get(event) || [];
    store = store.filter((_cb) => _cb !== cb);
    this.events.set(event, store);
  },
};
</file>

<file path="modules/vscode/extension/src/providers/CodeLensProvider.js">
// eslint-disable-next-line import/no-unresolved
const vscode = require('vscode');

/**
 * CodelensProvider
 */
module.exports = class CodelensProvider {
  constructor(context, message) {
    this.message = message;
    this.context = context;
    this.regex = /(.+)/g;
    /** @type {vscode.CodeLens[]} */
    this.codeLenses = [];
    /** @type {vscode.EventEmitter<void>} */
    this._onDidChangeCodeLenses = new vscode.EventEmitter();
    /** @type {vscode.Event<void>} */
    this.onDidChangeCodeLenses = this._onDidChangeCodeLenses.event;

    vscode.workspace.onDidChangeConfiguration(() => {
      this._onDidChangeCodeLenses.fire();
    });
  }

  /**
   * @param {vscode.TextDocument} document
   * @returns {vscode.CodeLens[] | Thenable<vscode.CodeLens[]>}
   */
  provideCodeLenses(document) {
    this.codeLenses = [];
    const { line } = vscode.window.activeTextEditor.selection.start;
    const range = document.getWordRangeAtPosition(new vscode.Position(line, 0), new RegExp(this.regex));
    if (range) {
      this.codeLenses.push(new vscode.CodeLens(range));
    }
    return this.codeLenses;
  }

  /** @param {vscode.CodeLens} codeLens */
  async resolveCodeLens(codeLens) {
    codeLens.command = {
      title: this.message,
      tooltip: 'Tooltip provided by sample extension',
      command: 'codelens-runeya.codelensAction',
      arguments: ['Argument 1', false],
    };
    return codeLens;
  }
};
</file>

<file path="modules/vscode/extension/src/views/views.js">
// eslint-disable-next-line import/no-unresolved
const vscode = require('vscode');
const NodeDependenciesProvider = require('../providers/TreeProvider');
const CodelensProvider = require('../providers/CodeLensProvider');
const ServicesProvider = require('../providers/ServicesProvider');
const {
  getAxios, start, stop, restart, openUrl,
} = require('../networks/axios');

module.exports = {
  dependencies: {
    /** @type {import('vscode').ExtensionContext | null} */
    context: null,
    async update() {
      const file = vscode.window.activeTextEditor?.document.fileName;
      if (!file) return;
      vscode.window.createTreeView('dependencies', {
        treeDataProvider: new NodeDependenciesProvider(file),
      });
    },
    async initialize(context) {
      module.exports.dependencies.context = context;
      vscode.window.onDidChangeActiveTextEditor(async () => {
        module.exports.dependencies.update();
      });
      module.exports.dependencies.update();
    },
  },
  services: {
    /** @type {import('vscode').ExtensionContext | null} */
    context: null,
    async update() {
      const { context } = module.exports.services;
      ['services', 'services-explorer'].forEach((view) => {
        const tree = vscode.window.createTreeView(view, {
          treeDataProvider: new ServicesProvider(context),
        });
        tree.onDidChangeSelection(async (item) => {
          /** @type {{data: import('@runeya/servers-server/models/Service'), type: string}} */
          const { data, type } = item.selection[0] || {};
          if (type === 'start-service') await start(data.label, context);
          if (type === 'stop-service') await stop(data.label, context);
          if (type === 'restart-service') await restart(data.label, context);
          if (type === 'openUrl') await openUrl(data.url, context);
        });
      });
    },
    async initialize(context) {
      module.exports.services.context = context;
      module.exports.services.update();
    },
  },
  editor: {
    /** @type {import('vscode').Disposable | null} */
    codeLensDisposable: null,
    /** @type {import('vscode').ExtensionContext | null} */
    context: null,
    async update(fetch = false) {
      const { context } = module.exports.editor;
      const file = vscode.window.activeTextEditor?.document.fileName;
      if (file) {
        if (fetch || !module.exports.cache) {
          const { data: services } = await getAxios(context).get('/vscode/get-services-from-file', { params: { file } })
            .catch((err) => {
              console.error(err);
              return { data: [] };
            });
          module.exports.cache = services;
        }
        const services = module.exports.cache;
        const crashedServices = services.filter((service) => service.enabled && (service.exited || service.crashed));
        if (crashedServices?.length) {
          const codelensProvider = new CodelensProvider(context, `${crashedServices.map((a) => a.label).join(', ')} ${crashedServices?.length > 1 ? 'are' : 'is'} down`);
          if (module.exports.editor.codeLensDisposable) {
            module.exports.editor.codeLensDisposable.dispose();
          }
          module.exports.editor.codeLensDisposable = vscode.languages.registerCodeLensProvider('*', codelensProvider);
          module.exports.editor.context.subscriptions.push(module.exports.editor.codeLensDisposable);
        } else if (module.exports.editor.codeLensDisposable) {
          module.exports.editor.codeLensDisposable.dispose();
        }
      }
    },
    /** @param {import('vscode').ExtensionContext} context */
    async initialize(context) {
      module.exports.editor.context = context;
      vscode.window.onDidChangeTextEditorSelection(async () => {
        module.exports.editor.update();
      });
    },
  },
};
</file>

<file path="modules/vscode/extension/src/extension.js">
// eslint-disable-next-line import/no-unresolved
const { initSocket } = require('./helpers/initialize');
const { registerCommands } = require('./commands/commands');
const { launchHeartBeat } = require('./schedule/heartbeat');
const { dependencies, editor, services } = require('./views/views');

let interval;

/**
 * @param {import('vscode').ExtensionContext} context
 */
async function activate(context) {
  console.log('Congratulations, your extension "runeya" is now active!');
  await registerCommands(context);
  dependencies.initialize(context);
  editor.initialize(context);
  services.initialize(context);
  initSocket(context);
  launchHeartBeat(context);
}

// This method is called when your extension is deactivated
function deactivate() {
  clearInterval(interval);
}

module.exports = {
  activate,
  deactivate,
};
</file>

<file path="modules/workflows/backend/nodes/helpers/socket.js">
const crypto = require("crypto");

module.exports.askUiFor = async function(label, data, RED) {
  const {sockets} = RED.settings.functionGlobalContext.runeya
  return new Promise(resolve => {
    const uuid = crypto.randomUUID();
    sockets.emit('node-red-' + label, {
      respondTo: uuid, data: data
    })
    const cb = (data) => {
      sockets.off(cb)
      resolve(data)
    }
    sockets.on(uuid, cb)
  })
}
</file>

<file path="modules/workflows/backend/nodes/popup/index.js">
const { askUiFor } = require('../helpers/socket');

/** @param {import('node-red')} RED */
module.exports = function (RED) {
  const serviceSelector = function (config) {
    RED.nodes.createNode(this, config);
    var node = this;
    node.on('input', async function (msg) {
      if (!msg.payload) msg.payload = {}
      await askUiFor('displayPopup', {
        ui: {
          header: config.header,
          html: msg.payload.toDisplay
        },
      }, RED);
      node.status({ fill: "green", shape: "dot", text: 'Displayed' });
      node.send(msg);
    });
  }
  RED.nodes.registerType("sm-popup", serviceSelector);
}
</file>

<file path="modules/workflows/backend/nodes/run-command/index.js">
/** @param {import('node-red')} RED */
module.exports = function (RED) {
  const controller = function (config) {
    RED.nodes.createNode(this, config);
    const node = this;
    if (!config.commandId) config.commandId = 'STACK_LOAD_FROM_INPUT'
    const { sockets, stack } = RED.settings.functionGlobalContext.runeya
    node.on('input', async function (msg) {
      try {
        let command, service
        stack.getServices().forEach(_service => {
          [..._service.commands, ..._service.shortcuts].forEach(_command => {
            if (_command.id === config.commandId) {
              command = _command
              service = _service
            }
          });
        });
        if(!command) {
          node.status({ fill: "red", shape: "ring", text: "No command found" });
          return
        }
        const axios = await stack.getAxios({})
        await axios.post(`/logs/${service.label}/prompt`, { command, service: service.label })
        node.status({ fill: "green", shape: "ring", text: `OK - ${new Date().toISOString()}` });
        return node.send(msg)
      } catch (err) {
        node.error(err + (err?.stack || ''))
        node.status({ fill: "red", shape: "ring", text: err?.message || err });
      }
    })
  }

  RED.nodes.registerType("sm-run-command", controller)
}
</file>

<file path="modules/workflows/backend/nodes/services-events-launcher/index.js">
/** @param {import('node-red')} RED */
module.exports = function (RED) {
  const controller = function (config) {
    RED.nodes.createNode(this, config);
    const node = this;
    const { sockets, stack } = RED.settings.functionGlobalContext.runeya
    const filteredEvents = (config.events?.split(',') || []).filter(c => c)
    const filteredServices = (config.services?.split(',') || []).filter(c => c)
    ;[
      'service:start',
      'service:crash',
      'service:exit',
      'service:healthcheck:down',
      'service:healthcheck:up',
    ]
      .filter(event => ((!filteredEvents?.length) || filteredEvents.includes(event)))
      .forEach(event => {
        sockets.on(event, async ({label, pid, code}) => {
          if (filteredServices?.length && !filteredServices.includes(label)) return
          const service = stack.getServices().find(s => s.label === label)
          node.send({
            payload: {
              service,
              serviceLabel: label,
              event,
              pid,
              code,
            }
          })
        })
      })
  }

  RED.nodes.registerType("sm-services-events-launcher", controller)
}
</file>

<file path="modules/workflows/backend/nodes/package.json">
{
  "name": "node-red-contrib-runeya",
    "node-red": {
    "nodes": {
      "services-events-launcher": "services-events-launcher/index.js",
      "manual-launcher": "manual-launcher/index.js",
      "service-selector": "service-selector/index.js",
      "popup": "popup/index.js",
      "service-action": "service-action/index.js",
      "run-command": "run-command/index.js"
    }
  }
}
</file>

<file path="modules/workflows/front/package.json">
{
  "name": "@runeya/modules-workflows-front",
  "version": "2.1.0",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "vue": "^3.4.18",
    "vue-eslint-parser": "^9.4.2",
    "vue-router": "^4.2.5"
  },
  "dependencies": {
    "primevue": "^4.2.5"
  }
}
</file>

<file path="servers/server/helpers/crypto.js">
const _sodium = require('libsodium-wrappers');
const crypto = require('crypto');

module.exports.generateKey = async () => {
  await _sodium.ready;
  const sodium = _sodium;
  const key = sodium.crypto_aead_aegis256_keygen();
  return sodium.to_base64(key);
};

module.exports.encrypt = async (data, { additionnalNonce = '', encryptionKey = '' } = {}) => {
  await _sodium.ready;
  const sodium = _sodium;
  if (!encryptionKey) encryptionKey = require('../models/EncryptionKey').encryptionKey;
  const key = sodium.from_base64(encryptionKey);
  if (!key || key.length !== sodium.crypto_secretbox_KEYBYTES) {
    throw new Error('Invalid encryption key length');
  }

  let nonce;
  if (additionnalNonce) {
    const combinedHash = crypto.createHash('blake2b512').update(data + additionnalNonce).digest();
    nonce = combinedHash.slice(0, sodium.crypto_secretbox_NONCEBYTES); // Tronquer à la taille requise
  } else {
    nonce = sodium.randombytes_buf(sodium.crypto_secretbox_NONCEBYTES);
  }

  const ciphertext = sodium.crypto_secretbox_easy(data, nonce, key);

  return Buffer.concat([nonce, ciphertext]).toString('base64');
};

module.exports.decrypt = async (encryptedData, { additionnalNonce = '', encryptionKey = '' } = {}) => {
  await _sodium.ready;
  const sodium = _sodium;

  if (!encryptionKey) encryptionKey = require('../models/EncryptionKey').encryptionKey;
  const key = sodium.from_base64(encryptionKey);
  if (!key || key.length !== sodium.crypto_secretbox_KEYBYTES) {
    throw new Error('Invalid decryption key length');
  }
  const encryptedBuffer = Buffer.from(encryptedData, 'base64');

  const nonce = encryptedBuffer.slice(0, sodium.crypto_secretbox_NONCEBYTES);
  const ciphertext = encryptedBuffer.slice(sodium.crypto_secretbox_NONCEBYTES);

  const decrypted = sodium.crypto_secretbox_open_easy(ciphertext, nonce, key);

  if (!decrypted) {
    throw new Error('Decryption failed');
  }

  return Buffer.from(decrypted).toString('utf-8');
};
</file>

<file path="servers/server/helpers/stringTransformer.helper.js">
const slugify = require('slugify').default;
const { specialCaracters } = require('./specialCaracters.helper');

const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';

/**
 * Transform number to alphabet letters.
 * Pick letters until there is no rest
 * @example
 * numberToLetters(1111111111111) // => EHHUAAUUA
 */
function numberToLetters(number, result = '') {
  let charIndex = number % alphabet.length;
  let quotient = number / alphabet.length;
  if (charIndex - 1 === -1) {
    charIndex = alphabet.length;
    quotient -= 1;
  }
  // eslint-disable-next-line no-param-reassign
  result = alphabet.charAt(charIndex - 1) + result;
  return quotient >= 1
    ? numberToLetters(+quotient, result)
    : result;
}

/**
 * A beginning number can be an issue for certain templating language.
 * This function transforms beginning numbers to deterministic and non conflict letters
 * @example
 * transformBeginingNumber('1111111111111aaa') // => EHHUAAUUA_aaa
 */
function transformBeginingNumber(str) {
  let transformedString = str;
  const beginningNumber = Number.parseInt(transformedString, 10);
  const isBeginningWithNumber = Number.isInteger(beginningNumber);
  if (isBeginningWithNumber) {
    const hasAlreadySeparator = transformedString.split(beginningNumber.toString())?.[1]?.charAt(0) === '_';
    transformedString = transformedString.replace(beginningNumber.toString(), `${numberToLetters(beginningNumber)}${hasAlreadySeparator ? '' : '_'}`);
  }
  return transformedString;
}

/**
 * Transliterate a string to a string without ambigeous caracters
 * @example
 * humanStringToKey('aaa aaa aaa') // => aaa_aaa_aaa
 * humanStringToKey('1111111111111aaa') // => EHHUAAUUA_aaa
 */
module.exports.humanStringToKey = (str, separator = '_') => {
  let transformedString = str
    .trim()
    .toLowerCase();
  specialCaracters.forEach((sc) => {
    const [char, eacute, slug] = sc;
    if (eacute) transformedString = transformedString.replaceAll(eacute.toLowerCase(), char);
    if (slug) transformedString = transformedString.replaceAll(slug.toLowerCase(), char);
  });
  transformedString = transformBeginingNumber(transformedString);
  slugify.extend({
    "'": separator,
    '-': '_',
    '(': separator,
    ')': separator,
  });
  return slugify(transformedString, separator);
};

module.exports.replaceEnvs = (str) => {
  Object.keys(process.env).forEach((env) => {
    if (!env) return;
    str = str.replaceAll(`$${env}`, process.env[env]);
  });
  return str;
};
</file>

<file path="servers/server/models/Parser.js">
const PromiseB = require('bluebird');
const { randomUUID } = require('crypto');
const dbs = require('../helpers/dbs');

const nativeParsers = {
  [require('../parser/debug').id]: require('../parser/debug'),
  [require('../parser/json').id]: require('../parser/json'),
  [require('../parser/link').id]: require('../parser/link'),
};
class Parser {
  /**
   * @param {import('@runeya/common-typings').NonFunctionProperties<Parser>} parser
   */
  constructor(parser) {
    /** @type {string} */
    this.label = parser.label || '';
    /** @type {string} */
    this.id = parser.id || randomUUID();
    /** @type {string} */
    this.transform = parser.transform || '';
    /** @type {boolean} */
    this.readonly = parser.readonly || false;
    try {
      /** @type {Function} */
      this.transformFunction = typeof parser.transform === 'string' ? eval(parser.transform) : parser.transform;
    } catch (error) {
      console.error('[PARSER]:', this.label, 'Cannot interpret your parser', error);
    }
  }

  static async load(id) {
    if (nativeParsers[id]) return new Parser(nativeParsers[id]);
    return new Parser(await dbs.getDb(`parsers/${id}`).read());
  }

  static async all() {
    const allDbds = [
      ...await dbs.getDbs('parsers'),
      ...Object.keys(nativeParsers),
    ];
    return PromiseB.map(allDbds, (id) => this.load(id));
  }

  static async find(envId) {
    const parsers = await this.all();
    return parsers.find((env) => env.id === envId);
  }

  async save() {
    const obj = this.toStorage();
    await dbs.getDb(`parsers/${this.id}`).write(obj);
    return this;
  }

  async update(env) {
    this.transform = env.transform;
    this.label = env.label;
    await dbs.getDb(`parsers/${this.id}`).write(this.toStorage());
  }

  async delete() {
    await dbs.getDb(`parsers/${this.id}`).delete();
  }

  toStorage() {
    return {
      id: this.id,
      label: this.label,
      transform: this.transform,
    };
  }
}

module.exports = Parser;
</file>

<file path="servers/server/routes/crypto.js">
const { express } = require('@runeya/common-express');
const config = require('../models/EncryptionKey');
const dbs = require('../helpers/dbs');

const router = express.Router();

router.get('/generate-key', async (req, res) => {
  res.send(await config.generateKey());
});
router.post('/encryption-key', async (req, res) => {
  const { key } = req.body;
  await config.saveKey(key);
  return res.send(key);
});
router.get('/should-setup', async (req, res) => {
  if (!config.encryptionKey) return res.json(true);
  const envSample = (await dbs.getDbs('envs'))[0];
  try {
    if (envSample) await dbs.getDb(`envs/${envSample}`).read();
    return res.json(false);
  } catch (error) {
    console.error(error);
    return res.json(true);
  }
});
router.get('/encryption-key', async (req, res) => {
  res.send(config.encryptionKey);
});
router.post('/test-encryption-key', async (req, res) => {
  const result = await config.testKey(req.body?.key || config.encryptionKey);
  if (result) return res.send('ok');
  return res.status(400).send(config.encryptionKey);
});

module.exports = router;
</file>

<file path="servers/server/routes/index.js">
const { express } = require('@runeya/common-express');

const router = express.Router();
const plugins = require('../helpers/plugins');

plugins.routes.forEach((route) => router.use(route));

router.use('/plugins', require('./plugins'));
router.use('/system', require('./system'));
router.use('/stack', require('./stack'));
router.use('/fs', require('./fs'));
router.use('/crypto', require('./crypto'));
router.use('/parsers', require('./parsers'));
router.use('/editors', require('./editors'));

router.get('/version', async (req, res) => {
  res.send(require('../helpers/version').version);
});

module.exports = router;
</file>

<file path="servers/server/routes/plugins.js">
const { express } = require('@runeya/common-express');

const router = express.Router();
const PromiseB = require('bluebird');
const { findService } = require('../models/stack');
const Stack = require('../models/stack');
const plugins = require('../helpers/plugins');

router.get('/services/:service', async (req, res) => {
  const service = findService(req.params.service);
  const services = await PromiseB.filter(plugins.forService, async (plugin) => (plugin.hidden ? !(await plugin.hidden(service, Stack, 'service')) : true));
  services.sort((a, b) => (b?.order || Number.MAX_SAFE_INTEGER) - (a?.order || Number.MAX_SAFE_INTEGER));
  res.send(services);
});
router.get('/services', async (req, res) => {
  const services = await PromiseB.filter(plugins.forService, async (plugin) => (plugin.hidden ? !(await plugin.hidden(null, Stack, 'global')) : true));
  res.send(services);
});
router.get('/:type', async (req, res) => {
  /** @type {import("@runeya/modules-plugins-loader-front/src/views").PluginSM<null>[]} */
  // @ts-ignore
  const services = await PromiseB.filter(plugins[req.params.type], async (plugin) => (plugin.hidden ? !(await plugin.hidden(null, Stack, req.params.type)) : true));
  services.sort((a, b) => (a.order || 1000) - (b.order || 1000));
  res.send(services);
});
module.exports = router;
</file>

<file path="servers/server/routes/system.js">
const { express } = require('@runeya/common-express');
const axios = require('axios');

const router = express.Router();
const pidusageTree = require('pidusage-tree');
const os = require('os');
const Stack = require('../models/stack');
const { execAsync } = require('../helpers/exec');

router.get('/:service/infos', async (req, res) => {
  try {
    const service = Stack.findService(req.params.service);
    if (service.container?.name) {
      const data = await execAsync('docker container stats --format \'{ "cpuPerc": "{{.CPUPerc}}", "memPerc": "{{.MemPerc}}" }\'  --no-stream --no-trunc   user_api_monorepo', {})
        .then((_data) => {
          const data = JSON.parse(_data);
          const cpuPerc = data.cpuPerc.trim().replaceAll('%', '');
          const memPerc = data.memPerc.trim().replaceAll('%', '');
          return {
            cpu: Number.isNaN(+cpuPerc) ? 0 : +cpuPerc,
            mem: Number.isNaN(+memPerc) ? 0 : +memPerc,
          };
        });
      res.json(data);
    } else {
      const pid = service.container?.customPid
        ? await service.container.customPid({ cmd: null, args: null, pid: null })
        : service.pids[0]?.pid;
      res.json(pid ? await getCPU(pid) : {
        cpu: null,
        ram: null,
      });
    }
  } catch (e) {
    res.json({ cpu: null, mem: null });
  }
});

router.get('/disconnect', async () => {
  process.exit(0);
});
router.get('/proxy-img', async (req, res) => {
  axios({
    method: 'get',
    url: req.query.url,
    responseType: 'stream',
  })
    .then((response) => {
      for (const key in response.headers) {
        if (response.headers.hasOwnProperty(key)) {
          const element = response.headers[key];
          res.header(key, element);
        }
      }
      res.status(response.status);
      response.data.pipe(res);
    })
    .catch(({ response }) => {
      for (const key in response.headers) {
        if (response.headers.hasOwnProperty(key)) {
          const element = response.headers[key];
          res.header(key, element);
        }
      }
      res.status(response.status);
      response.data.pipe(res);
    });
});

/** @param {number} pid */
async function getCPU(pid) {
  const tree = await pidusageTree(pid).catch(() => null);
  /** @type {number[]} */
  const cpus = [];
  let mem = 0;
  let cpuPerc = 0;
  let totalMem = 0;
  if (tree) {
    Object.keys(tree).forEach((key) => {
      if (tree[key]?.cpu) cpus.push(tree[key].cpu);
      if (tree[key]?.memory) mem += tree[key].memory;
    });
    cpuPerc = cpus.reduce((prev, curr) => prev + curr, 0) / cpus.length;
    totalMem = os.totalmem();
  }
  return {
    cpu: Number.isNaN(cpuPerc) ? 0 : cpuPerc,
    mem: mem / totalMem,
  };
}

module.exports = router;
</file>

<file path="servers/server/.gitignore">
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# Runtime data
pids
*.pid
*.seed
*.pid.lock

# Directory for instrumented libs generated by jscoverage/JSCover
lib-cov

# Coverage directory used by tools like istanbul
coverage

# nyc test coverage
.nyc_output

# Grunt intermediate storage (http://gruntjs.com/creating-plugins#storing-task-files)
.grunt

# Bower dependency directory (https://bower.io/)
bower_components

# node-waf configuration
.lock-wscript

# Compiled binary addons (https://nodejs.org/api/addons.html)
build/Release

# Dependency directories
node_modules/
jspm_packages/

# Typescript v1 declaration files
typings/

# Optional npm cache directory
.npm

# Optional eslint cache
.eslintcache

# Optional REPL history
.node_repl_history

# Output of 'npm pack'
*.tgz

# Yarn Integrity file
.yarn-integrity

# dotenv environment variables file
.env

# next.js build output
.next
dist
bin/public
*.vsix
public
</file>

<file path=".yarnrc.yml">
compressionLevel: mixed

enableGlobalCache: false

nmHoistingLimits: none

nodeLinker: node-modules

yarnPath: .yarn/releases/yarn-4.2.2.cjs
</file>

<file path="turbo.json">
{
  "$schema": "https://turborepo.org/schema.json",
  "tasks": {
    "build": {
      "dependsOn": [
        "^build"
      ],
      "outputs": [
        ".next/**",
        ".vitepress/dist/**",
        "dist/**",
        "out/**",
        "build/**",
        "server/public/**"
      ]
    },
    "test": {
      "outputs": []
    },
    "lint": {
      "outputs": []
    },
    "deploy": {
      "dependsOn": [
        "build",
        "test",
        "lint"
      ],
      "outputs": []
    }
  }
}
</file>

<file path=".runeya/dbs/services/Documentation.encrypted.json">
MMmJRFN8mJkejbsuxKc4xMiBK5MXSp8aGShI9MD0IGWwlyDR2nOJ/hhfILI65oExG4RYYOuVwXaJi2tUOgsNrJGvMphYmWHLB5xwl3Eh4855ijpJ7mxp26fyKSPGYIR/sOcBM2l64lfmYzETUNFRyy5xF1e3JrWyaf29zsRGUmdTLDxYyCyzFbkrJTRAtSkh47OX+a8oHVjIomWUaV3xp+CfPYjKKG2MLkQdaVpEdRH6hkblGXHS4Xu2cLXOzSjt9zPqNFUovGAmXDgNxbB9cx1YdPuj/N9Zm1aZy1t+V5zJCMSimQZ187Mx9gdnzDCCFdS16OoI1kLyelymlP1weCzpoUB4iYIKgdvDcHt6/PxE1R06WeE23uoh2WZHiWY0caBc39GPM7ua2s2+n+8LrcAPpJt3UQpXjI/yPt0/961UUC5pSBdsH1Mbljxuwo6N8KH5Dq0VNWTLa2TfXVKuj63a0knvtgP1Hp1uDwf5Kt/1NtC499rpSiFFnQG7BmcIxdlqDRjfZRy4P/lB5+AvrP8Qk57ytpP9FlCQJNAbVw/dmRJY3xthi6hqfvMPG93nURHJ/LnZeHbwsiUn+KxzIZQyvaTY4foZG9QCP0paU+fgmQXfbaiVybvscHKfyHRyyjBxlNU70OEZyu270ekEZA5LDLViGdbqfkqcpawSHPM6JVmBtLUMntUSqRA7/WOqz76tukDuRQDEw5fiMsbjCupcaUL6TPi+Tn8uiKJiZPnYHyC6otwzekN9Q23wUzMQ7dxoP13Gez8ShyO1kaY1dZ+t6f6O0lT5yBzwxvBA9TscSz0K+FkQqjPSNTrBzau7JFW/Qi1Wj4io91nEXGJ/Rb8VVoKAAaHtHMGeG4s7WovIRIX3+VgB8JNPsae3/sHWCgUb2FQN6slNwTBYJ9attoZJWxwv1H0euVLuS2zfwbt82MLE3tbhnjOOr9mUmYrA50HF/auoaO57eiOBPGPxR/trjKd0kap7NVHgXcaX3qokYt71pdXpu74XnIaQ4DuJpMZv7/++UV12MFpWeldI4wkbt3OHafw3aG3WEDoE03lGXvtMAUGLEHO9Lg90drD1UrBvSl3GJy+koanuWeCnHJzmQxUYbbLxoTFDwqBmPq7z4satPDptaW8BQCLKRFkkK1+QTEikJGgSuA6kRXubn2w61RFoqGz+6qSdQgb59KnEGBMtDz1eFVTtKyx+TRyVzplAWwBOKMr/vQGFLpcBbKo2zY+P7Bp0W/uDD4NyfDEbABm7592rIHLHQhSIPQ65ZZrcwwmowKkUgp5m5SioN3ooc+ye1Z3mgiXHmIL2DRVV2WAz2H/MB7ZYgK5pnA+lJ0blZ9sZdG3Qip4bdB67CbOkSqxvGrV2BuVeGCTubOpqS0gz0VXZWuQuFWQgVCl+qzYxv5lRIE7zn9dQm+PiepF6j5BWwgsYjtS/PYYVA+/4Kg3NFqszL0FYbQCiU+tuhC/fMJpykCaPfFpkVnp0aL257awZYHxQ7h8jsNc8gBnw0QVt4436s+SsOL/Ew41pIrpNTXKqF84wItL6LnVztDY5sbYMCgroQ+70TLddaHv40MxIWqvI/fYj0EievgThaztBwS8MqdIifbGUKzf9f9NBIAB5sNswCl2z8tCrmHaEZQfagzH7Lxvhggpd1pqGIyxyAVWIqjMwgCPSUOSxyKKEMBCVLqbRXH/XSzIZijx29wkbNvLZAHPUbA8jiioH3d5uXmhbcU2MLmuAVMr2xjNhLse4sMQkRw6zRtlCABlH1aVXJsibK+2PgXRCbyiIEVimyGodAp/VR6cCTLgo1AxgHOyjlzxfVoeG5ejCybPsUy0vHwxFfH2V+hHE95LNZVuUl6ZeLH2RkYd8AKftMImVFlkjFTRFChVwHOn4XAJvNLKn77XwSFnaCQRTJRCKvb+DhW5vd5howNKPq3SHAMlLIu+thcd4KqqIhLkG3ayfIithFkzGLnpt1lQs/8pXWlXl11SfYDS8YgL9eOflDfbWMAjHhqf88zKw9u3Vlbxj+mSqINfVRfTKSooWAQJET8UyOmMb2F6j4LNk5ySlhCIxEI+h/oQgeoyoJ3g3zS54eMhPFjnnVM+LFh7k01EPOH0ultl5AttiMuODFNnJjum0B3mX2WMHA9dYQccRD1X0yiueOM8t0plpVNkgGXIm4UqoVl2JUWNepEzn2hgdxiju7KF8WW+6uI85KfGb5WcHTH3cOtdqpgQ//ZP2kV7XlL2iHR/MI1IP1jUB3jxb53Zt/Muzzvf5SALSaKKr8i+FKPfww2jQ1290V2V9ysp9WH1f5s+ZtmV3C9HZnfOHMygnbDHjzyPz9AF3hqohuJoQVOFvMgp093G9tHhWsKxMmEGdiVCF+BnfMafQaQT+JfooaYG9ZbkltZ3ztxbodASd+vOp0LfzBicEu9iIX/OZLAEGR0A6BQANYUqftKVsXMcZye+U8stxWRb+WAeOBTW89YRhfMUCMiITva/7WsX/n6e9ACTAeF8Cq4fxfN0+DmxnLp1NGpmfQihsEGylfBcT6NeG0KPHJC/9MNP/kwE4jApoDshBIWL4PCj1sLXarJ+qinhPl8YxBwdcshXUYyeleqLC9QeU4kapLVYD9xY/BhgEGanVAb1fdmAKBTxVLCy+unOSM8DkkbHY7i6qggY+5UbOs4TtLPAIKdmXi2XZnCC+JMY/cUpfiUw2B5mUbUqV7eaT79yeG5tTCEL3lxJ6eTWWGv0Y3nTxbgIh6s96iCetMgw22Ro+JXoeQiijtGwwXbSHlcTHsS8net11Iue0vdgds71VnYqMTcfOM3Z200PVkdnSgYKIp5GieFbkA1yyirSaUBshjpOcr1+Bxs0raItbemjmgHKVqRoblATACrAee2m/We/9ceWtmg+4Rcc72tOxPVGHVEPCpP4pAa0dqAvRsDuzRF2PW4cZIpizBLSWW+JfMA6FHbciLcwzCw8NIv1kxLeg5IHdoUVpEQQ6xmgcdJY/uPipyJ7dWLyVMBUj4A0MHxkuyonyzvXTkDkIdrS/MvTjgZwp
</file>

<file path="common/express-404/package.json">
{
  "name": "@runeya/common-express-404",
  "version": "2.0.5",
  "private": true,
  "description": "",
  "repository": "https://github.com/runeya/runeya",
  "main": "src/index.js",
  "types": "src/index.js",
  "scripts": {
    "test": "echo \"no test\""
  },
  "author": "",
  "license": "ISC",
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "jest-sonar-reporter": "^2.0.0"
  }
}
</file>

<file path="common/express-error-handler/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* remove some dependencies ([5667402](https://github.com/runeya/runeya/commit/5667402d57add874a89ba029ce62b16b3bbed9e0))

## [2.0.1](https://github.com/runeya/runeya/compare/v2.0.0...v2.0.1) (2024-12-25)

**Note:** Version bump only for package @runeya/common-express-error-handler

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/common-express-error-handler

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

### Bug Fixes

* various changes ([06e6241](https://github.com/runeya/runeya/commit/06e624176595b95c4227fe684242919c7eeda192))

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

**Note:** Version bump only for package @runeya/common-express-error-handler

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))

## [1.17.10](https://github.com/runeya/runeya/compare/v1.17.9...v1.17.10) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express-error-handler

## [1.17.9](https://github.com/runeya/runeya/compare/v1.17.8...v1.17.9) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express-error-handler

## [1.17.8](https://github.com/runeya/runeya/compare/v1.17.7...v1.17.8) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express-error-handler

## [1.17.7](https://github.com/runeya/runeya/compare/v1.17.6...v1.17.7) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express-error-handler

## [1.17.6](https://github.com/runeya/runeya/compare/v1.17.5...v1.17.6) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express-error-handler

## [1.17.5](https://github.com/runeya/runeya/compare/v1.17.4...v1.17.5) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express-error-handler

## [1.17.4](https://github.com/runeya/runeya/compare/v1.17.3...v1.17.4) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express-error-handler

## [1.17.3](https://github.com/runeya/runeya/compare/v1.11.23...v1.17.3) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express-error-handler
</file>

<file path="common/express-health-check/package.json">
{
  "name": "@runeya/common-express-health-check",
  "version": "2.0.5",
  "description": "",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "main": "src/index.js",
  "scripts": {
    "test": "echo \"no test\""
  },
  "author": "",
  "license": "ISC",
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "jest-sonar-reporter": "^2.0.0",
    "supertest": "^6.3.4"
  },
  "dependencies": {
    "express": "^4.18.2"
  }
}
</file>

<file path="common/socket-server/src/sockets.js">
const WebSocket = require('ws');
const CustomObservable = require('./CustomObservable');

/** @type {Record<string, CustomObservable>} */
const events = {};

module.exports = {
  /** @type {WebSocket.Server | null} */
  io: null,
  emit(channel, ...data) {
    events[channel]?.next(...data)
    this.io?.clients.forEach((ws) => {
      ws.send(JSON.stringify({ channel, data }));
    });
  },
  on: (event, cb) => {
    if (!events[event]) events[event] = new CustomObservable();
    events[event].subscribe(cb);
  },
  off(event, cb) {
    events[event]?.off(cb)
  },
  /**
   *
   * @param {*} server
   */
  connect(server) {
    this.io = new WebSocket.Server({ noServer: true, path: '/socket' });
    this.io.on('connection', function message(ws) {
      ws.on('message', function message(event) {
        const { channel, data } = JSON.parse(event?.toString());
        events[channel]?.next(...data)
      })
    })
    const self = this
    server.on('upgrade', function upgrade(request, socket, head) {
      if (request.url === '/socket') {
        self.io?.handleUpgrade(request, socket, head, function done(ws) {
          self.io?.emit('connection', ws, request);
        });
      }
    });
  },
};
</file>

<file path="common/workflows/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.1.1](https://github.com/runeya/runeya/compare/v2.1.0...v2.1.1) (2025-02-11)

### Bug Fixes

* improve code health ([865b996](https://github.com/runeya/runeya/commit/865b996fa0adcf49668fa770c465bac1f1d8f21a))

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* remove some dependencies ([5667402](https://github.com/runeya/runeya/commit/5667402d57add874a89ba029ce62b16b3bbed9e0))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/common-workflows

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))

## [1.17.10](https://github.com/runeya/runeya/compare/v1.17.9...v1.17.10) (2024-02-04)

**Note:** Version bump only for package @runeya/common-workflows

## [1.17.9](https://github.com/runeya/runeya/compare/v1.17.8...v1.17.9) (2024-02-04)

**Note:** Version bump only for package @runeya/common-workflows

## [1.17.8](https://github.com/runeya/runeya/compare/v1.17.7...v1.17.8) (2024-02-04)

**Note:** Version bump only for package @runeya/common-workflows

## [1.17.7](https://github.com/runeya/runeya/compare/v1.17.6...v1.17.7) (2024-02-04)

**Note:** Version bump only for package @runeya/common-workflows

## [1.17.6](https://github.com/runeya/runeya/compare/v1.17.5...v1.17.6) (2024-02-04)

**Note:** Version bump only for package @runeya/common-workflows

## [1.17.5](https://github.com/runeya/runeya/compare/v1.17.4...v1.17.5) (2024-02-04)

**Note:** Version bump only for package @runeya/common-workflows

## [1.17.4](https://github.com/runeya/runeya/compare/v1.17.3...v1.17.4) (2024-02-04)

**Note:** Version bump only for package @runeya/common-workflows

## [1.17.3](https://github.com/runeya/runeya/compare/v1.11.23...v1.17.3) (2024-02-04)

**Note:** Version bump only for package @runeya/common-workflows
</file>

<file path="fronts/app/src/assets/theme/_mixin.scss">
@mixin backgroundGradient {
  $gradient: 160deg, rgba(var(--BgColorAccentGradient), 1), rgba(var(--BgColorAccent), 1);
  background: var(--headerBgColorAccent);
  background: -webkit-linear-gradient($gradient);
  background: linear-gradient($gradient);
  color: white;
  ion-icon{
    color: white;
  }
}
@mixin backgroundGradientImage($opacity, $imageUrl) {
  $gradient: 160deg, rgba(var(--BgColorAccentGradient), $opacity), rgba(var(--BgColorAccent), $opacity);
  background: var(--headerBgColorAccent);
  background: -webkit-linear-gradient($gradient);
  background: linear-gradient($gradient);
  color: white;
  position: relative;

  &::before {
    content: "";
    z-index: -1;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: url($imageUrl);
    background-size: cover;
    background-position: right;
  }
}

@mixin card-template($color1, $color2, $color3) {
  background: $color1;
  background: linear-gradient(93deg, $color1 0%, $color2 100%);
  color: white;
}
@mixin card() {
  @include card-template(var(--system-accent-backgroundColor1), var(--system-accent-backgroundColor2), var(--system-accent-backgroundColor3-lighter));
}
@mixin card-darker() {
  @include card-template(var(--system-accent-backgroundColor1-darker), var(--system-accent-backgroundColor2-darker), var(--system-accent-backgroundColor3-darkest));
}
@mixin card-darkest() {
  @include card-template(var(--system-accent-backgroundColor1-darkest), var(--system-accent-backgroundColor2-darkest), var(--system-accent-backgroundColor3-darkest));
}
@mixin card-secondary() {
  @include card-template(var(--system-accent-backgroundColor1-secondary), var(--system-accent-backgroundColor2-secondary), var(--system-accent-backgroundColor3-secondary));
}
@mixin card-tertiary() {
  @include card-template(var(--system-accent-backgroundColor1-tertiary), var(--system-accent-backgroundColor2-tertiary), var(--system-accent-backgroundColor3-tertiary));
}
</file>

<file path="fronts/app/src/components/EnvironmentsChooser.vue">
<template>
  <div class="banner" v-if="currentEnvironment" :style="{
    backgroundColor: currentEnvironment.bgColor || 'transparent',
    color: currentEnvironment.color || 'transparent',
  }">
    <div>
      Current environment
      <Select
        class="select"
          size="small"
          :defaultValue="currentEnvironment.label"
          :value="currentEnvironment.label"
          @change="changeEnvironment"
          :options="environments.filter(a => a)"
          optionLabel="label"
          optionValue="label"
          placeholder="Select an environment">
          <template #footer>
            <Button label="Add New" fluid severity="secondary" text size="small" icon="fas fa-plus" @click="createEnvironment"/>
            <Button label="Edit" fluid severity="secondary" text size="small" icon="fas fa-edit" @click="editEnvironments"/>
          </template>
        </Select>
    </div>
  </div>
  <Teleport to="body" v-if="loading">
    <div class="reload-modal">
      <Spinner></Spinner>
      Change environments...
    </div>
  </Teleport>
  <Modal ref="overrideModalRef" cancelString="Cancel" validateString="Ok">
    <template #header="{data: services}">
      Change environment
    </template>
    <template #body="{data: services}">
      Because .env in services root folder is the main truth. Some environments may not be taken into account.
      <ul>
        <li v-for="service of services" :key="service.id">
          {{service.label}}
          <ul>
            <li v-for="(env, key) of service.spawnOptions.overrideEnvs">
              {{key}}: {{env}}
            </li>
          </ul>
        </li>
      </ul>
    </template>
  </Modal>

  <Modal ref="createEnvironmentModalRef" cancelString="Cancel" validateString="Ok">
    <template #header>
      Create environment
    </template>
    <template #body>
      <IftaLabel>
        <InputText id="environment-to-create-label" size="small" v-model="environmentToCreate.label" fluid></InputText>
        <label for="environment-to-create-label">Label</label>
      </IftaLabel>
      <IftaLabel>
        <InputText id="environment-to-create-bgColor" size="small" v-model="environmentToCreate.bgColor" fluid></InputText>
        <label for="environment-to-create-bgColor">Background color</label>
      </IftaLabel>
      <IftaLabel>
        <InputText id="environment-to-create-color" size="small" v-model="environmentToCreate.color" fluid></InputText>
        <label for="environment-to-create-color">Color</label>
      </IftaLabel>
    </template>
  </Modal>
</template>

<script setup>
import { ref, onMounted, onBeforeUnmount } from 'vue'
import Stack from '../models/stack'
import notification from '../helpers/notification'
import Spinner from './Spinner.vue';
import Modal from '../components/Modal.vue';
import Button from 'primevue/button';
import InputText from 'primevue/inputtext';
import Socket from '../helpers/Socket';
import IftaLabel from 'primevue/iftalabel';
import Select from 'primevue/select';
import { useRouter } from 'vue-router';
const router = useRouter()

/** @type {import('vue').Ref<import('../../../../servers/server/models/stack').Environment | null>} */
const currentEnvironment = ref(null)
/** @type {import('vue').Ref<Record<string, import('../../../../servers/server/models/stack').Environment>[]>} */
const environments = ref([])
const loading = ref(false)
/** @type {import('vue').Ref<InstanceType<typeof import('../components/Modal.vue')['default']> | null>} */
const overrideModalRef = ref(null)
/** @type {import('vue').Ref<InstanceType<typeof import('../components/Modal.vue')['default']> | null>} */
const createEnvironmentModalRef = ref(null)
const environmentToCreate = ref({label: '', color: '', bgColor: ''})
onMounted(reload)
async function reload() {
  currentEnvironment.value = await Stack.getEnvironment()
  environments.value = await Stack.getEnvironments()
}
onMounted(() => {
  Socket.on('reloadEnvironments', reload)
})
onBeforeUnmount(() => {
  Socket.off('reloadEnvironments', reload)
})

async function createEnvironment() {
  const result = await createEnvironmentModalRef.value?.open().promise
  if(!result) return 
  if(!environmentToCreate.value?.label) return
  await Stack.createEnvironment(environmentToCreate.value)
  environmentToCreate.value = {label: '', color: '', bgColor: ''}
} 
function getOverridedEnvsServices () {
  return Stack.services.value?.filter(s => s.enabled).reduce((/**@type {import('../models/service').default[]}*/agg, service) => {
    const overrideEnvs = Object.keys(service?.spawnOptions?.overrideEnvs || {})
    const envs = Object.keys(service?.spawnOptions?.env || {})
    if(envs.some((key => overrideEnvs.includes(key)))) {
      agg.push(service)
    }
    return agg
  }, [])
}
async function changeEnvironment({value: env}) {
  const servicesOverrided = getOverridedEnvsServices()
  if(servicesOverrided?.length && overrideModalRef.value) {
    const res = await overrideModalRef.value.open(servicesOverrided).promise
    if(!res) return 
  }
  loading.value = true
  await Stack.changeEnvironment(env)
    .then(() => {
      window.location.reload()
    })
    .catch(err => {
      console.error(err)
      notification.next('error', 'Problem has occured')
    })
    .finally(() => {
      loading.value = false
    })
}
function editEnvironments() {
  router.push({name: 'settings', params: {setting: 'environments'}})

}
</script>

<style lang="scss" scoped>
.banner {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 10px;
  box-sizing: border-box;
  box-shadow: 0 0 10px 0 rgba(0,0,0,0.5);
  position: relative;
  z-index: 10;
}
.select {
  padding: 0;
  :deep(.p-select-label) {
    padding: 0 10px;
  }
}
.reload-modal {
  width: 100vw;
  height: 100vh;
  position: fixed;
  top: 0;
  left: 0;
  z-index: 10000;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  backdrop-filter: blur(10px);
  color: #0076bc;
  background-color: rgba(255,255,255,0.5);
}
.line {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%;
}
</style>
</file>

<file path="fronts/app/src/components/Modal.vue">
<template>
<teleport to="body">
  <transition name="fade">
    <div  v-if="isOpen" class="modal-root" @click="noGlobalClose ? '' : close()" :class="{right: position==='right'}">
      <div :name="uuid" height="auto" :style="{width:width || '90%'}" :scrollable="noScroll ? !noScroll : true" class="modal" @closed="cancel()" @click.stop>
        <div id="modal-content" :style="{height: height || 'auto', maxHeight}">
          <div class="close-cross" v-if="closeCross" @click="close()">
            <i class="fas fa-times" aria-hidden="true"></i>
          </div>
          <div class="title-modal" v-if="$slots.header" :style="{'font-size': headerFontSize}">
            <slot name="header" :data="data"></slot>
          </div>
          <div class="body">
            <slot name="body" :data="data"></slot>
          </div>
          <div class="button-box" v-if="!noActions">
            <button class="notif-button cancel" v-if="!noCancel" @click="cancel()">{{ cancelString || 'Annuler' }}</button>
            <button class="notif-button validate" :disabled="disabled" :class="{colored}" v-if="!noValidate" @click="validate()">{{ validateString || 'Sauvegarder' }}</button>
          </div>
        </div>
      </div>
    </div>
  </transition>
</teleport>
</template>

<script>
import Subject from '../helpers/CustomObservable'
import { v4 as uuid } from 'uuid';
export default {
  props: [
    'value',
    'width',
    'height',
    'maxHeight',
    'cancelString',
    'validateString',
    'noGlobalClose',
    'noActions',
    'closeCross',
    'noScroll',
    'headerFontSize',
    'noCancel',
    'noValidate',
    'colored',
    'disabled',
    'position'
  ],
  data() {
    return {
      /** @type {((...args: any[]) => any) | null} */
      resolve: null,
      /** @type {Subject & {promise: Promise} | null} */
      result: null,
      uuid: uuid(),
      data: null,
      isOpen: false
    }
  },
  watch: {
    value(newVal) {
      this.data = newVal
    }
  },
  beforeUnmount() {
    this.close(null)
  },
  methods: {
    cancel() {
      this.close(null)
    },
    validate() {
      if(!this.disabled) {
        this.close(this.value || true)
      }
    },
    /** @param {*} data */
    close(data = null) {
      this.isOpen = false
      if (this.result) {
        this.result.next(data)
        // this.result.unsubscribe()
        this.result = null
      }
      if(this.resolve) {
        this.result = null
        this.resolve(data)
      }
    },
    /** 
     * @param {*} data
     * @return {Subject & {promise: Promise}}
     */
    open(data = null) {
      this.isOpen = true
      this.data = data
      // @ts-ignore
      this.result = new Subject()
      // @ts-ignore
      this.result.promise = new Promise((resolve) => {
        this.resolve = resolve
      });
      // @ts-ignore
      return this.result
    }
  }
}
</script>
<style scoped lang="scss">
.modal-root {
  color: var(--system-secondary-color);
  z-index: 1299;
  position: fixed;
  top: 0;
  left: 0;
  background: rgba(0,0,0,0.5);
  width: 100vw;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  transition: 300ms;
  #modal-content {
    max-height: 90vh;
    background: var(--system-backgroundColor);
    height: auto;
    margin: auto;
    display: flex;
    flex-direction: column;
    .close-cross {
      position: absolute;
      right: 20px;
      top: 10px;
      color: #8a8a8a;
      width: 20px;
      height: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      transition-duration: 500ms;
      cursor: pointer;
      i {
        font-size: 15px;
      }
      &:hover {
        background-color: #959595;
        color: white;
        border-radius: 100%;
      }
    }

    .title-modal {
      font-size: 1.5rem;
      padding: 20px;
      padding-bottom: 0;
      font-weight: bold;
    }
    .body {
      display: flex;
      flex-direction: column;
      width: 100%;
      padding: 20px;
      overflow: auto;
    }
    .subtitle {
      font-size: 24px;
      padding-left: 20px;
      font-weight: bold;
    }
  }
  &.right {
    justify-content: flex-end;
    #modal-content {
      height: 100vh !important;
      display: flex;
      flex-direction: column;
      .body {
        flex-grow: 1;
      }
    }
  }
}

.button-box {
  display: flex;
  .notif-button {
    background: none;
    color: var(--system-secondary-color);
    font-size: 18px;
    padding: 12px 0px 12px 0px;
    background-color: var(--system-secondary-backgroundColor);
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    cursor: pointer;
    transition: 300ms;
    &.colored {
      background-color: #26928e;
      color: white;
    }
    &[disabled] {
      border: none;
      color: #999;
      background-color: #bbb;
    }
    &:hover {
      background-color: #d1d1d1;
      &.colored {
        background-color: #267774;
        color: white;
      }
    }
  }
}

.fade-enter-active,.fade-leave-active {
  transition: all 0.3s ease-out;
}

.fade-enter-from,
.fade-leave-to {
  opacity: 0;
  transform: translate(10px);
}
.fade-enter-active {
  top: 0;
  width: 100%;
}
</style>
</file>

<file path="fronts/app/src/components/sidebarItem.vue">
<template>
  <div @click="goToService(service)"
    class="sidebar-item"
    :class="{active: isActive, disabled: !service.enabled, crashed: service.crashed}">
      <span>
        <template v-if="service.crashed"><i class="fas fa-exclamation"></i></template>
        <template v-else-if="service.enabled && !service.exited"><i class="fas fa-heartbeat success"></i></template>
        <template v-else-if="service.exited"><i class="fas fa-times warning"></i> </template>
        <template v-else><i class="fas fa-square"></i></template>
        {{service.label}}
      </span>
      <i class="fas fa-chevron-right hover"  aria-hidden="true"></i>
  </div>
</template>

<script setup>
import { computed } from 'vue';
import { useRouter } from 'vue-router';
const router = useRouter()

const props = defineProps({
  service: {
    /** @type {import('../models/service').default | null} */
    default: null
  }
})
const isActive = computed(() => {
  const url = router.currentRoute.value.fullPath.split('?')[0]
  const serviceLabel = url.split('/').filter(a => a).pop()
  return props.service?.label ? encodeURIComponent(props.service.label) === serviceLabel : false
})
/** @param {import('../models/service').default} service */
function goToService(service) {
  localStorage.setItem('last-service-visisted', service.label || '')
  router.push({name: 'stack-single', params: {label: service.label}})
}
</script>

<style lang="scss" scoped>
.sidebar-item {
  cursor: pointer;
  transform: translateZ(0);
  transition: background-color 300ms;
  padding: 5px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-left: 5px solid transparent; 
  span {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  i {
    width: 15px;
    text-align: center;
  }
  i.hover {
    opacity: 0;
    transition: 300ms
  }
  &:hover {
    background-color: var(--system-secondary-backgroundColor);
    i {
      opacity: 1;
    }
  }
  &.active {
    font-weight: bold;
    border-left: 5px solid var(--system-accent-backgroundColor1)
  }
  &.disabled {
    color: var(--system-tertiary-color);
  }
  &.crashed {
    color: red;
  }

  .warning {
    color: orange;
  }
  .success {
    color: green;
  }
}
</style>
</file>

<file path="fronts/app/src/components/TableGeneric.vue">
<template>
<div class="table-root">
  <div class="table-wrapper" ref="tableWrapperRef" @scroll="scroll" :class="{scroll: isScrolling, center, noBorder, noHover}" :style="{maxHeight: height}">
    <table :class="{['table-group-by']: !Array.isArray(computedList) && computedList.type ==='groupBy'}">
      <caption>Table</caption>
      <thead v-if="!noHeader">
        <tr>
          <th v-for="header of computedHeaders" :key="'th-' + header.id" :id="header.id" :style="{width: header.width ? header.width : ''}">
            <div class="header">
              <div class="sort-container" @click="changeSort(header)" v-if="header.label && !header.disableSort">
                <i class="fas fa-sort-up" :class="{active: header.sortByAsc}" aria-hidden="true"></i>
                <i class="fas fa-sort-down" :class="{active: header.sortByDesc}" aria-hidden="true"></i>
              </div>
              {{header.label}}
            </div>
            <slot :name="'header-' + header.id"></slot>
          </th>
        </tr>
      </thead>
      <div v-if="loading" class="spinner">
        <spinner/>
      </div>
      <tbody v-else-if="noElements">
        <tr>
          <td :colspan="computedHeaders.length">
            <slot name="fallback">Aucun élément à afficher</slot >
          </td>
        </tr>
      </tbody>
      <tbody v-else-if="noElementsFilter">
        <tr>
          <td :colspan="computedHeaders.length">
            <slot name="fallbackFilter">Aucun élément à afficher pour ce filtre</slot >
          </td>
        </tr>
      </tbody>
      <tbody v-else-if="develop" >
        <template v-for="(row, i) of computedList" :key="'rows-' + i">
          <tr>
            <td v-for="(header, i) of computedHeaders" :key="i +'-td-' + header.id" :style="{width: header.width ? header.width : ''}"
              @click="click(row, header, row[header.id])">
              <slot :name="header.id" :item="row[header.id]" :row="row">
                {{row[header.id]}}
              </slot>
            </td>
          </tr>
          <transition name="develop-row">
          <tr v-if="openRows.includes(row)" class="develop-row">
            <td :colspan="computedHeaders.length">
              <slot name="develop" :row="row"></slot>
            </td>
          </tr>
          </transition>
        </template>
      </tbody>
      <tbody v-else-if="Array.isArray(computedList)">
        <tr v-for="(row, rowIndex) of computedList" :key="`row-${rowIndex}`">
          <td v-for="(header, i) of computedHeaders" :key="i +'-td-' + header.id" :style="{width: header.width ? header.width : ''}"
            @click="click(row, header, row[header.id])">
            <slot :name="header.id" :item="row[header.id]" :row="row" :index="i">
              {{row[header.id]}}
            </slot>
          </td>
        </tr>
      </tbody>
      <tbody v-else>
        <template v-for="(row, i) of computedList.rows" :key="'rows-' + i">
          <tr v-if="row.tableLetter" class="letter">
            <td><div>{{row.label}}</div></td>
          </tr>
          <tr v-else>
            <td v-for="(header, i) of computedHeaders" :key="i +'-td-' + header.id" :style="{width: header.width ? header.width : ''}"
              @click="click(row, header, row[header.id])">
              <slot :name="header.id" :item="row[header.id]" :row="row">
                {{row[header.id]}}
              </slot>
            </td>
          </tr>
        </template>
      </tbody>
    </table>
  </div>
  <div class="pagination" v-if="(computedList?.length || computedList?.rows?.length) && nbTotalPagination && nbTotalPagination !== 1 && !lazy">
    <button @click="previousPage" v-if="offset"><i class="fas fa-chevron-left"></i></button>
    <button>{{offset + 1}} sur {{nbTotalPagination}}</button>
    <button @click="nextPage" v-if="offset + 1 < nbTotalPagination"><i class="fas fa-chevron-right"></i></button>
  </div>
</div>
</template>

<script>

/**
 * @example :header="[
 *     {id: 'img', label: ''},
 *     {id: 'name', label: 'Name', customSortValue: (name)=> name.toUpperCase()},
 *     {id: 'date', label: 'Date', customValue: (val)=> dayjs(val).format('L')},
 * ]"
 * 
 * @example Async
 *  <table-generic :asyncValue="getProductByPage"/>
 * async function getProductsByPage({offset,maxPerPage,sortDirection,sortProperty,filterValue}) {
 *    const array = await sever.get(`/product?sortDirection=${sortDirection}&sortProperty=${sortProperty}........`) 
 *    return array
 * }
 */

import {computed, ref, onMounted, reactive, watch} from "vue"
import {sort} from "fast-sort"
import dotObject from "dot-object"
import { cloneDeep, groupBy } from 'lodash-es'
import dayjs from 'dayjs'
import Spinner from './Spinner.vue'
import debounce from 'debounce'
export default {
  components: {Spinner},
  props: {
    value: {default: () => ([]), type: Array},
    asyncValue: {default: null, type: Function},
    headers: {default: () => ([]), type: Array},
    defaultSortProperty: {default: '', type: String},
    defaultSortDirection: {default: 'asc', type: String},
    showGroups: {default: false, type: Boolean},
    height: {default: '', type: String},
    filterValue: {default: '', type: String},
    filterSchema: {default: () => ({}), type: Object},
    center: {default: false, type: Boolean},
    develop: {default: false, type: Boolean},
    noHeader: {default: false, type: Boolean},
    noHover: {default: false, type: Boolean},
    maxPerPage: {default: 0, type: Number},
    totalRows: {default: 0, type: Number},
    noBorder: {default: false, type: Boolean},
    customGroupByValue: {default: null, type: Function},
    customGroupByLabel: {default: null, type: String},
    lazy: {default: false, type: Boolean}
  },
  setup(props, component) {
    const tableWrapperRef = ref()
    const loading = ref(false)
    const offset = ref(0)
    // Init list in async/sync way
    const asyncValue = ref([])
    const isAsync = ref(!!props.asyncValue)
    const list = computed(() => {
      return isAsync.value ? asyncValue.value : props.value
    })
    
    // Scroll behavior
    const nbPxToTriggerLoadingInLazyMode = 400
    const isScrolling = ref(false)
    const lazyLoad = debounce(() => {
        offset.value++
    }, 100)
    const scroll = (evt) => {
      isScrolling.value = evt.target.scrollTop !== 0
      const isEnd = evt.target.offsetHeight + evt.target.scrollTop >= evt.target.scrollHeight - nbPxToTriggerLoadingInLazyMode
      if(props.lazy && isEnd) {
        lazyLoad()
      }
    }

    // Sort behavior
    const sortProperty = ref('')
    const sortDirection = ref('asc')
    const changeSort = (header) => {
      if(sortProperty.value !== header.id) sortDirection.value = "asc"
      else {
        sortDirection.value = sortDirection.value === 'asc' ? 'desc' : 'asc'
      }
      sortProperty.value = header.id
    }

    // Headers beahavior
    const computedHeaders = computed(() => {
      const addSort = (header) =>  {
        header.sortByAsc = sortProperty.value === header.id && sortDirection.value === 'asc'
        header.sortByDesc = sortProperty.value === header.id && sortDirection.value === 'desc'
        return header
      }
      if(props.headers && props.headers.length) {
        return props.headers.map(header => {
          if(typeof header === 'string') return addSort({label: header, id: header})
          return addSort(header)
        })
      }
      const headersList = {}
      list.value.map(value => {
        if(value) Object.keys(value).forEach(key => headersList[key] = {label: key, id: key})
      })
      return Object.values(headersList).map(addSort)
    })
    onMounted(() => {
      sortProperty.value = props.defaultSortProperty || computedHeaders.value[0]?.id
      sortDirection.value = props.defaultSortDirection || 'asc'
    })
    
    // Computed visible lines
    const computedList = computed(() => {
      const customSort = computedHeaders.value.filter(header => header.id === sortProperty.value).pop()
      const sortFunction = (val) => {
        return customSort && customSort.customSortValue 
          ? customSort.customSortValue(val[sortProperty.value])
          : val[sortProperty.value]
      }
      const headersById = computedHeaders.value.reduce((obj, header) => {
        obj[header.id] = header
        return obj
      }, {})

      // Transform values 
      const transform = (_row) => {
        const row = cloneDeep(_row)
        computedHeaders.value.forEach(({id}) => {
          const value = row[id]
          if(headersById[id] && headersById[id].customValue) {
            row[id] = headersById[id].customValue(value, row)
          } else {
            row[id] = value
          }
        })
        return row
      }

      // Group Behavior
      const groupByFunction = (row) => {
        if(props.customGroupByValue) return props.customGroupByValue(row[sortProperty.value])
        if(headersById[sortProperty.value] && headersById[sortProperty.value].customGroupByValue) {
          return headersById[sortProperty.value].customGroupByValue(row[sortProperty.value])
        } else if(typeof row[sortProperty.value] === 'string') {
          return row[sortProperty.value].toString().toUpperCase().substr(0, 1)
        } else {
          return row[sortProperty.value]
        }
      }
      const sortGroups = (groups) => {
        const keys = sortDirection.value === 'asc'
          ? sort(Object.keys(groups)).asc()
          : sort(Object.keys(groups)).desc()
        
        const rows = []
        keys.forEach(key => {
          const label = props.customGroupByLabel
            ? groups[key][0][props.customGroupByLabel]
            : key
          rows.push({tableLetter: true, label}, ...groups[key])
        })
        return {
          type: 'groupBy',
          rows
        }
      }

      const filterFunction = row => {
        return Object.keys(row).map(key => {
          if(typeof row[key] === 'string') {
            return props.filterValue 
              ? row[key]
              : row[key].toUpperCase().includes(props.filterValue.toUpperCase()) 
          } else if(typeof row[key] === 'number') {
            return props.filterValue
              ? row[key].toString()
              : row[key].toString().includes(props.filterValue) 
          } else {
            return false
          }
        }).some(prop => prop)
      }

      const sortedFilteredTransformedArray = sortDirection.value === 'asc'
        ? sort(list.value).asc(sortFunction).map(transform).filter(filterFunction)
        : sort(list.value).desc(sortFunction).map(transform).filter(filterFunction)

      const to = offset.value * props.maxPerPage +  props.maxPerPage
      const from = props.lazy ? 0 : offset.value * props.maxPerPage
      const slicedSortedFilteredTransformedArray = props.maxPerPage && !isAsync.value
        ? sortedFilteredTransformedArray.slice(from, to)
        : sortedFilteredTransformedArray

      return props.showGroups 
        ? sortGroups(groupBy(slicedSortedFilteredTransformedArray, groupByFunction))
        : slicedSortedFilteredTransformedArray
    })
    
    const openRows = reactive([])
    const isGroupByTable = computed(() => computedList.value?.type ==="groupBy")

    // Pagination data
    const nbTotalPagination = computed(() => {
      if(isAsync.value) return Math.ceil(props.totalRows / props.maxPerPage)
      const totalNumber = list.value?.length
      const currrentNumber = isGroupByTable.value
          ? computedList.value?.rows?.length
          : computedList.value?.length
      const page = Math.ceil(totalNumber / currrentNumber)
      return Number.isNaN(page) ? 0 : page
    })
    const formatDateIfNeeded = (value) => {
      if(/\d{2}\/\d{2}\/\d{4}/.test(props.filterValue) ) {
        value = dayjs(props.filterValue, 'DD/MM/YYYY').format('YYYY-MM-DD') 
      } else if(/\d{2}\/\d{4}/.test(props.filterValue) ) {
        value = dayjs(props.filterValue, 'MM/YYYY').format('YYYY-MM') 
      }
      return value
    }
    // Update async list  
    const loadAsyncValue = async() => {
      if(!props.asyncValue) return
      loading.value = true
      let filter = {}
      if (props.filterValue != '' && props.filterSchema) {
        const exclude = [ // All unwanted props (like dayjs)
          '.\\$L$',
          '.\\$u$',
          '.\\$d$',
          '.\\$x$',
          '.\\$y$',
          '.\\$M$',
          '.\\$D$',
          '.\\$W$',
          '.\\$H$',
          '.\\$m$',
          '.\\$s$',
          '.\\$ms$',
        ]
        const regex = new RegExp(exclude.join('|'))
        filter['$or'] =  Object
            .keys(dotObject.dot(props.filterSchema)) // Get all props from object
            .map(key => key.replace(regex, '')) // Remove all unwanted props
            .filter((item, pos, arr) => arr.indexOf(item) == pos) // Dedupe
            .map(key => {
              let value = props.filterValue
              value = formatDateIfNeeded(value)
              return { // Construct mongo query
                [key]: {
                  '$regex': value,
                  '$options': 'i' 
                }
              }
            })
      }
      const res = await props.asyncValue({
        offset: props.lazy ? 0 : offset.value * props.maxPerPage,
        maxPerPage: props.lazy ? offset.value * props.maxPerPage +  props.maxPerPage : props.maxPerPage,
        sort: {[sortProperty.value]: sortDirection.value === 'asc' ? 1 : -1},
        sortProperty: sortProperty.value,
        filter: filter
      }).finally(() => loading.value = false)
      if(!Array.isArray(res)) throw new Error('Async table return should be an array')
      asyncValue.value = res
    }
    const watcher = computed(() => [
      props.asyncValue,
      props.filterValue,
      offset.value,
      sortDirection.value,
      sortProperty.value,
    ])
    watch(() => watcher.value, loadAsyncValue)
    onMounted(loadAsyncValue)
    return {
      tableWrapperRef,
      loading,
      offset,
      nbTotalPagination,
      computedHeaders,
      computedList,
      scroll,
      isScrolling,
      changeSort,
      openRows,
      isGroupByTable,
      noElements:computed(() => {
        return isGroupByTable.value
          ? !computedList.value?.rows?.length && !props.filterValue
          : !computedList.value?.length && !props.filterValue
      }),
      noElementsFilter:computed(() => {
        return isGroupByTable.value
          ? !computedList.value?.rows?.length && props.filterValue
          : !computedList.value?.length && props.filterValue
      }),
      previousPage() {
        if(offset.value !==0) {
          offset.value--
          tableWrapperRef.value.scrollTop = 0
        }
      },
      nextPage() {
        offset.value++
        tableWrapperRef.value.scrollTop = 0
      },
      click(row, header, value) {
        if(props.develop) {
          openRows.includes(row)
            ? openRows.splice(openRows.indexOf(row), 1)
            : openRows.push(row)
        } else {
          component.emit('row-click', {row})
          component.emit('td-click', {row, header, value})
        }
      }
    }
  }
}
</script>

<style lang="scss" scoped>
.table-root {
  background-color: var(--system-sidebar-backgroundColor);
  color: var(--system-sidebar-color);

  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 0 10px 0 rgba(0,0,0,0.1);
  th, td {
    padding: 5px 5px;
    vertical-align: middle;
    font-size: 1em;
    word-break: break-word
  }
  th {
    text-align: left;
    z-index: 1;
    font-weight: normal;
    color: var(--system-sidebar-color);
    .header {
      display: flex;
    }
  }
  td {
    width:200px
  }
  tr {
    margin: 3px 0;
  }
  
  .center {
    th .header {
      justify-content: center;
    }
    td {
      text-align: center;
    }
  }
  thead {
    box-shadow: 0 0 10px 0 rgba(0,0,0,0.2);
    th {
      padding: 15px 5px;
      box-sizing: border-box;
    }
  }
  tbody tr:hover {
    background-color: rgba(0,0,0,0.05);
    cursor: pointer;
    transition: 300ms;
    border-radius: 20px;
  }
  .scroll thead th {
    box-shadow: 0 4px 11px -1px #d1d1d1;
    transition: 200ms;
  }
  .table-wrapper{
    overflow-y: auto;
    flex-grow: 1;
    height: 100%;
    position: relative;
  }
  .table-wrapper th{
      position: sticky;
      top: 0;
      background-color: var(--system-sidebar-backgroundColor);
      color: var(--system-sidebar-color);

  }
}
table {
  width: 100%;
  table-layout: fixed;
}
.table-group-by {
  th:first-of-type {
    z-index: 1;
    ::before {
      content: "";
      width: 40px;
      height: 100%;
      background-color: var(--system-sidebar-backgroundColor);
      color: var(--system-sidebar-color);
      position: absolute;
      left: 0;
      top: 0;
      z-index: -1;
      transform: translateX(-40px);
    }
  }
  .letter {
    height: 40px;
    display: flex;
    align-items: flex-end;
    &:hover {
      background-color: transparent;
    }
    &:first-of-type {
      height: 30px;
    }
    td {
      width: max-content;
      position: absolute;
      padding: 0;
    }
    div {
      background-color: var(--system-sidebar-backgroundColor);
      color: var(--system-sidebar-color);
      border: 1px solid #ddd;
      padding: 10px 12px;
      box-sizing: border-box;
      margin: 0 10px;
      display: flex;
      border-radius: 12px;
      justify-content: center;
      align-items: center;
    }
  }
}
.sort-container {
  position: relative;
  color: lightgrey;
  cursor: pointer;
  display: flex;
  justify-content: center;
  align-items: center;
  width:10px;
  margin-right: 5px;
  i {
    position: absolute;
  }
  .active {
    color: black;
  }
}
.pagination {
  display: flex;
  justify-content: center;
  margin-left: auto;
  margin-right: 0;
  margin-top: 15px;
  border: 1px solid lightgrey;
  width: max-content;
  border-radius: 4px;
  button {
    background-color: transparent;
    color: black;
    border: 0;
    border-radius: 4px;
  }
}
.noBorder {
  tr {
    td {
      border: none;
      &:first-child {border: none;}
      &:last-child {border: none;}
    }
  }
}
.spinner {
  height: 140px;
}
caption {
  display: none;
}
.noHover {
  tbody tr:hover {
    background-color: transparent;
  }
}
</style>
</file>

<file path="fronts/app/src/models/system.js">
import { reactive, ref } from 'vue';
import axios from '../helpers/axios';
const a = "fzmfzemfkzefmzek"
function System() {
  this.infos = reactive({
    cpu: 0,
    mem: 0,
  });
  this.globalInfos = reactive({
    nbCpus: 0,
    totalmem: 0,
    freemem: 0,
    memPercentage: 0,
    cpu: 0,
  });
  this.version = ref('0.0.0');
}
/** @param {string} serviceLabel */
System.prototype.getInfos = async function (serviceLabel) {
  const { data: infos } = await axios.get(`/system/${serviceLabel}/infos`);
  this.infos = infos;
  return this.infos;
};

System.prototype.proxyImg = function (url) {
  const baseUrl = axios.defaults.baseURL === '/'
    ? ''
    : axios.defaults.baseURL;
  return `${baseUrl}/system/proxy-img?url=${encodeURIComponent(url)}`;
};
System.prototype.getVersion = async function () {
  const { data: version } = await axios.get('/version');
  this.version.value = version;
  return this.version.value;
};
System.prototype.disconnect = async function () {
  return axios.get('/system/disconnect');
};
System.prototype.hasUpdate = async function () {
  const { data } = await axios.get('/stack/has-update');
  return data;
};
export default new System();
</file>

<file path="fronts/app/src/views/Settings.vue">
<template>
  <div class="stack-create-root">
    <Splitter style="height: 100%">
        <SplitterPanel :size="1" :style="{minWidth: '160px'}" class="leftPanel"> 
          <Tree :value="nodes" :selectionKeys="selectedKey" @update:selectionKeys="navigate" selectionMode="single" size="small" class="w-full md:w-[30rem]">
          </Tree>
        </SplitterPanel>
        <SplitterPanel :size="75" class="rightPanel">
          <div class="splitter-content" :class="{full: selectedKey['parsers']}">
            <Crypto v-if="selectedKey['crypto']"></Crypto>
            <Environments v-else-if="selectedKey['environments']"></Environments>
            <Parsers v-else-if="selectedKey['parsers']"></Parsers>
            <General v-else-if="selectedKey['general']"></General>
            <Notifications v-else-if="selectedKey['notifications']"></Notifications>
          </div>
        </SplitterPanel>
    </Splitter>
  </div>
</template>

<script setup>
import Environments from './settings/Environments.vue';
import Crypto from './settings/Crypto.vue';
import Notifications from './settings/Notifications.vue';
import General from './settings/General.vue';
import Parsers from './settings/Parsers.vue';
import { computed, onMounted, ref, watch } from 'vue';
import Splitter from 'primevue/splitter';
import SplitterPanel from 'primevue/splitterpanel';
import Tree from 'primevue/tree';
import { useRouter } from 'vue-router';
let selectedKey = ref({})
const router = useRouter()
watch(() => router.currentRoute.value, () => {
  selectedKey.value = {[router.currentRoute.value.params.setting?.toString()]: true}
}, {deep: true})
onMounted(() => {
  const tab = router.currentRoute.value.params.setting
  selectedKey
  if(tab) selectedKey.value = {[tab?.toString()]: true}
  if(!Object.keys(selectedKey.value).length) selectedKey.value = {[nodes.value[0].key]: true}
})

function navigate(res) {
  router.push({name: 'settings', params: {setting: Object.keys(res)[0]}})
}

const nodes = computed(() => ([
   {
    key: 'general',
    label: 'General',
    icon: 'fas fa-home',
  },
  {
    key: 'crypto',
    label: 'Security',
    icon: 'fas fa-shield-halved',
  },
  {
    key: 'environments',
    label: 'Environments',
    icon: 'fas fa-home',
  },
  {
    key: 'parsers',
    label: 'Parsers',
    icon: 'fas fa-scroll',
  },
  {
    key: 'notifications',
    label: 'Notifications',
    icon: 'fas fa-bell',
  },
]));

</script>

<style lang="scss" scoped>
  .stack-create-root {
    display: flex;
    flex-direction: column;
    gap: 20px;
    width: 100%;
  }
  .rightPanel {
    padding: 10px;
    display: flex;
    justify-content: center;
    overflow: auto;
  }
  .leftPanel {
    background-color: var(--p-content-background);
  }
  ::v-deep {
    .p-splitter {
      background-color: transparent;
      border: none;
      .p-tree-node-toggle-button {
        display: none;
      }
      .p-splitterpanel {}
    }
  }
  .splitter-content {
    width: 100%;
    max-width: 800px;
    &.full {
      max-width: inherit
    }
  }
</style>
</file>

<file path="modules/bugs/backend/index.js">
const { existsSync } = require('fs');
const pathfs = require('path');

/** @type {import('@runeya/modules-plugins-loader-front/src/views').PluginSM<null>} */
const plugin = {
  enabled: true,
  name: 'Bugs',
  displayName: 'Bugs',
  description: 'Find bugs across a whole javascript project',
  icon: 'fas fa-bug',
  placements: ['service'],
  order: 4,
  export: null,
  hidden: async (service) => {
    if (!service) return true;
    const npm = new service.Stack.npm(service)
    const serviceIsNpm = !!npm.getNpmPaths(service);
    return !serviceIsNpm;
  },
  routes: require('./routes'),
};
module.exports = plugin;
</file>

<file path="modules/bugs/front/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.0.15](https://github.com/runeya/runeya/compare/v2.0.14...v2.0.15) (2025-01-24)

### Bug Fixes

* **Bugs:** support for new command selector ([afd2815](https://github.com/runeya/runeya/commit/afd2815b8c7cf3dd01e5f9408174000e8913996b))

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-bugs-front

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

### Bug Fixes

* cosmetic changes ([a18735e](https://github.com/runeya/runeya/commit/a18735e5b5cec706f3cdf4c4f4ca22482ce7ea0f))

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

### Bug Fixes

* link front to backend deps ([66b3135](https://github.com/runeya/runeya/commit/66b313523d99765b692208de0043303dcb6a0914))
* link front to backend deps ([54fcbf3](https://github.com/runeya/runeya/commit/54fcbf371cf03dc4f51a7196de15fe5d352088e9))

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-bugs-front

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/dev-ops/front/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-dev-ops-front

## [1.18.2](https://github.com/runeya/runeya/compare/v1.18.1...v1.18.2) (2024-02-24)

### Bug Fixes

* **front:** cosmetic changes ([ff9b282](https://github.com/runeya/runeya/commit/ff9b2821de658eae571a1da4407ec0651a102e15))

## [1.17.29](https://github.com/runeya/runeya/compare/v1.17.28...v1.17.29) (2024-02-15)

### Bug Fixes

* **theme:** add black theme ([bee4697](https://github.com/runeya/runeya/commit/bee469731be182ac929298dc13fe1c230eccb7ba))

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

### Bug Fixes

* **server:** resolve dependencies ([7a15ef0](https://github.com/runeya/runeya/commit/7a15ef01ba9946fb2662c0f15a6da758f0c40280))

## [1.17.24](https://github.com/runeya/runeya/compare/v1.17.23...v1.17.24) (2024-02-11)

### Bug Fixes

* link front to backend deps ([351abfd](https://github.com/runeya/runeya/commit/351abfd8f8cde96bce80d5202a78dd1daabbf6bb))

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

### Bug Fixes

* link front to backend deps ([66b3135](https://github.com/runeya/runeya/commit/66b313523d99765b692208de0043303dcb6a0914))
* link front to backend deps ([54fcbf3](https://github.com/runeya/runeya/commit/54fcbf371cf03dc4f51a7196de15fe5d352088e9))

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-dev-ops-front

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/diff/front/package.json">
{
  "name": "@runeya/modules-diff-front",
  "version": "2.0.5",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "vue-eslint-parser": "^9.4.2"
  }
}
</file>

<file path="modules/docker/backend/index.js">
/** @type {import('@runeya/modules-plugins-loader-front/src/views').PluginSM<null>} */
const plugin = {
  enabled: true,
  name: 'Docker',
  displayName: 'Docker',
  description: 'Show docker configs',
  icon: 'fab fa-docker',
  export: null,
  placements: ['service'],
  order: 4,
  /** @param {import('../../../servers/server/models/Service') | null} service */
  hidden: async (service) => {
    if (!service?.container) return true;
    return !service.container.enabled;
  },
  routes: require('./routes'),
};
module.exports = plugin;
</file>

<file path="modules/docker/front/src/Index.vue">
<template>
  <section-cmp v-if="service" :key="service.label">
    <h2>Docker</h2>
    <ul>
      <li v-for="info of infos">
        <div class="label">{{labelTrad[info.label] || info.label}}</div>
        <div class="value">
          <JsonTreeView v-if="info.type === 'json'" class="json" :maxDepth="1" :json="stringifiedJSON(info.value)" :copyable="true"/>
          <div v-else>
            {{ info.value }}
          </div>
        </div>
      </li>
    </ul>
  </section-cmp>
</template>

<script setup>
import { onMounted, onUnmounted, ref } from 'vue';
import { JsonTreeView } from 'json-tree-view-vue3';
import Service from '../../../../fronts/app/src/models/service';
import SectionCmp from '../../../../fronts/app/src/components/Section.vue';
import axios from '../../../../fronts/app/src/helpers/axios';
import Socket from '../../../../fronts/app/src/helpers/Socket';

const labelTrad = {
  containerName: 'Name of container',
  isAlive: 'Is Alive',
  pid: 'PID',
  image: 'Image',
  dockerInfos: 'More infos',
};

const props = defineProps({
  service: {
    default: null,
    required: true,
    type: Service,
  },
});
const infos = ref([]);

const stringifiedJSON = (json) => {
  try {
    return JSON.stringify(json);
  } catch (error) {
    return '{}';
  }
};

async function reload() {
  const { data: _infos } = await axios.get(`/docker/${props.service.label}`);
  infos.value = _infos;
}
onMounted(reload);

Socket?.on('stack:selectConf', reload);
Socket?.on('service:crash', reload);
Socket?.on('service:start', reload);
Socket?.on('service:exit', reload);
Socket?.on('service:healthcheck:down', reload);
Socket?.on('service:healthcheck:up', reload);

onUnmounted(() => {
  Socket?.off('stack:selectConf', reload);
  Socket?.off('service:crash', reload);
  Socket?.off('service:start', reload);
  Socket?.off('service:exit', reload);
  Socket?.off('service:healthcheck:down', reload);
  Socket?.off('service:healthcheck:up', reload);
});

</script>
<style lang="scss" scoped>
h2 {
  margin: 0;
}
li {
  display: flex;
  .label {
    width: 300px;
    flex-shrink: 0;
  }
  &:nth-child(odd) {
    background-color: rgba(0,0,0,0.05);
  }
  .json {
    margin: 0;
    padding: 0;
  }
}
</style>
</file>

<file path="modules/documentation/backend/index.js">
const { readFile } = require('fs/promises');
const PromiseB = require('bluebird');
const pathfs = require('path');
const Documentation = require('./Documentation');

/** @type {import('@runeya/modules-plugins-loader-front/src/views').PluginSM<import('./Documentation')>} */
const plugin = {
  enabled: true,
  name: 'Documentation',
  displayName: 'Documentation',
  description: 'Read documentation for a given service',
  icon: 'fas fa-book',
  // export: Documentation,
  placements: ['service'],
  order: 6,
  routes: require('./routes'),
  finder: async (search, runeya) => {
    // const services = runeya.getServices()?.filter((/** @type {any} */s) => s.documentation);
    // const servicesFiles = (await PromiseB.map(services, async (service) => {
    //   const files = await runeya.documentation.getFlatFiles('.', service.documentation);
    //   return PromiseB.filter(files, (leaf) => !leaf.isDir)?.map(async (path) => {
    //     const content = path.path && await readFile(pathfs.resolve(service.documentation, path.path), { encoding: 'utf-8' }).catch(console.error);
    //     return { service, path, content };
    //   }) || [];
    // })).flat()
    //   .filter((file) => runeya.helpers.searchString(file.path?.name || '', search) || runeya.helpers.searchString(file.content || '', search));
    // return [
    //   ...servicesFiles.map((file) => ({
    //     icon: 'fas fa-book',
    //     title: file.path.name || '',
    //     group: 'Documentation',
    //     description: `Read documentation for ${file.service.label}`,
    //     secondaryTitle: file.service.label,
    //     url: { path: `/stack-single/${encodeURIComponent(file.service.label)}`, query: { tab: 'Documentation', leaf: file.path.path } },
    //   })),
    // ];
  },
};
module.exports = plugin;

/**
 * @typedef {{
 *  id: string,
 *  name: string,
 *  isDir: boolean,
 *  path: string,
 *  ext: string,
 *  opened: boolean,
 *  children:Leaf[] | null
 * }} Leaf
 */
</file>

<file path="modules/documentation/front/src/Index.vue">
<template>
  <section-cmp
    class="configs-root"
    :key="service?.label || 'global'">
    <div class="header">
      <h2>Documentation</h2>
    </div>
    <Splitter style="height: 100%">
      <SplitterPanel :size="1" :style="{minWidth: '160px'}" class="leftPanel"> 
          <Tree :value="tree" class="w-full md:w-[30rem] treeLeft" v-if="tree.length" :key="resync">
            <template #default="slot">
              <div class="line" :class="{active: slot.node?.id === currentNode?.id}">
                <Leaf :key="slot.node.id" :node="slot.node" @select="select(slot.node)" :tree="tree" @updateDoc="updateDoc($event)" @deleteDoc="deleteDoc($event)"/>
              </div>
            </template>
            <template #url="slotProps">
              <a :href="slotProps.node.data">{{ slotProps.node.label }}</a>
            </template>
        </Tree>
        <div>
          <button :style="{width: '100%'}" class="button-add" @click="addNewDoc"><i class="fas fa-plus" /></button>
        </div>
      </SplitterPanel>
      <SplitterPanel :size="75" class="rightPanel">
        <template v-if="currentNode">
          <Markdown v-model="currentNode.text" @update:modelValue="updateDoc(currentNode)"></Markdown>
        </template>
      </SplitterPanel>
    </Splitter>
  </section-cmp>
</template>

<script setup>
import { onMounted, ref } from 'vue';
import axios from '../../../../fronts/app/src/helpers/axios';
import Service from '../../../../fronts/app/src/models/service';
import SectionCmp from '../../../../fronts/app/src/components/Section.vue';
import {v4} from 'uuid'
import Tree from 'primevue/tree';
import Leaf from './Leaf.vue';
import Markdown from '../../../../fronts/app/src/components/Markdown.vue';
import Splitter from 'primevue/splitter';
import SplitterPanel from 'primevue/splitterpanel';
import {Plugins, Sortable} from '@shopify/draggable';


const props = defineProps({
  service: {
    default: null,
    type: Service,
  },
});
const tree = ref([])
const currentNode = ref()
const resync = ref(0)

let sortable
const sort = async ({data: {oldIndex, newIndex}}) => {
  if(oldIndex === newIndex) return
  const element  = tree.value.splice(oldIndex, 1)[0]
  tree.value.splice(newIndex, 0, element)
  const {data: _tree} = await axios.post('/documentation/tree/sort', tree.value)
  await reload()
}

async function reload() {
  const {data: _tree} = await axios.get('/documentation/tree', {
    params: {
      serviceId: props.service?.label
    }
  })
  if(_tree) tree.value = (_tree||[]).sort((a, b) => a.position - b.position)
  if(!currentNode.value) currentNode.value = tree.value[0]
  await enableSorting()
  resync.value++
}
onMounted(reload)

let enablingInProgress = false
async function enableSorting() {
  if(enablingInProgress) return
  enablingInProgress = true
  sortable?.destroy() 
  setTimeout(() => {
    sortable = new Sortable(document.querySelectorAll('.p-tree-root-children'), {
      delay: 200,
      draggable: '.p-tree-node-leaf',
      sortAnimation: {
        duration: 200,
        easingFunction: 'ease-in-out',
      },
      plugins: [Plugins.SortAnimation],
    })
    sortable.on('sortable:stop', sort)
    enablingInProgress = false
  }, 0);
}

async function addNewDoc() {
  const {data: _tree} = await axios.post('/documentation/tree', {
    key: v4(),
    serviceId: props.service?.label,
    label: 'New doc...',
    position: tree.value.length
  })
  reload()
  select(tree.value.find(t => t.id === _tree.id))
} 

async function updateDoc(doc) {
  const {data: _tree} = await axios.post(`/documentation/tree/${doc.id}`, doc)
  reload()
} 

async function deleteDoc(doc) {
  const {data: _tree} = await axios.delete(`/documentation/tree/${doc.id}`, doc)
  reload()
} 


// watch(() => currentNode.value, async() => {
//   currentDocument.value = await axios.get(`/documentation/services/${props.service.label}/${currentNode.value.key}`)
// })


function select(node) {
  currentNode.value = node
}
/**
 * @typedef {import('../../backend/index').Leaf} Leaf
 */
</script>
<style lang="scss" scoped>
h2 {
  margin-top: 0;
}
.tree {
  width: 200px;
}
.container {
  display: flex;
  flex-direction: column;
  overflow: auto;
  button {
    width: max-content;
  }
}
.leftPanel {
  display: flex;
  flex-direction: column;
  height: 100%;
  overflow-y: auto;
}
.markdown {
  border-radius: 10px;
  padding: 0 10px;
  box-sizing: border-box;
  height: 100%;
  overflow: auto;
  flex-grow: 1;
  &::v-deep {
    ul {
      li {
        margin-left: 20px;
        list-style: disc;
      }
    }
  }
}
.line {
  position: relative;

  display: flex;
  transition: 300ms;
  padding: 10px;
  &.active {
    background-color:var(--system-accent-backgroundColor1);
    color:white;
  }
}
.p-tree {
  padding: 0;
}
::v-deep {
  .p-tree-node-content {
    padding: 0;
  }
  .p-tree-node-toggle-button {
    display: none;
  }
  .p-tree-node-label {
    flex-grow: 1;
    overflow: hidden;
  }
  .p-tree-node-children {
    padding: 0 30px
  }
}
.button-add {
  flex-grow: 1;
}
</style>
</file>

<file path="modules/documentation/front/src/Leaf.vue">
<template>
  <div class="leaf-root" @click.stop="$emit('select')">
    <input v-model="node.label" v-if="edit" @change="emitEdit()" @blur="emitEdit()"/>
    <div v-else>{{ node.label }}</div>
    <div class="actions" v-if="!edit">
      <i class="fas fa-edit" @click.stop="edit = true"></i>
      <!-- <i class="fas fa-plus" @click="addChild(node)"></i> -->
      <i class="fas fa-trash" @click.stop="$emit('deleteDoc', node)"></i>
    </div>
  </div>
</template>

<script setup>
import { ref, defineProps } from 'vue';
import axios from '../../../../fronts/app/src/helpers/axios';
import Service from '../../../../fronts/app/src/models/service'

const edit = ref(false)
const props = defineProps({
  node: {
    /**@type {import('primevue/treenode').TreeNode} */
    default: {key: ''}
  },
  service: {
    type: Service,
  },
  tree: {
    /**@type {import('primevue/treenode').TreeNode[]} */
    default: []
  }
})

const emit = defineEmits(['updateDoc'])

async function emitEdit() {
  edit.value = false
  emit('updateDoc', props.node)
}
async function addChild(node) {
  if(!node.children) node.children = []
  await axios.post('/documentations/services/') 
}

function walkthrough(children, cb) {
  children.forEach(node => {
    cb({node, parent: children})
    if(node.children) walkthrough(node.children, cb)
  });

}
function deleteChild(_node) {
  
}
</script>

<style lang="scss" scoped>

.leaf-root {
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  width: 100%;
  input {
    width: 100%
  }
  .actions {
    position: absolute;
    opacity: 0;
    transition: 300ms;
    display: flex;
    height: 100%;
    align-items: center;
    padding: 0 10px;
    gap: 10px;
    background-color: var(--system-accent-backgroundColor2);
    color: white;
    right: -100%;
  }
  &:hover {
    .actions {
      opacity: 1;
      right: 0;
      cursor: pointer;
    }
  }
}
</style>
</file>

<file path="modules/finder/front/package.json">
{
  "name": "@runeya/modules-finder-front",
  "version": "2.0.5",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "vue": "^3.4.18",
    "vue-eslint-parser": "^9.4.2",
    "vue-router": "^4.2.5"
  }
}
</file>

<file path="modules/github/front/package.json">
{
  "name": "@runeya/modules-github-front",
  "version": "2.0.5",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "vue": "^3.4.18",
    "vue-eslint-parser": "^9.4.2"
  }
}
</file>

<file path="modules/help/front/package.json">
{
  "name": "@runeya/modules-help-front",
  "version": "2.0.5",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "vue-eslint-parser": "^9.4.2"
  }
}
</file>

<file path="modules/json-formatter/front/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-json-formatter-front

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

### Bug Fixes

* improve performance + add jsoncrack view ([c534a97](https://github.com/runeya/runeya/commit/c534a9749162f5f15589ec335da149656c757bfb))

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

### Bug Fixes

* link front to backend deps ([66b3135](https://github.com/runeya/runeya/commit/66b313523d99765b692208de0043303dcb6a0914))
* link front to backend deps ([54fcbf3](https://github.com/runeya/runeya/commit/54fcbf371cf03dc4f51a7196de15fe5d352088e9))

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-json-formatter-front

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/jwt/front/package.json">
{
  "name": "@runeya/modules-jwt-front",
  "version": "2.0.5",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "json-tree-view-vue3": "^1.0.1",
    "vue": "^3.4.18",
    "vue-eslint-parser": "^9.4.2"
  }
}
</file>

<file path="modules/kanban/front/package.json">
{
  "name": "@runeya/modules-kanban-front",
  "version": "2.0.5",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "vue": "^3.4.18",
    "vue-eslint-parser": "^9.4.2",
    "vue-router": "^4.2.5",
    "vuedraggable": "^4.1.0"
  }
}
</file>

<file path="modules/mongo/front/package.json">
{
  "name": "@runeya/modules-mongo-front",
  "version": "2.0.5",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "dayjs": "^1.11.10",
    "vue": "^3.4.18",
    "vue-eslint-parser": "^9.4.2"
  }
}
</file>

<file path="modules/node-repl/front/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-node-repl-front

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

### Bug Fixes

* improve performance + add jsoncrack view ([c534a97](https://github.com/runeya/runeya/commit/c534a9749162f5f15589ec335da149656c757bfb))

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

### Bug Fixes

* various changes ([06e6241](https://github.com/runeya/runeya/commit/06e624176595b95c4227fe684242919c7eeda192))

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

### Bug Fixes

* link front to backend deps ([66b3135](https://github.com/runeya/runeya/commit/66b313523d99765b692208de0043303dcb6a0914))
* link front to backend deps ([54fcbf3](https://github.com/runeya/runeya/commit/54fcbf371cf03dc4f51a7196de15fe5d352088e9))

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-node-repl-front

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/npm/backend/index.js">
const Npm = require('./Npm');

/** @type {import('@runeya/modules-plugins-loader-front/src/views').PluginSM<import('./Npm')>} */
const plugin = {
  enabled: true,
  name: 'Npm',
  displayName: 'Npm',
  description: 'View your dependencies and execute your scripts on a service',
  icon: 'fab fa-npm',
  export: Npm,
  placements: ['service'],
  order: 4,
  /**
   *
   * @param {import('../../../servers/server/models/Service')} service
   * @returns
   */
  hidden: async (service) => {
    if (!service) return false;
    const project = new Npm(service);
    const serviceIsNpm = !!project.getNpmPaths().length;
    return !serviceIsNpm;
  },
  routes: require('./routes'),
};
module.exports = plugin;

/**
 * @typedef {Record<string, {
 *   "current": string,
 *   "wanted": string,
 *   "latest": string,
 *   "dependent": string,
 *   "location": string,
 * }>} Outdated
 */
</file>

<file path="modules/npm/backend/Npm.js">
const pathfs = require('path');
const { execAsync } = require('@runeya/servers-server/helpers/exec');
const { readFile } = require('fs/promises');
const { replaceEnvs } = require('../../../servers/server/helpers/stringTransformer.helper');
const { existsSync } = require('fs');

class Npm {
  /** @param {import('@runeya/servers-server/models/Service')} service */
  constructor(service) {
    this.service = service;
  }

  async isNpm(path) {
    if (path) {
      return existsSync(pathfs.resolve(path?.toString(), 'package.json'));
    }
    return null;
  }

  getNpmPaths() {
    return [
      ...this.service.commands
        .filter(cmd => cmd.spawnOptions.cwd?.toString()?.trim() && cmd.spawnOptions.cwd !== '.')
        .map(cmd => replaceEnvs(cmd.spawnOptions.cwd)),
      this.service.getRootPath(),
    ].filter(cwd => this.isNpm(cwd))
  }

  async packageJSON(path) {
    if (path) {
      return JSON.parse(await readFile(pathfs.resolve(path?.toString(), 'package.json'), 'utf-8'));
    }
    return {};
  }

  async packageLock(path) {
    if (path) {
      return JSON.parse(await readFile(pathfs.resolve(path?.toString(), 'package-lock.json'), 'utf-8')).catch((err) => {
        console.error(err);
        return {};
      });
    }
    return {};
  }

  /**
     * @returns {Promise<import('./index').Outdated>}
     */
  async outdated(path) {
    const result = await execAsync('npm outdated --json || true', { cwd: path });
    return JSON.parse(result);
  }
}

module.exports = Npm;
</file>

<file path="modules/openai/backend/routes.js">
const express = require('express');
const pathfs = require('path');
const OpenAIApi = require('openai').OpenAI;
const {
  existsSync, mkdirSync, createReadStream,
  writeFileSync,
  readFileSync,
} = require('fs');
const { encode } = require('gpt-3-encoder');
const { v4 } = require('uuid');
const { writeFile, unlink } = require('fs/promises');
const homedir = require('os').homedir();
const axios = require('axios').default;
const PromiseB = require('bluebird');
const ports = require('../../../servers/server/models/ports');

const router = express.Router();
const confDir = pathfs.resolve(homedir, '.runeya');

if (!existsSync(confDir)) mkdirSync(confDir);
const openaiConfPath = pathfs.resolve(confDir, 'openaiconf.json');
if (!existsSync(openaiConfPath)) writeFileSync(openaiConfPath, '{}', 'utf-8');
const openaiStoragePath = pathfs.resolve(confDir, 'storage');
if (!existsSync(openaiStoragePath)) mkdirSync(openaiStoragePath);
const openaiconf = JSON.parse(readFileSync(openaiConfPath, 'utf-8'));
/** @type {OpenAIApi | null} */
let openai = process.env.RUNEYA_OPENAI_APIKEY ? new OpenAIApi({
  apiKey: process.env.RUNEYA_OPENAI_APIKEY,
}) : null;

module.exports = () => {
  router.get('/openai', async (req, res) => {
    res.json('hello');
  });
  router.get('/openai/image/:id', async (req, res) => {
    res.setHeader('content-type', 'image/png');
    res.setHeader('content-disposition', 'filename=image.png');
    const path = pathfs.resolve(openaiStoragePath, `${req.params.id}.png`);
    if (existsSync(path)) createReadStream(path).pipe(res);
    else res.status(404).send('file not found');
  });
  router.get('/openai/models', async (req, res) => {
    if (!openai) return res.status(400).send('Openai not initialized');
    const models = await openai.models.list({});
    return res.json(models.data);
  });

  router.post('/openai/tokenize', async (req, res) => {
    const encoded = encode(req.body.data);
    res.json({
      nbTokens: encoded.length,
      price: (encoded.length * 0.002) / 1000,
    });
  });

  router.post('/openai/review', async (req, res) => {
    if (!openai) return res.status(400).send('Openai not initialized');
    const result = await openai.chat.completions.create({
      model: 'gpt-3.5-turbo',
      temperature: 0,
      n: 1,
      max_tokens: Infinity,
      messages: [
        { role: 'system', content: 'You are a developer for 10 years. You are expert in git and you should write a commit. I gave you a git diff after. Write me a resume of this diff and write me a commit for this diff in this format: "<fix|feat|major>: <your message not exceeding 60 characters>"' },
        { role: 'assistant', content: req.body.data },
      ],
    }).catch((err) => {
      console.error(err.response.data);
      return Promise.reject(err);
    });
    return res.json(result.choices[0]?.message?.content || 'Cannot respond');
  });

  router.post('/openai/error', async (req, res) => {
    if (!openai) return res.status(400).send('Openai not initialized');
    const result = await openai.chat.completions.create({
      model: 'gpt-3.5-turbo',
      temperature: 0,
      n: 1,
      max_tokens: Infinity,
      messages: [
        { role: 'system', content: 'You are a developer for 20 years. You are expert in it and you should find a solution to this following error. Resume the following error and try to fix it' },
        { role: 'assistant', content: req.body.data },
      ],
    }).catch((err) => {
      console.error(err.response.data);
      return Promise.reject(err);
    });
    return res.json(result.choices[0]?.message?.content || 'Cannot respond');
  });

  router.post('/openai/chat/:room/image', async (req, res) => {
    if (!openai) return res.status(400).send('Openai not initialized');
    const { message, quality, resolution } = req.body;
    if (!openaiconf?.chat) openaiconf.chat = {};
    if (!openaiconf?.chat?.[req.params.room]) openaiconf.chat[req.params.room] = {};
    if (!openaiconf?.chat?.[req.params.room]?.messages) {
      openaiconf.chat[req.params.room].messages = [
        { role: 'system', content: 'Tu es un assistant utile.' },
      ];
    }
    /** @type {import('./index').OpenAiChat[]} */
    const messages = openaiconf?.chat[req.params.room]?.messages || [];
    messages.push({
      _id: v4(),
      // @ts-ignore
      role: 'user',
      content: message,
      created_at: new Date().toISOString(),
    });
    const response = await openai.images.generate({
      quality,
      model: 'dall-e-3',
      prompt: message,
      n: 1,
      size: resolution,
    });

    if (response?.data?.[0]?.url) {
      const { url, revised_prompt } = response.data[0];
      const uuid = v4();
      const { data: fileBuffer } = await axios.get(url, {
        responseType: 'arraybuffer',
        maxContentLength: Infinity,
        maxBodyLength: Infinity,
      });
      await writeFile(pathfs.resolve(openaiStoragePath, `${uuid}.png`), fileBuffer);

      messages.push({
        url: `http://localhost:${ports.http}/openai/image/${uuid}`,
        contentId: uuid,
        revised_prompt,
        _id: v4(),
        created_at: new Date().toISOString(),
      });
      save();
    }
    return res.json(response.data[0].url);
  });

  router.post('/openai/chat/:room', async (req, res) => {
    if (!openai) return res.status(400).send('Openai not initialized');
    const { message, model, temperature } = req.body;
    if (!openaiconf?.chat) openaiconf.chat = {};
    if (!openaiconf?.chat?.[req.params.room]) openaiconf.chat[req.params.room] = {};
    if (!openaiconf?.chat?.[req.params.room]?.messages) {
      openaiconf.chat[req.params.room].messages = [
        { role: 'system', content: 'Tu es un assistant utile.' },
      ];
    }
    /** @type {import('./index').OpenAiChat[]} */
    const messages = openaiconf?.chat[req.params.room]?.messages || [];
    messages.push({
      _id: v4(),
      // @ts-ignore
      role: 'user',
      content: message,
      created_at: new Date().toISOString(),
    });
    const result = await openai.chat.completions.create({
      model: model || 'gpt-3.5-turbo',
      temperature: Number.isNaN(+temperature) ? 0 : +temperature,
      n: 1,
      max_tokens: Infinity,
      // @ts-ignore
      messages: messages
        .filter((f) => f?.content)
        .map((a) => ({ role: a.role || 'user', content: a.content || '' }))
        .slice(-15),
    }).catch((err) => Promise.reject(err));
    if (result?.choices?.[0]?.message) {
      const { usage } = result;
      const { message } = result.choices[0];
      messages.push({
        ...message,
        ...usage,
        _id: v4(),
        created_at: new Date().toISOString(),
      });
    }
    save();
    return res.json(messages);
  });

  router.get('/openai/rooms', async (req, res) => {
    res.json(Object.keys(openaiconf?.chat || {}));
  });

  router.post('/openai/rooms', async (req, res) => {
    const { room } = req.body;
    if (!openaiconf?.chat?.[room]) {
      if (!openaiconf?.chat) openaiconf.chat = {};
      if (!openaiconf?.chat?.[room]) openaiconf.chat[room] = {};
    }
    save();
    res.json(Object.keys(openaiconf?.chat || {}));
  });

  router.delete('/openai/rooms/:room', async (req, res) => {
    const { room } = req.params;
    if (openaiconf?.chat?.[room]) {
      await PromiseB.map(openaiconf?.chat?.[room].messages, async (message) => {
        if (message.contentId && existsSync(pathfs.resolve(openaiStoragePath, `${message.contentId}.png`))) {
          await unlink(pathfs.resolve(openaiStoragePath, `${message.contentId}.png`));
        }
      }, { concurrency: 4 });
      delete openaiconf.chat[room];
    }
    save();
    res.json(Object.keys(openaiconf?.chat || {}));
  });

  router.get('/openai/chat/:room', async (req, res) => {
    res.json(openaiconf?.chat?.[req.params.room]?.messages);
  });

  router.post('/openai/apikey', async (req, res) => {
    const { apikey } = req.body;
    process.env.RUNEYA_OPENAI_APIKEY = apikey;
    save();
    openai = process.env.RUNEYA_OPENAI_APIKEY ? new OpenAIApi({
      apiKey: process.env.RUNEYA_OPENAI_APIKEY,
    }) : null;

    res.json(true);
  });

  router.get('/openai/ready', async (req, res) => {
    if (!openai) return res.json(false);
    console.log(process.env.RUNEYA_OPENAI_APIKEY, openaiconf?.apikey)
    try {
      const {data} = await openai.models.list({});
      res.json(!!data?.length);
    } catch (error) {
      res.json(false);
    }
    return undefined;
  });

  function save() {
    writeFileSync(openaiConfPath, JSON.stringify(openaiconf), 'utf-8');
  }
  return router;
};
</file>

<file path="modules/openai/front/src/OpenAi.vue">
<template>
  <div class="openai-root">
    <div class="header">
      <h1>Open ai</h1>
    </div>
    <div v-if="!ready">
      You need to provide a valid apikey from openai in the RUNEYA_OPENAI_APIKEY
      environment variable to use this module.
      <a href="https://platform.openai.com/api-keys" target="_blank">See here.</a>
    </div>
    <div v-else class="content">
      <div class="rooms">
        <input type="text" placeholder="New room..." :style="{width: '100%'}"
        @change="newRoom(/**@type {HTMLInputElement}*/($event.target)?.value, $event)">
        <div class="room" :class="{active: room === _room}" v-for="_room of rooms" :key="_room"
        @click="changeRoom(_room)">
          <div>{{ _room }}</div>
          <button class="small" @click.stop="deleteRoom(_room)">
            <i class="fas fa-trash"></i>
          </button>
        </div>
      </div>
      <div class="chat-container" v-if="room">
        <div class="header">
          <h2>{{ room }}</h2>
          <div class="toolbar">
            <template v-if="model.startsWith('gpt')">
              <div>
                Temperature:
                <input type="range" min="0" max="2" v-model="temperature" step="0.1">
              </div>
            </template>
            <template v-if="model.startsWith('dall')">
              <div>
                Resolution:
                <select v-model="resolution">
                  <option value="1024x1024">1024x1024</option>
                  <option value="1024x1792">1024x1792</option>
                  <option value="1792x1024">1792x1024</option>
                </select>
              </div>
              <div>
                Quality:
                <select v-model="quality">
                  <option value="standard">standard</option>
                  <option value="hd">hd</option>
                </select>
              </div>
            </template>
            <div>
              Model:
              <select v-model="model" default="gpt-3.5-turbo">
                <option v-for="_model of models" :value="_model.id">{{_model.id}}</option>
              </select>
            </div>
          </div>
        </div>
        <Chat class="chat" :messages="messagesToDisplay" :loading="loading" @send="sendMessage($event)"></Chat>
      </div>
    </div>
  </div>
</template>

<script setup>
import { computed, ref, onMounted } from 'vue';
import axios from '../../../../fronts/app/src/helpers/axios';
import notification from '../../../../fronts/app/src/helpers/notification';
import Chat from './Chat.vue';

const ready = ref(false);
const loading = ref(false);
/** @type {import('vue').Ref<import('../../backend/index').OpenAiChat[]>} */
const messages = ref([]);
const rooms = ref([]);

/** @type {import('vue').Ref<{id: string}[]>} */
const models = ref([]);
const room = ref();
const model = ref('gpt-3.5-turbo');
const temperature = ref(0);
const resolution = ref('1024x1024');
const quality = ref('standard');

onMounted(reload);

async function reload() {
  const { data: _ready } = await axios.get('/openai/ready');
  ready.value = _ready;
  if (!ready.value) return;
  const { data: _rooms } = await axios.get('/openai/rooms');
  rooms.value = _rooms;
  if (!room.value) {
    room.value = rooms.value?.[0];
  }
  const { data: _messages } = await axios.get(`/openai/chat/${room.value}`);
  messages.value = _messages;
  await getModels();
}

/**
 * @param {string} room
 * @param {Event} $event
 */
async function newRoom(room, $event) {
  await axios.post('/openai/rooms', { room });
  await reload();
  if ($event) /** @type {HTMLInputElement} */($event.target).value = '';
  await changeRoom(room);
}
/** @param {string} _room */
async function changeRoom(_room) {
  room.value = _room;
  messages.value = [];
  await reload();
}

async function getModels() {
  const { data: _models } = await axios.get('/openai/models');
  models.value = _models.filter((/** @type {*} */m) => (
    (m.id.startsWith('gpt') && (m.id.split('-')?.length === 2 || Number.isNaN(+m.id.split('-').pop())))
    || m.id.startsWith('dall')
  ));
}

/** @param {string} message */
async function sendMessage(message) {
  if (!messages.value) messages.value = [];
  messages.value.push({ role: 'user', content: message });
  loading.value = true;
  if (model.value.startsWith('dall')) {
    await axios.post(`/openai/chat/${room.value}/image`, { message, resolution: resolution.value, quality: quality.value })
      .catch((err) => {
        console.error(err);
        notification.next('error', 'Une erreur s\'est produite');
      })
      .finally(() => { loading.value = false; });
  } else {
    await axios.post(`/openai/chat/${room.value}`, { message, model: model.value, temperature: temperature.value })
      .catch((err) => {
        console.error(err);
        notification.next('error', 'Une erreur s\'est produite');
      })
      .finally(() => { loading.value = false; });
  }
  await reload();
}

/** @param {Room} _room */
async function deleteRoom(_room) {
  await axios.delete(`/openai/rooms/${_room}`);
  await reload();
}
const messagesToDisplay = computed(() => messages.value?.filter?.((f) => f.role !== 'system'));

/**
 * @typedef {{dada:string}} Room
 */
</script>
<style lang="scss" scoped>
h2 {
  margin: 0;
}
.header{
  display: flex;
  justify-content: space-between;
  text-align: center;
}
$leftSize: 200px;
.openai-root {
  height: 100%;
  width: 100%;
  box-sizing: border-box;
  .content {
    display: flex;
    gap: 10px;
    .rooms {
      width: $leftSize;
      flex-shrink: 0;
      gap: 5px;
      display: flex;
      flex-direction: column;
      .room {
        border-left: 1px solid black;
        padding: 5px;
        box-sizing: border-box;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 0 10px 0 rgba(0,0,0,0.2);

        cursor: pointer;
        &:hover {
          background-color: rgba(0,0,0,0.05);
        }
        button {
          width: max-content;
          justify-content: center;
          i {
            margin: 0;
          }
        }
        &.active {
          border-left: 4px solid #1d95db;
        }
      }
      input {
        box-sizing: border-box;
        height: 35px;
        border-radius: 20px;
        border: none;
        box-shadow: 0 0 10px 0 rgba(0,0,0,0.2);
        padding: 0 10px;

      }
    }
    .chat-container {
      width: 0;
      flex-grow: 1;
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: var(--system-sidebar-backgroundColor);
        padding: 5px 10px ;
        border: 1px solid var(--system-border-borderColor);
        border-bottom: 0;
        .toolbar {
          display: flex;
          &>div {
            display: flex;
            flex-direction: column;
          }
        }
      }
      .chat {
        border-radius: 0;
      }
    }

  }

}
</style>
</file>

<file path="modules/openai/front/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* remove some dependencies ([5667402](https://github.com/runeya/runeya/commit/5667402d57add874a89ba029ce62b16b3bbed9e0))
* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-openai-front

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

### Bug Fixes

* **docker:** add docker support ([f3abb42](https://github.com/runeya/runeya/commit/f3abb4237b8f708585769a8ff51c393d5f21dc5c))
* resolve issues for permission on docker volumes + cosmetic changes ([7a822cd](https://github.com/runeya/runeya/commit/7a822cd1c205e5808247075828c1d3ce49d1524b))

## [1.17.29](https://github.com/runeya/runeya/compare/v1.17.28...v1.17.29) (2024-02-15)

### Bug Fixes

* **theme:** add black theme ([bee4697](https://github.com/runeya/runeya/commit/bee469731be182ac929298dc13fe1c230eccb7ba))

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

### Bug Fixes

* various changes ([06e6241](https://github.com/runeya/runeya/commit/06e624176595b95c4227fe684242919c7eeda192))

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

### Bug Fixes

* link front to backend deps ([66b3135](https://github.com/runeya/runeya/commit/66b313523d99765b692208de0043303dcb6a0914))
* link front to backend deps ([54fcbf3](https://github.com/runeya/runeya/commit/54fcbf371cf03dc4f51a7196de15fe5d352088e9))

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-openai-front

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* build for npm ([0c07b41](https://github.com/runeya/runeya/commit/0c07b410a237412c1c73bbb42fe45c1f9c220482))
* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.13](https://github.com/runeya/runeya/compare/v1.17.12...v1.17.13) (2024-02-05)

### Bug Fixes

* **openai:** dont initialize openai if no apikey is configured ([0746e78](https://github.com/runeya/runeya/commit/0746e786fc54ae832b09ba5b99a33dc1d741da6f))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/regex/front/package.json">
{
  "name": "@runeya/modules-regex-front",
  "version": "2.0.5",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "json-tree-view-vue3": "^1.0.1",
    "monaco-editor": "^0.46.0",
    "vue": "^3.4.18",
    "vue-eslint-parser": "^9.4.2"
  }
}
</file>

<file path="modules/toolbox/front/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-toolbox-front

## [1.18.2](https://github.com/runeya/runeya/compare/v1.18.1...v1.18.2) (2024-02-24)

### Bug Fixes

* **front:** cosmetic changes ([ff9b282](https://github.com/runeya/runeya/commit/ff9b2821de658eae571a1da4407ec0651a102e15))

## [1.17.29](https://github.com/runeya/runeya/compare/v1.17.28...v1.17.29) (2024-02-15)

### Bug Fixes

* **theme:** add black theme ([bee4697](https://github.com/runeya/runeya/commit/bee469731be182ac929298dc13fe1c230eccb7ba))

## [1.17.24](https://github.com/runeya/runeya/compare/v1.17.23...v1.17.24) (2024-02-11)

### Bug Fixes

* link front to backend deps ([351abfd](https://github.com/runeya/runeya/commit/351abfd8f8cde96bce80d5202a78dd1daabbf6bb))

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

### Bug Fixes

* link front to backend deps ([66b3135](https://github.com/runeya/runeya/commit/66b313523d99765b692208de0043303dcb6a0914))
* link front to backend deps ([54fcbf3](https://github.com/runeya/runeya/commit/54fcbf371cf03dc4f51a7196de15fe5d352088e9))

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-toolbox-front

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/uuid/front/package.json">
{
  "name": "@runeya/modules-uuid-front",
  "version": "2.0.5",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "vue": "^3.4.18",
    "vue-eslint-parser": "^9.4.2"
  }
}
</file>

<file path="modules/vscode/backend/index.js">
const commandExists = require('command-exists');

/** @type {import('@runeya/modules-plugins-loader-front/src/views').PluginSM<null>} */
const plugin = {
  enabled: true,
  name: 'Vscode',
  displayName: 'Vscode',
  description: 'interact with vscode extension',
  icon: 'fab fa-git-alt',
  export: null,
  order: Infinity,
  placements: [{
    position: 'sidebar',
    label: 'VScode extension',
    img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/9a/Visual_Studio_Code_1.35_icon.svg/512px-Visual_Studio_Code_1.35_icon.svg.png',
    goTo: { path: '/Vscode' },
    active: 'Vscode',
  }],
  hidden: () => commandExists('code').then(() => false).catch(() => true),
  routes: require('./routes'),
};
module.exports = plugin;
</file>

<file path="modules/vscode/extension/src/commands/commands.js">
// eslint-disable-next-line import/no-unresolved
const vscode = require('vscode');
const { connect } = require('../helpers/initialize');

module.exports = {
  async registerCommands(context) {
    const disposable = vscode.commands.registerCommand('runeya.connect', () => connect(context));
    const disposableSnippet = vscode.commands.registerCommand('runeya.log', async () => {
      const editor = vscode.window.activeTextEditor;
      const highlighted = editor.selections.map((selection) => {
        const selectionRange = new vscode.Range(
          selection.start.line,
          selection.start.character,
          selection.end.line,
          selection.end.character,
        );
        return editor.document.getText(selectionRange);
      }).filter((f) => f);

      const languages = {
        javascript: `console.log(JSON.stringify(['runeya', ${highlighted?.length ? highlighted.join(', ') : '$1'}],(_, v) => (typeof v === 'function' ? \`[func]\` : v)));`,
        typescript: `console.log(JSON.stringify(['runeya', ${highlighted?.length ? highlighted.join(', ') : '$1'}],(_, v) => (typeof v === 'function' ? \`[func]\` : v)));`,
        typescriptreact: `console.log(JSON.stringify(['runeya', ${highlighted?.length ? highlighted.join(', ') : '$1'}],(_, v) => (typeof v === 'function' ? \`[func]\` : v)));`,
        json: '// cannot print into runeya from json. You can print only with dynamic language that print into shell console.',
        html: '// cannot print into runeya from html. You can print only with dynamic language that print into shell console.',
        css: '// cannot print into runeya from css. You can print only with dynamic language that print into shell console.',
        unknown: `// ${editor.document.languageId} language not supported for moment`,
      };
      const lastSelection = editor.selections
        .slice()
        .sort((a, b) => a.end.line - b.end.line)[editor.selections.length - 1];
      editor.selections = [lastSelection];
      await vscode.commands.executeCommand('editor.action.insertLineAfter');
      editor.insertSnippet(
        new vscode.SnippetString(
          languages[editor.document.languageId] || languages.unknown,
        ),
        lastSelection ? new vscode.Position(
          lastSelection.end.line + 1,
          lastSelection.start.character,
        ) : undefined,
      );
    });
    context.subscriptions.push(disposable, disposableSnippet);
  },
};
</file>

<file path="modules/vscode/extension/src/providers/ServicesProvider.js">
/* eslint-disable max-classes-per-file */
// eslint-disable-next-line import/no-unresolved
const vscode = require('vscode');
const PromiseB = require('bluebird');
const { getAxios } = require('../networks/axios');

/** @param {import('@runeya/servers-server/models/Service')} service */
function getLabel(service) {
  let status = '';
  if (service.crashed) status = '🗰';
  else if (service.enabled && !service.exited) status = '⏵';
  else if (service.exited) status = '🗙';
  else status = '■';
  return `${status} ${service.label}`;
}
module.exports = class ServicesProvider {
  constructor(context) {
    this.workspaceRoot = __dirname;
    this.context = context;
  }

  getTreeItem(element) {
    return element;
  }

  async getChildren(element) {
    if (!element) {
      const { data: services } = await getAxios(this.context).get('/stack/services');
      services.sort((a, b) => ((b.enabled ? 1 : 0) - (a.enabled ? 1 : 0)));
      return PromiseB.mapSeries(services, (service) => new Dependency({
        label: getLabel(service),
        collapsibleState: vscode.TreeItemCollapsibleState.Collapsed,
        type: 'service',
        tooltip: service.description,
        data: service,
      }));
    }
    if (element.type === 'service') return this.fillService(element);
    if (element.type === 'envs') return this.fillEnvs(element);
    if (element.type === 'actions') return this.fillActions(element);
    if (element.type === 'commands') return this.fillCommands(element);
    if (element.type === 'command') return this.fillCommand(element);
    if (element.type === 'urls') return this.fillUrls(element);
    return [];
  }

  async fillService(element) {
    /** @type {{data: import('@runeya/servers-server/models/Service')}} */
    const { data: service } = await getAxios(this.context).get(`/stack/${element.data.label}`);
    return [
      new Dependency({
        label: service.rootPath,
        tooltip: service.rootPath,
        collapsibleState: vscode.TreeItemCollapsibleState.None,
        type: 'rootPath',
      }),
      new Dependency({
        label: 'Actions',
        tooltip: 'Actions',
        collapsibleState: vscode.TreeItemCollapsibleState.Collapsed,
        type: 'actions',
        data: service,
      }),
      new Dependency({
        label: 'Commands',
        tooltip: 'Commands',
        collapsibleState: vscode.TreeItemCollapsibleState.Collapsed,
        type: 'commands',
        data: service,
      }),
      new Dependency({
        label: 'Urls',
        tooltip: 'Urls',
        collapsibleState: vscode.TreeItemCollapsibleState.Collapsed,
        type: 'urls',
        data: service,
      }),

    ];
  }

  async fillEnvs(element) {
    /** @type {import('@runeya/servers-server/models/Service')} */
    const service = element.data;
    const envs = service.spawnOptions.env || {};
    return [
      ...Object.keys(envs).map((key) => (
        new Dependency({
          label: key,
          version: envs[key],
          collapsibleState: vscode.TreeItemCollapsibleState.None,
          type: 'env',
        })
      )),
    ];
  }

  async fillActions(element) {
    /** @type {import('@runeya/servers-server/models/Service')} */
    const service = element.data;
    return [
      new Dependency({
        label: 'Start',
        collapsibleState: vscode.TreeItemCollapsibleState.None,
        type: 'start-service',
        data: service,
      }),
      new Dependency({
        label: 'Stop',
        collapsibleState: vscode.TreeItemCollapsibleState.None,
        type: 'stop-service',
        data: service,
      }),
      new Dependency({
        label: 'Restart',
        collapsibleState: vscode.TreeItemCollapsibleState.None,
        type: 'restart-service',
        data: service,
      }),
    ];
  }

  async fillCommands(element) {
    /** @type {import('@runeya/servers-server/models/Service')} */
    const service = element.data;
    return [
      new Dependency({
        label: `${service.spawnCmd} ${(service.spawnArgs || []).join(' ')}`,
        tooltip: `${service.spawnCmd} ${(service.spawnArgs || []).join(' ')}`,
        collapsibleState: vscode.TreeItemCollapsibleState.Collapsed,
        type: 'command',
        data: service,
      }),
      ...(service.commands || []).map((command) => (
        new Dependency({
          label: `${command.spawnCmd} ${(command.spawnArgs || []).join(' ')}`,
          tooltip: `${command.spawnCmd} ${(command.spawnArgs || []).join(' ')}`,
          collapsibleState: vscode.TreeItemCollapsibleState.Collapsed,
          type: 'command',
          data: service,
        })
      )),
    ];
  }

  async fillCommand(element) {
    /** @type {import('@runeya/servers-server/models/Service')} */
    const service = element.data;
    return [
      new Dependency({
        label: 'Envs',
        tooltip: 'Envs',
        collapsibleState: vscode.TreeItemCollapsibleState.Collapsed,
        type: 'envs',
        data: service,
      }),
    ];
  }

  async fillUrls(element) {
    /** @type {import('@runeya/servers-server/models/Service')} */
    const service = element.data;
    const { url } = service;
    return [
      ...url ? [new Dependency({
        label: url,
        tooltip: url,
        collapsibleState: vscode.TreeItemCollapsibleState.None,
        type: 'openUrl',
        data: { service, url },
      })] : [],
      ...(service.urls || []).map((url) => (
        new Dependency({
          label: url,
          tooltip: url,
          collapsibleState: vscode.TreeItemCollapsibleState.None,
          type: 'openUrl',
          data: { service, url },
        })
      )),
    ];
  }
};

class Dependency extends vscode.TreeItem {
  /**
   * @param {{
   *  label: string,
   *  version?: string,
   *  collapsibleState: any,
   *  type: string,
   *  data?: any,
   *  tooltip?: string,
   *  command?: import('vscode').Command
   * }} param0
   */
  constructor({
    label,
    version,
    collapsibleState,
    type,
    data,
    tooltip,
    command,
  }) {
    super(label, collapsibleState);
    this.tooltip = tooltip;
    this.version = version;
    this.description = this.version;
    this.type = type;
    this.data = data;
    this.command = command;
  }
}
</file>

<file path="modules/vscode/front/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-vscode-front

## [1.18.2](https://github.com/runeya/runeya/compare/v1.18.1...v1.18.2) (2024-02-24)

### Bug Fixes

* **extension:** create vscodeextension ([dfb2589](https://github.com/runeya/runeya/commit/dfb258912ca717cca9b2dc857c2774bfddd59251))
</file>

<file path="modules/workflows/backend/routes.js">
const { express, getServer } = require('@runeya/common-express');
const { sockets } = require('@runeya/common-socket-server');
var RED = require("node-red");
const compressing = require('compressing')

const router = express.Router();
const pathfs = require('path');
const { existsSync } = require('fs');
const { rm, readFile, writeFile, mkdir, readdir } = require('fs/promises');
const ports = require('@runeya/servers-server/models/ports');
const { execAsync } = require('@runeya/servers-server/helpers/exec');
const EncryptionKey = require('@runeya/servers-server/models/EncryptionKey');
const PromiseB = require('bluebird')
const { v4 } = require('uuid');

/** @param {import('@runeya/common-typings').Runeya} Stack */
module.exports = (Stack) => {
  getServer().then(async (server) => {
    const userDir = pathfs.resolve(Stack.getRootPath(), 'nodered')
    if (!existsSync(userDir)) await mkdir(userDir, {recursive: true})
    const settings = {
      httpAdminRoot: "/red",
      httpNodeRoot: "/node-red",
      userDir,
      credentialSecret: EncryptionKey.encryptionKey,
      functionGlobalContext: {},
      flowFile: 'flow.json',
      paletteCategories: ['Runeya'],
    }
    settings.functionGlobalContext.runeya = {
      sockets,
      url: `http://localhost:${ports.http}`,
      stack: require('@runeya/servers-server/models/stack')
    }
    
    RED.init(server, {
      ...settings,
    });
    router.use(settings.httpAdminRoot, RED.httpAdmin);
    router.use(settings.httpNodeRoot, RED.httpNode);

    const moduleName = 'node-red-contrib-runeya'
    const modulePath = pathfs.resolve(userDir, 'node_modules', moduleName);
    const localNodeModuleTarPath = pathfs.resolve(__dirname, `${moduleName}.tar`)
    const packageJSONPath = pathfs.resolve(userDir, 'package.json')

    if (existsSync(modulePath)) {
      console.log(moduleName, 'found, delete it before start nodered')
      await rm(modulePath, { recursive: true, force: true })
      await execAsync('npm uninstall node-red-contrib-runeya', { cwd: userDir })
    }

    await PromiseB.map(await readdir(userDir), async file => {
      if(file.startsWith(`node-red-contrib-runeya-`) && file.endsWith('.tgz')) {
        await rm(pathfs.resolve(userDir, file))
      }
    })

    /** @type {Buffer} */
    let buffer
    if(existsSync(localNodeModuleTarPath)) {
      console.log(`Read ${moduleName} from local tar`)
      buffer = await readFile(localNodeModuleTarPath)
    } else {
      console.log(`Build ${moduleName} from dir`)
      function stream2buffer(stream) {
        return new Promise((resolve, reject) => {
          const _buf = [];
          stream.on("data", (chunk) => _buf.push(chunk));
          stream.on("end", () => resolve(Buffer.concat(_buf)));
          stream.on("error", (err) => reject(err));
        });
      }
      const stream = new compressing.tar.Stream()
      stream.addEntry(pathfs.resolve(__dirname, './nodes'), { ignoreBase: true, relativePath: 'package' })
      buffer = await stream2buffer(stream)
    }

    let packageJSON = {
      "name": "node-red-project",
      "description": "A Node-RED Project",
      "version": "0.0.1",
      "private": true,
      "dependencies": {}
    }
    
    if(existsSync(packageJSONPath)) {
      Object.assign(packageJSON, JSON.parse(await readFile(packageJSONPath, 'utf-8')))
    }
    const tgzFileName = `${moduleName}.tgz`
    packageJSON.dependencies[moduleName] = `file:${tgzFileName}`
    const pathToTgz = pathfs.resolve(userDir, `${tgzFileName}`) 
    await writeFile(pathToTgz, buffer)
    await writeFile(packageJSONPath, JSON.stringify(packageJSON, null, 2), 'utf-8')
    await execAsync('npm i', { cwd: userDir })

    await writeFile(pathfs.resolve(userDir, '.gitignore'), `*
!flow.json
!flow_cred.json
!package.json
    `)
    await RED.start();
    sockets.emit('scenarios:start')
  })
  return router;
};
</file>

<file path="servers/server/models/Environment.js">
const PromiseB = require('bluebird');
const { cloneDeep, merge } = require('lodash');
const dbs = require('../helpers/dbs');

class Environment {
  /**
   * @param {import('@runeya/common-typings').NonFunctionProperties<Environment>} environment
   */
  constructor(environment) {
    /** @type {string} */
    this.label = environment.label || '';
    /** @type {boolean} */
    this.default = environment.default || false;
    /** @type {string} */
    this.color = environment.color || '';
    /** @type {string} */
    this.bgColor = environment.bgColor || '';
    /** @type {{[key: string]: string}} */
    this.envs = environment.envs || {};
    /** @type {string[]} */
    this.extends = environment.extends || [];
    /** @type {{[key: string]: string}} */
    this.overrideEnvs = environment.overrideEnvs || {};
  }

  static async load(label, Stack) {
    const environmentDB = await dbs.getDb(`envs/${label}`).read();
    const overrides = await dbs.getDb(`overrides/${label}-environment`).read();
    merge(environmentDB?.envs || {}, overrides?.envs || {});
    return new Environment(environmentDB, Stack);
  }

  static async all() {
    const allDbds = await dbs.getDbs('envs');

    const environments = await PromiseB.map(allDbds, (id) => Environment.load(id));
    if (!environments.length) {
      const localEnv = new Environment({
        bgColor: '#FFFFFF',
        color: '#000000',
        default: true,
        label: 'Local',
        envs: {},
      });
      await localEnv.save();
      environments.push(localEnv);
    }
    return environments;
  }

  static async find(envLabel) {
    const envs = await this.all();
    return envs.find((env) => env.label === envLabel);
  }

  /** @returns {Promise<Environment[]>} */
  async getExtendedEnvironments() {
    return [
      this,
      ...await PromiseB
        .mapSeries(this.extends || [], (environmentLabel) =>  Environment.find(environmentLabel))
        .filter(a => !!a)
    ]
  }
  async getBank() {
    const bank = {}
    const environments = await this.getExtendedEnvironments()
    await PromiseB.map(environments.reverse(), async environment => {
      Object.assign(bank, environment?.envs)
    })
    Object.assign(bank, this.envs)
    return bank
  }

  async save() {
    const dbToWrite = this.toStorage();
    const overrideDbToWrite = { envs: {} };
    Object.keys(dbToWrite.envs).forEach((key) => {
      if (key.endsWith('_RUNEYA_OVERRIDE')) {
        overrideDbToWrite.envs[key] = dbToWrite.envs[key];
        delete dbToWrite.envs[key];
      }
    });
    await dbs.getDb(`overrides/${this.label}-environment`).write(overrideDbToWrite);
    await dbs.getDb(`envs/${this.label}`).write(dbToWrite);
  }

  async update(env) {
    this.default = env.default;
    this.color = env.color;
    this.bgColor = env.bgColor;
    this.envs = env.envs;
    this.extends = env.extends;
    return this.save();
  }

  async delete() {
    await dbs.getDb(`envs/${this.label}`).delete();
  }

  toStorage() {
    return cloneDeep({
      label: this.label,
      default: this.default,
      color: this.color,
      bgColor: this.bgColor,
      extends: this.extends,
      envs: this.envs,
    });
  }
}

module.exports = Environment;
</file>

<file path="watch.js">
process.env.PREFERRED_WORKSPACE_MANAGER = 'yarn';
const { watch } = require('chokidar');
const { getPackageInfos } = require('workspace-tools');
const pathfs = require('path');
const { spawn } = require('node:child_process');
const debounce = require('debounce');
const killport = require('kill-port');
const net = require('net');
const kill = require('tree-kill');
const { platform } = require('node:os');

const command = {
  cmd: process.argv[2],
  args: process.argv.slice(3),
};
const ignored = [
  '**/*node_modules',
  '**/*dist',
  '**/*.git',
  '**/*.yarn',
  '**/*.turbo',
  '**/*test-report.xml',
  '**/*tsup*',
  '**/*vite*',
  '**/*logs-express',
  '**/*coverage',
  '**/*sandbox-node-repl',
];
let restartInProgress = false;
let pid;
let waitingRestart;

(async () => {
  const watchableDeps = getWatchableDeps(pathfs.resolve('.'));
  console.log('<h1 style="padding: 0;margin: 0">Listening these deps</h1><ul style="margin: 0">', watchableDeps.map((a) => `<li>${a.name}</li>`).join(''), '</ul>');
  mainProcessDaemon();
  await runMainProcess();
  watchDeps(watchableDeps, (packageInfo) => {
    console.log('Changed occured', packageInfo.name);
    runMainProcess();
    return packageInfo;
  });
})();

function mainProcessDaemon() {
  setInterval(() => {
    if (!restartInProgress) {
      if (waitingRestart) {
        const toRun = waitingRestart;
        waitingRestart = null;
        toRun();
      }
    }
  }, 0);
}

/**
 * @param {number} pid
 */
function killAsync(pid) {
  return new Promise((resolve, reject) => {
    kill(pid, (err, children) => {
      if (err) return reject(err);
      return resolve(children);
    });
  });
}

async function runMainProcess() {
  if (restartInProgress) {
    waitingRestart = () => runMainProcess();
    return pid;
  }
  restartInProgress = true;
  if (pid) {
    try {
      await killAsync(pid)
      process.kill(pid, 'SIGKILL');
    } catch (error) {}
  }
  const port = +(process.env.PORT || process.env.RUNEYA_HTTP_PORT || '');
  if (port && !Number.isNaN(port)) {
    await new Promise((resolve) => {
      setTimeout(resolve, 100);
    });
    const free = await checkport(port);
    if (!free) {
      await killport(+port).catch((err) => console.error('Error: (Kill port):', err?.message || err));
    }
  }
  console.log(' ');
  console.log(`<h3 style="padding: 0;margin: 0">Command: ${command.cmd} ${command.args.join(' ')}</h3>`);
  const spawned = spawn(command.cmd, command.args, { cwd: pathfs.resolve('.'), shell: platform() === 'win32', env: process.env });
  pid = spawned.pid;
  spawned.stdout.on('data', (data) => {
    console.log(data.toString('utf-8'));
  });
  spawned.stderr.on('data', (data) => {
    console.error(data.toString('utf-8'));
  });
  restartInProgress = false;
  return spawned.pid;
}

function watchDeps(watchableDeps, cb = (
  /** @type {import('workspace-tools').PackageInfos[number]} */packageInfo,
) => packageInfo) {
  const call = debounce((packageInfo) => cb(packageInfo), 100);
  watch(__dirname, { ignored, ignoreInitial: true }).on('all', (event, path) => {
    const packageInfos = getPackageInfos('.');
    const packageChanged = Object.keys(packageInfos)
      .filter((f) => {
        if (!watchableDeps.find((w) => w.name === f)) return false;
        const changedPath = path.replace(`${__dirname}/`, '').replaceAll('/', '-');
        const packageName = f.replace('@runeya/', '').replace('@iryu54/', '');
        return changedPath.startsWith(packageName);
      }).pop();
    if (packageChanged) {
      call(packageInfos[packageChanged]);
    }
  }).on('ready', () => console.log('ready'));
}

function getWatchableDeps(path) {
  const currentPackage = getPackageInfoFromPath(path);
  if (currentPackage) {
    const ignoreDependencies = [];
    if (currentPackage.name === '@runeya/servers-server') {
      ignoreDependencies.push('@runeya/fronts-app');
      ignoreDependencies.push('@runeya/modules-plugins-loader-front');
      ignoreDependencies.push((name) => name.endsWith('-front'));
    }
    const depsName = getDependencies(currentPackage?.name, ignoreDependencies);
    const deps = depsName.map((depName) => getPackageInfos('.')[depName]);
    return deps;
  }
  return [];
}

function getDependencies(packageName, ignoreDependencies = [], recursiveAggr = []) {
  const dependencies = (getPackageInfos(__dirname)[packageName].dependencies || {});
  const devDependencies = (getPackageInfos(__dirname)[packageName].devDependencies || {});
  const deps = [
    ...Object.keys(dependencies),
    ...Object.keys(devDependencies),
  ].filter((f) => (f.startsWith('@runeya') || f.startsWith('@iryu54')) && (dependencies[f] === 'workspace:*' || devDependencies[f] === 'workspace:*'));
  deps.forEach((f) => {
    const isIgnored = !ignoreDependencies.some((ignoreCondition) => (
      typeof ignoreCondition === 'function'
        ? ignoreCondition(f)
        : f === ignoreCondition
    ));
    if (!recursiveAggr.includes(f) && isIgnored) {
      recursiveAggr.push(f);
      deps.map((dep) => getDependencies(dep, ignoreDependencies, recursiveAggr)).flat();
    }
  });
  return recursiveAggr;
}

function getPackageInfoFromPath(path) {
  const packagesInfos = getPackageInfos(__dirname);
  return Object.values(packagesInfos)
    .filter((f) => {
      const packageName = path.replace(`${__dirname}/`, '').replaceAll('/', '-');
      return packageName.startsWith(f.name.replace('@runeya/', ''))
        || packageName.startsWith(f.name.replace('@iryu54/', ''));
    }).pop();
}

function checkport(_port) {
  return new Promise((resolve) => {
    const s = net.createServer();
    s.once('error', () => {
      s.close();
      resolve(false);
    });
    s.once('listening', () => {
      console.log(_port);
      resolve(true);
      s.close();
    });
    s.listen(_port);
  });
}
</file>

<file path="common/check-monorepo/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.1.1](https://github.com/runeya/runeya/compare/v2.1.0...v2.1.1) (2025-02-11)

### Bug Fixes

* improve code health ([865b996](https://github.com/runeya/runeya/commit/865b996fa0adcf49668fa770c465bac1f1d8f21a))

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* remove some dependencies ([5667402](https://github.com/runeya/runeya/commit/5667402d57add874a89ba029ce62b16b3bbed9e0))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/common-check-monorepo

## [1.18.2](https://github.com/runeya/runeya/compare/v1.18.1...v1.18.2) (2024-02-24)

### Bug Fixes

* **front:** cosmetic changes ([ff9b282](https://github.com/runeya/runeya/commit/ff9b2821de658eae571a1da4407ec0651a102e15))

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* build for npm ([0c07b41](https://github.com/runeya/runeya/commit/0c07b410a237412c1c73bbb42fe45c1f9c220482))
* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))

## [1.17.10](https://github.com/runeya/runeya/compare/v1.17.9...v1.17.10) (2024-02-04)

**Note:** Version bump only for package @runeya/common-check-monorepo

## [1.17.9](https://github.com/runeya/runeya/compare/v1.17.8...v1.17.9) (2024-02-04)

**Note:** Version bump only for package @runeya/common-check-monorepo

## [1.17.8](https://github.com/runeya/runeya/compare/v1.17.7...v1.17.8) (2024-02-04)

**Note:** Version bump only for package @runeya/common-check-monorepo

## [1.17.7](https://github.com/runeya/runeya/compare/v1.17.6...v1.17.7) (2024-02-04)

**Note:** Version bump only for package @runeya/common-check-monorepo

## [1.17.6](https://github.com/runeya/runeya/compare/v1.17.5...v1.17.6) (2024-02-04)

**Note:** Version bump only for package @runeya/common-check-monorepo

## [1.17.5](https://github.com/runeya/runeya/compare/v1.17.4...v1.17.5) (2024-02-04)

**Note:** Version bump only for package @runeya/common-check-monorepo

## [1.17.4](https://github.com/runeya/runeya/compare/v1.17.3...v1.17.4) (2024-02-04)

**Note:** Version bump only for package @runeya/common-check-monorepo

## [1.17.3](https://github.com/runeya/runeya/compare/v1.11.23...v1.17.3) (2024-02-04)

**Note:** Version bump only for package @runeya/common-check-monorepo
</file>

<file path="common/express-error-handler/package.json">
{
  "name": "@runeya/common-express-error-handler",
  "version": "2.0.5",
  "description": "",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "main": "src/index.js",
  "types": "src/index.js",
  "scripts": {
    "test": "echo \"no test\""
  },
  "author": "",
  "license": "ISC",
  "dependencies": {
    "@runeya/common-express-http-error": "workspace:*"
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "jest-sonar-reporter": "^2.0.0"
  }
}
</file>

<file path="common/socket-front/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

# [2.1.0](https://github.com/runeya/runeya/compare/v2.0.17...v2.1.0) (2025-01-31)

### Features

* **nodered:** add nodered into app ([f897eb2](https://github.com/runeya/runeya/commit/f897eb2c4a9128e0d4615f6765d3ef0ce1d2ca3e))

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* remove some dependencies ([5667402](https://github.com/runeya/runeya/commit/5667402d57add874a89ba029ce62b16b3bbed9e0))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/common-socket-front

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

### Bug Fixes

* improve performance + add jsoncrack view ([c534a97](https://github.com/runeya/runeya/commit/c534a9749162f5f15589ec335da149656c757bfb))

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

### Bug Fixes

* **server:** resolve dependencies ([7a15ef0](https://github.com/runeya/runeya/commit/7a15ef01ba9946fb2662c0f15a6da758f0c40280))
* various changes ([06e6241](https://github.com/runeya/runeya/commit/06e624176595b95c4227fe684242919c7eeda192))

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))

## [1.17.10](https://github.com/runeya/runeya/compare/v1.17.9...v1.17.10) (2024-02-04)

**Note:** Version bump only for package @runeya/common-socket-front

## [1.17.9](https://github.com/runeya/runeya/compare/v1.17.8...v1.17.9) (2024-02-04)

**Note:** Version bump only for package @runeya/common-socket-front

## [1.17.8](https://github.com/runeya/runeya/compare/v1.17.7...v1.17.8) (2024-02-04)

**Note:** Version bump only for package @runeya/common-socket-front

## [1.17.7](https://github.com/runeya/runeya/compare/v1.17.6...v1.17.7) (2024-02-04)

**Note:** Version bump only for package @runeya/common-socket-front

## [1.17.6](https://github.com/runeya/runeya/compare/v1.17.5...v1.17.6) (2024-02-04)

**Note:** Version bump only for package @runeya/common-socket-front

## [1.17.5](https://github.com/runeya/runeya/compare/v1.17.4...v1.17.5) (2024-02-04)

**Note:** Version bump only for package @runeya/common-socket-front

## [1.17.4](https://github.com/runeya/runeya/compare/v1.17.3...v1.17.4) (2024-02-04)

**Note:** Version bump only for package @runeya/common-socket-front

## [1.17.3](https://github.com/runeya/runeya/compare/v1.11.23...v1.17.3) (2024-02-04)

**Note:** Version bump only for package @runeya/common-socket-front
</file>

<file path="common/workflows/package.json">
{
  "name": "@runeya/common-workflows",
  "version": "2.1.1",
  "private": true,
  "description": "",
  "repository": "https://github.com/runeya/runeya",
  "main": "src/index.js",
  "scripts": {
    "test": "echo \"No test specified\""
  },
  "author": "",
  "license": "ISC",
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*"
  },
  "dependencies": {
    "bluebird": "^3.7.2"
  }
}
</file>

<file path="fronts/app/src/components/Section.vue">
<template>
  <div class="section" :class="{noStyle, noBodyPadding, headerBold,  headerCenter, noRadius}">
    <div class="background">
    </div>
    <div class="title" v-if="header || actions?.length || $slots.header">
      <div v-if="header">
        {{header}}
      </div>
      <slot v-else name="header">
      </slot>
      <div class="actions">
        <slot name="actions"></slot>
        <template v-for="action of activeActions" :key="action.label">
          <Popover appendTo="parent" trigger="mouseenter" placement="top" :disable="!action.hover">
            <template #trigger>
              <button
                @click="action?.click?.()"
                class="action small" :class="{mini: !action.label && action.icon || action.small, active: action.active}" :style="action.style || {}">
                <i :class="action.icon" v-if="action.icon"  aria-hidden="true"></i>
                <span class="text" v-if="action.label">{{action.label}}</span>
              </button>
            </template>
            <template #content>
              <span class="text" v-if="action.hover">{{action.hover}}</span>
            </template>
          </Popover>
        </template>
        
      </div>
    </div>
    <div class="content" :style="{maxHeight, overflow: scroll ? 'auto': 'inherit'}">
      <slot></slot>
    </div>
  </div>
</template>

<script setup>
import { computed } from 'vue';
import Popover from './Popover.vue';

const props = defineProps({
  header: {default: ''},
  actions: {
    default:() => (/**@type {Action[]}*/([]))
  },
  maxHeight: {default: 'auto'},
  noStyle: {default: false},
  noBodyPadding: {default: false},
  scroll: {default: true},
  headerBold: {default: false},
  headerCenter: {default: false},
  noRadius: { default: false },
})

const activeActions = computed(() => {
  return props.actions.filter(action => !action.hidden)
})

/**
 * @typedef {{
 *   click?: (...args: any[])=> any,
 *   icon?: string,
 *   hidden?: boolean,
 *   label?: string,
 *   hover?: string,
 *   small?: boolean,
 *   active?: boolean,
 * }} Action
 */
</script>

<style lang="scss" scoped>
$mainColor: rgb(234, 234, 234);
$secondaryColor: rgb(255, 255, 255);
$shadow: rgb(165, 177, 179);
.section {
  min-width: 0;
  width: calc(100%);
  box-sizing: border-box;
  border-right: 0;
  display: flex;
  flex-direction: column;
  border: 1px solid var(--system-border-borderColor);
  border-radius: 5px;
  position: relative;
  .background{
    border-radius: 5px;
    background: var(--system-sections-backgroundColor);
    position: absolute;
    width: 100%;
    height: 100%;
    overflow: hidden;
    z-index: -1;
    &>div{
      position: absolute;
      top: 0;
      left: 0;
    }
    $borderRadius: 100px;
    &::before, &::after {
      content: "";
      width: 100000px;
      height: 100000px;
      border-radius: 100px;
      position: absolute;
      bottom: calc(50%);
      left: calc(50%);
      transform: rotate(20deg);
      transform-origin: bottom left;
      box-shadow: inset 0 10px 100px var(--system-sections-innerShadow);
    }
    &::after {
      left: calc(50%);
      bottom: calc(50%);
      transform: rotate(200deg);
    }
  }
  .title {
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 5px 10px;
    box-sizing: border-box;
    position: relative;
    text-align: left;
    font-weight: bold;
    font-size: 1.4em;
  }
  .actions {
    display: flex;
    flex-wrap: wrap;
    width: max-content;
    justify-content: flex-end;
    gap: 5px;
    .action {
      gap: 5px;
      margin: 0;
    }
    .action.mini {
      width: max-content;
      i {
        margin: 0;
      }
    }
    .action.active {
      background: none;
      background-color: green;
      box-shadow: none;
    }
  }
  .content {
    display: flex;
    flex-direction: column;
    overflow: auto;
    height: 100%;
    padding: 10px;
    box-sizing: border-box;
    transform: translateZ(0);
    -webkit-transform: translateZ(0)
  }
}
.noStyle {
  border: none;
  border-left: 1px solid #999;  
  box-shadow: 0px 0px transparent;
  &:first-of-type {
    border: none;
  }
  .background {
    display: none;
  }
}
.noBodyPadding {
  &>.content {
    padding: 0;
  }
}
.headerCenter {
  .title {
    justify-content: center;
  }
}
.content {
  .content {
    .title {
      font-size: 1.2em;
    }
  }
}

.noRadius {
  border-radius: 0;  
  .background {
    border-radius: 0;  

  }
}
</style>
</file>

<file path="fronts/app/src/components/SidebarViewModeItem.vue">
<template>
  <Popover appendTo="parent" trigger="mouseenter" placement="right">
    <template #trigger>
      <button @click="button.click()" :class="{ active: isActive }" class="sidebar-item" :title="button.text">
        <i v-if="button.icon" :class="{ [button.icon]: true }" aria-hidden="true"/>
        <img :alt="`Icon for ${button.text}`" v-else-if="button.img" :src="button.img">
      </button>
    </template>
    <template #content>
      {{button.text}}
    </template>
  </Popover>
  
</template>

<script setup>
import { computed } from 'vue';
import { useRouter } from 'vue-router';
import Popover from './Popover.vue';
const router = useRouter(); 

const props = defineProps({
  button: {
    /** @type {SideBarButton | null}*/
    default: null
  }
})
const isActive = computed(() => {
  return router.currentRoute.value.fullPath.includes(props.button.active)
})

/**
 * @typedef {{active: string, click: (...args: any[]) => any, icon?: string,img?: string, text: string}} SideBarButton
 */
</script>

<style lang="scss" scoped>
.sidebar-item {
  cursor: pointer;
  transform: translateZ(0);
  transition: background-color 300ms;
  box-sizing: border-box;
  display: flex;
  justify-content: center;
  margin: auto;
  margin-top: 5px;
  z-index: 2;
  
  &:hover {
    background-color: var(--system-secondary-sidebar-backgroundColor);
    i {
      opacity: 1;
    }
  }
}
button {
  outline: none;
  border-radius: 5px;
  transition: 200ms;
  transition-property: font-size, box-shadow;
  height: 40px;
  display: flex;
  justify-content: center;
  align-items: center;
  background: transparent;
  margin: 0 5px;
  font-size: 1em;
  box-shadow: none;
  color: var(--system-tertiary-color);
  &:hover {
    background: var(--system-secondary-backgroundColor);
    color: var(--system-secondary-color);
    box-shadow: none;
    transform: none;
    img {
      filter: contrast(0) brightness(1.6);
    }
  }
  &.active {
    @include card();
    img {
      filter: contrast(0) brightness(2);
    }
  }
  i {
    font-size: 1.2em;
  }
  img {
    width: 1.2em;
    height: 1.2em;
    object-fit: contain;
    filter: contrast(0) brightness(2) brightness(0.5);
    
  }
}
</style>
</file>

<file path="fronts/app/src/helpers/Theme.js">
/* eslint-disable no-multi-assign */
/* eslint-disable no-nested-ternary */
/* eslint-disable max-len */
/* eslint-disable eqeqeq */
/* eslint-disable no-unused-expressions */
/* eslint-disable no-bitwise */
/* eslint-disable no-sequences */
/* eslint-disable no-mixed-operators */
import { merge, cloneDeep } from 'lodash-es';
import { ref } from 'vue';
import CustomObservable from './CustomObservable';
import base from './themes/base';
import lightPurple from './themes/lightPurple';
import lightOrange from './themes/lightOrange';
import lightBlue from './themes/lightBlue';
import darkPurple from './themes/darkPurple';
import darkOrange from './themes/darkOrange';
import darkBlue from './themes/darkBlue';
import baseDark from './themes/baseDark';

class Theme {
  constructor() {
    this.themes = ref({
      light: base(),
      dark: baseDark(),
      /** ==================================== */
      lightPurple: lightPurple(),
      lightOrange: lightOrange(),
      lightBlue: lightBlue(),
      /** ==================================== */
      darkPurple: darkPurple(),
      darkOrange: darkOrange(),
      darkBlue: darkBlue(),
    });
    this.currentTheme = 'lightPurple';
    this.buildedTheme = this.themes.value.light;
    this.observableCurrentTheme = new CustomObservable();
  }

  load(additionnalThemes = {}) {
    Object.assign(this.themes.value, additionnalThemes);
    this.loadCurrentTheme();
    this.apply(this.currentTheme);
  }

  get(property) {
    const [scope, rule] = property.split('/');
    return this.buildedTheme?.rules?.[scope]?.[rule];
  }

  loadCurrentTheme() {
    let currentTheme = localStorage.getItem('currentTheme');
    if (!currentTheme) {
      localStorage.setItem('currentTheme', 'lightPurple');
      currentTheme = 'lightPurple';
    }
    if (currentTheme === 'light') {
      localStorage.setItem('currentTheme', 'lightPurple');
      currentTheme = 'lightPurple';
    }
    if (currentTheme === 'dark') {
      localStorage.setItem('currentTheme', 'darkPurple');
      currentTheme = 'darkPurple';
    }
    this.currentTheme = currentTheme;
  }

  lighter(amount, color) {
    return pSBC.lighter(amount, color);
  }

  buildTheme(_theme) {
    let theme = cloneDeep(this.themes.value[_theme]);
    if (!theme) throw new Error(`${_theme} theme not exists`);
    if (theme.base) {
      if (!this.themes.value[theme.base]) return theme;
      theme = merge(this.buildTheme(theme.base), theme);
    }
    return theme;
  }

  apply(_theme) {
    localStorage.setItem('currentTheme', _theme);
    const theme = this.buildTheme(_theme);
    this.currentTheme = _theme;

    this.buildedTheme = theme;
    if (this.currentTheme.startsWith('dark')) {
      document.documentElement.classList.add('theme-dark');
      document.documentElement.classList.remove('theme-light');
    } else {
      document.documentElement.classList.add('theme-light');
      document.documentElement.classList.remove('theme-dark');
    }
    this.observableCurrentTheme.next('apply', _theme);
    Object.keys(theme.rules).forEach((rule) => {
      const cssRules = theme.rules[rule];
      Object.keys(cssRules).forEach((cssRule) => {
        const cssVariable = `--${rule.replaceAll('.', '-')}-${cssRule}`;
        const value = cssRules[cssRule];
        setCssVariable(cssVariable, value);
        setCssVariable(`${cssVariable}-darker`, this.lighter(-0.3, value));
        setCssVariable(`${cssVariable}-darkest`, this.lighter(-0.5, value));
        setCssVariable(`${cssVariable}-lighter`, this.lighter(0.3, value));
        setCssVariable(`${cssVariable}-lightest`, this.lighter(0.5, value));
      });
    });
    setCssVariable('--p-primary-color', theme.rules['system.accent'].backgroundColor2);
    setCssVariable('--p-content-background', theme.rules['system.sections'].backgroundColor);
    setCssVariable('--p-button-primary-color', '#FFFFFF');
    setCssVariable('--p-primary-active-color', theme.rules['system.accent'].backgroundColor3);
    setCssVariable('--p-primary-hover-color', theme.rules['system.accent'].backgroundColor3);
    setCssVariable('--p-button-primary-hover-color', '#FFFFFF');
    setCssVariable('--p-button-primary-background', 'linear-gradient(93deg, var(--system-accent-backgroundColor1) 0%, var(--system-accent-backgroundColor2) 100%)');
    setCssVariable('--p-button-primary-hover-background', 'linear-gradient(93deg, var(--system-accent-backgroundColor2) 0%, var(--system-accent-backgroundColor1) 100%)');
    setCssVariable('--p-highlight-color', theme.rules['system.accent'].backgroundColor3);
    setCssVariable('--p-highlight-background', theme.rules['system.secondary'].backgroundColor);
    setCssVariable('--p-primary-50', theme.rules['system.secondary'].backgroundColor);
    setCssVariable('--p-primary-100', theme.rules['system.secondary'].backgroundColor);
    console.log(theme.rules);
  }
}

// @ts-ignore
function getCssVariable() {
  const r = document.querySelector(':root');
  const rs = getComputedStyle(r);
  return rs.getPropertyValue('--blue');
}

function setCssVariable(key, value) {
  const r = document.querySelector(':root');
  if (!key.startsWith('--')) throw new Error('Css variable should starts with --');
  r.style.setProperty(key, value);
}

export default new Theme();

const pSBC = {
  lighter(p, c0, c1, l) {
    let r; let g; let b; let P; let f; let t; let h; const i = parseInt; const m = Math.round; let a = typeof (c1) === 'string';
    if (typeof (p) !== 'number' || p < -1 || p > 1 || typeof (c0) !== 'string' || (c0[0] != 'r' && c0[0] != '#') || (c1 && !a)) return null;
    if (!this.pSBCr) {
      this.pSBCr = (d) => {
        let n = d.length; const x = {};
        if (n > 9) {
          [r, g, b, a] = d = d.split(','), n = d.length;
          if (n < 3 || n > 4) return null;
          // @ts-ignore
          x.r = i(r[3] == 'a' ? r.slice(5) : r.slice(4)), x.g = i(g), x.b = i(b), x.a = a ? parseFloat(a) : -1;
        } else {
          if (n == 8 || n == 6 || n < 4) return null;
          if (n < 6)d = `#${d[1]}${d[1]}${d[2]}${d[2]}${d[3]}${d[3]}${n > 4 ? d[4] + d[4] : ''}`;
          d = i(d.slice(1), 16);
          if (n == 9 || n == 5)x.r = d >> 24 & 255, x.g = d >> 16 & 255, x.b = d >> 8 & 255, x.a = m((d & 255) / 0.255) / 1000;
          else x.r = d >> 16, x.g = d >> 8 & 255, x.b = d & 255, x.a = -1;
        } return x;
      };
    }
    h = c0.length > 9, h = a ? c1.length > 9 ? true : c1 == 'c' ? !h : false : h, f = this.pSBCr(c0), P = p < 0, t = c1 && c1 != 'c' ? this.pSBCr(c1) : P ? {
      r: 0, g: 0, b: 0, a: -1,
    } : {
      r: 255, g: 255, b: 255, a: -1,
    }, p = P ? p * -1 : p, P = 1 - p;
    if (!f || !t) return null;
    if (l)r = m(P * f.r + p * t.r), g = m(P * f.g + p * t.g), b = m(P * f.b + p * t.b);
    else r = m((P * f.r ** 2 + p * t.r ** 2) ** 0.5), g = m((P * f.g ** 2 + p * t.g ** 2) ** 0.5), b = m((P * f.b ** 2 + p * t.b ** 2) ** 0.5);
    // @ts-ignore
    a = f.a, t = t.a, f = a >= 0 || t >= 0, a = f ? a < 0 ? t : t < 0 ? a : a * P + t * p : 0;
    // @ts-ignore
    if (h) return `rgb${f ? 'a(' : '('}${r},${g},${b}${f ? `,${m(a * 1000) / 1000}` : ''})`;
    // @ts-ignore
    return `#${(4294967296 + r * 16777216 + g * 65536 + b * 256 + (f ? m(a * 255) : 0)).toString(16).slice(1, f ? undefined : -2)}`;
  },

};
</file>

<file path="fronts/app/src/views/settings/Environments.vue">
<template>
  <SectionCmp header="Environments">
    <div v-for="(environment, i) of environments" :key="environment.label" class="environment column">
      <h3>
        <Button size="small" severity="danger" icon="fas fa-trash" @click="deleteEnvironment(environment)"></Button>
        {{ environment.label }}
      </h3>
      <div>
        <IftaLabel>
          <Select size="small"
            v-model="environment.extends[0]"
            :options="['', ...environments.filter(a => a.label !== environment.label).map(a => a.label)]"
            @blur="saveEnvironment(environment)"
            fluid
            placeholder="Choose an environment" />
          <label>Extend from</label>
        </IftaLabel>
        <IftaLabel>
          <InputText size="small" fluid v-model="environment.color" @blur="saveEnvironment(environment)" @keypress.enter="saveEnvironment(environment)"></InputText>
          <label>Color: </label>
        </IftaLabel>
      </div>
      <div>
        <IftaLabel>
          <label>Background: </label>
          <InputText size="small" fluid v-model="environment.bgColor" @blur="saveEnvironment(environment)" @keypress.enter="saveEnvironment(environment)"></InputText>
        </IftaLabel>
      </div>
      <div class="line">
        <ToggleSwitch size="small" v-model="environment.default" @click="saveEnvironment(environment)"></ToggleSwitch>
        <label>Default</label>
      </div>
      <Button label="Envs" size="small" @click="openModalEnv(environment)"></Button>
      <Divider v-if="environments[i+1]"></Divider>
      <Modal :ref="(el) => envModalRefs[environment.label] = el" :noScroll="false" :noCancel="true" validateString="Close">
        <template #body>
          <div class="line">
            <div>
              <InputText v-if="!importViewMode" placeholder="Add new variable" @change="ev => addEnv(environment, ev.target.value)" v-model="keyToAdd"></InputText>
            </div>
            <Button :label="importViewMode? 'Import view' : 'Env view'" @click="toggleimportView(environment)"></Button>
          </div>
          <DataTable scrollable class="datatable" size="small"  sortField="key" :sortOrder="1" v-if="!importViewMode" :resizable-columns="true"
            :value="parseRawEnvs(environment.envs)"
            tableStyle="width: 100%;">
            <Column field="action" header="" col style="width: 20px" :pt="{
              bodyCell: {
                style: {
                  verticalAlign: 'middle'
                }
              }
            }">
              <template #body="{ data }">
                <Button size="small" @click="delete environment.envs[data.key]">
                  <i class="fas fa-times"></i>
                </Button>
              </template>
            </Column>
            <Column field="key" header="Key" col :colspan="1" style="max-width: 5rem" :pt="{
              bodyCell: {
                style: {
                  verticalAlign: 'middle'
                }
              }
            }">
              <template #body="{ data, field }">
                <Popover appendTo="parent" trigger="mouseenter" placement="top">
                  <template #trigger>
                    {{ data[field] }}
                  </template>
                  <template #content>
                    <span class="text">{{data[field]}}</span>
                  </template>
                </Popover>
              </template>
            </Column>
            <Column field="value" header="Value" :colspan="16" col :pt="{
              bodyCell: {
                style: {
                  verticalAlign: 'middle'
                }
              }
            }">
              <template #body="{ data, field }">
                <InputText v-model="environment.envs[data.key]" @blur="saveEnvironment(environment)" fluid>
                </InputText>
              </template>
            </Column>
            <Column field="value" header="Override" :colspan="16" col :pt="{
              bodyCell: {
                style: {
                  verticalAlign: 'middle'
                }
              }
            }">
              <template #body="{ data, field }">
                <InputText v-model="environment.envs[data.key + '_RUNEYA_OVERRIDE']" @blur="saveEnvironment(environment)" fluid>
                </InputText>
              </template>
            </Column>
          </DataTable>
          <Textarea  v-else v-model="code" @input="parseCode(environment)" @blur="saveEnvironment(environment)"></Textarea>
        </template>
      </Modal>
    </div>
  </SectionCmp>

  <Modal ref="modalDeleteRef" validate-string="Delete">
    <template #body>
      Are you sure you want to delete this environment?
    </template>
  </Modal>
</template>

<script setup>
import { onBeforeUnmount, onMounted, ref } from 'vue';
import SectionCmp from '../../components/Section.vue';
import Stack from '../../models/stack'
import InputText from 'primevue/inputtext';
import ToggleSwitch from 'primevue/toggleswitch';
import Button from 'primevue/button';
import axios from '../../helpers/axios';
import notification from '../../helpers/notification';
import Socket from '../../helpers/Socket';
import Divider from 'primevue/divider';
import IftaLabel from 'primevue/iftalabel';
import Modal from '../../components/Modal.vue';
import DataTable from 'primevue/datatable';
import Column from 'primevue/column';
import Textarea from 'primevue/textarea';
import Popover from '../../components/Popover.vue';
import Select from 'primevue/select';
const keyToAdd = ref('')
function addEnv(environment, value) {
  environment.envs[value] = ''
  keyToAdd.value = ''
}
async function openModalEnv(environment) {
  await envModalRefs.value[environment.label].open().promise
}

const importViewMode = ref(false)
const code = ref('')

function toggleimportView(environment) {
  if (!importViewMode.value) {
    code.value = `# key=value
${Object.keys(environment.envs).map((key) => `${key}=${environment.envs[key]}`).sort(( a,b) => a.localeCompare(b)).join('\n')}
`;
  }
  importViewMode.value = !importViewMode.value;
}
function parseCode(environment) {
  environment.envs = {}
  code.value
      .split('\n')
      .filter((line) => !line.trim().startsWith('#') && line.trim())
      .forEach((envString) => {
        const [key, ...value] = envString.split('=');
        environment.envs[key] = value.join('=')
      })
}

function parseRawEnvs(envs) {
  return Object.keys(envs).map((key) => ({ key, value: envs[key] })).filter(({ key }) => !key.endsWith('_RUNEYA_OVERRIDE'));
}
const envModalRefs = ref({})
/** @type {import('vue').Ref<Record<string, import('../../../../servers/server/models/stack').Environment>[]>} */
const environments = ref([])
onMounted(async () => {
  Socket.on('reloadEnvironments', reload)
  reload()
})
onBeforeUnmount(() => {
  Socket.off('reloadEnvironments', reload)
})
async function reload() {
  environments.value = await Stack.getEnvironments()
}

async function saveEnvironment(environment) {
  setTimeout(async() => {
    if(environment.default) {
      environments.value.forEach((_environment) => {
        if(_environment.label === environment.label) return
        _environment.default = false
        saveEnvironment(_environment)
      })
    }
    await axios.patch(`/stack/environments/${environment.label}`, environment)
      .then(() => notification.next('success', 'Environment saved'))
      .catch(() => notification.next('success', 'Environment cant be saved'));
  }, 100);
}


const modalDeleteRef = ref()
async function deleteEnvironment(environment) {
  const res = await modalDeleteRef.value.open().promise
  if(!res) return
  await axios.delete(`/stack/environments/${environment.label}`, environment)
      .then(() => notification.next('success', 'Environment deleted'))
      .catch(() => notification.next('success', 'Environment cant be deleted'));  
}

</script>

<style lang="scss" scoped>
  label {
    display: inline-block;
  }
  .environment {
    &:first-of-type{
    }
    h3 {
      margin: 0;
      display: flex;
      align-items: center;
    }
  }
  .line, .column {
    display: flex;
    gap: 5px;
  }
  .line {
    align-items: center;
    display: flex;
    justify-content: space-between;
  }

  .column {
    flex-direction: column;
    justify-content: center;
  }

  textarea {
    width: 100%;
    height: 50vh;
  }
</style>
</file>

<file path="fronts/app/src/views/settings/Parsers.vue">
<template>
  <Splitter height="100%" style="height: 100%">
    <SplitterPanel :size="1" :style="{minWidth: '160px'}" class="left-panel">
      <Button fluid icon="fas fa-plus" label="Add new" size="small" class="add-button" variant="text" @click="add"></Button>
      <Tree :value="nodes" v-model:selectionKeys="currentScriptKey" selectionMode="single" size="small" class="w-full md:w-[30rem]">
        <template #default="slotProps">
          <div class="line">
            <div class="label">
              {{ slotProps.node.label }}
            </div>
          </div>
        </template>
      </Tree>
    </SplitterPanel>
    <SplitterPanel :size="75" class="right-panel"  v-if="currentScript && currentScript?.label">
      <template v-if="currentScript">
        <Message size="small" severity="warn" closable>
          Caution: This script is designed to execute as is with an eval(). <br/>Please ensure it does not contain harmful content.
        </Message>
        <SectionCmp header="Parser" class="parsers" :actions="currentScript? [{
          icon: 'fas fa-trash',
          style: {
            background: 'red'
          },
          click: deleteCurrentParser
        }]: []">
          <Editor
            @blur="save"
            v-model="currentScript.transform"
            :style="{height: '100%'}"
            v-if="currentScript" language="typescript"
          />
        </SectionCmp>
      </template>
    </SplitterPanel>
  </Splitter>
  <Modal ref="addModalRef">
    <template #header>Add new parser</template>
    <template #body>
      <IftaLabel>
        <InputText v-model="scriptToAdd.label" fluid></InputText>
        <label>Label</label>
      </IftaLabel>
    </template>
  </Modal>

  <Modal ref="deleteModalRef">
    <template #header>Delete parser</template>
    <template #body>
      Are you sure to delete this parser ?
    </template>
  </Modal>
</template>

<script setup>
import { computed, onMounted, ref, watch, watchEffect } from 'vue';
import SectionCmp from '../../components/Section.vue';
import notification from '../../helpers/notification';
import Splitter from 'primevue/splitter';
import SplitterPanel from 'primevue/splitterpanel';
import { useRouter } from 'vue-router';
import Button from 'primevue/button';
import Modal from '../../components/Modal.vue';
import IftaLabel from 'primevue/iftalabel';
import InputText from 'primevue/inputtext';
import Tree from 'primevue/tree';
import Parsers from '../../models/Parsers';
import Message from 'primevue/message';

function getDefaultParser() {
  return {label: '', readonly: false, transform: /* typescript */`
/**
 * @type {(msg: LogMessage, service?: Service | null) => LogMessage}
 */
const parser = (line) => {
  return line;
}
module.exports = parser;

/**
 * @typedef {{
 *  msg: string,
 *  raw: string,
 *  timestamp: number,
 *  prompt?: boolean,
 *  id: string,
 *  source?: 'stdout' | 'stderr'
 *  json?: Record<any, any> | any[] | null,
 *  debug?: Record<any, any> | any[] | null,
 *  isSeparator?: boolean,
 *  label: string,
 *  pid?: number | null,
 *  hide?: boolean,
 *  cmd?: {cmd: string, args: string[], options: import('child_process').ExecOptions, status: 'running' | 'error' | 'exited'},
 * }} LogMessage
 */
    `}
}

const currentScriptKey = ref({})
const currentScript = ref()
const addModalRef = ref()
const deleteModalRef = ref()
const scriptToAdd = ref(getDefaultParser())
/** @type {import('vue').Ref<ReturnType<typeof getDefaultParser>[]>} */
const parsers =ref([])

const nodes = computed(() => parsers.value.filter(parser =>!parser.readonly).map((parser) => {
  return {
    key: parser.id,
    label: parser.label 
  }
}));

watchEffect(() => {
  const key = Object.keys(currentScriptKey.value || {})[0]
  currentScript.value = parsers.value.find((a)=> a.id === key)
})


async function reload() {
  parsers.value = await Parsers.all()
}

async function save() {
  await Parsers.update(currentScript.value)
}

async function add() {
  const result = await addModalRef.value.open().promise
  if(result) {
    await Parsers.create(scriptToAdd.value)
      .then(async (result) => {
        notification.next('success', 'Parser created')
        router.push({query: {...router.currentRoute.value.query, parser: result.id}})
        currentScript.value = result
      })
      .catch(() => notification.next('error', 'Parser cant be saved'))
    
  } 
  scriptToAdd.value = getDefaultParser()
  await reload()
}


const router = useRouter()
onMounted(async() => {
  await reload()
  const parserId = router.currentRoute.value.query.parser
  currentScript.value = parserId  
    ? parsers.value.find(a => a.id === parserId)
    : parsers.value.filter(a => a.readonly === false)[0]
  currentScriptKey.value[currentScript.value?.id] = true
})
watch(() => currentScriptKey, () => {
  const parser = currentScriptKey.value.id
  router.push({query: {...router.currentRoute.value.query,parser,}})
}, {deep: true})

async function deleteCurrentParser() {
  const result = await deleteModalRef.value.open().promise
  if(!result) return
  await Parsers.delete(currentScript.value.id)
      .then(() => notification.next('success', 'Parser deleted'))
      .catch(() => notification.next('error', 'Parser cant be deleted'))
  await reload()
}
</script>

<style lang="scss" scoped>
.line {
  display: flex;
  align-items: center;
}
.parsers {
  height: 100%;
}
.left-panel {
  padding-right: 10px;
}
.right-panel {
  padding: 0 10px;
  display: flex;
  flex-direction: column;
  gap: 5px;
}
.add-button {
  margin: 0;
  margin-bottom: 5px

}
.remove-button {
  padding: 2px;
  width: max-content;
  width: 20px;
}
:deep(.p-tree-selectable) {
  padding: 0;
}
:deep(.p-tree-node-label) {
  flex-grow: 1;
}
.line {
  display: flex;
  justify-content: space-between;
  align-items: center;
}
</style>
</file>

<file path="fronts/docs/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.0.9](https://github.com/runeya/runeya/compare/v2.0.8...v2.0.9) (2025-01-13)

**Note:** Version bump only for package @runeya/fronts-docs

## [2.0.8](https://github.com/runeya/runeya/compare/v2.0.7...v2.0.8) (2025-01-13)

### Bug Fixes

* documentation + various bugfixes ([bddd9f6](https://github.com/runeya/runeya/commit/bddd9f6a5507a5a45ea2e54d0fe836e1e518c820))

## [2.0.1](https://github.com/runeya/runeya/compare/v2.0.0...v2.0.1) (2024-12-25)

### Bug Fixes

* various fixes ([18129e9](https://github.com/runeya/runeya/commit/18129e96f7c92a69176d6a75add45f3a48ab11ae))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/fronts-docs

## [1.17.30](https://github.com/runeya/runeya/compare/v1.17.29...v1.17.30) (2024-02-19)

### Bug Fixes

* **documentation:** add documentation for documentation ([6290ce7](https://github.com/runeya/runeya/commit/6290ce7fc6aa070c1fb0f99e0cd815e5f51391b1))
* **documentation:** deployment for doc ([acacca6](https://github.com/runeya/runeya/commit/acacca68f431eb78a9852d67191ab454c1d59e4b))

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

**Note:** Version bump only for package @runeya/fronts-docs

## [1.17.10](https://github.com/runeya/runeya/compare/v1.17.9...v1.17.10) (2024-02-04)

**Note:** Version bump only for package @runeya/fronts-docs

## [1.17.9](https://github.com/runeya/runeya/compare/v1.17.8...v1.17.9) (2024-02-04)

**Note:** Version bump only for package @runeya/fronts-docs

## [1.17.8](https://github.com/runeya/runeya/compare/v1.17.7...v1.17.8) (2024-02-04)

**Note:** Version bump only for package @runeya/fronts-docs

## [1.17.7](https://github.com/runeya/runeya/compare/v1.17.6...v1.17.7) (2024-02-04)

**Note:** Version bump only for package @runeya/fronts-docs

## [1.17.6](https://github.com/runeya/runeya/compare/v1.17.5...v1.17.6) (2024-02-04)

**Note:** Version bump only for package @runeya/fronts-docs

## [1.17.5](https://github.com/runeya/runeya/compare/v1.17.4...v1.17.5) (2024-02-04)

**Note:** Version bump only for package @runeya/fronts-docs

## [1.17.4](https://github.com/runeya/runeya/compare/v1.17.3...v1.17.4) (2024-02-04)

**Note:** Version bump only for package @runeya/fronts-docs

## [1.17.3](https://github.com/runeya/runeya/compare/v1.11.23...v1.17.3) (2024-02-04)

**Note:** Version bump only for package @runeya/fronts-docs
</file>

<file path="modules/bugs/front/package.json">
{
  "name": "@runeya/modules-bugs-front",
  "version": "2.0.15",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "vue": "^3.4.18",
    "vue-eslint-parser": "^9.4.2"
  }
}
</file>

<file path="modules/dev-ops/front/package.json">
{
  "name": "@runeya/modules-dev-ops-front",
  "version": "2.0.5",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "vue": "^3.4.18",
    "vue-eslint-parser": "^9.4.2",
    "vue-router": "^4.2.5"
  }
}
</file>

<file path="modules/git/backend/index.js">
const commandExists = require('command-exists');

/** @type {import('@runeya/modules-plugins-loader-front/src/views').PluginSM<import('./Git')>} */
const plugin = {
  enabled: true,
  name: 'Git',
  displayName: 'Git',
  description: 'View and manage git across whole projects',
  icon: 'fab fa-git-alt',
  export: require('./Git'),
  placements: ['service', {
    position: 'sidebar',
    label: 'GIT',
    icon: 'fab fa-git-alt',
    goTo: { path: '/Git-NotUpToDate' },
    active: 'Git-NotUpToDate',
  }],
  order: 2,
  hidden: (service, stack, placement) => {
    if (placement === 'sidebar') return commandExists('git').then(() => false).catch(() => true);
    if (placement === 'service' && service?.git?.remote) return false;
    return true;
  },
  routes: require('./routes'),
};
module.exports = plugin;
</file>

<file path="modules/git/front/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.0.12](https://github.com/runeya/runeya/compare/v2.0.11...v2.0.12) (2025-01-24)

### Bug Fixes

* **editors:** can choose an editor by services ([0807227](https://github.com/runeya/runeya/commit/08072273fa2b3a7c3b133baddb2983771b68063c))
* reenable documentation and improve global git view ([2e4dd75](https://github.com/runeya/runeya/commit/2e4dd75c0513d92f12b8303b3dddd2f2fa6ccc73))

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-git-front

## [1.18.1](https://github.com/runeya/runeya/compare/v1.18.0...v1.18.1) (2024-02-20)

### Bug Fixes

* **theme:** cosmetic changes ([0da5cee](https://github.com/runeya/runeya/commit/0da5cee3b358d85bdc9c0fdf4907d7cd9b249e4a))

## [1.17.29](https://github.com/runeya/runeya/compare/v1.17.28...v1.17.29) (2024-02-15)

### Bug Fixes

* **theme:** add black theme ([bee4697](https://github.com/runeya/runeya/commit/bee469731be182ac929298dc13fe1c230eccb7ba))

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

### Bug Fixes

* various changes ([06e6241](https://github.com/runeya/runeya/commit/06e624176595b95c4227fe684242919c7eeda192))

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

### Bug Fixes

* cosmetic changes ([a18735e](https://github.com/runeya/runeya/commit/a18735e5b5cec706f3cdf4c4f4ca22482ce7ea0f))

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

### Bug Fixes

* link front to backend deps ([66b3135](https://github.com/runeya/runeya/commit/66b313523d99765b692208de0043303dcb6a0914))
* link front to backend deps ([54fcbf3](https://github.com/runeya/runeya/commit/54fcbf371cf03dc4f51a7196de15fe5d352088e9))

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-git-front

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/global-scripts/front/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-global-scripts-front

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

### Bug Fixes

* improve performance + add jsoncrack view ([c534a97](https://github.com/runeya/runeya/commit/c534a9749162f5f15589ec335da149656c757bfb))

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

### Bug Fixes

* resolve issues for permission on docker volumes + cosmetic changes ([7a822cd](https://github.com/runeya/runeya/commit/7a822cd1c205e5808247075828c1d3ce49d1524b))

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

### Bug Fixes

* link front to backend deps ([66b3135](https://github.com/runeya/runeya/commit/66b313523d99765b692208de0043303dcb6a0914))
* link front to backend deps ([54fcbf3](https://github.com/runeya/runeya/commit/54fcbf371cf03dc4f51a7196de15fe5d352088e9))

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-global-scripts-front

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/json-formatter/front/package.json">
{
  "name": "@runeya/modules-json-formatter-front",
  "version": "2.0.5",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "json-tree-view-vue3": "^1.0.1",
    "jsonrepair": "^3.5.1",
    "vue": "^3.4.18",
    "vue-eslint-parser": "^9.4.2",
    "vue-router": "^4.2.5"
  }
}
</file>

<file path="modules/node-repl/front/package.json">
{
  "name": "@runeya/modules-node-repl-front",
  "version": "2.0.5",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "vue": "^3.4.18",
    "vue-eslint-parser": "^9.4.2"
  },
  "dependencies": {
    "xterm": "^5.3.0",
    "xterm-addon-fit": "^0.8.0"
  }
}
</file>

<file path="modules/npm/front/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.0.16](https://github.com/runeya/runeya/compare/v2.0.15...v2.0.16) (2025-01-24)

### Bug Fixes

* **Npm:** priority to commands over rootpath ([460df64](https://github.com/runeya/runeya/commit/460df64d4ed66056ae26c213b8f83e5fe932d980))

## [2.0.15](https://github.com/runeya/runeya/compare/v2.0.14...v2.0.15) (2025-01-24)

### Bug Fixes

* **Npm:** support for new command selector ([edfbb76](https://github.com/runeya/runeya/commit/edfbb76cfddec911a210f5be9554e497c60f92fb))

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-npm-front

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

### Bug Fixes

* cosmetic changes ([a18735e](https://github.com/runeya/runeya/commit/a18735e5b5cec706f3cdf4c4f4ca22482ce7ea0f))

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

### Bug Fixes

* link front to backend deps ([66b3135](https://github.com/runeya/runeya/commit/66b313523d99765b692208de0043303dcb6a0914))
* link front to backend deps ([54fcbf3](https://github.com/runeya/runeya/commit/54fcbf371cf03dc4f51a7196de15fe5d352088e9))

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-npm-front

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/openai/front/package.json">
{
  "name": "@runeya/modules-openai-front",
  "version": "2.0.5",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "dayjs": "^1.11.10",
    "vue": "^3.4.18",
    "vue-eslint-parser": "^9.4.2"
  }
}
</file>

<file path="modules/openapi/front/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-openapi-front

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

### Bug Fixes

* resolve issues for permission on docker volumes + cosmetic changes ([7a822cd](https://github.com/runeya/runeya/commit/7a822cd1c205e5808247075828c1d3ce49d1524b))

## [1.18.1](https://github.com/runeya/runeya/compare/v1.18.0...v1.18.1) (2024-02-20)

### Bug Fixes

* **theme:** cosmetic changes ([0da5cee](https://github.com/runeya/runeya/commit/0da5cee3b358d85bdc9c0fdf4907d7cd9b249e4a))

# [1.18.0](https://github.com/runeya/runeya/compare/v1.17.30...v1.18.0) (2024-02-19)

### Features

* **swagger:** can read an opoenapi url from service ([481b543](https://github.com/runeya/runeya/commit/481b54305b2606f6f360287b17a4b4270a99eb3d))
</file>

<file path="modules/plugins-loader/backend/plugins.js">
const plugins = {
  bugs: require('@runeya/modules-bugs-backend'),
  configuration: require('@runeya/modules-configuration-backend'),
  devOps: require('@runeya/modules-dev-ops-backend'),
  diff: require('@runeya/modules-diff-backend'),
  documentation: require('@runeya/modules-documentation-backend'),
  finder: require('@runeya/modules-finder-backend'),
  git: require('@runeya/modules-git-backend'),
  github: require('@runeya/modules-github-backend'),
  globalScripts: require('@runeya/modules-global-scripts-backend'),
  jsonFormatter: require('@runeya/modules-json-formatter-backend'),
  jwt: require('@runeya/modules-jwt-backend'),
  kanban: require('@runeya/modules-kanban-backend'),
  logs: require('@runeya/modules-logs-backend'),
  mongo: require('@runeya/modules-mongo-backend'),
  nodeRepl: require('@runeya/modules-node-repl-backend'),
  npm: require('@runeya/modules-npm-backend'),
  openai: require('@runeya/modules-openai-backend'),
  regex: require('@runeya/modules-regex-backend'),
  toolbox: require('@runeya/modules-toolbox-backend'),
  uuid: require('@runeya/modules-uuid-backend'),
  help: require('@runeya/modules-help-backend'),
  openapi: require('@runeya/modules-openapi-backend'),
  vscode: require('@runeya/modules-vscode-backend'),
  docker: require('@runeya/modules-docker-backend'),
  nodered: require('@runeya/modules-workflows-backend'),
};
module.exports = Object.keys(plugins).reduce((acc, key) => {
  if (plugins[key].enabled) acc[key] = plugins[key];
  return acc;
}, {});
</file>

<file path="modules/toolbox/front/package.json">
{
  "name": "@runeya/modules-toolbox-front",
  "version": "2.0.5",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "vue": "^3.4.18",
    "vue-eslint-parser": "^9.4.2",
    "vue-router": "^4.2.5"
  }
}
</file>

<file path="modules/vscode/backend/routes.js">
const express = require('express');
const open = require('open');
const pathfs = require('path');
const ws = require('workspace-tools');
const { readFile } = require('fs/promises');
const { readFileSync, existsSync } = require('fs');
const { execAsync } = require('../../../servers/server/helpers/exec');

const router = express.Router();

/** @param {import('@runeya/common-typings').Runeya} runeya */
const routes = (runeya) => {
  router.post('/vscode/install', async (req, res) => {
    await execAsync('code --install-extension ./runeya.vsix', { cwd: __dirname });
    res.send('ok');
  });
  router.delete('/vscode/uninstall', async (req, res) => {
    await execAsync('code --uninstall-extension runeya.runeya', { cwd: __dirname });
    res.send('ok');
  });

  router.get('/vscode/open-url', async (req, res) => {
    const url = req.query.url?.toString();
    if (url) open(url);
    res.send('ok');
  });
  router.get('/vscode/get-services-from-file', async (req, res) => {
    try {
      if (!req.query.file) return res.status(400).send('file params is required');
      const packageRoot = ws.findPackageRoot(req.query.file?.toString());
      let projectRoot;
      try { projectRoot = ws.findProjectRoot(req.query.file?.toString()); } catch (error) { projectRoot = packageRoot; }
      if (!packageRoot) return res.status(400).send('no package found');
      if (!projectRoot) return res.status(400).send('no package found');
      const monorepo = packageRoot !== projectRoot;
      if (monorepo) {
        const packageInfos = await ws.getPackageInfosAsync(projectRoot);
        const { dependents: dependentsMap } = ws.createDependencyMap(packageInfos);
        const packageJSON = JSON.parse(await readFile(pathfs.resolve(packageRoot, './package.json'), 'utf-8'));
        const dependents = [
          ...(dependentsMap.get(packageJSON.name) || []),
        ];
        const services = runeya.getServices().filter((service) => {
          const servicePackageNames = [
            service.getRootPath(),
            ...service.commands.map((cmd) => cmd.spawnOptions?.env),
          ]
            .flat(100)
            .filter((a, i, arr) => (
              a
              && !arr.slice(0, i).includes(a)
              && a.toString() !== projectRoot
              && existsSync(pathfs.resolve(a.toString(), './package.json'))
            ))
            .map((path) => JSON.parse(readFileSync(pathfs.resolve(path?.toString() || '', './package.json'), 'utf-8')).name);
          return dependents.some((packageName) => servicePackageNames.includes(packageName))
            || servicePackageNames.includes(packageJSON.name);
        });
        res.json(services);
      } else {
        const packageRoot = ws.findPackageRoot(req.query.file?.toString());
        let projectRoot;
        try {
          projectRoot = ws.findProjectRoot(req.query.file?.toString());
        } catch (error) { projectRoot = packageRoot; }
        if (!packageRoot) return res.status(400).send('no package found');
        if (!projectRoot) return res.status(400).send('no package found');
        const services = runeya.getServices().filter((service) => {
          const servicePaths = [
            service.getRootPath(),
            ...service.commands.map((cmd) => cmd.spawnOptions?.env),
          ]
            .flat(100)
            .filter((a, i, arr) => (
              a
              && !arr.slice(0, i).includes(a)
              && existsSync(pathfs.resolve(a.toString(), './package.json'))
            ));
          return servicePaths.includes(projectRoot);
        });
        res.json(services);
      }
    } catch (error) {
      console.error(error);
      res.json([]);
    }
    return null;
  });
  return router;
};

module.exports = routes;
</file>

<file path="servers/server/bin/www">
#!/usr/bin/env node
process.title = 'runeya';
const args = require('../helpers/args');


require('dotenv').config();
(async () => {
  if(args['pull-env']) {
    await require('../models/stack').selectConf();
    const service = require('../models/stack').findService(args.s)
    if(!service) {
      console.error('Service', args.s, 'not found')
      process.exit(1)
    }
    const envs = await service.buildEnvs(args['e'])
    console.log(Object.keys(envs).reduce((agg, key) => (agg+=`\n${key}=${envs[key]}`), '').trim())
    process.exit(0)
  } else {
    console.log('Root path:', args.rootPath)
    require('./server')
      .launch()
        .catch((err) => {
          console.error(err)
          return err
        })
  }
})()
</file>

<file path="servers/server/models/EncryptionKey.js">
const { existsSync } = require('fs');
const path = require('path');
const { writeFile, readFile, appendFile } = require('fs/promises');
const { randomUUID } = require('crypto');
const dbs = require('../helpers/dbs');
const { generateKey, encrypt, decrypt } = require('../helpers/crypto');
const reencryptNodered = require('../helpers/reencrypt-nodered');
const pathfs = require('path');
const args = require('../helpers/args');

class EncryptionKey {
  constructor() {
    this.encryptionKey = '';
  }

  #getDb() {
    return dbs.getDb('encryption-key', { encrypted: false });
  }

  async init() {
    this.encryptionKey = (await this.#getDb().read()).encryptionKey;
    // Exclude db from git
    const dirname = path.dirname(await dbs.getDb('encryption-key', { encrypted: false }).getPath());
    const gitignorePath = path.resolve(dirname, '.gitignore');
    if (!existsSync(gitignorePath)) {
      writeFile(gitignorePath, 'encryption-key.json');
    } else {
      const gitignoreFile = (await readFile(gitignorePath, 'utf-8')).split('\n');
      const gitignoreHasKey = (key) => gitignoreFile.some((line) => line.trim() === key);
      if (!gitignoreHasKey('encryption-key.json')) await appendFile(gitignorePath, '\nencryption-key.json');
      if (!gitignoreHasKey('overrides')) await appendFile(gitignorePath, '\noverrides');
    }
  }

  async update() {

    console.log(JSON.stringify(['runeya', 'update'],(_, v) => (typeof v === 'function' ? `[func]` : v)));
    return this.#getDb().write(this.toStorage());
  }

  toStorage() {
    return {
      encryptionKey: this.encryptionKey,
    };
  }

  async generateKey() {
    return generateKey();
  }

  async testKey(encryptionKey) {
    try {
      const variable = randomUUID();
      const result = await encrypt(variable, { encryptionKey });

      const decrypted = await decrypt(result, { encryptionKey });
      if (decrypted === variable) return true;
      return false;
    } catch (error) {
      console.error(error);
      return false;
    }
  }

  async saveKey(key, {noReload} = {noReload: false}) {
    if (!await this.testKey(key)) throw new Error('Key not valid');
    try {
      const envSample = (await dbs.getDbs('envs'))[0];
      if (envSample) await dbs.getDb(`envs/${envSample}`).read();
      if (this.encryptionKey) {
        await reencryptNodered(this.encryptionKey, key, pathfs.resolve(require('./stack').getRootPath(), 'nodered/flow_cred.json'))
        await dbs.reencrypt(this.encryptionKey, key)
      };
    } catch (error) {
      console.error(error);
    }
    const shouldRestart = this.encryptionKey !== key
    this.encryptionKey = key;
    await this.update();
    if(!noReload) {
      await require('./stack').selectConf();
    }
    if(shouldRestart) {
      console.log('Restart...')
      require("child_process").spawn(process.argv[0], process.argv.slice(1), {
        cwd: args.initialCwd,
        detached: true,
        stdio: "inherit"
      }).unref();
      process.exit(0)
    }
    return key;
  }
}

module.exports = new EncryptionKey();
</file>

<file path=".runeya/dbs/services/Server.encrypted.json">
QYHvoJpJ1fFGYp/YA1UYpS59bUOCF+CqQfGPqB/79UzNNl6oJnj6wz4CleivHTtvSlOFSJxywgtp2Lw0naBKe8BEOqSYKgRkV2A7T9JGBUutSMspWUvcq6XU4Z9WZMs8vAuqwsRGp9Gg7U1beaPl1PQc86vCjbiZaNsT7l2pOB6F7Jjw+0hNzC5rxo5D0J9d9+JlrxrWFEosz04LtX4wBfmHcVOX+us9cBDMwfMK+vMPt1VRuyC8GZ1QRTRGKPz5/poulMfhgFeOkenwQktaOLl04UzHya0XI+Ucih07KribUXAbiK7JFRoqHgBkKUrqdP3ar/soQIfJSmOIqR/5GzO87+RnGB+lIcl6YtPSNMSiUtuz7F+HLAgmxZnlZDQwOS2NjFyC57nBJew1RbJdddLPBVVIymUOxpJJ4JWXqDN4636hPc5+kEtkb+7SMxMPdWNIcWaN8V9vjzKnDJM3QWbfPaaSi0Wr5ORMMkSbWXVekVOElYQOea+ilWdB4jjUFI1eWE1ikqTcjpF6l92+1gdU0LvxNiFbmbNDi3ToeM0w3JrBjRiVoOEbm8vQXRuaWFXvc0rHYWXa9fbNitmdxsQENoYU1UCv8zJM4CaTmO5tEwWqsU1PMbzMLYEuNNXUHiqpbHjlKfH31brZyPcCWMiRuGG2opUA9oPZ7+t5Y9VOshbXeRW32PVh8FF68nKtiMudsjQnjwTg8kbgBR+UnTWsdWwFmGOZfGnm3QK68TOsPpDzaxUWW/e2Kjvh8sRE0BWe8ArcLlnR+Io1UEgRupkQti0nHzOtDryktKYxFool23hSFnIC1RoRbKmM4DW8uXIRioM9i3CCiDXg0RME6TMnh2ENfDi+PR+qdvuHLDPj1qWqf5R263LjQanr71TTpVWwxdlPqynqhAhBwba45j0zunaeNjfoHEmB4iTxy24ZAz+Q7yRdVZ39mxMpdC0xVmA+G07X6bGvIS7qtNQvpvTQ9FkECha9g3UleHsCv2IAUPmG0kzN/CyBePWJi3jxz/5DrYwkjhkRID4eQpnGYUp4MAkVr3M/L932vC6Hwj0R+n2Mp8sVD0qgOAQJup1rvYoJ4Z+0MIEZE4Xx5J6hkQbCEZUDDM1DOapAUQmD6ptM4Znp+DzCaeQcd32JUih6wVmbVYSKrx4Q2Oy778Ntp+UWTzqMT7168mv7G3bP6FntT7h9Qgrd7l0YcjSHYYhRCWo9GgWOdtht9PTv+z6v2DemBADEbrPQ1I8us05pNxSUPjuV8b7CUFycWDfzVUOYlZAsfUj5QXjfrq122+l5CClCjueGq6RD5BOOHyGkIE+I/TDHIxCTBxFbw2D/lWzc+qplk3hTzjwFuNTocxx7R7XKHy12KLcKa+Ggi7i07uR/UkhS+ihE1OpJmdnrzP5KwxzkeSDbRTCAwMqmKi5a+JICgUdk0nI+ULx1Az0x6IglR9hKrsHe4uQi0RuXP8zRX/dRBZ8MvPRzCcv2cntnzQl/G33JlkAolTxo2uJJAjwk2cG9u3mex6M7rXI1zgTsY+25R81z9wId3nrwQgc0/9VHNPLDJQ6ElPA2QXo/2sPhm7EKSWshinALI75XOtv4Dh8xB+F7EixmgO2AtEi3odQAzQGzDrqlT5+Lt+r320crxpbh4Ny9Oq/EkjID+jX9samCC9IT75WA5wZmQEA1gz2kdUODnapR7NJiHYtU5GMwyaKibGiwuTZVOyW18kTrjI4Z8YKVHphm5Mg1NY8kDOxn0vHL7mtZ9XvLskqasaq4/cwRb0CSikQIHeIhsqqTUzMh+v9USzQYYdyuRS3TQeE7qdWV7i1j81waWRCcZKtat6jcpjIMj9pp1ov+EKmlVCCZMMUPCVVkuVzYw9UrzM6T6vEjGZktw7gsND7TCqzeINe1s/ECi+B3MkDZOtGRlBbdbmUBckur7HL9M6MICnoGoqkLuXVZahvGzlx//sBRjxul59B4bK+cxrpuV1CeFOt4tSysItydPz53x9amFINcEMpx8asulHDbp9GFXB/11UC77kTxINyxA/RsPpl2Ou92g8fRBPlXJ67YBp9pEkpiYqCb5cqY+nu2JiUjccji1yr5wNlb4QH2xS/RNoTqjLmGgYCTt3sFR0+D6+tKS9PqZv9JNPuIbdB/jsrydUAl9jHtbR0oEUXm+kjc+R5D0HWlB5XfzfKSQWCK83fB8Bk7rReOuaa3xPOQ2XQPZnoWzj137GnR2Hn0HaQmsP2n8EDDFBCmUBm+HNABNdSkGY3SwGgc2B86YYHXs9D7LJ0d3UR9s5BzNpay6cM7t5YHwiiXMrI4u/d3kZy7MM0DJUryYg7lzReM3RlqdwU5Hi16ApNTZxZQftIIaAD+YZflrmfVWxEy0vdatdr4gzu4n1/Q2++Qa8g6X2SGNYXVc0Pzc9Rtfn5/wzym7VzgsQAxN7U0oqua4xGkoPtCHvFWsOT/9EUlxh7d2lFLlQySvkPEAtz+a9myo147KU+KGvKdMZldwqMcm5lspVXJxOh/QWyJzKGL13OonTvQrZ6O45j89ugB12WaSB80vwGZjoSJ88sAqaIgUSGA41j9mbUqElXV6fzZtwZzI0S9XSYqL8fX2To7mCgmNmWZ/Bmc3rdAjSrShOdnbB3r9bHheforU7Zjijs/7+MpRInAghTPpw4mZaSXoqCdFuI0Cwvchz0VdqUEosvv29SfRkCCLtH3BUM8ZvlQbRjfhwh975h/zGOx2MoFY1KwMQYJqebyGkl0Qhn1SY0tKGWR4g3BV+JosJNdhjxZ5lBD7+7Q1GP3g1CaN5U18yfoqV22AhKwCqGIf9pfAk1orO2S/C15+b+dsqqc4VayxQTmDRUQczmpKOhlNuEA2j9SX68LFUXRROIIRzoN/SUl95JiwbKoB1Q13ilp0UqwiY00/f2WMNpYlp5Awhjt4XSje/uaAyygV29T/aplgrucrdlXV/jtfaBpRObMoGsXKgbgBilQubmv7ppxAwX9WxPRAx+60TBOr7KugU+PIuG2VGxNfXy6k+Nm982kZGk306u9ywljvBywYJoPz6fSo08C7JEy7QkjicC3N6dDZ6D6nTJPHO3sHLwlNgH67TKKivxxpq0BKiyzeIXN4G4MxWUi3qH71NRMSpWwS8zP1GJFeyZPKRswfSnJQyd1384ebUtx73L02aVCigfdHHfLi2mV+3JRSEdtXdHMY05i4qIIcSeSwsKHDYpkJ2HNlbXqWSwi0KVALIbqITdAJ9njYIUO8KAcMbseW2VdcuFbQXnl28gFKiOaRd26abL8YyqJiZOaTkjSlLGAw4irABD4Xay3y0GYlQXpxiQE1cbesXTSS5/EhCpnmvybqVd8R/lKh8R8s9RoW8MtiyzvX1pqFxO+dzDeh5+pK7omzS3S1Xj+VUhJ/j5Pq8UK3lqq7fkp0CyAqknx5BFJ8+e7fd0+pJ6P6vPBByhj7ONANSIugnnBFUPfMfF+YvKtzvbUHV/uB1KRtsgFlKbcZMOVJzbi4eOlINZDA06ZKc2+lFP2HpyG1fySc1Q40AElyDPn8dyjAZRTxCduGn6rWRFTs7GZ2e+gXpCVBSkcxo5xbELfF1H0Wtn+sdeD/+qrwvW2IYlXguJC/4EtviCPXaDzqVx6Kbwr3hZ8Bq5Thf0CcCI3gAKs2Cv9DCxyP01n4iCb9YWfizfvS4gLbkDPxSiDaaMCs0VIcgxKtiBXTY1obcKbXMRenVL+ixfBpjxa61EQdvQjz4/9v5vF6y8CQly2pbc5yJ+Fg2xYjjY0XNqvYeRmhwELlDTae9aegT9HNv3tYs4EEto18Dg9axPgbjyU20JT/gsDBxQaDW6Kd4wFqLlwh9XVqlph5kwrWW43t4HdUvPAzGDvkO2HD9jC576W4uGaQKskQMbcEQUHbTEdvdz89nTtx0oJYT2jGJ5FBZHJg1y/otADALg=
</file>

<file path="common/check-monorepo/package.json">
{
  "name": "@runeya/common-check-monorepo",
  "version": "2.1.1",
  "private": true,
  "description": "",
  "repository": "https://github.com/runeya/runeya",
  "main": "src/index.spec.js",
  "scripts": {
    "start": "jest",
    "serve": "jest --watch",
    "test": "jest"
  },
  "author": "",
  "license": "ISC",
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "@swc/core": "^1.10.2",
    "@swc/jest": "^0.2.37",
    "jest": "^29.7.0",
    "jest-sonar-reporter": "^2.0.0"
  }
}
</file>

<file path="common/express/src/index.js">
require('express-async-errors');
const express = require('express');
const cors = require('cors');
const pathfs = require('path');
const fs = require('fs');
const healthCheck = require('@runeya/common-express-health-check');
const helmet = require('helmet').default;
const cookieParser = require('cookie-parser');
const compression = require('compression');
const http = require('http');
const Socket = require('@runeya/common-socket-server');
const CustomObservable = require('@runeya/common-socket-server/src/CustomObservable');

const onServerLaunch = new CustomObservable()
let _server
require('express-async-errors');

module.exports = {
  onServerLaunch, 
  getServer: () => {
    return new Promise((res) => {
      if(_server) return res(_server)
      onServerLaunch.subscribe(() => {
        res(_server)
      })
    })
  },
  /**
   * @param {{
   *  port: number | string,
   *  baseUrl?: string,
   *  helmetConf?: import('helmet').HelmetOptions | null,
   *  corsConf?: import('cors').CorsOptions,
   *  beforeAll?: ({app, server}) => any,
   *  afterAll?: () => any,
   *  socket?: boolean,
   *  onListening?: (server: {server: http.Server<typeof http.IncomingMessage, typeof http.ServerResponse>, app: import('express').Express}) => any,
   *  beforeStatic?: (server: {server: http.Server<typeof http.IncomingMessage, typeof http.ServerResponse>, app: import('express').Express}) => any,
   *  afterControllers?: (server: {server: http.Server<typeof http.IncomingMessage, typeof http.ServerResponse>, app: import('express').Express}) => any,
   *  controllers?: () => import('express').RequestHandler,
   *  staticController?: string,
   *  noGreetings?: boolean,
   *  apiPrefix?: string
   *  bodyLimit?: string
   *  healthPath?: string
   * }} param0
   * @returns
   */
  async launch({
    port = process.env.PORT || 4002,
    baseUrl = __dirname,
    helmetConf = {},
    corsConf = {},
    beforeAll = () => {},
    afterAll = () => {},
    onListening = () => { },
    beforeStatic = () => { },
    afterControllers = () => { },
    controllers = () => () => {},
    staticController = undefined,
    noGreetings = false,
    socket = false,
    apiPrefix = '/api',
    bodyLimit = '50mb',
    healthPath = apiPrefix,
  }) {
    const pkgJSONPath = pathfs.resolve(baseUrl, 'package.json');
    const isPkgJSONExists = fs.existsSync(pkgJSONPath);
    const pkgJSON = isPkgJSONExists ? require(pkgJSONPath) : { name: 'unknown', version: 'unknown' };
    const appVersion = pkgJSON.version;
    const appName = pkgJSON.name;

    console.log(`<h2 style="background: linear-gradient(90deg, rgba(52,70,91,1) 0%, rgba(28,92,227,1) 100%);color:white;border-radius:10px;padding:10px;width: max-content">${appName.replace('@runeya/', '')}</h2>`);
    console.log(`v${appVersion} started, listening on port ${port}.`);

    const app = express();

    const server = http.createServer(app);
    if (helmetConf) {
      app.use((req, res, next) => {
        if(req.url.startsWith('/red')) return next()
        helmet(
          helmetConf
        )(req, res, next)
      });
    }

    console.log('Enable cors...');
    app.use(cors(corsConf));
    app.options('*', (req, res, next) => {
      res.setHeader('Access-Control-Allow-Credentials', 'true');
      next();
    });

    console.log('Enable JSON body...');
    app.use(express.json({ limit: bodyLimit }));
    app.use(express.urlencoded({ extended: true }));

    console.log('Enable Cookie parser...');
    app.use(cookieParser());

    console.log('Enable Compression...');
    app.use(compression());

    console.log('Enable health check...');
    app.use(healthPath, healthCheck(express, { name: appName, version: appVersion }));

    beforeStatic?.({ server, app });

    console.log('Apply additional routes...');
    if (staticController) {
      app.use('/', express.static(staticController));
    }

    if (socket) {
      console.log('Enable socket...');
      Socket.sockets.connect(server);
    }
    app.use(apiPrefix, controllers());

    if (!noGreetings) {
      app.get('/', (req, res) => res.json({ appName, appVersion }));
    }

    afterControllers?.({ server, app });
    if (process.env.NODE_ENV === 'HFBXdZMJxLyJoua28asEaxRixJ6LriR7FnRzX6pwA7pFjZ') {
      const httpProxy = require('http-proxy');
      const proxy = httpProxy.createProxy({ ws: true });
      server.on('upgrade', (req, res) => {
        if (req.url === '/') {
          proxy.ws(req, res, {
            target: 'ws://127.0.0.1:5173',
          });
        }
      });
      app.use((req, res) => {
        proxy.web(req, res, {
          target: 'http://127.0.0.1:5173',
        });
      });
    }
    console.log('Enable error handling...');
    app.use(require('@runeya/common-express-error-handler')());

    console.log('Enable 404 handling...');
    app.use(require('@runeya/common-express-404'));

    console.log('Apply additional tasks before launch...');
    await beforeAll({ app, server });

    console.log('Launch...');
    server.on('listening', () => onListening({ server, app }));

    server.listen(port, async () => {
      _server = server
      onServerLaunch.next({ server, app })
      console.log('<h1>✓ Launched</h1>');
    });
    server.on('close', async () => {
      await afterAll();
    });

    return server;
  },
  express,
};
</file>

<file path="common/socket-front/package.json">
{
  "name": "@runeya/common-socket-front",
  "private": true,
  "version": "2.1.0",
  "description": "",
  "repository": "https://github.com/runeya/runeya",
  "main": "src/index.js",
  "scripts": {
    "test": ""
  },
  "author": "",
  "license": "ISC",
  "peerDependencies": {
    "vue": "^3.2.45"
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*"
  }
}
</file>

<file path="common/socket-server/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

# [2.1.0](https://github.com/runeya/runeya/compare/v2.0.17...v2.1.0) (2025-01-31)

### Features

* **nodered:** add nodered into app ([f897eb2](https://github.com/runeya/runeya/commit/f897eb2c4a9128e0d4615f6765d3ef0ce1d2ca3e))

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* remove some dependencies ([5667402](https://github.com/runeya/runeya/commit/5667402d57add874a89ba029ce62b16b3bbed9e0))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

* feat!: migrate runeya to entire UI ([e173073](https://github.com/runeya/runeya/commit/e173073d932be7e400b1f51261c090116e8fb543))

### BREAKING CHANGES

* all stack files are useless now

## [1.18.11](https://github.com/runeya/runeya/compare/v1.18.10...v1.18.11) (2024-11-11)

### Bug Fixes

* remove eiwos ([12ff054](https://github.com/runeya/runeya/commit/12ff0548941856cd5ca627f1a0a157141366b3cf))

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

### Bug Fixes

* improve performance + add jsoncrack view ([c534a97](https://github.com/runeya/runeya/commit/c534a9749162f5f15589ec335da149656c757bfb))

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

### Bug Fixes

* various changes ([06e6241](https://github.com/runeya/runeya/commit/06e624176595b95c4227fe684242919c7eeda192))

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))

## [1.17.10](https://github.com/runeya/runeya/compare/v1.17.9...v1.17.10) (2024-02-04)

**Note:** Version bump only for package @runeya/common-socket-server

## [1.17.9](https://github.com/runeya/runeya/compare/v1.17.8...v1.17.9) (2024-02-04)

**Note:** Version bump only for package @runeya/common-socket-server

## [1.17.8](https://github.com/runeya/runeya/compare/v1.17.7...v1.17.8) (2024-02-04)

**Note:** Version bump only for package @runeya/common-socket-server

## [1.17.7](https://github.com/runeya/runeya/compare/v1.17.6...v1.17.7) (2024-02-04)

**Note:** Version bump only for package @runeya/common-socket-server

## [1.17.6](https://github.com/runeya/runeya/compare/v1.17.5...v1.17.6) (2024-02-04)

**Note:** Version bump only for package @runeya/common-socket-server

## [1.17.5](https://github.com/runeya/runeya/compare/v1.17.4...v1.17.5) (2024-02-04)

**Note:** Version bump only for package @runeya/common-socket-server

## [1.17.4](https://github.com/runeya/runeya/compare/v1.17.3...v1.17.4) (2024-02-04)

**Note:** Version bump only for package @runeya/common-socket-server

## [1.17.3](https://github.com/runeya/runeya/compare/v1.11.23...v1.17.3) (2024-02-04)

**Note:** Version bump only for package @runeya/common-socket-server
</file>

<file path="fronts/app/src/helpers/Socket.js">
import { Socket } from '@runeya/common-socket-front';

export default {
  /** @type {Awaited<Socket>} */
  // @ts-ignore
  socket: null,
  async init(url) {
    await Socket.init(url);
    this.socket = Socket;
  },
  on(...args) {
    this.socket.on(...args);
  },
  off(...args) {
    this.socket.off(...args);
  },
  emit(...args) {
    this.socket.emit(...args);
  },
};
</file>

<file path="fronts/app/src/models/stack.js">
import { ref } from 'vue';
import axios from '../helpers/axios';
import Service from './service';
import Socket from '../helpers/Socket';

function Stack() {
  /** @type {import('vue').Ref<import('./service').default[]>} */
  this.services = ref([]);
  Socket.on('conf:update', (/** @type {string[]} */data) => {
    if (data.length) {
      data.forEach((label) => {
        const service = this.services.value.find((_service) => _service.label === label);
        if (service) service.fetch();
      });
    }
  });
}

Stack.prototype.loadServices = async function () {
  /** @type {{data: import('./service').default[]}} */
  const { data: services } = await axios.get('/stack/services');
  this.services.value = services.filter((s) => s).map((service) => new Service(service));
  return this.services.value;
};
Stack.prototype.scenarios = async function (type, data) {
  const { data: flows } = await axios.get('/red/flows');
  return flows.filter(flow => {
    if (type === 'services' && flow.launchType === type) {
      return flow.services.split(',').includes(data)
    }
    return false
  });
};

Stack.prototype.getEnvironment = async function () {
  const { data: environment } = await axios.get('/stack/environment');
  return environment;
};

Stack.prototype.getAdditionalThemes = async function () {
  const { data: additionalThemes } = await axios.get('/stack/additional-themes');
  return additionalThemes;
};

Stack.prototype.getEnvironments = async function () {
  const { data: environments } = await axios.get('/stack/environments');
  return environments;
};
/** @param {string} environment */
Stack.prototype.changeEnvironment = async function (environment) {
  const { data: environments } = await axios.post('/stack/environment', { environment });
  return environments;
};

Stack.prototype.shouldSetup = async function () {
  const { data: shouldSetup } = await axios.get('/crypto/should-setup');
  return shouldSetup;
};

/** @param {{label: string, color: string, bgColor: string}} environment */
Stack.prototype.createEnvironment = async function (environment) {
  const { data: environments } = await axios.post('/stack/environment/create', { environment });
  return environments;
};

Stack.prototype.getAllConfsPath = async function () {
  const { data: paths } = await axios.get('/stack/all-confs-path');
  return paths;
};
/** @param {string} path */
Stack.prototype.selectConf = async function (path) {
  await axios.post('/stack/select-conf/', { path });
};
/** @param {string} path */
Stack.prototype.deleteConf = async function (path) {
  await axios.post('/stack/delete-conf/', { path });
};

/** @param {{label?: string, enabled?: boolean}[]} services */
Stack.prototype.launchServices = async function (services) {
  await axios.post('/stack/choose', services);
  return this.loadServices();
};
/** @param {string} label */
Stack.prototype.getService = async function (label) {
  if (!this.services.value.length) await this.loadServices();
  return this.services.value.filter((service) => service.label === label).pop();
};

Stack.prototype.getAvailableEditors = async function () {
  const { data: editors } = await axios.get('/editors/available-editors');
  return editors;
};

Stack.prototype.getEnabledServices = async function () {
  if (!this.services.value.length) await this.loadServices();
  return this.services.value.filter((service) => service.enabled);
};

export default new Stack();
</file>

<file path="fronts/docs/package.json">
{
  "name": "@runeya/fronts-docs",
  "version": "2.0.9",
  "private": true,
  "description": "Monitor processes as a stack",
  "repository": "https://github.com/runeya/runeya",
  "author": {
    "name": "runeya",
    "email": "corentinlabroche@gmail.com",
    "url": "https://corentinlabroche.fr/"
  },
  "scripts": {
    "serve": "vitepress dev",
    "build": "vitepress build",
    "test": ""
  },
  "main": "./background.js",
  "files": [
    "server/**/*",
    "typings/**/*",
    "modules/**/*",
    ".env.production",
    "package.json"
  ],
  "typings": "./typings/export.d.ts",
  "types": "./typings/export.d.ts",
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "vitepress": "^1.5.0"
  },
  "postcss": {
    "plugins": {
      "autoprefixer": {}
    }
  },
  "browserslist": [
    "> 1%",
    "last 2 versions"
  ],
  "bin": "server/bin/www",
  "keywords": [
    "runeya",
    "stack",
    "microservices",
    "git",
    "github",
    "bitbucket",
    "npm",
    "process",
    "command",
    "cli",
    "monitor",
    "monitoring"
  ],
  "license": "MIT",
  "packageManager": "yarn@4.0.2"
}
</file>

<file path="modules/docker/front/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-docker-front

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

### Bug Fixes

* improve performance + add jsoncrack view ([c534a97](https://github.com/runeya/runeya/commit/c534a9749162f5f15589ec335da149656c757bfb))

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

### Bug Fixes

* **docker:** add docker support ([f3abb42](https://github.com/runeya/runeya/commit/f3abb4237b8f708585769a8ff51c393d5f21dc5c))
* resolve issues for permission on docker volumes + cosmetic changes ([7a822cd](https://github.com/runeya/runeya/commit/7a822cd1c205e5808247075828c1d3ce49d1524b))

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

### Bug Fixes

* cosmetic changes ([a18735e](https://github.com/runeya/runeya/commit/a18735e5b5cec706f3cdf4c4f4ca22482ce7ea0f))

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

### Bug Fixes

* link front to backend deps ([66b3135](https://github.com/runeya/runeya/commit/66b313523d99765b692208de0043303dcb6a0914))
* link front to backend deps ([54fcbf3](https://github.com/runeya/runeya/commit/54fcbf371cf03dc4f51a7196de15fe5d352088e9))

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-docker-front

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/git/front/package.json">
{
  "name": "@runeya/modules-git-front",
  "version": "2.0.12",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "vue": "^3.4.18",
    "vue-eslint-parser": "^9.4.2",
    "vue-router": "^4.2.5",
    "xterm": "^5.3.0",
    "xterm-addon-canvas": "^0.5.0",
    "xterm-addon-fit": "^0.8.0",
    "xterm-addon-search": "^0.13.0"
  }
}
</file>

<file path="modules/global-scripts/front/package.json">
{
  "name": "@runeya/modules-global-scripts-front",
  "version": "2.0.5",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "vue": "^3.4.18",
    "vue-eslint-parser": "^9.4.2",
    "vue-router": "^4.2.5"
  }
}
</file>

<file path="modules/logs/backend/routes.js">
const express = require('express');
const { v4 } = require('uuid');

const router = express.Router();

/** @param {import('@runeya/common-typings').Runeya} runeya */
module.exports = (runeya) => {
  const history = runeya.getSave('history.json', {
    /** @type {History[]} */
    history: [],
  });

  const { findService, Socket } = runeya;
  router.get('/logs/:service/logs', (req, res) => {
    const service = findService(req.params.service);
    res.send(service ? service.store : []);
  });

  router.get('/logs/:service/autocomplete', (req, res) => {
    const msg = req.query.message;
    if (!msg && !req.query.force) return res.json([]);
    const historyToSend = groupBy(history.data.history, 'raw')
      .sort(((a, b) => a.timestamp - b.timestamp))
      .filter((a) => a?.raw?.startsWith(msg) || a.cmd?.startsWith(msg))
      .slice(-10);
    return res.json(historyToSend);
  });

  router.post('/logs/:service/prompt', async (req, res) => {
    const service = findService(req.params.service);
    /** @type {Record<any, any>} */
    let command = req.body.command || {};
    /** @type {number | undefined} */
    const pid = req.body.pid ? +req.body.pid : undefined;
    if (!command.spawnCmd) command.spawnCmd = '\n';
    /** @type {History} */
    let result = {
      id: v4(), pid, cmd: command.spawnCmd, args: [], raw: command.spawnCmd, timestamp: Date.now(), service: service.label || '',
    };
    if (pid) service.respondToProcess(pid, command.spawnCmd);
    else if (command) {
      const { spawnProcess, launchMessage } = await service.launchProcess(
        { spawnCmd: command.spawnCmd, spawnArgs: command.spawnArgs || [], spawnOptions: command.spawnOptions || {  } },
        false,
      );
      result = {
        ...result,
        pid: spawnProcess?.pid,
        raw: launchMessage.raw,
        timestamp: launchMessage.timestamp,
      };
      history.data.history.push(result);
      history.save();
    }

    res.json(result);
  });

  router.post('/logs/:service/terminate', (req, res) => {
    const service = findService(req.params.service);
    const {
      /** @type {number | undefined} */
      pid,
      /** @type {boolean | undefined} */
      forceKill,
    } = req.body;
    if (!pid) throw new Error('Pid is required');
    if (pid) service.terminate(pid, !!forceKill);
    Socket.emit('logs:update', []);
    res.send('ok');
  });

  router.delete('/logs/:service/logs', (req, res) => {
    const service = findService(req.params.service);
    service.store = [];
    Socket.emit('logs:clear', { label: service.label });
    res.send(service.store);
  });
  return router;
};

/**
 *
 * @param {Record<string, any>[]} xs
 * @param {string} key
 * @returns
 */
const groupBy = (xs, key) => {
  const group = xs.reduce((rv, x) => {
    if (!rv[x[key]]) rv[x[key]] = { ...x, number: 0, timestamps: [] };
    rv[x[key]].timestamps.push(x.timestamp);
    rv[x[key]].timestamp = x.timestamp;

    return rv;
  }, {});
  return Object.keys(group).map((key) => group[key]);
};

/**
 * @typedef {{
 *   id: string,
 *   cmd: string,
 *   args: string[],
 *   raw: string,
 *   timestamp: number,
 *   service: string,
 *   pid?: number,
 * }} History
 */
</file>

<file path="modules/npm/front/package.json">
{
  "name": "@runeya/modules-npm-front",
  "version": "2.0.16",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "vue": "^3.4.18",
    "vue-eslint-parser": "^9.4.2",
    "vue-router": "^4.2.5"
  }
}
</file>

<file path="modules/openapi/front/package.json">
{
  "name": "@runeya/modules-openapi-front",
  "version": "2.0.5",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "vue": "^3.4.18",
    "vue-eslint-parser": "^9.4.2",
    "vue-router": "^4.2.5"
  }
}
</file>

<file path="modules/plugins-loader/front/src/views.js">
import LogsVue from '@runeya/modules-logs-front/src/Logs.vue';
import GitVue from '@runeya/modules-git-front/src/Git.vue';
import NotUpToDate from '@runeya/modules-git-front/src/NotUpToDate.vue';
import NpmVue from '@runeya/modules-npm-front/src/Npm.vue';
import BugsVue from '@runeya/modules-bugs-front/src/Bugs.vue';
import ConfigsVue from '@runeya/modules-configuration-front/src/Configs.vue';
import OpenAI from '@runeya/modules-openai-front/src/OpenAi.vue';
import Toolbox from '@runeya/modules-toolbox-front/src/Toolbox.vue';
import UUID from '@runeya/modules-uuid-front/src/UUID.vue';
import JWT from '@runeya/modules-jwt-front/src/Index.vue';
import Mongo from '@runeya/modules-mongo-front/src/Index.vue';
import NodeREPL from '@runeya/modules-node-repl-front/src/Index.vue';
import Diff from '@runeya/modules-diff-front/src/Index.vue';
import Regex from '@runeya/modules-regex-front/src/Index.vue';
import JSONFormatter from '@runeya/modules-json-formatter-front/src/Index.vue';
import Documentation from '@runeya/modules-documentation-front/src/Index.vue';
import DevOps from '@runeya/modules-dev-ops-front/src/Index.vue';
import Github from '@runeya/modules-github-front/src/Index.vue';
import Kanban from '@runeya/modules-kanban-front/src/Index.vue';
import OpenApi from '@runeya/modules-openapi-front/src/Index.vue';
import GlobalScripts from '@runeya/modules-global-scripts-front/src/Index.vue';
import Finder from '@runeya/modules-finder-front/src/Index.vue';
import Help from '@runeya/modules-help-front/src/Index.vue';
import Vscode from '@runeya/modules-vscode-front/src/Index.vue';
import Docker from '@runeya/modules-docker-front/src/Index.vue';
import Workflows from '@runeya/modules-workflows-front/src/Index.vue';
import WorkflowsModals from '@runeya/modules-workflows-front/src/modals/Modals.vue';
import DynamicComponent from './DynamicComponent.vue';

const toolboxPlugins = [
  { name: 'JWT', component: JWT },
  { name: 'OpenApi', component: OpenApi },
  { name: 'Finder', component: Finder },
  { name: 'Git-NotUpToDate', component: NotUpToDate },
  { name: 'Regex', component: Regex },
  { name: 'UUID', component: UUID },
  { name: 'JSONFormatter', component: JSONFormatter },
  { name: 'Diff', component: Diff },
  { name: 'NodeREPL', component: NodeREPL },
  { name: 'Mongo', component: Mongo },
  { name: 'Help', component: Help },
  { name: 'OpenAI', component: OpenAI },
  { name: 'GlobalScripts', component: GlobalScripts },
  { name: 'Workflows', component: Workflows },
  { name: 'Kanban', component: Kanban },
  { name: 'Vscode', component: Vscode },
  { name: 'Docker', component: Docker },
  {
    name: 'Toolbox',
    component: Toolbox,
    children: [
      {
        path: ':plugin',
        props: true,
        component: DynamicComponent,
      },
    ],
  },
  {
    name: 'DevOps',
    component: DevOps,
    children: [
      {
        path: ':plugin',
        props: true,
        component: DynamicComponent,
      },
    ],
  },
];

/**
 * @type {{
 *  load?: boolean,
 *  name: string, cmp: import('vue').Component, routes?: import('vue-router').RouteRecordRaw[]
 * }[]}
 * */
const plugins = [
  { name: 'WorkflowsModals', cmp: WorkflowsModals, load: true },
  { name: 'DynamicComponent', cmp: DynamicComponent },
  ...toolboxPlugins.map(({ name, component, children }) => ({
    name,
    cmp: component,
    routes: [
      {
        path: `/${name}`,
        name,
        component,
        children,
      },
    ],
  })),
  { name: 'Logs', cmp: LogsVue },
  { name: 'Git', cmp: GitVue },
  { name: 'Github', cmp: Github },
  { name: 'Documentation', cmp: Documentation },
  { name: 'Npm', cmp: NpmVue },
  { name: 'Bugs', cmp: BugsVue },
  { name: 'Configuration', cmp: ConfigsVue },
];
export default plugins;

/**
 * @template T
 * @typedef {{
 *  enabled: boolean,
 *  name: string,
 *  displayName: string,
*   description?: string,
 *  icon?: string,
 *  order?: number,
 *  hidden?: (
 *    service: import('../../../../servers/server/models/Service') | null,
 *    stack: typeof import('../../../../servers/server/models/stack'),
 *    placement: 'toolbox' | 'sidebar' | 'dev-ops' | 'service' | 'global',
 *  ) => Promise<boolean> | boolean,
 *  routes?: (runeya: import('../../../../servers/server/models/stack')) => import('express').Router,
 *  export: T,
 *  finder?: (search: string, runeya: typeof import('../../../../servers/server/models/stack')) => import('../../../finder/backend/routes').FinderChoice[] | Promise<import('../../../finder/backend/routes').FinderChoice[]>
 *  placements: ({
 *    label: string,
 *    position?: 'toolbox' | 'sidebar' | 'sidebar-top' | 'dev-ops',
 *    icon?: string,
 *    img?: string,
 *    iconText?: string,
 *    goTo?: import('vue-router').RouteLocationRaw | string,
 *    active: string
 *  } | 'toolbox' | 'sidebar' | 'sidebar-top'  | 'dev-ops' | 'service' | 'global')[]
 * }} PluginSM
 */
</file>

<file path="modules/vscode/extension/src/helpers/initialize.js">
// eslint-disable-next-line import/no-unresolved
const vscode = require('vscode');
const _commandExists = require('command-exists');
const { execAsync } = require('./exec');

const commandExists = (cmd) => _commandExists(cmd).then(() => true).catch(() => false);

const { services, editor } = require('../views/views');
const {
  getAxios,
} = require('../networks/axios');
const Socket = require('../networks/Socket');

const findPorts = async () => {
  /** @type {string[]} */
  const ports = [];
  if (await commandExists('lsof')) {
    const lsof = await execAsync('lsof -i -n -P', {});
    const ports = lsof
      .trim().split('\n')
      .filter((line) => line.includes('stack-mon') && line.includes('LISTEN'))
      .map((line) => line.split(' ').map((a) => a.trim()).filter((a) => a).slice(-2)[0].split(':').pop());
    return ports;
  }
  if (await commandExists('netstat')) {
    try {
      const netstat = await execAsync('netstat -tlpn', {});
      const ports = netstat
        .trim().split('\n')
        .filter((line) => line.includes('stack-mon') && line.includes('LISTEN'))
        .map((line) => line.split('   ').map((a) => a.trim()).filter((a) => a)[2].split(':').pop());
      if (ports?.length) return ports;
    } catch (error) {
      console.error(error);
    }
  }
  return ports;
};

let connectInProgress = false;
module.exports = {
  isConnectInProgress: () => connectInProgress,
  /**
   * @param {vscode.ExtensionContext} context
   */
  connect: async (context) => {
    const ports = await findPorts();
    connectInProgress = true;
    let port;
    if (ports?.length) {
      port = await vscode.window.showQuickPick([
        ...ports,
        'Other',
      ]);
    }
    if (!port || port === 'Other') {
      port = await vscode.window.showInputBox({
        prompt: 'Which port to use',
        ignoreFocusOut: true,
      });
      if (!port) return;
    }

    context.globalState.setKeysForSync(['runeyaPort']);
    context.globalState.update('runeyaPort', port);
    await getAxios(context).get('/version')
      .then(async ({ data: version }) => {
        await module.exports.initSocket(context);
        context.globalState.update('runeyaAvailable', true);
        vscode.window.showInformationMessage(`Successfully connected to runeya v${version}`);
      })
      .catch(() => {
        vscode.window.showInformationMessage('Can\'t connect to runeya. Retry...');
        context.globalState.update('runeyaAvailable', false);
        module.exports.connect(context);
      })
      .finally(() => {
        connectInProgress = false;
      });
  },
  initSocket: async (context) => {
    await Socket.init(`http://localhost:${context.globalState.get('runeyaPort')}/socket`);
    services.update();
    editor.update(true);
    Socket.on('service:crash', async ({ label }) => {
      services.update();
      editor.update(true);
      vscode.window.showInformationMessage(`Service: ${label} crash`);
    });
    Socket.on('service:start', async ({ label }) => {
      services.update();
      editor.update(true);
      vscode.window.showInformationMessage(`Service: ${label} start`);
    });

    Socket.on('service:exit', async ({ label }) => {
      services.update();
      editor.update(true);
      vscode.window.showInformationMessage(`Service: ${label} exit`);
    });
    Socket.on('service:healthcheck:down', async ({ label }) => {
      services.update();
      editor.update(true);
    });
    Socket.on('service:healthcheck:up', async () => {
      services.update();
      editor.update(true);
    });
  },
};
</file>

<file path="modules/vscode/front/package.json">
{
  "name": "@runeya/modules-vscode-front",
  "version": "2.0.5",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "vue": "^3.4.18",
    "vue-eslint-parser": "^9.4.2",
    "vue-router": "^4.2.5"
  }
}
</file>

<file path="modules/workflows/backend/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.1.4](https://github.com/runeya/runeya/compare/v2.1.3...v2.1.4) (2025-03-16)

### Bug Fixes

* **nodered:** add possibility to launch single command or shortcut ([a9f5d09](https://github.com/runeya/runeya/commit/a9f5d094098c08a04278464013b0eb3956c460e9))

## [2.1.3](https://github.com/runeya/runeya/compare/v2.1.2...v2.1.3) (2025-03-05)

### Bug Fixes

* uuid vanilla for nodered ([20ec123](https://github.com/runeya/runeya/commit/20ec1232a9db39f024c8db3159123bd2266aa915))

## [2.1.2](https://github.com/runeya/runeya/compare/v2.1.1...v2.1.2) (2025-03-05)

### Bug Fixes

* set needed fields on nodered packagejson when missing ([8e6bdce](https://github.com/runeya/runeya/commit/8e6bdcef674023ed560d631fa2d0dc5f1cb16cfd))

## [2.1.1](https://github.com/runeya/runeya/compare/v2.1.0...v2.1.1) (2025-02-11)

### Bug Fixes

* improve code health ([865b996](https://github.com/runeya/runeya/commit/865b996fa0adcf49668fa770c465bac1f1d8f21a))
* **nodered:** respect git versionning ([0965d44](https://github.com/runeya/runeya/commit/0965d445f6ad3ff9165cb8b3c3397958229ff7a8))

# [2.1.0](https://github.com/runeya/runeya/compare/v2.0.17...v2.1.0) (2025-01-31)

### Features

* **nodered:** add nodered into app ([f897eb2](https://github.com/runeya/runeya/commit/f897eb2c4a9128e0d4615f6765d3ef0ce1d2ca3e))
</file>

<file path="servers/server/helpers/dbs.js">
const {
  existsSync, mkdirSync, writeFileSync, readFileSync,
  unlinkSync,
} = require('fs');
const pathfs = require('path');
const {
  readdir, mkdir, writeFile, readFile,
  unlink,
} = require('fs/promises');
const { fdir } = require('fdir');
const PromiseB = require('bluebird');
const { sockets } = require('@runeya/common-socket-server');
const args = require('./args');
const { encrypt, decrypt } = require('./crypto');
const alasql = require('alasql');

module.exports = new class {
  cache = {};

  getRootPath() {
    const rootPath = pathfs.resolve(args.rootPath, '.runeya/dbs');
    if (!existsSync(rootPath)) mkdirSync(rootPath, { recursive: true });
    return rootPath;
  }

  async getDbs(namespace = '') {
    const pathToDbs = pathfs.resolve(this.getRootPath(), namespace);
    if (!existsSync(pathToDbs)) await mkdir(pathToDbs, { recursive: true });
    return (await readdir(pathToDbs)).map((id) => id.replace(pathfs.extname(id), '').replace('.encrypted', ''));
  }

  async reencrypt(oldKey, newKey) {
    const api = new fdir().withFullPaths()
      .filter((path) => path.endsWith('encrypted.json'))
      .crawl(this.getRootPath());
    await PromiseB.map(api.withPromise(), async (file) => {
      const fileEncrypted = await readFile(file, 'utf-8');
      const additionnalNonce = file.split('.runeya').pop();
      const fileDecrypted = await decrypt(fileEncrypted, { additionnalNonce, encryptionKey: oldKey });
      const fileReEncrypted = await encrypt(fileDecrypted, { additionnalNonce, encryptionKey: newKey });
      await writeFile(file, fileReEncrypted, 'utf-8');
    });
  }

  getDb(id, { encrypted, defaultData } = { encrypted: true, defaultData: {} }) {
    const getPath = async () => {
      const persistencePath = pathfs.resolve(`${this.getRootPath()}/${id}${encrypted ? '.encrypted' : ''}.json`);
      if (!existsSync(pathfs.dirname(persistencePath))) await mkdirSync(pathfs.dirname(persistencePath), { recursive: true });
      if (!existsSync(persistencePath)) {
        let defaultDB = JSON.stringify(defaultData || [], null, 2);
        if (encrypted) defaultDB = await encrypt(defaultDB, { additionnalNonce: persistencePath.split('.runeya').pop() });
        await writeFile(persistencePath, defaultDB, 'utf-8');
        this.cache[id] = defaultDB;
      }
      return persistencePath;
    };
    const table = id.replace(/[^a-z0-9]|\s+|\r?\n|\r/gmi, "_");
    const read = async () => {
      if (this.cache[id]) return this.cache[id];
      const path = await getPath();
      const additionnalNonce = path.split('.runeya').pop();
      let db = readFileSync(path, 'utf-8');
      if (encrypted) {
        db = await decrypt(db, { additionnalNonce })
          .catch((err) => {
            console.error(path, err);
            sockets.emit('system:wrongKey');
            throw err;
          });
      }
      this.cache[id] = JSON.parse(db);
      if (!alasql.tables[table]){
        await alasql(`CREATE TABLE ${table}`)
      }
      alasql.tables[table].data = this.cache[id];
      return this.cache[id];
    }
    const write = async (data) => {
      let db = JSON.stringify(data, null, 2);
      const path = await getPath();
      const additionnalNonce = path.split('.runeya').pop();
      if (encrypted) db = await encrypt(db, { additionnalNonce });
      writeFileSync(path, db, 'utf-8');
      this.cache[id] = data;
      if (alasql.tables[table]) {
        alasql.tables[table].data = data;
      }
    }
    const escapeQuote = (data) => {
      if (typeof data === 'string') {
        return data.replace(/'/g, "''");
      }
      return data;
    };
    const setValue = (item) => {
      if (item == null) {
        return 'NULL';
      }
      if (item instanceof Date && item.toISOString) {
        return `'${item.toISOString()}'`;
      }
      if (typeof item === 'string') {
        return `'${escapeQuote(item)}'`;
      }
      return `${item}`;
    };
    return {
      getPath,
      alasql: {
        table,
        buildUpdateQuery(data) {
          const set = []
          Object.keys(data).forEach(key => {
            set.push(`${key} = ${setValue(data[key])}`)
          })
          return set.join(', ')
        },
        read: async (sql) => {
          await read()
          return alasql.promise(sql)
        }, 
        write: async (sql, value) => {
          await read()
          await alasql.promise(sql, value)
          await write(await alasql(`select * from ${table}`))
        }, 
      },
      write,
      read,
      delete: async () => {
        delete this.cache[id];
        return unlink(await getPath());
      },
    };
  }
}();
</file>

<file path="servers/server/tsup.config.ts">
import { existsSync, readFileSync} from 'fs';
import { copyFile, cp, mkdir, readFile, rm, writeFile } from 'fs/promises';
import { defineConfig } from 'tsup';
import path from 'path'
import { execSync } from 'child_process';
import PromiseB from 'bluebird';
import compressing from 'compressing';

const rootPath = path.resolve(__dirname, '../../')
const distPath = process.env.DIST_PATH
  ? path.resolve(process.env.DIST_PATH)
  : path.resolve(__dirname, "dist")
console.log(distPath)
const publicPath = path.resolve(distPath, 'public')

const workspaces = execSync('yarn workspaces list --json', {cwd: rootPath, encoding: 'utf-8'}).trim().split('\n').map(a => JSON.parse(a))

async function findPackageDepsFromInternalPackages(packageName) {
  const workspacePath = workspaces.find(b => b.name === packageName)
  if(workspacePath) {
    const packageJSON = JSON.parse(await readFile(path.resolve(rootPath, workspacePath.location, 'package.json'), 'utf-8'))
    if(packageJSON.dependencies) {
      const deps = await PromiseB.map(Object.keys(packageJSON.dependencies), (packageNameDep) => {
        if (/@runeya\/*/.test(packageNameDep)) {
          return findPackageDepsFromInternalPackages(packageNameDep)
        }
        return {name: packageNameDep, version: packageJSON.dependencies[packageNameDep], from: packageName}
      })
      return deps.flat(1000)
    }
  } 
  return []
}
const makeAllPackagesExternalPlugin = {
  name: 'make-all-packages-external',
  async setup(build) {
    await rm(distPath, {recursive: true, force: true})
    build.onResolve({ filter: /.*/ }, async (args) => {
      if (!/^(#|\/|\.\/|\.\.\/)/.test(args.path)) {
        if (/@runeya\/*/.test(args.path)) {
          return { external: false };
        }
        return { external: true };
      }
      return { external: false };
    });
  },
};

const syncPackageJSON = {
  name: 'sync-package-json',
  async setup(build) {
    console.log('sync-package-json')
    if(!existsSync(distPath)) await mkdir(distPath)
    const packageJSON = JSON.parse(await readFile(path.resolve(__dirname, 'package.json'), 'utf-8'))
    const deps = await findPackageDepsFromInternalPackages(packageJSON.name)
    deps.forEach((dep) => {
      if(!packageJSON.dependencies[dep.name]) {
        console.log('Add', dep.name, dep.version, 'from', dep.from)
        packageJSON.dependencies[dep.name] = dep.version
      }
    })
    Object.keys(packageJSON.dependencies).forEach((packageName) => {
      if(packageJSON.dependencies[packageName] === 'workspace:*')  delete packageJSON.dependencies[packageName]

    })
    delete packageJSON.private
    delete packageJSON.devDependencies
    packageJSON.bin = 'www.js'
    packageJSON.main = 'stack.js'
    packageJSON.name = '@runeya/runeya'
    await writeFile(path.resolve(distPath, 'package.json'), JSON.stringify(packageJSON, null, 2), 'utf-8')
  },
};

const copyFilePlugin = {
  name: 'copyFilePlugin',
  async setup(build) {
    console.log('copyFilePlugin')
    if(!existsSync(distPath)) await mkdir(distPath)
    await copyFile(path.resolve(__dirname, "../../modules/bugs/backend/checkJsFork.js"), path.resolve(distPath, "checkJsFork.js"))
    await copyFile(path.resolve(__dirname, "../../modules/bugs/backend/defaultJsConfig.json"), path.resolve(distPath, "defaultJsConfig.json"))
    await copyFile(path.resolve(__dirname, "./helpers/cpuFork.js"), path.resolve(distPath, "cpuFork.js"))
  }
}

const integrateWebApp = {
  name: 'integrateWebApp',
  async setup(build) {
    build.onEnd(async () => {
      console.log('integrateWebApp')
      if(!existsSync(distPath)) await mkdir(distPath)
      execSync('yarn turbo build --filter=@runeya/fronts-app', {cwd: path.resolve(__dirname, '../..'), stdio: 'inherit'})
      if(existsSync(publicPath)) await rm(publicPath, {recursive: true, force: true})
      await cp(path.resolve(__dirname, '../../fronts/app/dist'), publicPath, {recursive: true})
      console.log('integrate extension')
      execSync('yarn turbo build --filter=@runeya/modules-vscode-extension', {cwd: path.resolve(__dirname, '../..'), stdio: 'inherit'})
      await cp(path.resolve(__dirname, '../../modules/vscode/extension/out/runeya.vsix'), path.resolve(distPath, 'runeya.vsix'), {recursive: true})
      const modulePath = path.resolve(__dirname, '../../modules/workflows/backend/nodes')
      const packageJSON = JSON.parse(await readFile(path.resolve(modulePath, 'package.json'), 'utf-8'))
      await compressing.tar.compressDir(
        modulePath,
        path.resolve(distPath, `${packageJSON.name}.tar`),
         {ignoreBase: true, relativePath: 'package'}
      )
    })
  }
}

export default defineConfig({
  entry: ['./bin/www'],
  outDir: distPath,
  clean: true,
  bundle: true,
  publicDir: './src/public',
  esbuildPlugins: [
    makeAllPackagesExternalPlugin,
    copyFilePlugin,
    integrateWebApp,
    syncPackageJSON,
  ],
  noExternal: [
    /@runeya\/.*/,
  ],
  sourcemap: true,
});
</file>

<file path="fronts/app/src/components/sidebar.vue">
<template>
  <div class="sidebar-root" :class="{ minimized, mouseInAnchor }" @mouseenter="mouseInAnchor = true" @mouseleave="mouseInAnchor = false">
    <div>
      <div class="sidebar">
        <div class="header">
          <input type="text" v-model="search" @input="openGroup = 'All'" placeholder="Search service..." @keypress.enter="launchService" >
          <i class="fas fa-chevron-left" @click="minimized = true"></i>
        </div>
        <div class="add-container">
          <div class="add">
            <i class="fas fa-plus"></i>
            <input v-model="serviceLabelToAdd" placeholder="Add new service..." @keypress.enter="addService">
          </div>
          <label v-if="addServiceError">{{ addServiceError }}</label>
        </div>
        <sidebar-group header="All" :open="openGroup === 'All'" @open="openGroup = 'All'">
          <sidebar-item v-for="service of sortedStack" :key="service.label" :service="service"/>
        </sidebar-group>
        <sidebar-group :header="group.label" v-for="(group) of groups" :open="openGroup === group.label" @open="openGroup = group.label" @close="openGroup = 'All'">
          <sidebar-item v-for="service of group.services" :key="service.label" :service="service"/>
        </sidebar-group>
      </div>
    </div>
    <div class="minimized anchor" @click="minimized = false" >
      <i class="fas fa-thumbtack" v-if="mouseInAnchor"></i>
      <i class="fas fa-chevron-right" v-else></i>
    </div>
  </div>
</template>

<script>
import Stack from '../models/stack'
import System from '../models/system'
import { sort } from 'fast-sort'
import sidebarItemVue from './sidebarItem.vue'
import sidebarGroup from './sidebarGroup.vue'
import { computed, onMounted, ref } from 'vue'
import Socket from '../helpers/Socket'
import notification from '../helpers/notification'
import { useRouter } from 'vue-router';
import axios from '../helpers/axios'

export default {
  components: {
    sidebarItem: sidebarItemVue,
    sidebarGroup
  },
  props: {
    currentService: {default: null}
  },
  setup() {
    const router = useRouter(); 
    const search = ref('')
    const openGroup = ref('All');
    const minimized = ref(false);
    const mouseInAnchor = ref(false);
    onMounted(async () => {
      await Stack.loadServices()
      Socket.on('service:crash', async ({ label, code, signal }) => {
        notification.next('error', `${label} has crashed with code ${code}`)
        await Stack.loadServices()
      });

      Socket.on('service:exit', async ({ label, code, signal }) => {
        await Stack.loadServices()
      });
      Socket.on('service:healthcheck:down', async ({label, code, signal}) => {
        const service = await Stack.getService(label)
        if(!service?.crashed) await Stack.loadServices()
      });
      Socket.on('service:healthcheck:up', async ({label, code, signal}) => {
        const service = await Stack.getService(label)
        if(service?.crashed) await Stack.loadServices()
      });
    })
    const sortedStack = computed(() => sort(Stack.services.value.filter(a => (a.label || '').toUpperCase().includes(search.value.toUpperCase()))).desc((a) => a.enabled))

    const groups = computed(() => {
      const groupObject = sortedStack.value.reduce((agg, service) => {
        if (service.groups?.length) {
          service.groups.forEach((group) => {
            if (!agg[group]) agg[group] = []
            agg[group].push(service)
          })
        }
        return agg
      }, {})
      return Object.keys(groupObject)
        .map(key => ({label: key, services: groupObject[key]}))
        .sort((a,b) => a.label.localeCompare(b.label))
    })
    const serviceLabelToAdd= ref('')
    return {
      groups,
      minimized,
      mouseInAnchor,
      openGroup,
      search,
      sortedStack,
      System,
      serviceLabelToAdd,
      addServiceError: computed(() => {
        if(Stack.services.value.find(a => a.label === serviceLabelToAdd.value)) return 'A service already exists with this label'
        return ''
      }),
      addService: () => {
        if(Stack.services.value.find(a => a.label === serviceLabelToAdd.value)) return
        axios.post('/stack/services',  {
          label: serviceLabelToAdd.value,
        }).then(() => {
          const label = serviceLabelToAdd.value
          setTimeout(() => {
            router.push({name: 'stack-single', params: {label}, query: {tab: "Configuration"}})
          }, 100);
          serviceLabelToAdd.value = ''
        })
      },
      /** @param {KeyboardEvent} $event */
      launchService($event) {
        const service = sortedStack.value[0]
        if ($event.ctrlKey && service) {
          service?.restart()
          localStorage.setItem('last-service-visisted', service.label || '')
          router.push({name: 'stack-single', params: {label: service.label}})
        }
      }
    }
  }
}
</script>

<style lang="scss" scoped>

@mixin card($mainColor, $secondaryColor, $shadow) {
  background: $mainColor;
  background: linear-gradient(93deg, $mainColor 0%, $secondaryColor 100%);
  color: white;
  box-shadow:
    0 0 5px 0 $shadow;
  &::before, &::after {
    box-shadow:
      inset 0 0 50px $mainColor,
      inset -20px 0 300px $mainColor,
      0 0 50px #fff,
      -10px 0 80px $mainColor,
      10px 0 80px $mainColor;
  }
}
.sidebar-root {
  height: 100vh;
  display: flex;

  &.minimized {
    .sidebar {
      max-width: 0;
      overflow: hidden;
      opacity: 0;

    }
    .anchor {
      max-width: 25px;
    }
    &.mouseInAnchor {
      .sidebar {
        max-width: 250px;
        overflow: hidden;
        opacity: 1;
      }
      .anchor {
        max-width: 50px;
        width: 50px;
      }
    }
  }
  .anchor  {
    transition: 300ms;
    max-width: 0;
    overflow: hidden;
    display: flex;
    width: 25px;
    justify-content: center;
    align-items: center;
    @include card(rgb(57, 42, 59), rgb(156, 22, 209), rgb(141, 58, 148));
    &:hover {
      @include card(rgb(81, 56, 84), rgb(156, 22, 209), rgb(141, 58, 148));
    }
    color: white;
    cursor: pointer;
    &:hover {
      background-color: #666;
    }
    i {
      width: 100%;
      font-size: 25px;
      text-align: center;
    }
  }
}
.header {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 10px;
  padding: 10px;
  i {
    width: 15px;
    height: 15px;
  }
}
input {
  flex-grow: 1;
  box-sizing: border-box;
  margin: 5px auto;
  justify-self: center;
}
.sidebar {
    transform-origin: left;
    transform: scaleX(1);
    opacity: 1;
    transition: 300ms;
    display: flex;
    overflow: auto;
    flex-direction: column;
    box-shadow: 0px 0px 4px 0px black;
    width: 250px;
    max-width: 250px;
    background-color: var(--system--secondary-sidebar-backgroundColor);
    height: 100%;
    flex-shrink: 0;
    z-index: 3;
    
    ul {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
    }
  }


.progress-container {
  display: flex;
  align-items: center;
  label {
    width: 60px;
  }
}

.system-root {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  &>button {
    z-index: 1;
    width: 90%;
    margin: auto;
  }
} 
.system .title {
  justify-content: center;
}
.add-container {
  margin: 0 10px;
  margin-bottom: 10px;
  label {
    color: red;
  }
  .add {
    display: flex;
    align-items: center;
    gap: 10px;
    input {
      margin: 0;
    }
  }
}
</style>
</file>

<file path="modules/configuration/front/src/ModalEditEnvs.vue">
<template>
  <div class="root">
    <Modal ref="modalEditEnv" :noCancel="true" validateString="Close" :maxHeight="'80vh'" :noScroll="false">
      <template #header>
        <div class="line">
          Edit
          <Select
            size="small"
            v-model="showEnvironment"
            @change="changeEnvironment"
            :options="extendsEnvironments.filter(a => a)"
            placeholder="Select an environment" />
          environment
          <div v-if="currentEnvironment.extends?.[0]">
            <Badge :value="`This environment herit from 
            ${currentEnvironment.extends[0]}
            environment`" size="large" severity="warn"></Badge>
          </div>
        </div>
      </template>
      <template #body>
        <div class="line spaced">
          <div>
            <InputGroup v-if="!importView">
              <InputText
                size="small"
                icon="fas fa-plus"
                v-model="envToAdd"
                placeholder="Add new Env"
                @keypress.enter="addEnv()"/>
              <InputGroupAddon icon>
                <Button size="small" icon="fas fa-plus" @click="addEnv()" />
              </InputGroupAddon>
            </InputGroup>
          </div>
          <div>
            <Button size="small" :label="importView ? 'Variable view' : 'Import view'" @click="toggleimportView()" icon="fas fa-eye"/>
            <Button size="small" label="Download env" @click="exportEnv()" icon="fas fa-download"/>
          </div>
        </div>
        <DataTable scrollable class="datatable" size="small"   v-if="!importView" sortField="key" :sortOrder="1"
          :value="Object.keys(getEnvs()).map(key => Object.assign(getEnvs()[key], {key}))"
          tableStyle="width: 100%;">
            <Column field="action" header="" :row-span="2" col :pt="{
              bodyCell: {
                style: {
                  verticalAlign: 'top'
                }
              }
            }">
              <template #body="{ data }">
                <Button :disabled="!!data.systemOverride" size="small" @click="deleteEnv(data.key)">
                  <i class="fas fa-times"></i>
                </Button>
              </template>
            </Column>
            <Column field="key" header="Key" sortable :pt="{
              bodyCell: {
                style: {
                  verticalAlign: 'top'
                }
              }
            }" :style="{maxWidth: '14rem'}">
              <template #body="{ data, field }">
                <span :style="{
                  color: {
                    'normal': 'green',
                    'systemOverride': 'red',
                    override: 'orange'
                  }[(data.systemOverride && 'systemOverride') || (data.override && 'override') || 'normal']
                }">
                  {{ data[field] }}
                </span>
              </template>
            </Column>
            <Column field="value" header="Value" style="min-width: 200px;" :pt="{
              bodyCell: {
                style: {
                  verticalAlign: 'top'
                }
              }
            }">
              <template #body="{ data, field }">
                <div class="line">
                  <IftaLabel :style="{flexGrow: 1}">
                    <AutoComplete
                      v-model="data.value"
                      dropdown
                      size="small"
                      :suggestions="items"
                      @complete="search"
                      @input="() => setOverrideIfNeeded(data)"
                      @change="() => setOverrideIfNeeded(data)"
                      autofocus
                      fluid
                      @blur="save"
                      @keypress.enter="save"/>
                    <label>Variable</label>
                  </IftaLabel>
                </div>
                <div class="line">
                  <IftaLabel :style="{flexGrow: 1}" v-if="data[field] && data[field].match(/{{(.*)}}/gi)">
                    <InputText
                      v-model="data.prefix"
                      dropdown
                      size="small"
                      :suggestions="items"
                      @complete="search"
                      @input="() => setOverrideIfNeeded(data)"
                      @change="() => setOverrideIfNeeded(data)"
                      autofocus
                      fluid
                      @blur="save"
                      @keypress.enter="save"/>
                    <label>Prefix</label>
                  </IftaLabel>
                  
                  <IftaLabel :style="{flexGrow: 1}" v-if="data[field] && data[field].match(/{{(.*)}}/gi)">
                    <InputText
                      v-model="data.suffix"
                      dropdown
                      size="small"
                      :suggestions="items"
                      @complete="search"
                      @input="() => setOverrideIfNeeded(data)"
                      @change="() => setOverrideIfNeeded(data)"
                      autofocus
                      fluid
                      @blur="save"
                      @keypress.enter="save"/>
                    <label>Suffix</label>
                  </IftaLabel>
                </div>
                <div v-if="data[field] && data[field].match(/{{(.*)}}/gi)">
                  <InputGroup>
                      <InputGroupAddon v-if="data.prefix">{{data.prefix}}</InputGroupAddon>
                      <IftaLabel size="small" :style="{marginTop: '4px'}">
                        <InputText
                          v-model="currentEnvironment.envs[extractTag(data[field])]"
                          @blur="saveEnvironment"
                          @keypress.enter="saveEnvironment"
                          autofocus
                          fluid />
                          <label>Update variable value globally</label>
                      </IftaLabel>
                      <InputGroupAddon v-if="data.suffix">{{data.suffix}}</InputGroupAddon>
                  </InputGroup>
                </div>
              </template>
            </Column>
            <Column field="override" header="Override" style="min-width: 200px;" :pt="{
              bodyCell: {
                style: {
                  verticalAlign: 'top'
                }
              }
            }">
              <template #body="{ data, field }">
                <div class="line">
                  <IftaLabel :style="{flexGrow: 1}">
                    <InputText
                      :disabled="!!extractTag(data.override)"
                      v-model="data[field]"
                      autofocus
                      full
                      fluid
                      @blur="save"
                      @keypress.enter="save"/>
                    <label>Variable</label>
                  </IftaLabel>
                </div>
                <div v-if="data[field] && data[field].match(/{{(.*)}}/gi)">
                  <InputGroup>
                      <InputGroupAddon v-if="data.prefix">{{data.prefix}}</InputGroupAddon>
                      <IftaLabel size="small" :style="{marginTop: '4px'}">
                        <InputText
                          v-model="currentEnvironment.envs[extractTag(data[field])]"
                          @blur="saveEnvironment"
                          @keypress.enter="saveEnvironment"
                          autofocus
                          fluid />
                          <label>Update variable value globally</label>
                      </IftaLabel>
                      <InputGroupAddon v-if="data.suffix">{{data.suffix}}</InputGroupAddon>
                    </InputGroup>
                </div>
              </template>
            </Column>
            <Column field="systemOverride" header="System override" :style="{maxWidth: '4rem'}">
              <template #body="{ data, field }">
                {{ data[field] }}
              </template>
            </Column>
        </DataTable>
        <div v-else>
          <Textarea v-model="code" @input="parseCode()" @blur="save"></Textarea>
        </div>
      </template>
    </Modal>
  </div>
</template>

<script setup>
import { onMounted, ref, watch } from 'vue';

import DataTable from 'primevue/datatable';
import Column from 'primevue/column';
import InputText from 'primevue/inputtext'; // optional
import Textarea from 'primevue/textarea'; // optional
import Button from 'primevue/button';
import { cloneDeep, endsWith } from 'lodash';
import Select from 'primevue/select';
import IftaLabel from 'primevue/iftalabel';
import AutoComplete from 'primevue/autocomplete';
import Modal from '../../../../fronts/app/src/components/Modal.vue';
import stack from '../../../../fronts/app/src/models/stack';
import axios from '../../../../fronts/app/src/helpers/axios';
import notification from '../../../../fronts/app/src/helpers/notification';
import InputGroupAddon from 'primevue/inputgroupaddon';
import InputGroup from 'primevue/inputgroup';
import Badge from 'primevue/badge';

const items = ref([]);
const search = (event) => {
  const query = extractTag(event.query) || event.query;
  items.value = Object.keys(currentEnvironment.value.envs)
    .filter((key) => key.toUpperCase().includes(query.toUpperCase()) && !key.toUpperCase().includes('RUNEYA_OVERRIDE'))
    .map((key) => `{{${key}}}`);
};

const props = defineProps({
  service: {
    /** @type {import('../../../../fronts/app/src/models/service').default | null} */
    default: null,
  },
});

const modalEditEnv = ref();
const importView = ref(false);
const code = ref('');
function toggleimportView() {
  if (!importView.value) {
    const envs = getEnvs()
    code.value = `# key=value
${Object.keys(envs).map((key) => {
  const env = envs[key]
  return `${key}=${env.prefix || ''}${env.value|| ''}${env.suffix || ''}`
}).join('\n')}
`;
  }
  importView.value = !importView.value;
}
/** @type {import('vue').Ref<string[]>} */
const extendsEnvironments = ref([]);
function extractTag(field) {
  const extractedTag = /{{(.*)}}/gi.exec(field)?.[1]?.trim();
  return extractedTag || '';
}

function getEnvs() {
  return props.service.envs?.[showEnvironment.value] || {}
}
function setEnvs(envs) {
  props.service.envs[showEnvironment.value] = envs;
  return envs;
}

function parseCode() {
  const envs = {}
  code.value
    .split('\n')
    .filter((line) => !line.trim().startsWith('#') && line.trim())
    .forEach((envString) => {
      const [key, ...value] = envString.split('=');
      const env = getEnvs()[key] || {
        value: '', systemOverride: '', override: '', prefix: '', suffix: ''
      };
      env.value = value.join('=');
      envs[key] = env
      setOverrideIfNeeded({key, value: env.value});
    })
  setEnvs(envs);
}

const envToAdd = ref('');
function addEnv() {
  setEnvs({
    ...getEnvs(),
    [envToAdd.value]: {
      value: '', override: '', systemOverride: '',
    }
  });
  save();
}
function setOverrideIfNeeded({key, value}) {
  if(!props.service.envs[currentEnvironment.value.label][key]) props.service.envs[currentEnvironment.value.label][key] = {
    value: '', override: ''
  }
  const data = props.service.envs[currentEnvironment.value.label][key]
  const tag = extractTag(value)
  if (tag) {
    const res = /(.*){{.*}}(.*)/gi.exec(value)
    data.prefix = res?.[1] || data.prefix || ''
    data.suffix = res?.[2] || data.suffix || ''
    data.value = `{{${tag}}}`
    data.override = `{{${tag}_RUNEYA_OVERRIDE}}`;
  }
  else if (extractTag(data.override)) {
    data.override = '';
  }
}

async function exportEnv() {
  const { data: exportedEnv } = await axios.get('/stack/export-env', { params: { environment: currentEnvironment.value.label, service: props.service.label } });
  const envObject = exportedEnv;
  const envString = Object.keys(envObject).map((key) => `${key}=${envObject[key]}`).join('\n');
  const element = document.createElement('a');
  element.setAttribute('href', `data:text/plain;charset=utf-8,${encodeURIComponent(envString)}`);
  element.setAttribute('download', '.env');
  element.style.display = 'none';
  document.body.appendChild(element);
  element.click();
  document.body.removeChild(element);
}

async function save() {
  if (props.service) {
    await props.service.save()
      .then(() => notification.next('success', 'Configuration saved'))
      .catch(() => notification.next('error', 'Cannot save configuration'));
  }
}
async function saveEnvironment() {
  await axios.patch(`/stack/environments/${currentEnvironment.value.label}`, currentEnvironment.value)
    .then(() => notification.next('success', 'Environment saved'))
    .catch(() => notification.next('success', 'Environment cant be saved'));
}
async function open() {
  await changeEnvironment();
  return modalEditEnv.value.open().promise;
}
async function changeEnvironment() {
  currentEnvironment.value = environments.value.find((a) => a.label === showEnvironment.value) || { label: 'unknown', envs: {}, overrideEnvs: {} };
}
async function deleteEnv(key) {
  delete getEnvs()[key]
  save();
}
/** @type {import('vue').Ref<{label: string, envs: Record<string, {envs: string}>, overrideEnvs: Record<string, {envs: string}>, extends: string[]}[]>} */
const environments = ref([]);
/** @type {import('vue').Ref<{label: string, envs: Record<string, {envs: string}>, overrideEnvs: Record<string, {envs: string}>, extends: string[]}>} */
const currentEnvironment = ref({ label: '', envs: {}, overrideEnvs: {} });
const showEnvironment = ref('');
onMounted(async () => {
  currentEnvironment.value = await stack.getEnvironment();
  environments.value = await stack.getEnvironments();
  showEnvironment.value = currentEnvironment.value.label;
  extendsEnvironments.value = environments.value
    .map((env) => env.label);
  extendsEnvironments.value.unshift('');
});
defineExpose({
  open,
});
</script>

<style lang="scss" scoped>
  .modal {
    height: 100%;
    overflow: auto;
  }
  button.small {
    width: max-content;
    i {
      margin: 0;
      padding: 0;
    }
  }
  .override {
    input {
      margin-bottom: 20px;
      margin-top: 20px;
    }
  }
  .datatable {
    display: flex;
    width: 100%;
    overflow: auto;
  }

  ::v-deep {
    .p-datatable-table-container {
      width: 100%;
    }
    .p-inputgroupaddon {
      line-break: anywhere
    }
  }
  .line {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: center;
    margin: 5px 0;
    &.spaced {
      justify-content: space-between;
    }
  }
  textarea {
    width: 100%;
    height: 50vh;
  }
</style>
</file>

<file path="modules/docker/front/package.json">
{
  "name": "@runeya/modules-docker-front",
  "version": "2.0.5",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "vue": "^3.4.18",
    "vue-eslint-parser": "^9.4.2"
  }
}
</file>

<file path="modules/documentation/front/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.1.1](https://github.com/runeya/runeya/compare/v2.1.0...v2.1.1) (2025-02-11)

### Bug Fixes

* improve code health ([865b996](https://github.com/runeya/runeya/commit/865b996fa0adcf49668fa770c465bac1f1d8f21a))

## [2.0.12](https://github.com/runeya/runeya/compare/v2.0.11...v2.0.12) (2025-01-24)

### Bug Fixes

* reenable documentation and improve global git view ([2e4dd75](https://github.com/runeya/runeya/commit/2e4dd75c0513d92f12b8303b3dddd2f2fa6ccc73))

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-documentation-front

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

### Bug Fixes

* resolve issues for permission on docker volumes + cosmetic changes ([7a822cd](https://github.com/runeya/runeya/commit/7a822cd1c205e5808247075828c1d3ce49d1524b))

## [1.18.2](https://github.com/runeya/runeya/compare/v1.18.1...v1.18.2) (2024-02-24)

### Bug Fixes

* **front:** cosmetic changes ([ff9b282](https://github.com/runeya/runeya/commit/ff9b2821de658eae571a1da4407ec0651a102e15))

## [1.17.30](https://github.com/runeya/runeya/compare/v1.17.29...v1.17.30) (2024-02-19)

### Bug Fixes

* **documentation:** add a global documentation ([0ef6b0f](https://github.com/runeya/runeya/commit/0ef6b0f15760d06380e9d7df3fc9c3a0393305d5))

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

### Bug Fixes

* cosmetic changes ([a18735e](https://github.com/runeya/runeya/commit/a18735e5b5cec706f3cdf4c4f4ca22482ce7ea0f))

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

### Bug Fixes

* link front to backend deps ([66b3135](https://github.com/runeya/runeya/commit/66b313523d99765b692208de0043303dcb6a0914))
* link front to backend deps ([54fcbf3](https://github.com/runeya/runeya/commit/54fcbf371cf03dc4f51a7196de15fe5d352088e9))

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-documentation-front

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.14](https://github.com/runeya/runeya/compare/v1.17.13...v1.17.14) (2024-02-05)

### Bug Fixes

* **front:** can edit markdown and migrate away from vue markdown ([ef11ae3](https://github.com/runeya/runeya/commit/ef11ae39ee563ee6af4b2bc6f916f4c4705287dd))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/workflows/backend/package.json">
{
  "name": "@runeya/modules-workflows-backend",
  "version": "2.1.4",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "@runeya/modules-plugins-loader-front": "workspace:*",
    "@types/express": "^4.17.21",
    "@types/uuid": "^9.0.8"
  },
  "dependencies": {
    "compressing": "^1.10.1",
    "express": "^4.18.2",
    "node-red": "^4.0.8",
    "uuid": "^9.0.1"
  }
}
</file>

<file path="common/express/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

# [2.1.0](https://github.com/runeya/runeya/compare/v2.0.17...v2.1.0) (2025-01-31)

### Features

* **nodered:** add nodered into app ([f897eb2](https://github.com/runeya/runeya/commit/f897eb2c4a9128e0d4615f6765d3ef0ce1d2ca3e))

## [2.0.7](https://github.com/runeya/runeya/compare/v2.0.6...v2.0.7) (2025-01-05)

### Bug Fixes

* **windows:** fix windows support ([5590e7d](https://github.com/runeya/runeya/commit/5590e7de8f27c45ee76d401e53eeda6fcae5bbfe))

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* remove some dependencies ([5667402](https://github.com/runeya/runeya/commit/5667402d57add874a89ba029ce62b16b3bbed9e0))

## [2.0.1](https://github.com/runeya/runeya/compare/v2.0.0...v2.0.1) (2024-12-25)

### Bug Fixes

* various fixes ([18129e9](https://github.com/runeya/runeya/commit/18129e96f7c92a69176d6a75add45f3a48ab11ae))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

* feat!: migrate runeya to entire UI ([e173073](https://github.com/runeya/runeya/commit/e173073d932be7e400b1f51261c090116e8fb543))

### BREAKING CHANGES

* all stack files are useless now

## [1.18.11](https://github.com/runeya/runeya/compare/v1.18.10...v1.18.11) (2024-11-11)

**Note:** Version bump only for package @runeya/common-express

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

**Note:** Version bump only for package @runeya/common-express

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

### Bug Fixes

* **server:** healthcheck working ([13d2960](https://github.com/runeya/runeya/commit/13d2960ffa5125aff7792d95a9306fe6e04d2889))
* various changes ([06e6241](https://github.com/runeya/runeya/commit/06e624176595b95c4227fe684242919c7eeda192))

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))

## [1.17.10](https://github.com/runeya/runeya/compare/v1.17.9...v1.17.10) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express

## [1.17.9](https://github.com/runeya/runeya/compare/v1.17.8...v1.17.9) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express

## [1.17.8](https://github.com/runeya/runeya/compare/v1.17.7...v1.17.8) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express

## [1.17.7](https://github.com/runeya/runeya/compare/v1.17.6...v1.17.7) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express

## [1.17.6](https://github.com/runeya/runeya/compare/v1.17.5...v1.17.6) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express

## [1.17.5](https://github.com/runeya/runeya/compare/v1.17.4...v1.17.5) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express

## [1.17.4](https://github.com/runeya/runeya/compare/v1.17.3...v1.17.4) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express

## [1.17.3](https://github.com/runeya/runeya/compare/v1.11.23...v1.17.3) (2024-02-04)

**Note:** Version bump only for package @runeya/common-express
</file>

<file path="fronts/app/src/components/StackChooser.vue">
<template>
    <section-cmp class="stack-chooser" v-if="servicesToLaunch" header="Choose all services to launch">
        <div class="groups">
        <div v-for="(group) of groups" :key="group.label">
            <div class="group-header" @click="group.show = !group.show">
            <div class="left-header">
                <i class="fas fa-chevron-down" v-if="group.label !== 'All'" aria-hidden="true"></i>
                <h3>{{ group.label }} <span>({{ group.services?.length }})</span></h3>
            </div>
            <div class="right-header" >
                <button @click.stop="toggleGroup(group.label)" class="mini">
                <i class="far fa-check-square" v-if="isGroupSelected(group.label)" aria-hidden="true"></i>
                <i class="far fa-square" v-else aria-hidden="true"></i>
                </button>
            </div>
            </div>
            <ul v-if="group.show || group.label === 'All'">
            <input type="text" v-model="search" @keypress.enter="toggleService(servicesToLaunch.find(f => f.label === displayedServices(group.services)[0]?.label))" placeholder="Type+Enter to toggle..." >
            <li v-for="service of displayedServices(group.services)" :key="'services-' + service.label">
                <input
                type="checkbox"
                :id="'input-' + service.label"
                :value="servicesToLaunch.find(f => f.label === service.label)?.enabled"
                :checked="servicesToLaunch.find(f => f.label === service.label)?.enabled"
                @change="toggleService(servicesToLaunch.find(f => f.label === service.label))">
                <label :for="'input-' + service.label">
                {{ service.label }}
                </label>
            </li>
            </ul>
        </div>
        </div>
        <div class="actions">
        <button v-if="!isAllEnabled" @click="toggleGroup('All')">Select all</button>
        <button v-else @click="toggleGroup('All')">Unselect all</button>
        <button @click="validate" class="success"><i class="fas fa-play" aria-hidden="true"></i> {{oneOrMoreEnabled ? 'Launch' : 'Open without launching'}}</button>
        </div>
    </section-cmp>
</template>


<script>
import Stack from '../models/stack'
import System from '../models/system'
import SectionVue from '../components/Section.vue'
import { computed, onMounted, reactive, ref, onUnmounted } from 'vue'
import BackgroundStackChooser from '../components/BackgroundStackChooser.vue'
import LeftLogo from '../components/LeftLogo.vue'
import { useRouter } from 'vue-router';
import Socket from '../helpers/Socket'

export default {
    name: 'StackChooser',
    components: {
        sectionCmp: SectionVue,
        BackgroundStackChooser,
        LeftLogo
    },
    props: {
        embed: { default: false },
    },
    setup() {
        const router = useRouter();
        /** @type {import('vue').Ref<{label: string | undefined, enabled: boolean, groups: string[] | undefined}[]>} */
        const servicesToLaunch = ref([])
        async function reload() {
          await Stack.loadServices()
          if(!Stack.services.value.length) return router.push({name: 'stack-single-no-view'})
          servicesToLaunch.value = Stack.services.value.map(service => {
            const state = localStorage.getItem(`automatic-toggle-${service.label}`)
            return {
              label: service.label,
              enabled: state === 'true' || service.enabled || false,
              groups: service.groups
            }
          })
          if(router.currentRoute.value.name === 'stack-chooser') {
            const launched = Stack.services.value.find((service) => service.enabled)
            if (launched) {
                const lastVisited = Stack.services.value.find((service) => service.label === localStorage.getItem('last-service-visisted') && service.enabled)
                if(lastVisited) router.push({ name: 'stack-single', params: { label: lastVisited.label } })
                else router.push({ name: 'stack-single', params: { label: launched.label } })
            }
          }
        }
        onMounted(reload)
        Socket?.on('stack:selectConf', reload)
        Socket?.on('service:start', reload)
        onUnmounted(() => {
            Socket?.off('stack:selectConf', reload)
            Socket?.off('service:start', reload)
        })

        const validate = async () => {
            servicesToLaunch.value.forEach((s) => {
                const service = Stack.services.value.find(_s => _s.label === s.label)
                if (!service) return
                service.enabled = s.enabled
            })
            Stack.launchServices(servicesToLaunch.value.map(s => ({label: s.label, enabled: s.enabled})))
            const enabledServices = await Stack.getEnabledServices()
            router.push({ name: 'stack-single', params: { label: enabledServices[0]?.label || Stack.services.value[0]?.label } })
        }
        /** @param {string} group */
        const getServicesFromGroup = group => servicesToLaunch.value.filter(service => service.groups?.includes(group) || group === 'All')
        /** @param {string} group */
        const isGroupSelected = group => getServicesFromGroup(group).every(service => service.enabled)
        const search = ref('')

        /** @param {typeof servicesToLaunch['value'][number] | undefined} service */
        const save = async (service) => {
            if (!service?.label) return
            localStorage.setItem(`automatic-toggle-${service.label}`, service.enabled == null ? 'false' : service.enabled.toString())
        }
        /**
         * @param {typeof servicesToLaunch['value'][number] | undefined} service
         * @param {boolean | null} force
         */
        const toggleService = async (service, force = null) => {
            if (service != null) {
                service.enabled = force != null ? force : !service.enabled
                await save(service)
            }
        }
        return {
            servicesToLaunch,
            search,
            isAllEnabled: computed(() => servicesToLaunch.value.every(service => service.enabled)),
            oneOrMoreEnabled: computed(() => servicesToLaunch.value.some(service => service.enabled)),
            groups: computed(() => {
                const groupsById = servicesToLaunch.value.reduce((groups, service) => {
                    if (service.groups) {
                        service.groups.forEach(group => {
                            if (!groups[group]) groups[group] = reactive({ services: [], label: group })
                            groups[group].services.push(service)
                        });
                    }

                    if (!groups['All']) groups['All'] = reactive({ services: [], label: "All" })
                    groups['All'].services.push(service)

                    return groups
                }, /**@type {Record<string, {label: string, services: typeof servicesToLaunch['value'][number][], show?: boolean}>}*/({}))
                return Object.keys(groupsById).map(key => groupsById[key]).sort((a, b) => a.label.localeCompare(b.label))
            }),
            /** @param {string} group */
            toggleGroup(group) {
                const groupSelected = isGroupSelected(group)
                getServicesFromGroup(group).map(service => {
                    toggleService(service, !groupSelected)
                })
            },
            save,
            isGroupSelected,
            Stack,
            System,
            validate,
            /** @param {typeof servicesToLaunch['value'][number][]} services */
            displayedServices(services) {
                return services.filter(s => s.label?.toUpperCase().includes(search.value.toUpperCase()))
            },
            toggleService,
        }
    }
}
</script>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style scoped lang="scss">
    h3 {
        margin: 0;

        span {
            color: #8e8e8e;
            font-weight: normal;
        }
    }

    .group-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-top: 10px;
        cursor: pointer;
        border-radius: 10px;
        transition: 300ms background-color linear;

        .left-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        &:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        i {
            padding: 0;
            margin: 0 5px
        }
    }

    .groups {
        overflow: auto;

    }

    .stack-chooser {
        display: flex;
        margin: auto;
        flex-direction: column;
        min-width: 200px;
        width: 100%;
        overflow: auto;

        .header {
            font-size: 2em;
            margin-bottom: 20px;
        }

        .content {
            li {
                display: flex;
                align-items: center;
                gap: 10px;
                margin-bottom: 5px;
                font-size: 1.1em;
            }

            .actions {
                margin-top: 20px;
                display: flex;
                justify-content: flex-end;
            }
        }
    }

    ul {
        list-style: none;
        margin: 0;
        padding: 0;
    }

button.mini {
    padding: 5px 10px;
}


.embed {
    &.stack-chooser-root {
        width: auto;
        height: auto;
    }
}
</style>
</file>

<file path="fronts/app/src/models/service.js">
import axios from '../helpers/axios';

class Service {
  /** @param {import('@runeya/common-typings').NonFunctionProperties<Service>} service */
  constructor(service) {
    /** @type {string} */
    this.label = service.label || ''
    /** @type {Array<Record<any, any>>} */
    this.commands = service.commands || [];
    /** @type {string} */
    this.rootPath = service.rootPath || this.commands?.[0]?.spawnOptions?.cwd || '';
    this.envs = {}
    this.shortcuts = []
    this.updateFields(service);
  }

  /**
   * @param {import('@runeya/common-typings').NonFunctionProperties<Service>} service} service
   */
  updateFields(service) {
    if (!service.label) throw new Error('A service should have a label');
    /** @type {string} */
    this.label = service.label;
    /** @type {string} */
    this.description = service.description || '';
    /** @type {string} */
    this.url = service.url || '';
    /**
     * @type {{
     *  enabled: boolean,
     *  url: string,
     *  interval: string,
     *  method: 'GET' | 'POST' | 'PATCH' | 'PUT' | 'DELETE'
     *  returnCode: number,
     *  responseText: string,
     *  timeout: number,
     *  startAfter: number
     * }}
     */
    this.health = service.health || {
      enabled: false,
      url: '',
      interval: '',
      method: 'GET',
      returnCode: 200,
      responseText: '',
      timeout: 0,
      startAfter: 0,
    };
    /** @type {string[]} */
    this.groups = service.groups || [];
    /** @type {string[]} */
    this.parsers = service.parsers || [];
    /** @type {string[]} */
    this.urls = service.urls || [];
    /** @type {string} */
    this.openapiURL = service.openapiURL || '';
    /**
     * @type {{
     *   home: string,
     *   remote: string,
     *   branches: {name: string, merged: boolean, canDelete: boolean, isRemote: boolean}[],
     *   stash: string[],
     *   delta: number | null,
     *   currentBranch: string,
     *   status: []
     * }}
     * */
    this.git = service.git || {
      home: '',
      remote: '',
      branches: [],
      stash: [],
      delta: 0,
      currentBranch: '',
      status: [],
    };
    /** @type {string} */
    this.spawnCmd = service.spawnCmd || '';
    /** @type {string[]} */
    this.spawnArgs = service.spawnArgs || [];
    /** @type {Record<any, any>} */
    this.spawnOptions = service.spawnOptions || {
      cwd: '',
      env: '',
    };
    /** @type {Array<Record<any, any>>} */
    this.commands = service.commands || [];
    /** @type {Array<Record<any, any>>} */
    this.shortcuts = service.shortcuts || [];
    /** @type {{[key:string]: {[key:string]: {value: string, override: string, systemOverride?: string, prefix?: string, suffix?: string}}}} */
    this.envs = service.envs || {}
    /** @type {boolean} */
    this.enabled = service.enabled || false;
    /** @type {boolean} */
    this.crashed = service.crashed || false;
    /** @type {boolean} */
    this.exited = service.exited || false;
    /** @type {string} */
    this.rootPath = service.rootPath || this.commands?.[0]?.spawnOptions?.cwd || '';
    /** @type {{enabled: true, name: string, build: string, volumes: string[], ignoreVolumes: string[], ports: string[], bootstrap: {commands: {cmd: string,user: string,entrypoint: string,}[]}}} */
    this.container = service.container;
    /** @type {Record<string, string>} */
    this.meta = service.meta || {};
    if (this.container) {
      if (!this.container.volumes?.length) this.container.volumes = [];
      if (!this.container.ignoreVolumes?.length) this.container.ignoreVolumes = [];
    }
  }

  async updateGit() {
    if (this.git?.remote) {
      this.git.branches = await this.getBranches();
      this.git.currentBranch = await this.getCurrentBranch();
      this.git.status = await this.getStatus();
      const list = await this.stashList();
      this.git.stash = list;
    }
  }

  async fetch() {
    const { data: service } = await axios.get(`/stack/${this.label}/`);
    this.updateFields(service);
    return this;
  }

  /** @returns {Promise<LogMessage[]>} */
  async getLogs() {
    const { data: logs } = await axios.get(`/logs/${this.label}/logs`);
    return logs;
  }

  /** @param {{command: any, pid?: number}} prompt */
  async sendTerminalPrompt(prompt) {
    const { data: logs } = await axios.post(`/logs/${this.label}/prompt`, { ...prompt, service: this.label });
    return logs;
  }

  /** @param {{pid?: number, forceKill?: boolean}} prompt */
  async sendTerminalTerminate(prompt) {
    const { data: logs } = await axios.post(`/logs/${this.label}/terminate`, { ...prompt, service: this.label });
    return logs;
  }

  async clear() {
    const { data: logs } = await axios.delete(`/logs/${this.label}/logs`);
    return logs;
  }

  /**
   * @param {string} msg
   * @param {{force?: boolean}} param0
   */
  async autocomplete(msg, { force } = {}) {
    const { data: logs } = await axios.get(`/logs/${this.label}/autocomplete`, {
      params: { message: msg, force: !!force },
    });
    return logs;
  }

  async openInVsCode(path, editor) {
    return axios.get(`/editors/${this.label}/open-in-vs-code`, { params: { path, editor } });
  }

  /**
   *
   * @param {string} link
   * @returns
   */
  async openLinkInVsCode(link, editor) {
    return axios.get(`/editors/${this.label}/open-link-in-vs-code`, { params: { link, editor } });
  }

  async openFolder(path) {
    return axios.get(`/stack/${this.label}/open-folder`, { params: { path } });
  }

  async restart() {
    this.enabled = true;
    localStorage.setItem(`automatic-toggle-${this.label}`, this.enabled.toString());
    return axios.get(`/stack/${this.label}/restart`);
  }

  async start() {
    this.enabled = true;
    localStorage.setItem(`automatic-toggle-${this.label}`, this.enabled.toString());
    return axios.get(`/stack/${this.label}/start`);
  }

  async stop() {
    this.enabled = false;
    localStorage.setItem(`automatic-toggle-${this.label}`, this.enabled.toString());
    return axios.get(`/stack/${this.label}/stop`);
  }

  async getBranches() {
    const { data: branches } = await axios.get(`/git/${this.label}/branches`);
    return branches;
  }

  async getCurrentBranch() {
    const { data: currentBranch } = await axios.get(`/git/${this.label}/current-branch`);
    return currentBranch;
  }

  /**
   * @param {string} name
   * @param {boolean} shouldPush
   */
  async addBranch(name, shouldPush) {
    const { data: status } = await axios.post(`/git/${this.label}/add-branch`, {
      shouldPush, name,
    });
    return status;
  }

  async getStatus() {
    const { data: status } = await axios.get(`/git/${this.label}/status`);
    return status;
  }

  async getDiff() {
    const { data: diff } = await axios.get(`/git/${this.label}/diff`);
    return diff;
  }

  /**
   *
   * @param {string} branchName
   */
  async changeBranch(branchName) {
    await axios.post(`/git/${this.label}/branch/${encodeURIComponent(branchName)}/change`);
  }

  /**
   *
   * @param {string} branchName
   */
  async deleteBranch(branchName) {
    await axios.delete(`/git/${this.label}/branch/${encodeURIComponent(branchName)}`);
  }

  /**
   *
   * @param {string} branchName
   */
  async gitRemoteDelta(branchName) {
    if (this.git) this.git.delta = null;
    const { data: delta } = await axios.get(`/git/${this.label}/branch/${encodeURIComponent(branchName)}/remote-delta`);
    if (this.git) this.git.delta = delta;
    return delta;
  }

  async gitFetch() {
    await axios.post(`/git/${this.label}/fetch`);
  }

  /**
   *
   * @param {boolean} graphOnAll
   */
  async getGraph(graphOnAll) {
    const { data: graph } = await axios.get(`/git/${this.label}/graph`, {
      params: {
        graphOnAll,
      },
    });
    return graph;
  }

  async reset() {
    await axios.delete(`/git/${this.label}/reset`);
  }

  async stash() {
    await axios.post(`/git/${this.label}/stash`);
    return this.updateGit();
  }

  async stashPop() {
    await axios.post(`/git/${this.label}/stash-pop`);
  }

  async pull() {
    await axios.post(`/git/${this.label}/pull`);
  }

  async stashList() {
    const { data: stash } = await axios.post(`/git/${this.label}/stash-list`);
    return stash;
  }

  /**
   *
   * @param {string} file
   */
  async checkoutFile(file) {
    file = encodeURIComponent(file);
    await axios.delete(`/git/${this.label}/checkout/${file}`);
  }

  async isNpm(cwd) {
    const { data: isNpm } = await axios.get(`/npm/${this.label}`, {
      params: { cwd }
    });
    return isNpm;
  }
  async getNpmPaths() {
    const { data: paths } = await axios.get(`/npm/${this.label}/paths`);
    return paths;
  }

  async getPackageJSON(cwd) {
    const { data: packageJSON } = await axios.get(`/npm/${this.label}/packagejson`, {
      params: {cwd}
    });
    return packageJSON;
  }

  async outdatedNpm(cwd) {
    const { data: outdated } = await axios.get(`/npm/${this.label}/outdated`, {
      params: {cwd}
    });
    return outdated;
  }

  async getBugs(cwd) {
    const { data: bugs } = await axios.get(`/bugs/${this.label}`, {
      params: {cwd}
    });
    return bugs || [];
  }

  async save() {
    await axios.post('/stack/services', this);
    return this;
  }

  /**
   *
   * @param {*} data
   * @returns
   */
  static async getTokens(data) {
    const { data: bugs } = await axios.post('/openai/tokenize', { data });
    return bugs || [];
  }

  /**
   *
   * @param {*} data
   * @returns
   */
  static async reviewFromAi(data) {
    const { data: bugs } = await axios.post('/openai/review', { data });
    return bugs || [];
  }

  /**
   *
   * @param {*} data
   * @returns
   */
  static async findSolutionFromAi(data) {
    const { data: bugs } = await axios.post('/openai/error', { data });
    return bugs || [];
  }

  static async homedir() {
    const { data: path } = await axios.post('/fs/homedir');
    return path || '';
  }
}

export default Service;

/**
 * @typedef {import('../../../../servers/server/models/Service').LogMessage} LogMessage
 */
</file>

<file path="fronts/app/src/views/StackSingle.vue">
<template>
  <div class="stack-single" v-if="currentService" :key="$route.params.label.toString()">
    <div class="main">
      <div class="header">
        <div class="left">
          <div class="title">
            <Popover trigger="mouseenter" appendTo="parent" max-width="50vh"  v-if="currentService.container?.enabled">
              <template #trigger>
                <i class="fab fa-docker"></i>
              </template>
              <template #content>
                <ul>
                  <li>Container name: {{ currentService.container.name }}</li>
                </ul>
              </template>
            </Popover>
            {{currentService.label}}
          </div>
          <div class="description">{{currentService.description}}</div>
        </div>
        <div class="right">
          <notification-bell/>
          <div class="icons">
            <a v-if="currentService.git && currentService.git.home" :href="currentService.git.home" target="_blank" title="Open git home"><i class="fab fa-github"  aria-hidden="true"></i></a>
            <a v-if="currentService.url" :href="currentService.url" target="_blank" title="Open service URL"><i class="fas fa-globe"  aria-hidden="true"></i></a>
            <a v-for="url in currentService.urls" :key="url" :href="url" target="_blank" :title="url"><i class="fas fa-globe"  aria-hidden="true"></i></a>
            <CurrentEditor :key="'current-editor-' + currentService.label" :service="currentService" @openEditor="openInVsCode(currentService.rootPath, $event)"></CurrentEditor>
            <i v-if="currentService.rootPath"  class="fas fa-folder" aria-hidden="true" title="Open folder" @click="openFolder(currentService.rootPath)"></i>
          </div>
        </div>
      </div>
      <div class="sections" >
        <div v-if="!currentService.enabled" class="sections">
          <section-cmp header="This service is not started" :actions="[{ label: 'Start', click: () => start(), icon: 'fas fa-play' }]" class="section-not-started">
          </section-cmp>
        </div>
        <div v-else class="system-cards">
          <card class="card to-hide-for-small-screen" :mini="true">
            <i class="fas fa-memory"></i>
            <div class="hovered">Memory</div>
            <progress-cmp :percent="mem"></progress-cmp>
          </card>
          <card class="card to-hide-for-small-screen" color="purple" :mini="true">
            <i class="fas fa-microchip"></i>
            <div class="hovered">CPU</div>
            <progress-cmp :percent="cpu"></progress-cmp>
          </card>
          <card class="card restart-stop-card" color="orange" :mini="true">
            <button class="small" @click="restart()" :disabled="restartInProgress">
              <i class="fas fa-sync" aria-hidden="true" :class="{rotate: restartInProgress}"></i>
              <span>Restart</span>
            </button>
            <button class="small" @click="stop()">
              <i class="fas fa-stop" aria-hidden="true"></i>
              <span>Stop</span>
            </button>
          </card>
        </div>
        <tabs class="tabs" :tabs="tabs" :showLabels="false" direction="left" :contentCss="{height: '100%'}">
          <template #default="{tab}">
            <div class="tab">
              <component :is="tab.id" :service="currentService" :key="currentService.label"></component>
            </div>
          </template>
        </tabs>
      </div>
    </div>
  </div>
</template>

<script>
import Stack from '../models/stack'
import System from '../models/system'
import ProgressVue from '../components/Progress.vue';
import SectionVue from '../components/Section.vue'
import { onBeforeUnmount, onMounted, ref, watch } from 'vue'
import Tabs from '../components/Tabs.vue';
import Card from '../components/Card.vue';
import NotificationBell from '../components/NotificationBell.vue';
import axios from '../helpers/axios'
import Socket from '../helpers/Socket';
import { useRouter } from 'vue-router';
import Popover from '../../../../fronts/app/src/components/Popover.vue';
import CurrentEditor from '../components/CurrentEditor.vue';
export default {
  name: 'StackSingle',
  components: {
    progressCmp: ProgressVue,
    sectionCmp: SectionVue,
    Tabs,
    Card,
    CurrentEditor,
    Popover,
    NotificationBell,
  },
  setup() {
    const router = useRouter(); 
    /** @type {import('vue').Ref<import('../models/service').default[]>} */
    const stack = ref([])
      /** @type {import('vue').Ref<import('../models/service').default | undefined>}*/
    const currentService = ref()
    const cpu = ref(0)
    const mem = ref(0)
    const restartInProgress = ref(false)
    watch(() => router.currentRoute.value.params.label, async () => {
      await reload()
    })
    const onConfUpdate = (/**@type {string[]}*/data) => {
      if (data.includes(router.currentRoute.value.params.label.toString())) {
        reload()
      }
    }
    onMounted(() => {
      Socket.on('conf:update', onConfUpdate)
    })
    onBeforeUnmount(() => {
      Socket.off('conf:update', onConfUpdate)
    })

    /** @type {number} */
    let interval
    const tabs = ref([])

    async function reload() {
      await Stack.loadServices()
      currentService.value = await Stack.getService(router.currentRoute.value.params.label?.toString())
      if(currentService.value) {
        const {data: plugins} = await axios.get('/plugins/services/' + currentService.value.label)
        tabs.value = plugins
          .sort((
            /** @type {any} */ a,
            /** @type {any} */ b
          ) => a.order - b.order)
          .map((/** @type {{ name: any; icon: any; hidden: any; }} */ plugin) => {
            const tab = {
              label: plugin.name,
              id: plugin.name,
              icon:plugin.icon,
              hidden: plugin.hidden,
              warning: 0
            }
            if(plugin.name === "Configuration") {
              const overrideEnvs = Object.keys(currentService.value?.spawnOptions?.overrideEnvs || {})
              const envs = Object.keys(currentService.value?.spawnOptions?.env || {})
              if(envs.some((key => overrideEnvs.includes(key)))) {
                tab.warning = 1   
              }
            }
            return tab
          })
      }
    }

    onMounted(async () => {
      await reload()
      // @ts-ignore
      interval = setInterval(async () => {
        if(!currentService.value?.label) return
        const {cpu: _cpu, mem: _mem} = await System.getInfos(currentService.value.label.toString())
        cpu.value = _cpu
        mem.value = _mem
      }, 1000);
    })
    onBeforeUnmount(()=> {
      if(interval) clearInterval(interval)
    })
    return {
      stack,
      System,
      currentService,
      cpu, mem,
      tabs,
      restartInProgress,
      async openInVsCode(path, editor) {
        currentService.value?.openInVsCode(path, editor)
      },
      async openFolder(path) {
        currentService.value?.openFolder(path)
      },
      async restart() {
        restartInProgress.value = true
        await currentService.value?.restart()
          .finally(() => restartInProgress.value = false)
      },
      async stop() {
        await currentService.value?.stop()
      },
      async start() {
        await currentService.value?.start()
      },
    }
  }
}
</script>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style scoped lang="scss">
.section-not-started {
  box-shadow: 10px 10px 20px rgba(0,0,0,0.1);
}
.stack-single {
  display: flex;
  width: 100%;
  overflow: hidden;
  .main {
    flex-grow: 1;
    height: 100%;
    margin: auto;
    overflow: auto;
    scroll-behavior: smooth;
    margin-bottom: 20px;
    .header {
      width: 100%;
      height: 85px;
      display: flex;
      justify-content: space-between;
      padding: 10px calc(5% + 10px);
      font-weight: 700;
      position: relative;
      color: white;
      text-align: left;
      box-sizing: border-box;
      .left {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        .title {
          font-size: 2em;
          display: flex;
          gap: 10px;
        }
        .description {
          color: #97d8ff;
          font-weight: 500;
        }
      }
      .right {
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
        align-items: flex-end;
        flex-shrink: 0;
        img {
          width: 18px;
          height: 18px;
          filter: invert(1);
          &.filter-dark {
            filter:  grayscale(1) opacity(0.7)
          }
        }
        .icons {
          display: flex;
          flex-wrap: wrap;
          gap: 10px;
        }
        i {
          color: white;
          font-size: 18px;
        }
        i,img {
          cursor: pointer;
          transition: 300ms;
          &:hover {
            transform: scale(1.1);
          }
        }
      }
      &::before {
        content: '';
        z-index: -1;
        position: absolute;
        top: 0;
        left: 0;
        border-bottom: 3px solid #214f6b;
        border-bottom-left-radius: 20px;
        border-bottom-right-radius: 20px;
        background: linear-gradient(93deg, #1d95db 0%, #074971 100%);
        width: 100%;
        height: calc(100% + 30px);
      }
    }
    .sections {
      margin: auto;
      overflow: auto;
      padding: 0 20px;
      box-sizing: border-box;
    }
  }
}

.system-cards{
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 10px;
  @media (max-width: 1300px) {
    .to-hide-for-small-screen {
      display: none;
    }
  }
  .card {
    i {
      font-size: 20px;
      padding: 0 10px;
      box-sizing: border-box;
    }
    &:hover {
      .hovered {
        max-width: 100px;
      }
    }
    button {
      box-shadow: none;
    }
    .hovered {
      position: absolute;
      top: 0;
      left: 0;
      transition: 300ms;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
      width: 100%;
      height: 100%;
      backdrop-filter: blur(10px) brightness(0.5);
      z-index: 1;
      font-weight: bold;
      max-width: 0;
      overflow: hidden;

    }
  }
  .restart-stop-card {
    button {
      border-radius: 1000px;
      background: #0000003d;
      width: 100%;
      text-align: center;
      display: flex;
      justify-content: center;
      align-items: center;
      &:hover {
        span {
          visibility: visible;
          max-width: 100px;
        
        }
      }
      span {
        visibility: hidden;
        max-width: 0;
        overflow: hidden;
        transition: 300ms;
      }
      &:hover {
        box-shadow: 2px 2px 0px rgba(0,0,0,0.3);
      }
    }
  }
}

.progress-container {
  display: flex;
  align-items: center;
  label {
    width: 60px;
  }
}
.tabs {
  margin-top: 20px;
  .tab {
    padding-left: 20px;
    box-sizing: border-box;
    transform: translateZ(0);
    height: 100%;
  }
}

.rotate {
  animation: rotation 2s infinite;
}
@keyframes rotation {
  0% {
    transform: rotateZ(0);
  }
  100% {
    transform: rotateZ(360deg);
  }
}
</style>
</file>

<file path="fronts/app/src/App.vue">
<template>
  <div id="app-container" v-if="connected">
    <div id="app">
      <sidebar-view-mode v-if="!['stack-chooser', 'import-create'].includes($route.name?.toString() || '')"/>
      <sidebar v-if="['stack-single', 'stack-single-no-view'].includes($route.name?.toString() || '')"/>
      <div class="main">
        <router-view/>
      </div>
    </div>
    <EnvironmentsChooser/>
  </div>
  <div class="not-connected" v-else>
    Server is not connected or has crashed <br>
    Try to restart it or fill an issue: <br><br>
    <a :href="githubIssue" target="_blank">Click here</a>
  </div>

  <template v-for="cmp of componentsToLoad">
    <component :is="cmp"></component>
  </template>
  <Finder/>
  <notif-history/>
  <notifications/>

</template>

<script>
import Stack from './models/stack'
import sidebarVue from './components/sidebar.vue'
import Socket from './helpers/Socket'
import githubIssue from './helpers/githubIssue'
import { ref, onMounted } from 'vue'
import system from './models/system'
import notif from './helpers/notification'
import Notifications from "./components/Notifications.vue"
import './helpers/ServiceError'
import NotifHistory from './components/NotifHistory.vue'
import SidebarViewMode from './components/SidebarViewMode.vue'
import EnvironmentsChooser from './components/EnvironmentsChooser.vue'
import { useRouter } from 'vue-router';
import Theme from './helpers/Theme'
import plugins from '@runeya/modules-plugins-loader-front/src/views';

const componentsToLoad = plugins.filter(p => p.load).reduce((agg, {cmp, name}) => {
  agg[name] = cmp
  return agg
}, {})
export default {
  components: {
    sidebar: sidebarVue,
    Notifications,
    NotifHistory,
    SidebarViewMode,
    EnvironmentsChooser,
    ...componentsToLoad
  },
  setup() {
    (async () => {
      const additionalThemes = await Stack.getAdditionalThemes()
        .catch(err => {
          console.error(err)
          return {}
        })
      Theme.load(additionalThemes)
    })()
    const router = useRouter(); 
    const connected = ref(true)
    const redirect = async () => {
      connected.value = Socket.socket.connected
      if(!connected.value) Stack.services.value = []
      if(
        router.currentRoute.value.fullPath.startsWith('/stack-single') ||
        router.currentRoute.value.fullPath.startsWith('/stack-multiple')
      ) {
        router.push({name:'stack-chooser'})
      }
      const shouldSetup = await Stack.shouldSetup()
      if(shouldSetup) router.push({name: 'settings', params: {setting: 'crypto'}, query: { wrongKey: 'true' }})
    }
    onMounted(async ()=> {
      Socket.on('connect',  redirect);
      Socket.on('disconnect', redirect);
      Socket.on('forceReload', () => {
        window.location.reload()
      });
      Socket.on('system:wrongKey', () => router.push({name: 'settings', params: {setting: 'crypto'}, query: { wrongKey: 'true' }}))
      await redirect()
    })

    // Check versions
    /** @type {import('vue').Ref<{local: string,remote: string,hasUpdate: boolean} | null>} */
    let versions = ref({ local: '', remote: '', hasUpdate: false })
    onMounted(async () => {
      versions.value = await system.hasUpdate()
      if (versions.value?.hasUpdate) {
        notif.next('error', `Update available: ${versions.value.local} => ${versions.value.remote}`)
      }
    })
    return {
      componentsToLoad: ref(Object.keys(componentsToLoad)),
      redirect,
      connected,
      githubIssue,
      versions,
    }
  }
}
</script>

<style lang="scss">
@import '~@fortawesome/fontawesome-free/css/all.min.css';
@import './assets/fonts/Jost/Jost.css';
@import './assets/theme/index.scss'
</style>

<style lang="scss" scoped> 
.main {
  display: flex;
  width: 100%;
  height: 100%;
  overflow: hidden;
  min-height: 100%;
}
#app-container {
  display: flex;
  flex-direction: column;
  height: 100vh;
  width: 100vw;

  #app {
    width: 100vw;
    height: 100%;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
  }
}
.not-connected {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  width: 100vw;
  height: 100vh;
  text-align: center;
}
</style>
</file>

<file path="modules/configuration/front/src/Configs.vue">
<template>
  <section-cmp
    class="configs-root"
    v-if="service" :key="service.label">
    <div class="header">
      <h2>Configuration</h2>
      <div class="line">
        <Button size="small" icon="fas fa-copy" label="Duplicate" @click="duplicate"/>
        <Button size="small" icon="fas fa-trash" label="Remove" severity="danger" @click="remove"/>
      </div>
    </div>
    <Tree :value="nodes"  v-model:expandedKeys="expandedKeys">
       <template #nodeicon="{node: {svgIcon, icon}}">
          <div v-html="svgIcon" v-if="svgIcon" :style="{width: '15px', display: 'flex'}"></div>
          <i :class="icon" v-else></i>
      </template>
      <template #default="slotProps">
        <div class="line">
          <div class="column">
            <div class="label">
              <div class="actions">
                <div class="action" v-for="action of slotProps.node.actions || []">
                  <Button :icon="action.icon" size="small" @click="action?.action()" :disabled="action.disabled"></Button>
                </div>
              </div>
              <b>{{ slotProps.node.label }}</b>
              <i class="fas fa-question-circle" v-if="slotProps.node.hint" v-tooltip="slotProps.node.hint"></i>
            </div>
            <span class="description" v-if="slotProps.node.description">{{ slotProps.node.description }}</span>
          </div>
          <div>
            <Button :disabled="button.disabled" v-for="button of slotProps.node.buttons || []" :key="button.label"
              :severity="button.severity" :style="{justifyContent:'flex-start', width: 'max-content', padding: '5px'}"
              size="small"
              @click="button.action">
              <i :class="button.icon"/>
              {{button.label}}
            </Button>
          </div>
        </div>
      </template>
      <template #inputtext="slotProps">
        <div class="line">
          <Button :disabled="button.disabled" v-for="button of slotProps.node.buttons || []" :key="button.label"
            :severity="button.severity" :style="{padding: 0, width: '25px', height: '25px', flexShrink: 0}"
            size="small"
            @click="button.action">
            <i :class="button.icon"/>
            {{button.label}}
          </Button>
          <InputGroup fluid>
            <InputGroupAddon v-if="slotProps.node.beforeText">{{slotProps.node.beforeText}}</InputGroupAddon>
            <template v-if="slotProps.node.inputLabel">
              <IftaLabel fluid full :style="{display: 'inline-grid',flexGrow: '1'}">
                <InputText v-if="slotProps?.node?.model"
                  v-model="slotProps.node.model.obj[slotProps.node.model.key]"
                  size="small"
                  :placeholder="slotProps.node.placeholder"
                  :type="slotProps.node.inputType || 'text'"
                  @blur="slotProps.node.save"
                  @keypress.enter="slotProps.node.save"
                  :style="{width: '100%'}"
                />
                <label>{{ slotProps.node.inputLabel }}</label>
              </IftaLabel>
            </template>
            <template v-else>
              <InputText v-if="slotProps?.node?.model"
                v-model="slotProps.node.model.obj[slotProps.node.model.key]"
                :placeholder="slotProps.node.placeholder"
                size="small"
                :type="slotProps.node.inputType || 'text'"
                fluid
                @blur="slotProps.node.save"
                @keypress.enter="slotProps.node.save"
              />
            </template>
          </InputGroup>

        </div>
      </template>
      <template #textarea="slotProps">
        <div class="line">
          <Textarea v-if="slotProps?.node?.model"
            v-model="slotProps.node.model.obj[slotProps.node.model.key]"
            size="small"
            @blur="slotProps.node.save"
            @keypress.enter="slotProps.node.save"
          ></Textarea>
          <Button :disabled="button.disabled" v-for="button of slotProps.node.buttons || []" :key="button.label"
            :severity="button.severity" fluid :style="{justifyContent:'flex-start', width: 'max-content', padding: '5px'}"
            size="small"
            @click="button.action">
            <i :class="button.icon"/>
            {{button.label}}
          </Button>
        </div>
      </template>
      <template #switch="slotProps">
        <div class="line">
          <ToggleSwitch v-if="slotProps?.node?.model"
            v-model="slotProps.node.model.obj[slotProps.node.model.key]"
            size="small"
            @blur="slotProps.node.save"
            @change="slotProps.node.save"
          ></ToggleSwitch>
          <Button :disabled="button.disabled" v-for="button of slotProps.node.buttons || []" :key="button.label"
            :severity="button.severity" fluid :style="{justifyContent:'flex-start', width: 'max-content', padding: '5px'}"
            size="small"
            @click="button.action">
            <i :class="button.icon"/>
            {{button.label}}
          </Button>
        </div>
      </template>
      <template #editor="slotProps">
        <div class="line">
          <Editor :language="slotProps.node.language || 'plain/text'" :style="{height: '400px', minWidth:'600px'}"
            :additionalOptions="{
              minimap: { enabled: false },
              lineNumbers: 'off',
              automaticLayout: true
            }"
            v-model="slotProps.node.model.obj[slotProps.node.model.key]"
            @blur="slotProps.node.save"
          ></Editor>
          <Button :disabled="button.disabled" v-for="button of slotProps.node.buttons || []" :key="button.label"
            :severity="button.severity" fluid :style="{justifyContent:'flex-start', width: 'max-content', padding: '5px'}"
            size="small"
            @click="button.action">
            <i :class="button.icon"/>
            {{button.label}}
          </Button>
        </div>
      </template>
      <template #button="{node}">
        <Form
          @submit="($ev) => {node.click($ev.states.value.value); $ev.reset() }"
          v-if="node.inputtext"
          :style="{display: 'flex'}">
          <FormField v-slot="$field" initialValue="" name="value" :style="{width: '100%'}" >
            <InputText size="small" />
          </FormField>
          <Button
            type="submit"
            size="small"
            :severity="node.severity"
            fluid
            :style="{justifyContent:'flex-start', width: 'max-content', padding: '5px'}">
            <i v-if="node.buttonIcon" :class="node.buttonIcon"></i>
            {{ node.label }}
          </Button>
        </Form>
        <Button v-else
            @click="node.click"
            size="small"
            :severity="node.severity"
            fluid
            :style="{justifyContent:'flex-start', width: 'max-content', padding: '5px'}">
            <i v-if="node.buttonIcon" :class="node.buttonIcon"></i>
            {{ node.label }}
          </Button>
      </template>
      <template #select="{node}">
        <Select :options="node.options?.value || node.options || []" fluid
          optionLabel="label"
          optionValue="id"
          :defaultValue="node.value"
          @change="node.onChange"
        ></Select>
      </template>
    </Tree>
  </section-cmp>
  <ModalEditEnvs ref="modalEditEnvsRef" :service="service"></ModalEditEnvs>
  <Modal ref="modalShowEnvRef" :no-cancel="true" validateString="Close" :maxHeight="'80vh'" :noScroll="false">
      <template>
      </template>
      <template #body="{data: envs}">
        <div v-if="envs">
          <div class="line">
            <h2>Current environment</h2>
            <Button label="Download" icon="fas fa-download" size="small" @click="exportEnv(envs)"/>
          </div>
          <DataTable scrollable class="datatable" size="small"  sortField="key" :sortOrder="1"
            :value="parseRawEnvs(envs)"
            tableStyle="width: 100%;">
            <Column field="key" header="Key" col></Column>
            <Column field="value" header="Value" col></Column>
          </DataTable>
        </div>
      </template>
  </Modal>
  <Modal
  ref="duplicateModalRef"
  cancelString="Cancel"
  validateString="Duplicate"
  :disabled="duplicateModalDisabled">
    <template #header>
        Duplication
      </template>
      <template #body>
        <IftaLabel>
          <InputText size="small" fluid v-model="labelOfDuplicatedService"></InputText>
          <label>Name of the duplicated service</label>
        </IftaLabel>
      </template>
  </Modal>
  <Modal
  ref="removeModalRef"
  cancelString="Cancel"
  validateString="Remove">
    <template #header>
        Remove
      </template>
      <template #body>
        <IftaLabel>
          Are you sure to delete this service ?
        </IftaLabel>
      </template>
  </Modal>
</template>

<script>
import { computed, onMounted, ref } from 'vue';
import { useRouter } from 'vue-router';
import Tree from 'primevue/tree';
import Button from 'primevue/button';
import InputText from 'primevue/inputtext';
import DataTable from 'primevue/datatable';
import Column from 'primevue/column';
import Select from 'primevue/select';
import Textarea from 'primevue/textarea';
import IftaLabel from 'primevue/iftalabel';
import ToggleSwitch from 'primevue/toggleswitch';
import { v4 as uuid } from 'uuid';
import { Form, FormField } from '@primevue/forms';
import InputGroup from 'primevue/inputgroup';
import InputGroupAddon from 'primevue/inputgroupaddon';
import Service from '../../../../fronts/app/src/models/service';
import SectionVue from '../../../../fronts/app/src/components/Section.vue';
import Modal from '../../../../fronts/app/src/components/Modal.vue';
import axios from '../../../../fronts/app/src/helpers/axios';
import notification from '../../../../fronts/app/src/helpers/notification';
import ModalEditEnvs from './ModalEditEnvs.vue';
import stack from '../../../../fronts/app/src/models/stack';
import Parsers from '../../../../fronts/app/src/models/Parsers';

export default {
  components: {
    sectionCmp: SectionVue,
    ModalEditEnvs,
    Tree,
    IftaLabel,
    Form,
    Button,
    InputText,
    FormField,
    Modal,
    DataTable,
    Column,
    Select,
    Textarea,
    ToggleSwitch,
    InputGroup,
    InputGroupAddon,
  },
  props: {
    service: {
      /** @type {import('../../../../fronts/app/src/models/service').default | null} */
      default: null,
      required: true,
      type: Service,
    },
  },
  setup(props) {
    const modalEditEnvsRef = ref();
    const modalShowEnvRef = ref();
    const currentEnvironment = ref();
    const router = useRouter();
    const parsers = ref([]);
    const save = () => {
      props.service.save()
        .then(() => notification.next('success', 'Configuration saved'))
        .catch(() => notification.next('error', 'Cannot save configuration'));
    };
    function reorder(arr, index) {
      return [
        {icon: 'fas fa-chevron-up', disabled: index ===0,  action() {
          const [el] = arr.splice(index, 1)
          arr.splice(index - 1 , 0, el)
          save();
        }},
        {icon: 'fas fa-chevron-down', disabled: (index ===(arr?.length || 0) - 1), action() {
          const [el] = arr.splice(index, 1)
          arr.splice(index + 1 , 0, el)
          save();
        }},
      ]
    }
    const nodes = computed(() => ([
      {
        key: 'general',
        label: 'General',
        icon: 'fas fa-home',
        children: [
          {
            key: 'general-description',
            label: 'Description',
            description: props.service.description,
            children: [
              {
                type: 'inputtext',
                model: {
                  obj: props.service,
                  key: 'description',
                },
                save,
              },
            ],
          }, {
            key: 'general-url',
            label: 'URL',
            description: props.service.url,
            children: [
              {
                type: 'inputtext',
                model: {
                  obj: props.service,
                  key: 'url',
                },
                save,
              },
            ],
          },
          {
            key: 'rootpath',
            label: 'Root path',
            icon: 'home',
            hint: 'This is the root path of your services. In a monorepo, this is the root path of your monorepo. You can specify the subpath in your commands below.',
            description: props.service.rootPath,
            children: [
              {
                type: 'inputtext',
                model: {
                  obj: props.service,
                  key: 'rootPath',
                },
                save,
              },
            ],
          },
        ],
      }, {
        key: 'general-health',
        label: 'Health check',
        icon: 'fas fa-heart',
        description: `${props.service.health?.enabled ? 'Enabled' : 'Disabled'}:  ${props.service.health?.url || ''}`,
        children: [
          {
            type: 'switch',
            model: {
              obj: props.service.health,
              key: 'enabled',
            },
            save,
          }, {
            type: 'select',
            options: [
              { id: 'GET', label: 'GET' },
              { id: 'POST', label: 'POST' },
              { id: 'PATCH', label: 'PATCH' },
              { id: 'PUT', label: 'PUT' },
              { id: 'DELETE', label: 'DELETE' },
            ],
            onChange({ value }) {
              if (!props.service.health) return;
              props.service.health.method = value;
              save();
            },
            value: props.service.health?.method,
            save,
          }, {
            type: 'inputtext',
            inputLabel: 'URL',
            model: {
              obj: props.service.health,
              key: 'url',
            },
            save,
          }, {
            type: 'inputtext',
            inputLabel: 'Return code',
            inputType: 'number',
            model: {
              obj: props.service.health,
              key: 'returnCode',
            },
            save,
          }, {
            type: 'inputtext',
            inputLabel: 'Return text',
            model: {
              obj: props.service.health,
              key: 'responseText',
            },
            save,
          }, {
            type: 'inputtext',
            inputLabel: 'Interval (ms)',
            inputType: 'number',
            model: {
              obj: props.service.health,
              key: 'interval',
            },
            save,
          }, {
            type: 'inputtext',
            inputLabel: 'Timeout (ms)',
            inputType: 'number',
            model: {
              obj: props.service.health,
              key: 'timeout',
            },
            save,
          }, {
            type: 'inputtext',
            inputLabel: 'Start after (ms)',
            inputType: 'number',
            model: {
              obj: props.service.health,
              key: 'startAfter',
            },
            save,
          },
        ],
      },
      {
        key: 'groups',
        label: 'Groups',
        icon: 'fas fa-home',
        description: props.service.groups?.join(', '),
        children: [
          ...props.service.groups?.map((group, i) => ({
            key: `group-${i}`,
            type: 'inputtext',
            model: {
              obj: props.service.groups,
              key: i,
            },
            buttons: [{ severity: 'danger', icon: 'fas fa-trash', action: () => { props.service.groups?.splice(i, 1); save(); } }],
            save,
          })) || [],
          {
            key: 'group-add',
            type: 'button',
            label: 'Add new group',
            buttonIcon: 'fas fa-plus',
            click: () => props.service.groups?.push(''),
          },
        ],
      },
      {
        key: 'git',
        label: 'Git',
        icon: 'fab fa-git-alt',
        description: props.service.git?.home,
        children: [
          {
            key: 'git-home',
            label: 'Home',
            hint: 'Add a link to your service to the git repository',
            description: props.service.git?.home,
            children: [
              {
                key: 'git-home',
                type: 'inputtext',
                model: {
                  obj: props.service.git || {},
                  key: 'home',
                },
                save,
              },
            ],
          },
          {
            key: 'git-remote',
            label: 'Remote',
            hint: 'Enables git features of the service',
            description: props.service.git?.remote,
            children: [
              {
                key: 'git-remote',
                type: 'inputtext',
                model: {
                  obj: props.service.git || {},
                  key: 'remote',
                },
                save,
              },
            ],
          },
        ],
      },
      {
        key: 'service-parsers',
        icon: 'fas fa-scroll',
        label: 'Parsers',
        hint: 'Modify the lines produced by your commands to display them the way you want. You can go to the settings to add more.',
        description: props.service.parsers?.map((parserId) => {
          const parser = parsers.value.find((p) => p.id === parserId);
          return parser?.label;
        }).join(', '),
        children: [
          ...props.service.parsers?.map((parserId, i) => {
            const parser = parsers.value.find((p) => p.id === parserId);
            return {
              key: `service-parser-${i}`,
              label: parser?.label,
              actions: reorder(props.service.parsers, i),
              buttons: [{ severity: 'danger', icon: 'fas fa-trash', action: () => { props.service.parsers?.splice(i, 1); save(); } }],
              save,
            };
          }) || [],
          {
            type: 'select',
            model: {
              obj: props.service.spawnOptions,
              key: 'cwd',
            },
            options: parsers.value.filter((parser) => !(props.service.parsers || []).includes(parser.id)),
            onChange({ value }) {
              if (!props.service.parsers) props.service.parsers = [];
              props.service.parsers.push(value);
              save();
            },
            value: '',
            save,
          },
        ],
      },
      {
        key: 'openapi-url',
        label: 'Openapi Url',
        svgIcon: '<svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Swagger</title><path d="M12 0C5.383 0 0 5.383 0 12s5.383 12 12 12c6.616 0 12-5.383 12-12S18.616 0 12 0zm0 1.144c5.995 0 10.856 4.86 10.856 10.856 0 5.995-4.86 10.856-10.856 10.856-5.996 0-10.856-4.86-10.856-10.856C1.144 6.004 6.004 1.144 12 1.144zM8.37 5.868a6.707 6.707 0 0 0-.423.005c-.983.056-1.573.517-1.735 1.472-.115.665-.096 1.348-.143 2.017-.013.35-.05.697-.115 1.038-.134.609-.397.798-1.016.83a2.65 2.65 0 0 0-.244.042v1.463c1.126.055 1.278.452 1.37 1.629.033.429-.013.858.015 1.287.018.406.073.808.156 1.2.259 1.075 1.307 1.435 2.575 1.218v-1.283c-.203 0-.383.005-.558 0-.43-.013-.591-.12-.632-.535-.056-.535-.042-1.08-.075-1.62-.064-1.001-.175-1.988-1.153-2.625.503-.37.868-.812.983-1.398.083-.41.134-.821.166-1.237.028-.415-.023-.84.014-1.25.06-.665.102-.937.9-.91.12 0 .235-.017.369-.027v-1.31c-.16 0-.31-.004-.454-.006zm7.593.009a4.247 4.247 0 0 0-.813.06v1.274c.245 0 .434 0 .623.005.328.004.577.13.61.494.032.332.031.669.064 1.006.065.669.101 1.347.217 2.007.102.544.475.95.941 1.283-.817.549-1.057 1.333-1.098 2.215-.023.604-.037 1.213-.069 1.822-.028.554-.222.734-.78.748-.157.004-.31.018-.484.028v1.305c.327 0 .627.019.927 0 .932-.055 1.495-.507 1.68-1.412.078-.498.124-1 .138-1.504.032-.461.028-.927.074-1.384.069-.715.397-1.01 1.112-1.057a.972.972 0 0 0 .199-.046v-1.463c-.12-.014-.204-.027-.291-.032-.536-.023-.804-.203-.937-.71a5.146 5.146 0 0 1-.152-.993c-.037-.618-.033-1.241-.074-1.86-.08-1.192-.794-1.753-1.887-1.786zm-6.89 5.28a.844.844 0 0 0-.083 1.684h.055a.83.83 0 0 0 .877-.78v-.046a.845.845 0 0 0-.83-.858zm2.911 0a.808.808 0 0 0-.834.78c0 .027 0 .05.004.078 0 .503.342.826.859.826.507 0 .826-.332.826-.853-.005-.503-.342-.836-.855-.831zm2.963 0a.861.861 0 0 0-.876.835c0 .47.378.849.849.849h.009c.425.074.853-.337.881-.83.023-.457-.392-.854-.863-.854z"/></svg>',
        description: props.service.openapiURL,
        children: [
          {
            type: 'inputtext',
            model: {
              obj: props.service,
              key: 'openapiURL',
            },
            save,
          },
        ],
      },
      {
        key: 'service-container',
        icon: 'fab fa-docker',
        label: 'Docker',
        description: `${props.service.container?.enabled ? 'Enabled' : 'Disabled'}:  ${props.service.container?.build?.split('\n')?.[0] || ''}`,
        children: [
          {
            key: 'service-container-switch',
            type: 'switch',
            model: {
              obj: props.service.container,
              key: 'enabled',
            },
            save,
          },
          {
            key: 'service-container-build',
            label: 'Dockerfile',
            hint: 'Only Linux images are supported at the moment and commands will be run in a sh shell to support environment variables in arguments',
            description: props.service.container?.build?.split('\n')?.[0] || '',
            children: [
              {
                key: 'service-container-build-input',
                type: 'editor',
                language: 'dockerfile',
                model: {
                  obj: props.service.container,
                  key: 'build',
                },
                save,
              },
            ],
          }, {
            key: 'service-container-user',
            label: 'User',
            description: props.service.container?.user,
            children: [
              {
                key: 'service-container-user-input',
                label: 'Shared volume',
                description: props.service.container?.user,
                type: 'inputtext',
                placeholder: 'Default: <hostUser>:<hostGroup>',
                model: {
                  obj: props.service.container,
                  key: 'user',
                },
                save,
              },
            ],
          }, {
            key: 'service-container-bootstrap',
            label: 'Bootstrap',
            description: props.service.container?.bootstrap.commands.map((a) => `${a.entrypoint} ${a.cmd}`)?.join(', '),
            children: [
              ...props.service.container?.bootstrap.commands?.map((command, i) => ({
                key: `service-container-bootstrap-${i}`,
                label: `${command.entrypoint} ${command.cmd}`,
                actions: reorder(props.service.container?.bootstrap.commands, i),
                children: [
                  {
                    type: 'inputtext',
                    inputLabel: 'Entrypoint',
                    model: {
                      obj: props.service.container?.bootstrap.commands[i],
                      key: 'entrypoint',
                    },
                    save,
                  },
                  {
                    type: 'inputtext',
                    inputLabel: 'Command',
                    model: {
                      obj: props.service.container?.bootstrap.commands[i],
                      key: 'cmd',
                    },
                    save,
                  },
                  {
                    type: 'inputtext',
                    inputLabel: 'User:Group',
                    placeholder: 'Default: <hostUser>:<hostGroup>',
                    model: {
                      obj: props.service.container?.bootstrap.commands[i],
                      key: 'user',
                    },
                    save,
                  },
                  {
                    type: 'button',
                    severity: 'danger',
                    label: 'Delete command',
                    buttonIcon: 'fas fa-trash',
                    click: () => { props.service.container?.bootstrap.commands?.splice(i, 1); save(); },
                  },
                ],
              })) || [],
              {
                key: 'contaienr-command-add',
                type: 'button',
                label: 'Add new command',
                buttonIcon: 'fas fa-plus',
                click: () => props.service.container.bootstrap.commands?.push({ user: '$UID:$GID', cmd: '-c ""', entrypoint: '/bin/sh' }),
              },
            ],
          }, 
          // {
          //   key: 'service-container-ports',
          //   label: 'Ports',
          //   description: props.service.container?.ports?.join(', '),
          //   children: [
          //     ...props.service.container?.ports?.map((_, i) => ({
          //       key: `service-container-ports-${i}`,
          //       type: 'inputtext',
          //       model: {
          //         obj: props.service.container?.ports,
          //         key: i,
          //       },
          //       buttons: [{ severity: 'danger', icon: 'fas fa-trash', action: () => { props.service.container?.ports?.splice(i, 1); save(); } }],
          //       save,
          //     })) || [],
          //     {
          //       key: 'volume-add',
          //       type: 'button',
          //       label: 'Add new port',
          //       buttonIcon: 'fas fa-plus',
          //       click: () => props.service.container?.ports.push(''),
          //     },
          //   ],
          // },
          {
            key: 'service-container-volumes',
            label: 'Volumes',
            description: props.service.container?.volumes?.join(', '),
            children: [
              ...props.service.container?.volumes?.map((_, i) => ({
                key: `service-container-volumes-${i}`,
                type: 'inputtext',
                model: {
                  obj: props.service.container?.volumes,
                  key: i,
                },
                buttons: [
                  { severity: 'danger', icon: 'fas fa-trash', action: () => { props.service.container?.volumes?.splice(i, 1); save(); } },
                  ...reorder(props.service.container?.volumes, i)
                ],
                  save,
              })) || [],
              {
                key: 'volume-add',
                type: 'button',
                label: 'Add new volume',
                buttonIcon: 'fas fa-plus',
                click: () => props.service.container.volumes.push(''),
              },
            ],
          }, {
            key: 'service-container-ignoreVolumes',
            label: 'Ignore volumes',
            description: props.service.container?.ignoreVolumes?.join(', '),
            children: [
              ...props.service.container?.ignoreVolumes?.map((_, i) => ({
                key: `service-container-ignoreVolumes-${i}`,
                type: 'inputtext',
                model: {
                  obj: props.service.container?.ignoreVolumes,
                  key: i,
                },
                buttons: [
                  { severity: 'danger', icon: 'fas fa-trash', action: () => { props.service.container?.ignoreVolumes?.splice(i, 1); save(); } },
                  ...reorder(props.service.container?.ignoreVolumes, i)
                ],
                save,
              })) || [],
              {
                key: 'volume-add',
                type: 'button',
                label: 'Add new ignored volume',
                buttonIcon: 'fas fa-plus',
                click: () => props.service.container.ignoreVolumes.push(''),
              },
            ],
          }, {
            key: 'service-container-sharedVolumes',
            label: 'Shared volumes',
            description: props.service.container?.sharedVolume,
            children: [
              {
                key: 'service-container-sharedVolume-input',
                label: 'Shared volume',
                description: props.service.container?.sharedVolume,
                type: 'inputtext',
                model: {
                  obj: props.service.container,
                  key: 'sharedVolume',
                },
                save,
              },
            ],
          },
        ],
      },
      {
        key: 'metadata',
        label: 'Metadata',
        icon: 'fas fa-list',
        description: Object.keys(props.service.meta || {}).map((metaKey) => `${metaKey}=${props.service.meta[metaKey]}`).join(','),
        children: [
          ...Object.keys(props.service.meta || {}).map((metaKey) => ({
            key: `metadata-${metaKey}`,
            inputLabel: metaKey,
            description: props.service.meta?.[metaKey],
            type: 'inputtext',
            model: {
              obj: props.service.meta,
              key: metaKey,
            },
            buttons: [{ severity: 'danger', icon: 'fas fa-trash', action: () => { delete props.service.meta[metaKey]; save(); } }],
            save,
          })),
          {
            key: 'metadata-add',
            type: 'button',
            label: 'Add new Metadata',
            buttonIcon: 'fas fa-plus',
            inputtext: true,
            click: (metaKey) => {
              props.service.meta[metaKey] = '';
              save();
            },
          },
        ],
      },
      {
        key: 'commands',
        label: 'Commands',
        icon: 'fas fa-terminal',
        description: `${props.service.commands?.length} command(s)`,
        children: [
          ...props.service.commands?.map((command, commandIndex) => ({
            key: `command-${commandIndex}`,
            label: `${command.spawnCmd} ${command.spawnArgs.join(' ')}`?.trim() || 'Put a command below...',
            actions: reorder(props.service.commands, commandIndex),
            children: [
              {
                key: `command-${commandIndex}-command`,
                label: 'Command',
                description: command.spawnCmd,
                children: [
                  {
                    type: 'inputtext',
                    model: {
                      obj: command,
                      key: 'spawnCmd',
                    },
                    save,
                  },
                ],
              }, {
                key: `command-${commandIndex}-argument`,
                label: 'Arguments',
                description: command.spawnArgs?.join(', '),
                children: [
                  ...command.spawnArgs?.map((argument, i) => ({
                    key: `command-${commandIndex}-argument-${i}`,
                    type: 'inputtext',
                    model: {
                      obj: command.spawnArgs,
                      key: i,
                    },
                    buttons: [
                      { severity: 'danger', icon: 'fas fa-trash', action: () => { command.spawnArgs?.splice(i, 1); save(); } },
                      ...reorder(command.spawnArgs, i)
                    ],
                    save,
                  })) || [],
                  {
                    key: 'argument-add',
                    type: 'button',
                    label: 'Add new argument',
                    buttonIcon: 'fas fa-plus',
                    click: () => command.spawnArgs?.push(''),
                  },
                ],
              }, {
                key: `command-${commandIndex}-path`,
                label: 'Path',
                hint: 'It\'s the concatenation of the rootpath and this one. If runeya was launched with environments variables, you can reference them in the path. Example: $EXTERNAL_PATH_TO_SERVICES/platform',
                description: `${command.spawnOptions?.cwd || ''}`,
                children: [
                  {
                    type: 'inputtext',
                    beforeText: `${props.service.rootPath || '.'}`,
                    model: {
                      obj: command.spawnOptions,
                      key: 'cwd',
                    },
                    save,
                  },
                ],
              }, {
                key: `command-${commandIndex}-parsers`,
                icon: 'parsers',
                label: 'Parsers',
                description: command.parsers?.map((parserId) => {
                  const parser = parsers.value.find((p) => p.id === parserId);
                  return parser?.label;
                }).join(', '),
                children: [
                  ...command.parsers?.map((parserId, i) => ({
                    key: `command-${commandIndex}-parser-${i}`,
                    label: parsers.value.find((p) => p.id === parserId)?.label,
                    actions: reorder(command.parsers, i),
                    buttons: [
                      { severity: 'danger', icon: 'fas fa-trash', action: () => { command.parsers?.splice(i, 1); save(); } },
                    ],
                    save,
                  })) || [],
                  {
                    type: 'select',
                    model: {
                      obj: command.spawnOptions,
                      key: 'cwd',
                    },
                    options: parsers.value.filter((parser) => !(command.parsers || []).includes(parser.id)),
                    onChange({ value }) {
                      if (!command.parsers) command.parsers = [];
                      command.parsers.push(value);
                      save();
                    },
                    value: '',
                    save,
                  },
                ],
              },  {
                key: `command-${commandIndex}-env`,
                label: 'Delete command ',
                buttonIcon: 'fas fa-trash',
                type: 'button',
                severity: 'danger',
                click: () => { props.service.commands?.splice(commandIndex, 1); save(); },
              },
            ],
          })) || [],
          {
            key: 'group-add',
            type: 'button',
            label: 'Add new Command',
            buttonIcon: 'fas fa-plus',
            click: async () => {
              if (!props.service.commands) return;
              props.service.commands.push({
                id: uuid(), spawnOptions: { cwd: '' }, spawnArgs: [], spawnCmd: '',
              });
              expandedKeys.value[`command-${props.service.commands.length - 1}`] = true;
              expandedKeys.value[`command-${props.service.commands.length - 1}-argument`] = true;
              expandedKeys.value[`command-${props.service.commands.length - 1}-command`] = true;
              expandedKeys.value[`command-${props.service.commands.length - 1}-path`] = true;
              await save();
              stack.loadServices();
            },
          },
        ],
      },
      {
        key: 'shortcut',
        label: 'Shortcut',
        icon: 'fas fa-terminal',
        description: `${props.service.shortcuts?.length} command(s)`,
        children: [
          ...props.service.shortcuts?.map((shortcut, shortcutIndex) => ({
            key: `shortcut-${shortcutIndex}`,
            label: shortcut.label || `${shortcut.spawnCmd} ${shortcut.spawnArgs.join(' ')}`?.trim() || 'Put a shortcut below...',
            actions: reorder(props.service.shortcuts, shortcutIndex),
            children: [
              {
                key: `shortcut-${shortcutIndex}-label`,
                label: 'Label',
                description: shortcut.label,
                children: [
                  {
                    type: 'inputtext',
                    model: {
                      obj: shortcut,
                      key: 'label',
                    },
                    save,
                  },
                ],
              }, {
                key: `shortcut-${shortcutIndex}-shortcut`,
                label: 'Command',
                description: shortcut.spawnCmd,
                children: [
                  {
                    type: 'inputtext',
                    model: {
                      obj: shortcut,
                      key: 'spawnCmd',
                    },
                    save,
                  },
                ],
              }, {
                key: `shortcut-${shortcutIndex}-argument`,
                label: 'Arguments',
                description: shortcut.spawnArgs?.join(', '),
                children: [
                  ...shortcut.spawnArgs?.map((argument, i) => ({
                    key: `shortcut-${shortcutIndex}-argument-${i}`,
                    type: 'inputtext',
                    model: {
                      obj: shortcut.spawnArgs,
                      key: i,
                    },
                    buttons: [{ severity: 'danger', icon: 'fas fa-trash', action: () => { shortcut.spawnArgs?.splice(i, 1); save(); } }],
                    save,
                  })) || [],
                  {
                    key: 'argument-add',
                    type: 'button',
                    label: 'Add new argument',
                    buttonIcon: 'fas fa-plus',
                    click: () => shortcut.spawnArgs?.push(''),
                  },
                ],
              }, {
                key: `shortcut-${shortcutIndex}-path`,
                label: 'Path',
                hint: 'It\'s the concatenation of the rootpath and this one. If runeya was launched with environments variables, you can reference them in the path. Example: $EXTERNAL_PATH_TO_SERVICES/platform',
                description: `${shortcut.spawnOptions?.cwd || ''}`,
                children: [
                  {
                    type: 'inputtext',
                    beforeText: `${props.service.rootPath || '.'}`,
                    model: {
                      obj: shortcut.spawnOptions,
                      key: 'cwd',
                    },
                    save,
                  },
                ],
              }, {
                key: `shortcut-${shortcutIndex}-parsers`,
                icon: 'parsers',
                label: 'Parsers',
                description: shortcut.parsers?.map((parserId) => {
                  const parser = parsers.value.find((p) => p.id === parserId);
                  return parser?.label;
                }).join(', '),
                children: [
                  ...shortcut.parsers?.map((parserId, i) => ({
                    key: `shortcut-${shortcutIndex}-parser-${i}`,
                    label: parsers.value.find((p) => p.id === parserId)?.label,
                    actions: reorder(shortcut.parsers, i),
                    buttons: [{ severity: 'danger', icon: 'fas fa-trash', action: () => { shortcut.parsers?.splice(i, 1); save(); } }],
                    save,
                  })) || [],
                  {
                    type: 'select',
                    model: {
                      obj: shortcut.spawnOptions,
                      key: 'cwd',
                    },
                    options: parsers.value.filter((parser) => !(shortcut.parsers || []).includes(parser.id)),
                    onChange({ value }) {
                      if (!shortcut.parsers) shortcut.parsers = [];
                      shortcut.parsers.push(value);
                      save();
                    },
                    value: '',
                    save,
                  },
                ],
              },  {
                key: `shortcut-${shortcutIndex}-env`,
                label: 'Delete shortcut ',
                buttonIcon: 'fas fa-trash',
                type: 'button',
                severity: 'danger',
                click: () => { props.service.shortcuts?.splice(shortcutIndex, 1); save(); },
              },
            ],
          })) || [],
          {
            key: 'group-add',
            type: 'button',
            label: 'Add new shortcut',
            buttonIcon: 'fas fa-plus',
            click: async () => {
              if (!props.service.shortcuts) return;
              props.service.shortcuts.push({
                id: uuid(), spawnOptions: { cwd: '' }, spawnArgs: [], spawnCmd: '',
              });
              expandedKeys.value[`shortcut-${props.service.shortcuts.length - 1}`] = true;
              expandedKeys.value[`shortcut-${props.service.shortcuts.length - 1}-argument`] = true;
              expandedKeys.value[`shortcut-${props.service.shortcuts.length - 1}-shortcut`] = true;
              expandedKeys.value[`shortcut-${props.service.shortcuts.length - 1}-path`] = true;
              await save();
              stack.loadServices();
            },
          },
        ],
      },
      {
            key: `service-env`,
            buttonIcon: 'fas fa-edit',
            label: 'Edit envs',
            type: 'button',
            click: () => editEnvForCommand(),
          }, {
            key: `service-env`,
            label: 'Show envs',
            buttonIcon: 'fas fa-eye',
            type: 'button',
            click: async () => {
              const { data: exportedEnv } = await axios.get('/stack/export-env', { params: { environment: currentEnvironment.value.label, service: props.service.label } });
              await modalShowEnvRef.value.open(exportedEnv).promise;
            },
          },
    ]));

    const expandedKeys = ref({
      general: true,
      commands: true,
    });
    const expandAll = () => {
      expandedKeys.value = { ...expandedKeys.value };
    };
    onMounted(async () => {
      expandAll();
      currentEnvironment.value = await stack.getEnvironment();
      parsers.value = await Parsers.all();
    });
    async function editEnvForCommand() {
      const result = await modalEditEnvsRef.value.open();
      if (result) return save();
      return null;
    }
    async function exportEnv(envObject) {
      const envString = Object.keys(envObject).map((key) => `${key}=${envObject[key]}`).join('\n');
      const element = document.createElement('a');
      element.setAttribute('href', `data:text/plain;charset=utf-8,${encodeURIComponent(envString)}`);
      element.setAttribute('download', '.env');
      element.style.display = 'none';
      document.body.appendChild(element);
      element.click();
      document.body.removeChild(element);
    }

    function parseRawEnvs(envs) {
      return Object.keys(envs).map((key) => ({ key, value: envs[key] }));
    }
    const removeModalRef = ref();
    const duplicateModalRef = ref();
    const labelOfDuplicatedService = ref('');
    return {
      duplicateModalRef,
      labelOfDuplicatedService,
      modalEditEnvsRef,
      modalShowEnvRef,
      exportEnv,
      parseRawEnvs,
      expandedKeys,
      nodes,
      removeModalRef,
      save,
      duplicateModalDisabled: computed(() => !labelOfDuplicatedService.value
          || stack.services.value.find((a) => a.label === labelOfDuplicatedService.value)),
      async remove() {
        const result = await removeModalRef.value.open().promise;
        if (!result) return;
        axios.delete(`/stack/${props.service.label}`)
          .then(() => {
            notification.next('success', 'Service supprimé');
            router.push({ name: 'stack-single-no-view' });
          });
      },
      async duplicate() {
        const result = await duplicateModalRef.value.open().promise;
        if (!result) return;

        axios.put(`/stack/${props.service.label}/duplicate`, { label: labelOfDuplicatedService.value })
          .then(() => {
            notification.next('success', 'Service duplicated');
            const label = labelOfDuplicatedService.value;
            router.push({ name: 'stack-single', params: { label }, query: { tab: 'Configuration' } });
          })
          .catch(() => {
            notification.next('error', 'Cant duplicate service');
          }).finally(() => {
            labelOfDuplicatedService.value = '';
          });
      },
    };
  },
};
</script>
<style lang="scss" scoped>
$grey: var(--system-border-borderColor);
.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  h2 {
    margin: 0;
  }
  input {
    height: max-content;
  }
}
.line {
  display: flex;
  align-items: center;
}
.label {
  white-space: nowrap;
  display: flex;
  text-overflow: ellipsis;
  overflow: hidden;
  flex-wrap: wrap;
  align-items: center;
  .actions {
    display: flex;
    align-items: center;
    :deep(button) {
      padding: 0;
      width: 25px;
      height: 25px;
    }
  }
  i {
    margin-left: 5px;
    font-size: 12px;
    position: relative;
    vertical-align:super;
    text-decoration:none;
  }
}
.description {
  color: var(--system-tertiary-color);
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow: hidden;
  display: inline-block;
}
.column {
  display: flex;
  flex-direction: column;
  overflow: hidden;
}
.line {
  display: flex;
  justify-content: space-between;
}
::v-deep {
  .p-tree-node-label {
    flex-grow: 1;
    overflow: hidden;
  }
  .p-tree-node-children {
    padding: 0 30px
  }
}
</style>
</file>

<file path="modules/configuration/front/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.1.1](https://github.com/runeya/runeya/compare/v2.1.0...v2.1.1) (2025-02-11)

### Bug Fixes

* improve code health ([865b996](https://github.com/runeya/runeya/commit/865b996fa0adcf49668fa770c465bac1f1d8f21a))

## [2.0.8](https://github.com/runeya/runeya/compare/v2.0.7...v2.0.8) (2025-01-13)

### Bug Fixes

* documentation + various bugfixes ([bddd9f6](https://github.com/runeya/runeya/commit/bddd9f6a5507a5a45ea2e54d0fe836e1e518c820))

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* attach heritage to environment instead of service + various fixes ([4647010](https://github.com/runeya/runeya/commit/4647010eadbf3370155faca171a0b10caea32baf))
* remove some dependencies ([5667402](https://github.com/runeya/runeya/commit/5667402d57add874a89ba029ce62b16b3bbed9e0))
* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

## [2.0.1](https://github.com/runeya/runeya/compare/v2.0.0...v2.0.1) (2024-12-25)

### Bug Fixes

* **env_vars:** fix reactivity ([12f7180](https://github.com/runeya/runeya/commit/12f718070723d79e1adef9050894c131ec6343f9))
* various fixes ([18129e9](https://github.com/runeya/runeya/commit/18129e96f7c92a69176d6a75add45f3a48ab11ae))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

* feat!: migrate runeya to entire UI ([e173073](https://github.com/runeya/runeya/commit/e173073d932be7e400b1f51261c090116e8fb543))

### BREAKING CHANGES

* all stack files are useless now

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

### Bug Fixes

* **configuration:** can search through envs ([3673cf9](https://github.com/runeya/runeya/commit/3673cf939a12fae76d851180fe79dcf01d6dcde7))

## [1.18.6](https://github.com/runeya/runeya/compare/v1.18.5...v1.18.6) (2024-02-25)

### Bug Fixes

* cosmetic changes ([87429f3](https://github.com/runeya/runeya/commit/87429f37a57d83f5d568fa4df13cb75e9e4145d1))

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

### Bug Fixes

* add link to runeya help ([62c1d4e](https://github.com/runeya/runeya/commit/62c1d4e07455759e6468133b2ee7fa4ed1cb8cb6))
* cosmetic changes ([a18735e](https://github.com/runeya/runeya/commit/a18735e5b5cec706f3cdf4c4f4ca22482ce7ea0f))

## [1.17.24](https://github.com/runeya/runeya/compare/v1.17.23...v1.17.24) (2024-02-11)

### Bug Fixes

* link front to backend deps ([351abfd](https://github.com/runeya/runeya/commit/351abfd8f8cde96bce80d5202a78dd1daabbf6bb))

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

### Bug Fixes

* link front to backend deps ([66b3135](https://github.com/runeya/runeya/commit/66b313523d99765b692208de0043303dcb6a0914))
* link front to backend deps ([54fcbf3](https://github.com/runeya/runeya/commit/54fcbf371cf03dc4f51a7196de15fe5d352088e9))

## [1.17.22](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.22) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-configuration-front

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-configuration-front

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/documentation/front/package.json">
{
  "name": "@runeya/modules-documentation-front",
  "version": "2.1.1",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "vue": "^3.4.18",
    "vue-eslint-parser": "^9.4.2",
    "vue-router": "^4.2.5"
  }
}
</file>

<file path="servers/server/helpers/args.js">
const path = require('path');

const yargs = require('yargs/yargs')
const { hideBin } = require('yargs/helpers')
const yarg = yargs(hideBin(process.argv))
  .usage('Usage: <path-to-your-stack> [options]')

  .alias('pe', 'pull-env')
  .describe('pe', 'Pull env from a service (need --environment and --service)')
  .default('pe', false)

  .alias('e', 'environment')
  .describe('e', 'Choose your environment')
  .default('e', undefined)

  .alias('s', 'service')
  .describe('s', 'Service')
  .default('s', undefined)

  .alias('ss', 'services')
  .describe('ss', 'Services')
  .default('ss', [])

  .boolean(['pe'])
  .string(['e', 's'])
  .array(['ss'])

  .help('h')
  .alias('h', 'help')
  .parse()

/** @type {Awaited<yarg> &  {rootPath: string, initialCwd: string}} */
const args = Object.assign({
  rootPath: path.resolve(yarg['_']?.[0] || '.'),
  initialCwd: '',
}, yarg);

if (args.rootPath) {
  args.initialCwd = process.cwd()
  process.chdir(args.rootPath)
}

if (args.pullEnv && !args.service) {
  console.error('Error: --service needed')
  process.exit(1)
}
if (args.pullEnv && !args.environment) {
  console.error('Error: --environment needed')
  process.exit(1)
}
module.exports = args
</file>

<file path="common/socket-server/package.json">
{
  "name": "@runeya/common-socket-server",
  "version": "2.1.0",
  "private": true,
  "description": "",
  "repository": "https://github.com/runeya/runeya",
  "main": "src/index.js",
  "scripts": {
    "test": ""
  },
  "author": "",
  "license": "ISC",
  "dependencies": {
    "ws": "^8.18.0"
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "@types/express": "^4",
    "@types/ws": "^8"
  }
}
</file>

<file path="modules/vscode/extension/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* attach heritage to environment instead of service + various fixes ([4647010](https://github.com/runeya/runeya/commit/4647010eadbf3370155faca171a0b10caea32baf))
* remove some dependencies ([5667402](https://github.com/runeya/runeya/commit/5667402d57add874a89ba029ce62b16b3bbed9e0))
* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

## [2.0.1](https://github.com/runeya/runeya/compare/v2.0.0...v2.0.1) (2024-12-25)

### Bug Fixes

* various fixes ([18129e9](https://github.com/runeya/runeya/commit/18129e96f7c92a69176d6a75add45f3a48ab11ae))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

* feat!: migrate runeya to entire UI ([e173073](https://github.com/runeya/runeya/commit/e173073d932be7e400b1f51261c090116e8fb543))

### BREAKING CHANGES

* all stack files are useless now

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

### Bug Fixes

* improve performance + add jsoncrack view ([c534a97](https://github.com/runeya/runeya/commit/c534a9749162f5f15589ec335da149656c757bfb))

## [1.18.7](https://github.com/runeya/runeya/compare/v1.18.6...v1.18.7) (2024-02-25)

### Bug Fixes

* **extension:** notification on health down is too verbose ([a96aad7](https://github.com/runeya/runeya/commit/a96aad77ce6d01be5a8411bdd9a32d4f7c1ad438))

## [1.18.6](https://github.com/runeya/runeya/compare/v1.18.5...v1.18.6) (2024-02-25)

### Bug Fixes

* **extension:** autodiscovery ([dcb1b24](https://github.com/runeya/runeya/commit/dcb1b24c486971a1538a86db9cfdf96f16244bff))
* **extension:** fix code lens ([d17b922](https://github.com/runeya/runeya/commit/d17b9228c15b9cb0acd21e3839fd0b85e07c5a69))

## [1.18.2](https://github.com/runeya/runeya/compare/v1.18.1...v1.18.2) (2024-02-24)

### Bug Fixes

* **extension:** add command and keybinding to print variable into runeya ([0c5d65f](https://github.com/runeya/runeya/commit/0c5d65fdf8a97ed312cc3bfcfa46f74590ca3895))
* **extension:** create vscodeextension ([dfb2589](https://github.com/runeya/runeya/commit/dfb258912ca717cca9b2dc857c2774bfddd59251))
* **front:** cosmetic changes ([ff9b282](https://github.com/runeya/runeya/commit/ff9b2821de658eae571a1da4407ec0651a102e15))

# Change Log

All notable changes to the "runeya" extension will be documented in this file.

Check [Keep a Changelog](http://keepachangelog.com/) for recommendations on how to structure this file.

## [Unreleased]

- Initial release
</file>

<file path="servers/server/bin/server.js">
const { launch } = require('@runeya/common-express');
const pathfs = require('path');
const ports = require('../models/ports');
const table = require('../helpers/console.table');
const args = require('../helpers/args');

module.exports = {
  async launch() {
    await launch({
      port: process.env.RUNEYA_HTTP_PORT || 0,
      controllers: () => require('../app'),
      socket: true,
      apiPrefix: '/',
      bodyLimit: '100mb',
      noGreetings: true,
      staticController: process.env.NODE_ENV !== 'HFBXdZMJxLyJoua28asEaxRixJ6LriR7FnRzX6pwA7pFjZ' ? pathfs.resolve(__dirname, 'public') : undefined,
      helmetConf: process.env.NODE_ENV !== 'HFBXdZMJxLyJoua28asEaxRixJ6LriR7FnRzX6pwA7pFjZ' ? {
        crossOriginEmbedderPolicy: false,
        crossOriginResourcePolicy: false,
        contentSecurityPolicy: {
          directives: {
            upgradeInsecureRequests: null,
            'frame-src': ["'self'", 'runeya.github.io', 'jsoncrack.com'],
          },
          useDefaults: true,
        },
      } : null,
      onListening({ server }) {
        const addr = server.address();
        const port = typeof addr === 'string'
          ? addr
          : addr?.port;
        ports.setHttpPort(+(port || 0));
        if (process.env.NODE_ENV !== 'HFBXdZMJxLyJoua28asEaxRixJ6LriR7FnRzX6pwA7pFjZ' && !process.versions.electron) {
          require('open')(`http://localhost:${port}`);
        }
        // Tips
        (() => {
          table([
            { '': 'Version', Value: require('../helpers/version').version, 'Overrided By': '-' },
            { '': 'Port', Value: ports.http, 'Overrided By': 'RUNEYA_HTTP_PORT' },
            { '': 'Url', Value: `http://localhost:${ports.http}`, 'Overrided By': '-' },
            ...args.ss.length
              ? [{ '': 'Services', Value: args.ss.join(', '), 'Overrided By': '-' }]
              : [],
          ]);
        })();
      },
    });
    await require('../models/stack').selectConf();
  },
};
</file>

<file path="common/express/package.json">
{
  "name": "@runeya/common-express",
  "private": true,
  "version": "2.1.0",
  "description": "",
  "repository": "https://github.com/runeya/runeya",
  "main": "src/index.js",
  "types": "src/index.js",
  "scripts": {
    "test": "echo \"no test\""
  },
  "author": "",
  "license": "ISC",
  "dependencies": {
    "@runeya/common-express-404": "workspace:*",
    "@runeya/common-express-error-handler": "workspace:*",
    "@runeya/common-express-health-check": "workspace:*",
    "@runeya/common-socket-server": "workspace:*",
    "compression": "^1.7.4",
    "cookie-parser": "^1.4.6",
    "cors": "^2.8.5",
    "express": "^4.18.2",
    "express-async-errors": "^3.1.1",
    "helmet": "^5.0.2",
    "http-proxy": "^1.18.1"
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "@types/http-proxy": "^1"
  }
}
</file>

<file path="modules/configuration/front/package.json">
{
  "name": "@runeya/modules-configuration-front",
  "version": "2.1.1",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "@primevue/forms": "^4.2.5",
    "fast-sort": "^3.4.0",
    "vue": "^3.4.18",
    "vue-eslint-parser": "^9.4.2"
  }
}
</file>

<file path="servers/server/routes/stack.js">
const { express } = require('@runeya/common-express');
const { exec } = require('child_process');
const open = require('open');
const commandExists = require('command-exists').sync;
const { Octokit } = require('fix-esm').require('@octokit/core');
const { restEndpointMethods } = require('fix-esm').require('@octokit/plugin-rest-endpoint-methods');

const { sockets } = require('@runeya/common-socket-server');
const Stack = require('../models/stack');
const myConfs = require('../models/myConfs');

const router = express.Router();
const { findService } = Stack;
const Service = require('../models/Service');
const Environment = require('../models/Environment');
const { replaceEnvs } = require('../helpers/stringTransformer.helper');
const MyOctokit = Octokit.plugin(restEndpointMethods);

router.post('/services', async (req, res) => {
  const existingService = Stack.findService(req.body.label);
  if (existingService) {
    await existingService.constructor(req.body, Stack, { isUpdate: true });
    await existingService.save();
    sockets.emit('conf:update', [existingService.label]);
    res.send(existingService);
  } else {
    const service = await new Service(req.body, Stack);
    await service.save();
    Stack.getStack()?.services.push(service);
    sockets.emit('conf:update', [service.label]);
    res.send(service);
  }
});

router.put('/:service/duplicate', async (req, res) => {
  const existingService = findService(req.params.service).toStorage();
  const service = await new Service(existingService, Stack);
  service.label = req.body.label;
  await service.save();
  Stack.getStack()?.services.push(service);
  sockets.emit('conf:update');
  res.send(service);
});
router.patch('/:service', async (req, res) => {
  const service = findService(req.params.service);
  await service.save();
  Stack.getStack()?.services.push(service);
  sockets.emit('conf:update');
  res.send(service);
});

router.get('/export-env', async (req, res) => {
  const service = findService(req.query.service?.toString() || '');
  if (!service) return res.status(404).send('Service not found');
  const command = service.commands?.[+(req.query.commandIndex?.toString() || '0')];
  if (!command) return res.status(404).send('Command not found');
  const envs = await service.buildEnvs(req.query.environment);
  res.send(envs);
});

router.delete('/:service', async (req, res) => {
  await Stack.deleteService(req.params.service);
  sockets.emit('conf:update');
  res.send('ok');
});

router.get('/has-update', async (req, res) => {
  try {
    const localVersion = `v${require('../helpers/version').version}`;
    const octokit = new MyOctokit({ auth: process.env.RUNEYA_GH_APIKEY });
    const { data: tags } = await octokit.rest.repos.listTags({ owner: 'runeya', repo: 'runeya' });
    const remoteVersion = tags[0]?.name;
    return res.json({
      local: localVersion,
      remote: remoteVersion,
      hasUpdate: localVersion !== remoteVersion,
    });
  } catch (error) {
    console.error(error);
    return res.json(null);
  }
});

router.get('/configuration', (req, res) => {
  res.json(Stack.getStack()?.exportInApi());
});
router.get('/environment', (req, res) => {
  res.json(Stack.getCurrentEnvironment());
});

router.patch('/environments/:environmentLabel', async (req, res) => {
  const env = await Stack.getStack()?.environments.find((env) => env.label === req.params.environmentLabel);
  if (!env) return res.status(404).send('Environment not found');
  await env.update(req.body);
  await sockets.emit('reloadEnvironments');
  res.json(Stack.getCurrentEnvironment());
});

router.delete('/environments/:environmentLabel', async (req, res) => {
  const env = await Stack.getStack()?.environments.find((env) => env.label === req.params.environmentLabel);
  if (!env) return res.status(404).send('Environment not found');
  await env.delete();
  await sockets.emit('reloadEnvironments');
  res.json('ok');
});

router.get('/additional-themes', (req, res) => {
  const additionalThemes = Stack.getStack()?.themes || {};
  res.json(additionalThemes);
});

router.post('/environment', async (req, res) => {
  const { environment } = req.body;
  if (!environment) return res.status(400).send('Provide an environment field in body');
  await Stack.getStack()?.changeEnvironment(environment);
  return res.json(Stack.getCurrentEnvironment());
});
router.post('/environment/create', async (req, res) => {
  const { environment } = req.body;
  if (!environment) return res.status(400).send('Provide an environment field in body');
  const newEnvironment = new Environment(environment);
  await newEnvironment.save();
  await sockets.emit('reloadEnvironments');
  return res.json(Stack.getCurrentEnvironment());
});
router.get('/environments', async (req, res) => {
  res.json(await Environment.all());
});
router.get('/all-confs-path', (req, res) => {
  res.json(myConfs.confs);
});
router.post('/select-conf', async (req, res) => {
  const { path } = req.body;
  await Stack.selectConf();
  res.json(path);
});

router.post('/delete-conf', async (req, res) => {
  const { path } = req.body;
  await myConfs.remove(path);
  res.json(path);
});

router.post('/choose', async (req, res) => {
  /** @type {{label: string, enabled: boolean}[]} */
  const servicesLabelSelected = req.body;
  if (!Array.isArray(servicesLabelSelected)) return res.status(400).send('you should provide an array as body with all service label you want to launch');
  const stack = Stack.getStack();
  if (!stack) return res.status(500).send('Stack not configured');
  await stack.enable(servicesLabelSelected);
  return res.json(stack.getEnabledServices().map((s) => s.exportInApi()));
});

router.get('/', (req, res) => {
  const stack = Stack.getStack();
  res.json(stack ? stack.exportInApi() : null);
});

router.get('/services', (req, res) => {
  res.json(Stack.getServices().map((s) => s.exportInApi()));
});

router.get('/:service', (req, res) => {
  const service = findService(req.params.service);
  res.send(service.exportInApi());
});

router.get('/:service/open-folder', (req, res) => {
  open(replaceEnvs(req.query.path?.toString() || '.'));
  res.send();
});

router.get('/:service/restart', async (req, res) => {
  const service = findService(req.params.service);
  await service.restart();
  res.send();
});
router.get('/:service/start', async (req, res) => {
  const service = findService(req.params.service);
  await service.launch();
  res.send();
});

router.get('/:service/stop', async (req, res) => {
  const service = findService(req.params.service);
  await service.kill();
  res.send();
});

module.exports = router;
</file>

<file path="modules/logs/front/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

# [2.1.0](https://github.com/runeya/runeya/compare/v2.0.17...v2.1.0) (2025-01-31)

### Features

* **nodered:** add nodered into app ([f897eb2](https://github.com/runeya/runeya/commit/f897eb2c4a9128e0d4615f6765d3ef0ce1d2ca3e))

## [2.0.17](https://github.com/runeya/runeya/compare/v2.0.16...v2.0.17) (2025-01-24)

### Bug Fixes

* **Logs:** fix arrow height for terminal bar ([eaa2dc3](https://github.com/runeya/runeya/commit/eaa2dc3f4333040dfb23dc04221bec1735f1ca3f))

## [2.0.14](https://github.com/runeya/runeya/compare/v2.0.13...v2.0.14) (2025-01-24)

### Bug Fixes

* **Log:** fix color css to view the cwd path ([8e38a36](https://github.com/runeya/runeya/commit/8e38a36394c1332c9607696fb659a0e3cf8247a3))

## [2.0.13](https://github.com/runeya/runeya/compare/v2.0.12...v2.0.13) (2025-01-24)

### Bug Fixes

* **services:** dont guess anymore cwd from the first command ([e62077f](https://github.com/runeya/runeya/commit/e62077f377c11553fcae6dfd19dbffe989342551))

## [2.0.8](https://github.com/runeya/runeya/compare/v2.0.7...v2.0.8) (2025-01-13)

### Bug Fixes

* documentation + various bugfixes ([bddd9f6](https://github.com/runeya/runeya/commit/bddd9f6a5507a5a45ea2e54d0fe836e1e518c820))

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

## [2.0.1](https://github.com/runeya/runeya/compare/v2.0.0...v2.0.1) (2024-12-25)

### Bug Fixes

* various fixes ([18129e9](https://github.com/runeya/runeya/commit/18129e96f7c92a69176d6a75add45f3a48ab11ae))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

* feat!: migrate runeya to entire UI ([e173073](https://github.com/runeya/runeya/commit/e173073d932be7e400b1f51261c090116e8fb543))

### BREAKING CHANGES

* all stack files are useless now

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

### Bug Fixes

* improve performance + add jsoncrack view ([c534a97](https://github.com/runeya/runeya/commit/c534a9749162f5f15589ec335da149656c757bfb))

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

### Bug Fixes

* **devcontainer:** add container support ([f2559fb](https://github.com/runeya/runeya/commit/f2559fb90bba3de5fcfef2c95dd45826358b7ad4))
* **docker:** add docker support ([f3abb42](https://github.com/runeya/runeya/commit/f3abb4237b8f708585769a8ff51c393d5f21dc5c))
* **logs:** dont render html on simplified mode ([713b2c7](https://github.com/runeya/runeya/commit/713b2c736d9d4f62b791076450b01d4f657e7ff1))
* resolve issues for permission on docker volumes + cosmetic changes ([7a822cd](https://github.com/runeya/runeya/commit/7a822cd1c205e5808247075828c1d3ce49d1524b))

## [1.17.29](https://github.com/runeya/runeya/compare/v1.17.28...v1.17.29) (2024-02-15)

### Bug Fixes

* **theme:** add black theme ([bee4697](https://github.com/runeya/runeya/commit/bee469731be182ac929298dc13fe1c230eccb7ba))

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

### Bug Fixes

* various changes ([06e6241](https://github.com/runeya/runeya/commit/06e624176595b95c4227fe684242919c7eeda192))

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

### Bug Fixes

* cosmetic changes ([a18735e](https://github.com/runeya/runeya/commit/a18735e5b5cec706f3cdf4c4f4ca22482ce7ea0f))

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

### Bug Fixes

* link front to backend deps ([66b3135](https://github.com/runeya/runeya/commit/66b313523d99765b692208de0043303dcb6a0914))
* link front to backend deps ([54fcbf3](https://github.com/runeya/runeya/commit/54fcbf371cf03dc4f51a7196de15fe5d352088e9))

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-logs-front

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="fronts/app/src/components/SidebarViewMode.vue">
<template>
  <div class="sidebar">
    <ul v-if="buttons.length">
      <sidebar-view-mode-item v-for="button of buttons" :key="button.label" :button="button"/>
    </ul>
    <ul v-if="buttonsBottom.length">
      <div style="position: relative">
        <div v-for="item of buttonsPlugins" :key="item?.text">
          <Popover appendTo="parent" trigger="mouseenter" placement="right">
              <template #trigger>
                <button @click="item?.click()" :class="{ active: $router.currentRoute.value.fullPath.includes(item?.active || ''), 'button-speed-dial': true }" class="sidebar-item" :title="item?.text">
                  <i v-if="item?.icon" :class="{ [item?.icon]: true }" aria-hidden="true"/>
                  <img :alt="`Icon for ${item?.text}`" v-else-if="item?.img" :src="item?.img" height="10px">
                </button>
              </template>
              <template #content>
                {{item?.text}}
              </template>
            </Popover>
        </div>
      </div>
      <Popover appendTo="parent" trigger="mouseenter" placement="right">
        <template #trigger>
          <doughtnut-chart
            placeholder="CPU"
            :width="'10px'"
            :rayon="17"
            fontSize="11"
            :value="cpu * 100"
            :strokeWidth="3"
            :strokeWidthBg="5"
            :adjustSubtitleLeft="-2"
            :adjustTitleTop="-5"
            :adjustSubtitleTop="-11"
            :padding="14"
            strokeColor="var(--system-accent-backgroundColor3-lightest)"
            strokeColorBg="var(--system-accent-backgroundColor1)"/>
        </template>
        <template #content>
          CPU
        </template>
      </Popover>
      <Popover appendTo="parent" trigger="mouseenter" placement="right">
        <template #trigger>
          <doughtnut-chart
            placeholder="RAM"
            :width="'10px'"
            :rayon="17"
            :value="mem"
            fontSize="11"
            :strokeWidth="3"
            :strokeWidthBg="5"
            :adjustSubtitleTop="-11"
            :adjustSubtitleLeft="-2"
            :adjustTitleTop="-5"
            :padding="14"
            strokeColor="var(--system-accent-backgroundColor3-tertiary-lightest)"
            strokeColorBg="var(--system-accent-backgroundColor1-tertiary)"/>
        </template>
        <template #content>
          RAM
        </template>
      </Popover>
      
      <Popover appendTo="parent" trigger="mouseenter" placement="left-start" :showOnCreate="false" >
        <template #trigger>
          <sidebar-view-mode-item key="Themes" :button="{
            text: '',
            icon: 'fas fa-sun',
            click: () => Theme.toggle()
          }"/>
        </template>
        <template #content>
          <div class="groups">
            <div v-for="(group) of groups" class="group">
              {{ group.group }}
              <div class="themes">
                <div v-for="theme of group.themes" class="theme" @click="Theme.apply(theme.id)">
                  <Popover appendTo="parent" trigger="mouseenter" placement="top" :showOnCreate="false">
                    <template #trigger>
                      <div class="view">
                        <div class="viewwindows" :style="{
                          ...(theme.preview.background || {}),
                          border: `4px solid ${theme.preview.background.backgroundColor}`
                        }">
                          <div class="rad" :style="theme.preview.foreground4 || theme.preview.foreground1"></div>
                          <div class="rad" :style="theme.preview.foreground3 || theme.preview.foreground1"></div>
                          <div class="rad" :style="theme.preview.foreground2 || theme.preview.foreground1"></div>
                          <div class="rad" :style="theme.preview.foreground1"></div>
                        </div>
                      </div>
                    </template>
                    <template #content>
                      {{ theme.name || theme.label }}
                    </template>
                  </Popover>
                </div>
              </div>
            </div>
          </div>
        </template>
      </Popover>
      <sidebar-view-mode-item v-for="button of buttonsBottom" :key="button.label" :button="button"/>
    </ul>
  </div>
</template>

<script>
import System from '../models/system'
import { computed, onMounted, ref } from 'vue'
import SidebarViewModeItemVue from './SidebarViewModeItem.vue'
import stack from '../models/stack'
import DoughtnutChart from './DoughtnutChart.vue'
import axios from '../helpers/axios'
import Socket from '../helpers/Socket';
import { useRouter } from 'vue-router';
import Theme from '../helpers/Theme'
import Popover from './Popover.vue';
import SpeedDial from 'primevue/speeddial'
import Button from 'primevue/button'

export default {
  components: {
    SidebarViewModeItem: SidebarViewModeItemVue,
    DoughtnutChart,
    Popover,
    SpeedDial,
    Button
  },
  setup() {
    const router = useRouter(); 
    /** @type {import('vue').Ref<import('@runeya/modules-plugins-loader-front/src/views').PluginSM<null>[]>} */
    const plugins = ref([])
    /** @type {import('vue').Ref<import('@runeya/modules-plugins-loader-front/src/views').PluginSM<null>[]>} */
    const pluginsTop = ref([])
    const cpu = ref(0)
    const mem = ref(0)

    onMounted(async () => {
      await stack.loadServices()
      const { data: _plugins } = await axios.get('/plugins/sidebar')
      const { data: _pluginsTop } = await axios.get('/plugins/sidebar-top')
      plugins.value = _plugins?.flat() || []
      pluginsTop.value = _pluginsTop?.flat() || []
      Socket.on('infos:global', data => {
        const {memPercentage, cpu: _cpu} = data
        cpu.value = _cpu
        mem.value = memPercentage
      })
    })
    function extractButtonFromPlugin(plugin) {
      return plugin.placements.map(placement => {
        if(typeof placement === 'string') return
        return {
          text: placement.label,
          icon: placement.icon,
          img: System.proxyImg(placement.img),
          click: placement.goTo ? () => router.push(placement.goTo || '/') : () => { },
          active: placement.active
        }
      })
    }
    function extractButtonsFromPlugin(plugins) {
      return plugins.map(extractButtonFromPlugin).flat().filter(f => f)
    }

    return {
      speedDialVisible: ref(true),
      Theme,
      groups: computed(() => {
        const groupsObj = Object.keys(Theme.themes.value).reduce((agg, themeId) => {
          const theme = Theme.themes.value[themeId]
          theme.id = themeId
          if(!theme.public || !theme.preview) return agg
          const group = theme.group || 'Unknown'
          if(!agg[group]) agg[group] = {group: 'unknown', themes: []}
          agg[group].group = group
          agg[group].themes.push(theme)
          return agg
        }, {})
        const groups = Object.keys(groupsObj).map(key => ({
          group: key,
          themes: groupsObj[key].themes
        }))
        return groups.sort((a, b) => a.group.localeCompare(b.group))
      }),
      buttons:computed(() => ([
        {
          text: 'Overview',
          active: 'overview',
          icon: 'fas fa-home',
          click: () => router.push({ name: 'overview' })
        },
        {
          text: 'Single View',
          active: 'single',
          icon: 'fas fa-columns',
          click: () => {
            const lastVisited = stack.services.value.find((service) => service.label === localStorage.getItem('last-service-visisted'))
            if(lastVisited) router.push({ name: 'stack-single', params: { label: lastVisited.label } })
            else if(stack.services.value[0]) router.push({ name: 'stack-single', params: { label: stack.services.value[0]?.label } })
            else router.push({ name: 'stack-single-no-view'})
          }
        },
        {
          text: 'Multiple view',
          active: 'multiple',
          icon: 'fas fa-th',
          click: () => router.push({name: 'stack-multiple'})
        },
        ...extractButtonsFromPlugin(pluginsTop.value),
      ])),
      buttonsPlugins: computed(() => ([
        ...extractButtonsFromPlugin(plugins.value),
      ])),
      buttonsBottom: computed(() => ([
        {
          text: 'Settings',
          active: 'settings',
          icon: 'fas fa-cog',
          click: () => router.push({name: 'settings-no-view'})
        },
        {
          text: 'Disconnect',
          icon: 'fas fa-unlink',
          click: () => System.disconnect()
        }
      ])),
      cpu, mem,
      System,
    }
  }
}
</script>

<style lang="scss" scoped>
.sidebar {
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  box-shadow: 0px 0px 4px 0px black;
  width: 50px;
  background-color: var(--system-sidebar-backgroundColor);
  height: 100%;
  flex-shrink: 0;
  z-index: 4;
  ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }
}


.progress-container {
  display: flex;
  align-items: center;
  label {
    width: 60px;
  }
}

.system-root {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  &>button {
    z-index: 1;
    width: 90%;
    margin: auto;
  }
} 
.system .title {
  justify-content: center;
}
.groups {
  display: flex;
  flex-direction: column;
  gap: 20px;
}
.view{
  display:flex;
  align-items: center;
  justify-content: center;
  width:50px;
  height:50px;
  position: relative;
  .viewwindows{
    position:absolute;
    width:50px;
    height:50px;
    border-radius:50%;
    box-sizing: border-box;
    overflow:hidden;
    .rad{
      position:absolute;
      width:170%;
      height:170%;
      background:rgb(118, 218, 255);
      animation: rotate 10s linear infinite;
      &:nth-child(1){
        left: -50%;
        top:26%;
        border-radius:35%;
        animation-delay: -4s;
      }
      &:nth-child(2){
        left:-30%;
        top:30%;
        border-radius:37%;
        animation-delay: -3s;
      }
      &:nth-child(3){
        left:-20%;
        top:33%;
        border-radius:40%;
        animation-delay: -2s;
      }
      &:nth-child(4){
        left:0;
        top:35%;
        border-radius:40%;
        animation-delay: -1s;
      }
    }
  }
}
@keyframes rotate {
    0% {
        transform: rotate(0deg);
    }
    50% {
        transform: rotate(180deg);
    }
    100% {
        transform: rotate(360deg);
    }
}
.themes {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  .theme {
    cursor: pointer;
    .background {
      width: 40px;
      height: 40px;
      border-radius: 40px;
      border: 1px solid var(--system-border-borderColor);
      position: relative;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      .foreground {
        position: absolute;
        width: 100%;
        height: 1px;
      }

      .foreground-1 {
        height: 10px;
        transform: rotate(45deg);
      }
      .foreground-2 {
        height: 5px;
        transform: rotate(90deg);
      }
      .foreground-3 {
        height: 3px;
        transform: rotate(135deg);
      }
      .foreground-4 {
        transform: rotate(180deg);
      }
    }
  }
}
.logo {
  width: 100%;
}
.button-speed-dial, .speeddial-button-trigger {
  outline: none;
  border-radius: 5px;
  transition: 200ms;
  transition-property: font-size, box-shadow;
  height: 40px;
  display: flex;
  justify-content: center;
  align-items: center;
  background: transparent;
  margin: 0 5px;
  font-size: 1em;
  box-shadow: none;
  color: var(--system-tertiary-color);
  border: none;
  &:hover {
    background: var(--system-secondary-backgroundColor);
    color: var(--system-secondary-color);
    box-shadow: none;
    transform: none;
    img {
      filter: contrast(0) brightness(1.6);
    }
  }
  &.active {
    @include card();
    img {
      filter: contrast(0) brightness(2);
    }
  }
  i {
    font-size: 1.2em;
  }
  img {
    width: 1.2em;
    height: 1.2em;
    object-fit: contain;
    filter: contrast(0) brightness(2) brightness(0.5);
    
  }
}
</style>

<style lang="scss" >
.p-speeddial-list {
    opacity:0;
  }
.p-speeddial-open {
  .p-speeddial-list {
    opacity:1;
  }
}

</style>
</file>

<file path="modules/logs/front/package.json">
{
  "name": "@runeya/modules-logs-front",
  "version": "2.1.0",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "dayjs": "^1.11.10",
    "json-tree-view-vue3": "^1.0.1",
    "jsonpath": "^1.1.1",
    "vue": "^3.4.18",
    "vue-eslint-parser": "^9.4.2",
    "xterm": "^5.3.0"
  }
}
</file>

<file path="package.json">
{
  "name": "@runeya/runeya",
  "version": "1.0.0",
  "description": "",
  "main": "stack.js",
  "scripts": {
    "prepare": "husky install",
    "postinstall": "husky install && node prepare-monorepo.js || true",
    "serve": "cross-env RUNEYA_HTTP_PORT=6874 runeya",
    "check:monorepo": "cd common/check-monorepo && npm run start",
    "check:dependencies-consistency": "check-dependency-version-consistency .",
    "check:unused": "knip",
    "check:all": "yarn check:unused && yarn check:monorepo && yarn check:dependencies-consistency",
    "ci:generate": "node ./common/workflows/src/index.js",
    "lint": "node runScriptWithEnv \"turbo run lint\"",
    "test": "node runScriptWithEnv \"turbo run test\"",
    "build": "node runScriptWithEnv \"turbo run build --filter @runeya/servers-server\"",
    "docs:build": "node runScriptWithEnv \"turbo run build --filter @runeya/fronts-docs\"",
    "eslint": "eslint",
    "lerna": "npx lerna",
    "changed": "yarn lerna changed -pl --toposort"
  },
  "repository": "git+https://github.com/runeya/runeya.git",
  "author": "runeya <corentinlabroche@gmail.com>",
  "license": "ISC",
  "bugs": {
    "url": "https://github.com/runeya/runeya/issues"
  },
  "homepage": "https://github.com/runeya/runeya#readme",
  "workspaces": {
    "packages": [
      "./fronts/*",
      "./modules/*/*",
      "./common/*",
      "./servers/*"
    ]
  },
  "private": true,
  "packageManager": "yarn@4.2.2",
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "@runeya/common-typings": "workspace:^",
    "@commitlint/cli": "^17.6.7",
    "@commitlint/config-conventional": "^17.6.7",
    "@eslint/eslintrc": "^3.2.0",
    "@eslint/js": "^9.17.0",
    "@runeya/runeya": "^2.1.4",
    "@lerna-lite/changed": "^2.5.0",
    "@lerna-lite/cli": "^2.5.0",
    "@lerna-lite/diff": "^2.5.0",
    "@lerna-lite/exec": "^2.5.0",
    "@lerna-lite/list": "^2.5.0",
    "@lerna-lite/publish": "^2.5.0",
    "@lerna-lite/version": "^2.5.0",
    "@types/bluebird": "^3.5.38",
    "@types/debounce": "^1",
    "@types/kill-port": "^2",
    "@types/lodash": "^4.14.201",
    "@types/node": "^20.8.9",
    "@typescript-eslint/eslint-plugin": "^8.18.2",
    "@typescript-eslint/parser": "^8.18.2",
    "bluebird": "^3.7.2",
    "check-dependency-version-consistency": "^4.1.0",
    "chokidar": "^3.5.3",
    "cross-env": "^7.0.3",
    "debounce": "^2.0.0",
    "dotenv": "^16.4.2",
    "eslint": "^9.17.0",
    "eslint-config-airbnb": "^19.0.4",
    "eslint-plugin-import": "^2.29.0",
    "eslint-plugin-jest": "^27.6.0",
    "eslint-plugin-jsx-a11y": "^6.8.0",
    "eslint-plugin-react": "^7.33.2",
    "eslint-plugin-react-hooks": "^4.6.0",
    "eslint-plugin-vue": "^9.32.0",
    "fix-esm": "^1.0.1",
    "globals": "^15.14.0",
    "husky": "^8.0.3",
    "kill-port": "^2.0.1",
    "knip": "^5.41.1",
    "tsup": "^8.0.1",
    "turbo": "^2.3.3 ",
    "typescript": "^5.3.3",
    "workspace-tools": "^0.36.3"
  },
  "engines": {
    "node": ">=16.0.0"
  },
  "dependencies": {
    "@octokit/core": "^6.1.2",
    "@octokit/plugin-rest-endpoint-methods": "^13.2.6"
  }
}
</file>

<file path="modules/logs/front/src/Logs.vue">
<template>
  <div  v-if="service.enabled" class="logs-root">
    <div class="main-content">
      <div class="pids-container" v-if="pids">
        <div class="pid" :class="{active: !currentPidView}" @click="currentPidView = null; scroll(true)">All</div>
        <Popover placement="bottom-end" appendTo="parent" max-width="50vh">
          <template #trigger>
            <div class="pid" :class="{active: currentPidView}" >
              Commands {{ currentPidView?.raw ? `: ${currentPidView?.raw?.substring(0, 20)}...` : ''}}
              <i class="fas fa-chevron-down"></i>
            </div>
          </template>
          <template #content>
            <div class="pids">
              <div v-for="pid of pids.slice().reverse().filter(a => a.raw?.trim())" :key="pid.pid" class="pid"
                @click="currentPidView = pid; scroll(true)"
                :class="{active: currentPidView?.pid === pid.pid}">
                {{ pid.raw }}
              </div>
            </div>
          </template>
        </Popover>
      </div>
      <sectionCmp :noStyle="noStyle" :noRadius="true"
        :actions="[
          { icon: 'fas fa-list', label: `${countLine}`, small: true, hidden: !countLine, active: !mode, click: () => mode = '' },
          { icon: 'fas fa-bug', label: `${countDebug}`, small: true, hidden: !countDebug, active: mode === 'debug', click: () => mode = 'debug' },
          { label: `{} ${countJSON}`, small: true, hidden: !countJSON, active: mode === 'json', click: () => mode = 'json' },
          { icon: 'fas fa-chevron-down', click: () => scroll(true) },
          { icon: 'fas fa-trash', click: () => clear() },
        ]" class="terminal-container">
          <template #header>
            <h4 class="header-title">{{ 'Logs' + (currentPidView?.raw ? `: ${currentPidView?.raw}` : '') }}</h4>
          </template>
          <template #actions>
            <div class="header">
              <Popover appendTo="parent" placement="bottom-start" trigger="mouseenter">
                <template #trigger>
                  <button class="small config"><i class="fas fa-cog"></i></button>
                </template>
                <template #content>
                  <template v-if="countJSON || countDebug">
                    <div class="input-container">
                      <i class="fas fa-search"></i>
                      <input type="text" v-model="jsonPathSearch" placeholder="JSON path...">
                    </div>
                    <hr>
                  </template>
                  <div class="input-container">
                    <input
                      type="text" v-model="filterSearch"
                      :placeholder="isInclude ? 'Include...' : 'Exclude...'">
                    <div class="radios">
                      <div>
                        <input type="radio" id="include" :checked="isInclude" :value="isInclude"
                          @input="isInclude = true">
                        <label for="include">Include</label>
                      </div>
                      <div>
                        <input type="radio" id="exclude" :checked="!isInclude" :value="!isInclude"
                          @input="isInclude = false">
                        <label for="exclude">Exclude</label>
                      </div>
                    </div>
                  </div>
                  <hr>
                  <div class="input-container">
                    <div class="radios">
                      <div>
                        <div>Display</div>
                        <select v-model="numberToDisplay">
                          <option :value="10">10</option>
                          <option :value="50">50</option>
                          <option :value="100">100</option>
                          <option :value="150">150</option>
                          <option :value="200">200</option>
                          <option :value="500">500</option>
                          <option :value="800">800</option>
                          <option :value="1000">1000</option>
                          <option :value="1500">1500</option>
                          <option :value="2000">2000</option>
                        </select>
                        <div>lines</div>
                      </div>
                    </div>
                  </div>
                  <hr>
                  <div>
                    <input id="simplified" type="checkbox" :checked="simplifiedMode" v-model="simplifiedMode">
                    <label for="simplified">Simplified mode</label>
                  </div>
                </template>
              </Popover>
            </div>
          </template>
          <Transition name="slide-fade">
          <div class="terminal-panel" v-if="selectedLine">
            <div class="terminal-panel-bg" @click="selectedLine = null"></div>
            <div class="terminal-panel-content">
              <h3>
                Type:
                <template v-if="selectedLine.debug">Debug</template>
                <template v-else-if="selectedLine.json">JSON</template>
                <template v-else-if="selectedLine.cmd">Command</template>
                <template v-else>Text</template>
              </h3>
              <div class="more-info-container">
                <div class="more-info-label">Raw message:</div>
                <div class="more-info-content"><pre>{{ selectedLine.msg }}</pre></div>
              </div>
              <div class="more-info-container pid-box" v-if="selectedLine.pid" @click="setPid(selectedLine)">
                <div class="more-info-label">Issued from pid: </div>
                <div class="more-info-content">
                  {{ selectedLine.pid }}
                  <button class="small"><i class="fas fa-chevron-right"></i></button>
                </div>
              </div>
              <div class="more-info-container">
                <div class="more-info-label">Emitted date:</div>
                <div class="more-info-content">{{ dayjs(selectedLine.timestamp).format('YYYY-MM-DD HH:mm:ss') }}</div>
              </div>
              <div v-if="selectedLine.cmd" class="more-info-container">
                <div class="more-info-label">Options:</div>
                <div class="more-info-content">
                  <JsonTreeView :maxDepth="1" :json="transformerJSON(selectedLine.cmd)" :copyable="true" :expand-depth="1" :show-double-quotes="true"/>
                </div>
              </div>
            </div>
          </div>
          </Transition>
          <div class="terminal" ref="jsonsRef">
            <div class="line" :class="{
              simplifiedMode,
              stderr: line.source === 'stderr' || (line.cmd && line.cmd.status === 'error'),
              success: (line.cmd && line.cmd.status === 'exited'),
              separator: line.isSeparator != null,
              json: line.json != null && !simplifiedMode,
              debug: line.debug != null && !simplifiedMode,
              cmd: line.cmd != null && !simplifiedMode,
              prompt: line.prompt && !simplifiedMode,
            }" v-for="line of displayedLines" :key="line.id" @click="setSelectedLine(line)" >
                  <div v-if="simplifiedMode">{{ line.msg }}</div>
                  <div v-else-if="line.cmd != null" >
                    <template v-if="line.cmd.cmd.trim()">
                      <h2 class="section-header" v-if="line.cmd.cmd.trim()">
                        Command
                        <template v-if="line.cmd.status === 'running'"><Spinner style="display: inline-flex;" :no-color="true" size="20"></Spinner></template>
                      </h2>
                      <div class="section-content">
                        {{ line.msg }}
                      </div>
                    </template>
                    <template v-else>
                      <br/>
                    </template>
                  </div>
                  <div v-else-if="line.prompt">
                    <h2 class="section-header">Prompt</h2>
                    <div class="section-content" v-html="line.msg.trim() || '<br/>'"/>
                  </div>
                  <div v-else-if="line.debug  != null" >
                    <div class="section-header">
                      <h2 class="section-header">Debug</h2>
                      <div class="section-actions">
                        <button class="small" @click.stop="copy(JSON.stringify(line.debug))">Copy</button>
                        <button class="small">
                          <router-link :to="{ name: 'JSONFormatter', query: { json: JSON.stringify(line.debug) } }">
                            Open in json-viewer
                          </router-link>
                        </button>
                        <button class="small" @click.stop="findSolution(/**@type {any}*/(line.debug))">
                          Find a solution
                        </button>
                      </div>
                    </div>
                    <div class="section-content">
                      <JsonTreeView :maxDepth="1" :json="transformerJSON(line.debug)" :copyable="true" :expand-depth="1" :show-double-quotes="true"/>
                    </div>
                  </div>
                  <div v-else-if="line.json != null"  >
                    <div class="section-header">
                      <h2 >JSON</h2>
                      <div class="section-actions">
                        <button class="small" @click.stop="copy(JSON.stringify(line.json))">Copy</button>
                        <button class="small">
                          <router-link :to="{ name: 'JSONFormatter', query: { json: JSON.stringify(line.json) } }">
                            Open in json-viewer
                          </router-link>
                        </button>
                        <button class="small" @click.stop="findSolution(/**@type {any}*/(line.json))">
                          Find a solution
                        </button>
                      </div>
                    </div>
                    <div class="section-content">
                      <JsonTreeView :maxDepth="1" :json="transformerJSON(line.json)" :copyable="true" :expand-depth="1" :show-double-quotes="true"/>
                    </div>
                  </div>
                  <div v-html="line.msg" v-else></div>
            </div>
          </div>

          <div class="input-container-terminal" v-if="!currentPidView || currentPidView.cmd?.status == 'running'">
            <div class="shortcuts">
              <Tag class="shortcut" v-for="shortcut of service.shortcuts" severity="info" @click="sendShortcut(shortcut)">
                <i class="fas fa-terminal"/>{{shortcut.label || shortcut.spawnCmd + ' ' + (shortcut.spawnArgs?.join(' ') || '')}}
              </Tag>
              <Tag class="shortcut" v-for="scenario of scenarios" severity="warn" @click="sendScenario(scenario)">
                <i class="fas fa-sitemap"/>{{scenario.name}}
              </Tag>
            </div>
            <div class="histories" v-if="histories?.length">
              <div
                class="history" :class="{active: history.active}"
                @click="messageToSend = history.cmd; histories = []; textareaRef?.focus()"
                v-for="(history, i) of histories" :key="i + 'history'">
                <div>
                  {{ history.cmd }}
                </div>
                <div class="right">
                  <div>Used: {{history.timestamps?.length || 0}}</div>
                  <div>Last used: {{history.timestamp
                    ? dayjs(history.timestamp).format('YYYY-MM-DD HH:mm:ss')
                    : '???'
                  }}</div>
                </div>
              </div>
            </div>
            <div class="histories" v-else-if="autocompleteInProgress">
              <div class="history">
                <Spinner size="20"></Spinner>
              </div>
            </div>
            <div class="bar-terminal">
              <div class="left">
                <div class="blue">
                  <template v-if="service.container?.enabled">
                    <i class="fab fa-docker"/>
                  </template>
                  <template v-else>
                  <i class="icon fas fa-folder"></i>
                    <Select
                      size="small"
                      v-model="cwd"
                      :options="cwds"
                    >
                      <option v-for="cwd of cwds">{{ getShortPath(cwd) }}</option>
                    </Select>
                  </template>
                </div>
                <div :class="gitChanges?.length ? 'yellow': 'green'" v-if="currentBranch">
                  <i class="icon fas fa-code-branch"></i>
                  <label>
                    {{ currentBranch }}
                    <div v-if="+gitRemoteDelta > 0">
                      <i class="fas fa-long-arrow-alt-up"></i>{{ +gitRemoteDelta }}
                    </div>
                    <div v-if="+gitRemoteDelta < 0">
                      <i class="fas fa-long-arrow-alt-down"></i>{{ Math.abs(+gitRemoteDelta) }}
                    </div>
                  </label>
                </div>
              </div>
            </div>
            <div class="input-content-terminal">
              <div class="badge" v-if="currentPidView?.pid">Pid: {{ currentPidView.pid }}</div>
              <i class="fas fa-chevron-right"></i>
              <PassThrough>
                <textarea ref="textareaRef"
                  v-model="messageToSend"
                  @keypress.enter="sendEnter"
                  @keyup="keyup"
                  @keydown="keydown"
                  @input="inputTerminal"
                  :placeholder="currentPidView ? `Send command to ${currentPidView.pid}...` : 'Send new command...'"
                />
              </PassThrough>
            </div>
          </div>
          <div class="input-container-terminal" v-else-if="currentPidView">
            Your command no longer accepts further response
            <button @click="currentPidView = null">Go to all processes view</button>
            <button class="danger" @click="sendTerminate(true)">Or try to force kill</button>
          </div>
      </sectionCmp>
    </div>
  </div>
  <sectionCmp v-else>
    <div class="not-launch">
      <div class="shortcuts">
        <Tag class="shortcut" v-for="shortcut of service.shortcuts" severity="info" @click="sendShortcut(shortcut)">
          <i class="fas fa-terminal"/>{{shortcut.label || shortcut.spawnCmd + ' ' + (shortcut.spawnArgs?.join(' ') || '')}}
        </Tag>
        <Tag class="shortcut" v-for="scenario of scenarios" severity="warn" @click="sendScenario(scenario)">
          <i class="fas fa-sitemap"/>{{scenario.name}}
        </Tag>
      </div>
      <i class="fas fa-ban"></i>
      Launch this service to view logs
    </div>
  </sectionCmp>

  <Modal ref="findSolutionModal" cancelString="No" validateString="Yes">
    <template #header>
      Find solution from AI
    </template>
    <template #body="{data: tokens}">
      Are you sure ? This have a cost of ~{{ tokens.price }}$
    </template>
  </Modal>

  <Modal ref="findSolutionResultModal" cancelString="OK" :noValidate="true">
    <template #header>
      Find solution from AI
    </template>
    <template #body="{data: result}">
      <pre>
        {{result?.trim()}}
      </pre>
    </template>
  </Modal>
</template>

<script setup>
import { JsonTreeView } from 'json-tree-view-vue3';
import 'json-tree-view-vue3/dist/style.css';
import jsonpath from 'jsonpath';
import {
  computed, onMounted, ref, nextTick, onBeforeUnmount,
  onUnmounted,
} from 'vue';
import dayjs from 'dayjs';
import debounce from 'debounce';
import Socket from '../../../../fronts/app/src/helpers/Socket';
import sectionCmp from '../../../../fronts/app/src/components/Section.vue';
import Modal from '../../../../fronts/app/src/components/Modal.vue';
import Service from '../../../../fronts/app/src/models/service';
import notification from '../../../../fronts/app/src/helpers/notification';
import Popover from '../../../../fronts/app/src/components/Popover.vue';
import fs from '../../../../fronts/app/src/models/fs';
import Spinner from '../../../../fronts/app/src/components/Spinner.vue';
import Tag from 'primevue/tag';
import PassThrough from './PassThrough.vue';
import Select from 'primevue/select';
import Stack from '../../../../fronts/app/src/models/stack'

const props = defineProps({
  service: {
    /** @type {import('../../../../fronts/app/src/models/service').default | null} */
    default: null,
  },
  noStyle: { default: false },
  isInMultiMode: { default: false },
});

/** @type {import('vue').Ref<import('xterm').Terminal | null>} */
const terminal = ref(null);
/** @type {import('vue').Ref<HTMLElement | null>} */
const logsContainer = ref(null);
/** @type {import('vue').Ref<HTMLElement | null>} */
const jsonsRef = ref(null);
const filterSearch = ref('');
const isInclude = ref(false);
/** @type {import('vue').Ref<LogMessage[]>} */
const logs = ref([]);
/** @type {import('vue').Ref<LogMessage | null>} */
const selectedLine = ref(null);
const jsonPathSearch = ref('');
const findSolutionModal = ref();
const simplifiedMode = ref(false);
const numberToDisplay = ref(100);
const findSolutionResultModal = ref();
const mode = ref('');
const scenarios = ref([]);
/** @type {import('vue').Ref<{active: boolean, cmd: string, args: string, raw: string, timestamp: number,timestamps: number[]}[]>} */
const histories = ref([]);

/** @param {string} data */
function copy(data) {
  navigator.clipboard.writeText(data)
    .then(() => notification.next('success', 'Data copied to clipboard'));
}

const countJSON = computed(() => {
  let count = logs.value.reduce((count, line) => (line.json && !line.debug ? count + 1 : count), 0);
  if (count > numberToDisplay.value) count = numberToDisplay.value;
  return count;
});
const countDebug = computed(() => {
  let count = logs.value.reduce((count, line) => (line.debug ? count + 1 : count), 0);
  if (count > numberToDisplay.value) count = numberToDisplay.value;
  return count;
});
const countLine = computed(() => {
  let count = logs.value.length;
  if (count > numberToDisplay.value) count = numberToDisplay.value;
  return count;
});

/** @param {any} json */
function transformerJSON(json) {
  if (jsonPathSearch.value) {
    const search = jsonPathSearch.value.endsWith('.')
      ? jsonPathSearch.value.slice(0, -1)
      : jsonPathSearch.value;
    try {
      const res = jsonpath.query(json, search);
      if (res.length === 1) return JSON.stringify(res['0'] || '{}');
      return JSON.stringify(res || '{}');
    } catch (error) {
      console.error(error);
    }
  }
  return JSON.stringify(json || '{}');
}
const displayedLines = computed(() => {
  /** @type {LogMessage[]} */
  let lines = [];
  if (mode.value === 'debug') {
    lines = logs.value
      .filter((line) => {
        if (line.isSeparator) return isLineIncluded(line);
        if (line.debug && isLineIncluded(line)) return true;
        return false;
      })
      .slice(-numberToDisplay.value);
  } else if (mode.value === 'json') {
    lines = logs.value
      .filter((line) => {
        if (line.isSeparator) return isLineIncluded(line);
        if (line.json && !line.debug && isLineIncluded(line)) return true;
        return false;
      })
      .slice(-numberToDisplay.value);
  } else {
    lines = logs.value
      .filter((line) => {
        if (line.isSeparator) return isLineIncluded(line);
        if (isLineIncluded(line)) return true;
        return false;
      })
      .slice(-numberToDisplay.value);
  }

  return lines.filter((line, i, arr) => {
    if (line.isSeparator) return !arr[i + 1]?.isSeparator;
    return true;
  });
});

/** @param {Record<string, string>} data */
async function findSolution(data) {
  const tokens = await Service.getTokens(JSON.stringify(data));
  const res = await findSolutionModal.value.open(tokens).promise;
  if (res) {
    const review = await Service.findSolutionFromAi(JSON.stringify(data));
    await findSolutionResultModal.value.open(review).promise;
  }
}

/**
 * @param {LogMessage} line
 */
const isLineIncluded = (line) => {
  const message = filterSearch.value;
  if (line.hide) return false;
  if (line.isSeparator) return true;
  if (currentPidView.value?.pid && currentPidView.value?.pid !== line.pid) return false;
  if (!message) return true;
  const filters = message.includes(' | ')
    ? message.split(' | ')
    : [message];
  return isInclude.value
    ? filters.filter((a) => a).some(((filter) => {
      const res = line.msg.toUpperCase().match(new RegExp(escapeRegExp(filter), 'gi'));
      return !!res;
    }))
    : filters.filter((a) => a).every(((filter) => {
      const res = line.msg.toUpperCase().match(new RegExp(escapeRegExp(filter), 'gi'));
      return !res;
    }));
};

onMounted(() => mounted());

const onConfUpdate = () => {
  if (logsContainer.value && !logsContainer.value?.children.length && terminal.value) {
    terminal.value.open(logsContainer.value);
  }
};
onMounted(() => {
  Socket.on('conf:update', onConfUpdate);
});
onBeforeUnmount(() => {
  Socket.off('conf:update', onConfUpdate);
});
async function mounted() {
  logs.value = await props.service.getLogs();
  scenarios.value = await Stack.scenarios('services', props.service.label)
  scroll(true);
}
const crashEventCB = (/** @type {{label:string, code: number, signal: string, pid?: number}} */data) => {
  if (data.label !== props.service.label) return;
  if (data.pid) {
    if (currentPidView.value?.pid === data.pid) {
      currentPidView.value = null;
      scroll(true);
    }
  }
};
const clearEventCB = (data) => {
  if (data.label !== props.service.label) return;
  logs.value = [];
  terminal.value?.clear();
};
const logsUpdateEventCB = (/** @type {LogMessage[]} */datas) => {
  datas.forEach((data) => {
    if (data.label !== props.service.label) return;
    logs.value.push(data);
    scroll();
  });
};
const logsUpdateLineEventCB = (/** @type {LogMessage[]} */lines) => {
  lines.forEach((line) => {
    if (line.label !== props.service.label) return;
    const index = logs.value.findIndex((a) => a.id === line.id);
    if (index >= 0) {
      logs.value.splice(index, 1, line);
    }
  });
};
const exitEventCB = (/** @type {{label:string, code: number, signal: string, pid?: number}} */data) => {
  if (data.label !== props.service.label) return;
  if (data.pid) {
    if (currentPidView.value?.pid === data.pid) {
      currentPidView.value = null;
      scroll(true);
    }
  }
};
Socket.on('logs:update', logsUpdateEventCB);
Socket.on('logs:update:lines', logsUpdateLineEventCB);
Socket.on('service:exit', exitEventCB);
Socket.on('service:crash', crashEventCB);
Socket.on('logs:clear', clearEventCB);
onUnmounted(() => {
  Socket.socket.off('logs:update', logsUpdateEventCB);
  Socket.socket.off('logs:update:lines', logsUpdateLineEventCB);
  Socket.socket.off('service:exit', exitEventCB);
  Socket.socket.off('service:crash', crashEventCB);
  Socket.socket.off('logs:clear', clearEventCB);
});

async function clear() {
  props.service.clear();
  logs.value = [];
}

/** @param {string} text */
function escapeRegExp(text) {
  return text.replace(/[-[\]{}()*+?.,\\^$|#\s]/g, '\\$&');
}
/**
 *
 * @param {boolean} force
 * @param {HTMLElement | null} customElement
 */
async function scroll(force = false, customElement = null) {
  const container = customElement || jsonsRef.value;
  if (!container) return;
  const shouldScroll = container.scrollTop + container.clientHeight === container.scrollHeight;
  await nextTick();
  if (shouldScroll || force) container.scrollTop = container.scrollHeight;
}

const messageToSend = ref('');
/** @param {Event | undefined} ev */
async function send(command, ev = undefined) {
  ev?.preventDefault?.();
  const pid = await props.service.sendTerminalPrompt({
    command,
    pid: currentPidView.value?.pid || undefined,
  });
  setTimeout(() => {
    const lineFound = logs.value.find((log) => log.pid === pid.pid);
    if (lineFound?.cmd?.status === 'running') {
      currentPidView.value = lineFound;
    }
  }, 100);
  messageToSend.value = '';
  if (ev?.target) {
    await nextTick();
    rerenderTextarea();
  }
  scroll(true);
  reloadBarInfos(true);
}

const textareaRef = ref();
function rerenderTextarea() {
  textareaRef.value.style.height = 'calc(15px)';
  textareaRef.value.style.height = `${textareaRef.value.scrollHeight}px`;
}
/** @param {KeyboardEvent} ev */
async function sendEnter(ev) {
  const active = histories.value.find((a) => a.active);
  if (active) {
    setTimeout(async () => {
      messageToSend.value = active.cmd?.trim();
      await nextTick();
      rerenderTextarea();
      setTimeout(() => {
        histories.value = [];
      }, 100);
    });
    return;
  }
  if (!ev.shiftKey) await send({
    spawnCmd: messageToSend.value.trim(),
    spawnOptions: {
      cwd: cwd.value
    }
  }, ev);
  else messageToSend.value += '\n';
}
/** @param {Event} ev */
async function inputTerminal(ev) {
  histories.value = [];
  if (ev.target) {
    if (/** @type {HTMLElement} */(ev.target).scrollHeight < 300) {
      rerenderTextarea();
    }
  }
}

/** @param {boolean} forceKill */
async function sendTerminate(forceKill = false) {
  await props.service.sendTerminalTerminate({ pid: currentPidView.value?.pid || undefined, forceKill });
}
const autocompleteInProgress = ref(false);

/** @param {KeyboardEvent} $event */
async function keydown($event) {
  if ($event.code === 'Tab') $event.preventDefault();
}
/** @param {KeyboardEvent} $event */
async function keyup($event) {
  if ($event.code === 'Escape') {
    histories.value = [];
    return null;
  }
  if ($event.code === 'Enter') {
    histories.value = [];
    return null;
  }
  if ($event.ctrlKey && $event.code === 'KeyC') {
    sendTerminate();
    return null;
  }
  if ($event.code !== 'ArrowUp' && $event.code !== 'ArrowDown' && !messageToSend.value) {
    histories.value = [];
    return null;
  }
  if ($event.code === 'ArrowUp' && histories.value.length) {
    changeActive($event, 1);
    return null;
  }
  if ($event.code === 'ArrowDown' && histories.value.length) {
    changeActive($event, -1);
    return null;
  }
  if (['ArrowUp', 'ArrowDown'].includes($event.code)) {
    histories.value = await props.service.autocomplete(messageToSend.value, { force: true });
    return null;
  }
  autocompleteInProgress.value = true;
  await autocomplete();
  if (!messageToSend.value) changeActive($event, 1);
  return null;
}
const autocomplete = debounce(async (force = false) => {
  try {
    autocompleteInProgress.value = true;
    const _histories = await props.service.autocomplete(messageToSend.value, { force });
    if (!messageToSend.value && !force) return;
    histories.value = _histories;
  } finally {
    autocompleteInProgress.value = false;
  }
}, 200);

/**
 * @param {KeyboardEvent} $event
 * @param {number} offset
 */
async function changeActive($event, offset) {
  const activeIndex = histories.value.findIndex((a) => a.active);
  if (activeIndex === -1) {
    const last = offset > 0 ? histories.value[histories.value.length - 1] : histories.value[0];
    if (last) last.active = true;
  } else {
    const current = histories.value[activeIndex];
    const next = histories.value[activeIndex - offset];
    current.active = false;
    if (next) next.active = true;
    else changeActive($event, offset);
  }
}
/** @type {import('vue').Ref<LogMessage | null | undefined>} */
const currentPidView = ref(null);
const pids = computed(() => logs.value.reduce((aggr, log) => {
  if (log.pid && !aggr?.find((_log) => _log.pid === log.pid)) aggr.push(log);
  return aggr;
}, /** @type {LogMessage[]} */([])));

const currentBranch = ref('');
const gitChanges = ref('');
const homedir = ref('');
const gitRemoteDelta = ref('');
const interval = setInterval(() => {
  reloadBarInfos();
}, 1000);
const longInterval = setInterval(() => {
  reloadBarInfos(true);
}, 20000);
onBeforeUnmount(() => {
  clearInterval(interval);
  clearInterval(longInterval);
});
onMounted(async () => {
  homedir.value = await fs.homeDir();
  reloadBarInfos(true);
});

const reloadBarInfos = debounce(async (reloadCostingInfos = false) => {
  if (!props.service.git?.remote) return;
  if (reloadCostingInfos) {
    if (gitRemoteDelta.value) gitRemoteDelta.value = '';
  }
  gitChanges.value = await props.service.getStatus();
  currentBranch.value = await props.service.getCurrentBranch();
  if (reloadCostingInfos) {
    gitRemoteDelta.value = await props.service.gitRemoteDelta(currentBranch.value);
  }
}, 100);
const cwds = ref(
  [
    props.service?.rootPath,
    ...(props.service?.commands?.map(a => a.spawnOptions.cwd) || []).filter(a => a && !!a.trim() && a !== '.')
  ]
);

const cwd = ref(cwds.value[0] || '.');
/**
 *
 * @param {string | undefined} path
 */
function getShortPath(path) {
  return path
    ?.replace(homedir.value, '~');
}

/**
 * @param {LogMessage | undefined | null} line
 */
function setPid(line) {
  const command = logs.value.find((l) => l.cmd && l.pid === line?.pid);
  currentPidView.value = command || null;
  selectedLine.value = null;
}

/**
 *
 * @param {*} line
 */
function setSelectedLine(line) {
  if (window.getSelection()?.toString()) return;
  selectedLine.value = line;
}
async function sendShortcut(shortcut) {
  return send(shortcut)
}
async function sendScenario(scenario) {
  Socket.emit(scenario.id, scenario, props.service.label)
}
/**
 * @typedef {import('../../../../servers/server/models/Service').LogMessage} LogMessage
 */
</script>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style scoped lang="scss">
.logs-root {
  height: 100%;
}
#terminal {
  width: 100%;
  position: relative;
}
.not-launch {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  font-size: 2em;
  color: #777
}

.header-title {
  margin: 0;
  max-width: 50vh;
  text-overflow: ellipsis;
  white-space: nowrap;
  overflow: hidden;
}
.header {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 20px;
  font-weight: normal !important;
  position: relative;
  z-index: 1;
  margin: 0;
  font-size: 0.7em !important;
  &>.separator {
    border-left: 1px solid lightgrey;
    height: 40px;
  }
}
.terminal-container {
  width: 100%;
  margin: auto;
  position: relative;
  border-left: none;
  border-right: none;
  border-bottom: none;
  box-sizing: border-box;
  overflow: auto;
  flex-grow: 1;
  border-top-left-radius: 0 !important;
  border-top-right-radius: 0 !important;
  .terminal-panel {
    position: absolute;
    z-index: 2;
    right: 0;
    top: 0;
    width: 100%;
    height: 100%;
    .terminal-panel-bg {
      position: absolute;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      left: 0;
      top: 0;
    }
    .terminal-panel-content {
      max-width: calc(100% - 40px);
      background-color: var(--system-backgroundColor);
      color: var(--system-color);
      z-index: 2;
      position: absolute;
      right: 0;
      top: 0;
      height: 100%;
      padding: 10px;
      box-sizing: border-box;
    }
  }
}

.input-container {
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  gap: 10px;

  input {
    border-radius: 10px;
    padding: 5px;
  }

  button {
    height: auto;
    padding: 5px 10px;
  }
}
.main-content {
  display: flex;
  flex-direction: column;
  height: 100%;
  .pids-container {
    display: flex;
    flex-wrap: wrap;
    position: relative;
    z-index: 1;
    background-color: var(--system-sections-backgroundColor);
    color: var(--system-sections-color);
    .pids {
      max-height: 400px;
      overflow: auto;
      .pid {
        text-overflow: ellipsis;
        white-space: nowrap;
        overflow: hidden;
        &:hover {
          background-color: rgba(0,0,0,0.05);
          cursor: pointer;
        }
        &.active {
          border-left-color: #0076bc;
          border-bottom-color: transparent;
        }
      }
    }
    .pid {
      padding: 5px 10px;
      border: 2px solid transparent;
      cursor: pointer;
      &.active {
        border-bottom-color:#0076bc
      }
    }
  }

}

.radios {
  display: flex;
  flex-direction: column;
  &>div {
    display: flex;
    align-items: center;
    gap: 5px;
    input {
      margin: 0;
    }
  }
}

.main-content  {
  background: none;
  right: 3px;
  top: 0;
  border: 1px solid var(--system-border-borderColor);
  box-sizing: border-box;
  margin: 0;
  z-index: 100;
  .section {
    margin: 0;
  }
}

.terminal {
  display: flex;
  flex-direction: column;
  line-break: anywhere;
  overflow: auto;
  flex-grow: 1;
  .line {
    border-left: 2px solid #ccc;
    border-top-left-radius: 4px;
    border-bottom-left-radius: 4px;
    padding-left: 10px;
    margin: 0px 0;
    will-change: background-color;
    transition: 300ms;
    white-space: pre-wrap;
    width: 100%;
    box-sizing: border-box;
    .section-actions {
      button {
        width: max-content;
        a {
          color: white;
          text-decoration: none;
        }
      }
    }
    .section-header {
      margin: 0;
      width: max-content;
      padding: 0 10px;
      background-color: #000000;
      color: white;
      border-top-left-radius: 10px;
      border-top-right-radius: 10px;
      position: relative;
      z-index: 1;
      display: flex;
      align-items: center;
      transition: 300ms;
      h2 {
        margin: 0;
      }
    }
    .section-content {
      border-left: 4px solid #000000;
      border-bottom-left-radius: 4px;
      padding: 0 10px;
      box-sizing: border-box;
    }
    .section-actions {
      max-width: 0;
      overflow: hidden;
      transition: 300ms;
      display: flex;
      margin-left: 0;
      button {
        white-space: nowrap;
      }
    }
    &:hover {
      background-color: rgba(0,0,0,0.05);
      .section-actions {
        display: flex;
        align-items: center;
        gap: 2px;
        max-width: 1000px;
        margin-left: 20px;
      }
      .section-content {
        position: relative;
      }
    }
    &.json {
      padding: 0;
      margin: 10px 0;
      border: none;
      .section-header {
        background-color: #d1b37a;
      }
      .section-content {
        border-color: #d1b37a
      }
    }

    &.debug {
      padding: 0;
      margin: 10px 0;
      border: none;
      .section-header {
        background-color: #ac32c4;
      }
      .section-content {
        border-color: #ac32c4
      }
    }
    &.cmd {
      padding: 0;
      margin: 10px 0;
      border: none;
      .section-header {
        background-color: #0076bc;
      }
      .section-content {
        border-color: #0076bc
      }
    }
    &.prompt {
      padding: 0;
      margin: 10px 0;
      border: none;
      align-self: flex-end;
      margin-right: 10px;
      .section-header {
        background-color: #5800bc;
        margin-left: auto;
      }
      .section-content {
        border-left: none;
        text-align: right;
        border-right: 4px solid #5800bc;
      }
    }
    &.separator {
      border-left: none;
      margin: 20px auto;
      display: inline-block;
      width: max-content;
      font-weight: bold;
    }
    &.stderr {
      border-left-color: #ac1010;
      .section-header {
        background-color: #ac1010;
      }
      .section-content {
        border-color: #ac1010
      }
    }
    &.success {
      border-left-color: #0c9913;
      .section-header {
        background-color: #0c9913;
      }
      .section-content {
        border-color: #0c9913
      }
    }

  }
}

.input-container-terminal {
  display: flex;
  flex-direction: column;
  align-items: center;
  position: relative;
  box-shadow: 0 0 10px 0 rgba(0,0,0,0.2);
  border-radius: 10px;
  padding: 10px;
  box-sizing: border-box;
  background: var(--system-backgroundColor);
  color: var(--system-color);
  width: calc(100% - 10px);
  margin: auto;
  margin-bottom: 5px;
  margin-top: 20px;
  .bar-terminal {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    .left,.right {
      display: flex;
      flex-wrap: wrap;
      gap: 1px;
      &.right{
        justify-content: flex-end;
      }
      &> div {
        padding: 2px 5px;
        margin-right: 12px;
        box-sizing: border-box;
        position: relative;
        color: white;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 12px;
        white-space: nowrap;
        label {
          display: flex;
          justify-content: center;
          align-items: center;
          gap: 10px;
        }
        &.red {
          background-color: #da0606;
          &::before {background-color: #da0606;}
          &::after {border-color: #da0606;}
        }
        &.white {
          background-color: lightgrey;
          color: black;
          &::before {background-color: lightgrey;}
          &::after {border-color: lightgrey;}
        }
        &.yellow {
          background-color: #bca900;
          &::before {background-color: #bca900;}
          &::after {border-color: #bca900;}
        }
        &.blue {
          background-color: #0076bc;
          &::before {background-color: #0076bc;}
          &::after {border-color: #0076bc;}
        }
        &.green {
          background-color: #00bc55;
          &::before {background-color: #00bc55;}
          &::after {border-color: #00bc55;}
        }
        &::after {
          content: '';
          border: 13px solid transparent;
          border-top-color: transparent !important;
          border-bottom-color: transparent !important;
          border-right-color: transparent !important;
          border-right: none;
          width: 0px;
          height: 100%;
          box-sizing: border-box;
          position: absolute;
          left: 100%;
          z-index: 1;
          top: 0;
        }
        &::before {
          content: '';
          width: 12px;
          height: 100%;
          box-sizing: border-box;
          position: absolute;
          right: 100%;
          background-color: attr(color);
          top: 0;
        }
      }
    }
  }
  .input-content-terminal {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    gap: 10px;
  }
  textarea {
    background-color: var(--system-backgroundColor);
    color: var(--system-color);
    outline: none;
    height: max-content;
    height: calc(19px);
    margin-top: 5px;
    flex-grow: 1;
    border: none;
  }
}

.more-info-container {
  display: flex;
  flex-direction: column;
  border-left: 2px solid #0076bc;
  padding-left: 10px;
  box-sizing: border-box;
  margin-bottom: 20px;
  border-radius: 5px;
  pre {
    margin: 0;
  }
  .more-info-label {
    font-weight: bold;
  }
  .more-info-content {
    background-color: var(--system-backgroundColor);
    color: var(--system-color);
    border: 1px solid var(--system-border-borderColor);
    border-radius: 5px;
    padding: 5px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    button {
      width: max-content;
    }
  }
}

:deep(.p-select-dropdown) {
  color: white;
}
:deep(.p-select), :deep(.p-select-sm .p-select-label) {
  background: transparent;
  border: none;
  color: white;
  padding: 0;
}
</style>

<style lang="scss">
@import '~xterm/css/xterm.css';
.xterm-decoration-top {
  background-color: orange;
  color: white;
}

.json-view-item {
  &.root-item {
    padding: 10px 0;
  }
  button {
    background: none;
    box-shadow: none;
    background-color: transparent !important;
    margin: 0;
    padding: 0;
    width: max-content;
    &:hover {
      background-color: rgba(0,0,0,0.1) !important;
    }
  }
  div.value-key {
    white-space: normal;
    padding: 0;
    display: flex;
    .value-key {
      color: var(--system-color) !important;
      padding: 0;
      &+span {
        overflow: hidden;
        white-space: normal;
        width: max-content;
        display: inline-block;
        overflow: auto;
        width: 100%;
      }
    }
  }
  .data-key {
    &:hover {
      background: transparent;
      box-shadow: none;
    }
    color: var(--system-color);
    .chevron-arrow {
      margin-right: 8px;
    }

  }
}

.histories {
  position: absolute;
  display: flex;
  flex-direction: column;
  background-color: var(--system-backgroundColor);
  color: var(--system-color);
  width: 100%;
  left: 0;
  bottom: calc(100% + 10px);
  z-index: 111;
  box-shadow: 0 0 12px 6px rgba(0,0,0,0.2);
  border-radius: 10px;
  .history {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 2px 10px;
    border-bottom: 1px solid lightgrey;
    &:hover {
      background-color: rgba(0,0,0,0.05);
      cursor: pointer;
    }
    .right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      justify-content: center;
    }
    &.active {
      background-color: rgba(0,0,0,0.1);
    }
  }
}
.badge {
  border-radius: 1000px;
  background-color: grey;
  color: white;
  padding: 0 10px;
  box-shadow: 0 0 10px 0px rgba(0,0,0,0.4);
}

.slide-fade-enter-active{
  transition: all 0.2s ease-out;
  &>* {
    transition: all 0.2s ease-out;
  }
}

.slide-fade-leave-active{
  transition: all 0.2s cubic-bezier(1, 0.5, 0.8, 1);
  &>* {
    transition: all 0.2s cubic-bezier(1, 0.5, 0.8, 1);
  }
}

.slide-fade-enter-from,
.slide-fade-leave-to {
  overflow: hidden;
  .terminal-panel-content {
    transform: translateX(100%);
  }
  .terminal-panel-bg {
    opacity: 0;
  }
}
.pid-box {
  cursor: pointer;
  &:hover {
    button {
      transform: scale(1.1)
    }
  }
}
button.config {
  width: max-content !important;
  i {
    margin: 0 !important;
  }
}
.shortcuts {
  width: 100%;
  margin-bottom: 5px;
  display: flex;
  flex-wrap: wrap;
  gap: 5px
}
.shortcut {
  cursor: pointer;
}
</style>
</file>

<file path="modules/docker/backend/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.1.1](https://github.com/runeya/runeya/compare/v2.1.0...v2.1.1) (2025-02-11)

**Note:** Version bump only for package @runeya/modules-docker-backend

# [2.1.0](https://github.com/runeya/runeya/compare/v2.0.17...v2.1.0) (2025-01-31)

**Note:** Version bump only for package @runeya/modules-docker-backend

## [2.0.17](https://github.com/runeya/runeya/compare/v2.0.16...v2.0.17) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-docker-backend

## [2.0.16](https://github.com/runeya/runeya/compare/v2.0.15...v2.0.16) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-docker-backend

## [2.0.15](https://github.com/runeya/runeya/compare/v2.0.14...v2.0.15) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-docker-backend

## [2.0.14](https://github.com/runeya/runeya/compare/v2.0.13...v2.0.14) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-docker-backend

## [2.0.13](https://github.com/runeya/runeya/compare/v2.0.12...v2.0.13) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-docker-backend

## [2.0.12](https://github.com/runeya/runeya/compare/v2.0.11...v2.0.12) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-docker-backend

## [2.0.8](https://github.com/runeya/runeya/compare/v2.0.7...v2.0.8) (2025-01-13)

**Note:** Version bump only for package @runeya/modules-docker-backend

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* remove some dependencies ([5667402](https://github.com/runeya/runeya/commit/5667402d57add874a89ba029ce62b16b3bbed9e0))
* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

## [2.0.1](https://github.com/runeya/runeya/compare/v2.0.0...v2.0.1) (2024-12-25)

### Bug Fixes

* various fixes ([18129e9](https://github.com/runeya/runeya/commit/18129e96f7c92a69176d6a75add45f3a48ab11ae))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

* feat!: migrate runeya to entire UI ([e173073](https://github.com/runeya/runeya/commit/e173073d932be7e400b1f51261c090116e8fb543))

### BREAKING CHANGES

* all stack files are useless now

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

**Note:** Version bump only for package @runeya/modules-docker-backend

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

### Bug Fixes

* resolve issues for permission on docker volumes + cosmetic changes ([7a822cd](https://github.com/runeya/runeya/commit/7a822cd1c205e5808247075828c1d3ce49d1524b))
</file>

<file path="modules/vscode/extension/package.json">
{
  "name": "@runeya/modules-vscode-extension",
  "displayName": "runeya",
  "private": true,
  "description": "Connect to your runeya instance",
  "repository": "https://github.com/runeya/runeya",
  "publisher": "runeya",
  "license": "ISC",
  "version": "2.0.5",
  "icon": "./resources/rocket.png",
  "engines": {
    "vscode": "^1.86.0"
  },
  "categories": [
    "Other"
  ],
  "activationEvents": [
    "onStartupFinished"
  ],
  "enabledApiProposals": [
    "extensionRuntime"
  ],
  "main": "./src/extension.js",
  "contributes": {
    "commands": [
      {
        "command": "runeya.connect",
        "title": "Runeya: Connect to runeya"
      },
      {
        "command": "runeya.log",
        "title": "Runeya: Create log"
      }
    ],
    "keybindings": [
      {
        "command": "runeya.log",
        "key": "ctrl+k l",
        "mac": "cmd+k l",
        "when": "editorTextFocus"
      }
    ],
    "viewsContainers": {
      "activitybar": [
        {
          "id": "runeya",
          "title": "Runeya",
          "icon": "resources/rocket.png"
        }
      ]
    },
    "viewsWelcome": [
      {
        "view": "welcome",
        "contents": "[Connect to runeya](command:runeya.connect)",
        "when": "!runeyaAvailable"
      }
    ],
    "views": {
      "explorer": [
        {
          "id": "services-explorer",
          "name": "Runeya services",
          "visibility": "visible",
          "type": "tree",
          "when": "runeyaAvailable"
        }
      ],
      "runeya": [
        {
          "id": "welcome",
          "name": "Welcome",
          "when": "!runeyaAvailable"
        },
        {
          "id": "services",
          "name": "Services",
          "visibility": "visible",
          "type": "tree",
          "when": "runeyaAvailable"
        },
        {
          "id": "dependencies",
          "name": "Dependencies",
          "type": "tree",
          "when": "runeyaAvailable"
        }
      ]
    }
  },
  "scripts": {
    "build": "node build.js",
    "test": ""
  },
  "dependencies": {
    "axios": "^1.7.9",
    "bluebird": "^3.7.2",
    "command-exists": "^1.2.9",
    "ws": "^8.18.0"
  },
  "devDependencies": {
    "@types/command-exists": "^1.2.3",
    "@types/mocha": "^10.0.6",
    "@types/node": "18.x",
    "@types/vscode": "^1.86.0",
    "@types/ws": "^8",
    "@vscode/test-cli": "^0.0.6",
    "@vscode/test-electron": "^2.3.9",
    "@vscode/vsce": "^3.2.1",
    "esbuild": "^0.20.1",
    "typescript": "^5.3.3"
  }
}
</file>

<file path="servers/server/models/stack.js">
/* eslint-disable func-names */
// eslint-disable-next-line import/no-extraneous-dependencies
const { sockets } = require('@runeya/common-socket-server');
// eslint-disable-next-line import/no-extraneous-dependencies
const plugins = require('@runeya/modules-plugins-loader-backend');
const PromiseB = require('bluebird');
const Service = require('./Service');
const ports = require('./ports');
const dbs = require('../helpers/dbs');
const EnvironmentModel = require('./Environment');
const EncryptionKey = require('./EncryptionKey');
const CustomObservable = require('@runeya/common-socket-server/src/CustomObservable');
const args = require('../helpers/args');
const { existsSync, mkdirSync } = require('fs');
const pathfs = require('path');
const { default: axios } = require('axios');


/** @param {Partial<Stack>} stack */
function Stack(stack) {
  this.onServerLauch = new CustomObservable()
  return (async () => {
    /** @type {string[]} */
    this.watchFiles = stack.watchFiles || [];
    /** @type {import('./Service').Parser[]} */
    this.logParsers = stack.logParsers || [];
    /** @type {boolean} */
    this.monorepo = stack.monorepo || false;
    /** @type {Record<string, string>} */
    this.themes = stack.themes || {};
    /** @type {import('./Environment')[]} */
    this.environments = stack.environments ? stack.environments.map((env) => new EnvironmentModel(env)) : [];
    /** @type {string | undefined} */
    this.documentation = stack.documentation;
    /** @type {Service[]} */
    this.services = await PromiseB.map(stack.services || [], (service) => (
      new Service(service, /** @type {StackWithPlugins} */(Stack))
    ));

    this.helpers = require('../helpers/exportedHelpers');
    return this;
  })();
}

/** @type {Stack | null} */
Stack.currentStack = null;
/** @type {import('fs').FSWatcher[]} */
Stack.currentWatches = [];
/** @type {import('./Environment') | null} */
Stack.currentEnvironment = null;
Stack.Socket = sockets;
Stack.plugins = plugins;
/** @type {string} */
Stack.version = require('../helpers/version').version || '';
/** @type {string} */
Stack.url = `http://localhost:${ports.http}`;
/** @type {number} */
Stack.port = +ports.http;
Stack.parsers = {
  links: require('../parser/link'),
  jsons: require('../parser/json'),
  debug: require('../parser/debug'),
};
Stack.helpers = require('../helpers/exportedHelpers');
Stack.getSave = require('./saves');

/** @param {{label: string, enabled: boolean}[]} servicesLabelSelected */
Stack.prototype.enable = async function (servicesLabelSelected) {
  const services = this.getServices();
  await PromiseB.map(servicesLabelSelected, (serviceConf) => {
    const service = services.find((service) => serviceConf.label === service.label);
    if (!service) return null;
    const hasChanged = serviceConf.enabled !== service.enabled;
    if (hasChanged) {
      if (serviceConf.enabled) {
        service.enable();
        return service.launch();
      }
      service.disable();
      return service.kill();
    }
    return null;
  });
};

Stack.restart = async function () {
  await PromiseB.map(this.getEnabledServices(), (service) => service.restart());
};

Stack.kill = async function () {
  await PromiseB.map(this.getEnabledServices(), (service) => service.kill());
};

Stack.getCurrentEnvironment = function () {
  return Stack.currentEnvironment;
};

Stack.prototype.toStorage = function () {
  return {
    watchFiles: this.watchFiles,
    themes: this.themes,
    services: this.services.map((s) => s.toStorage()),
  };
};

Stack.getRootPath = () => {
  const rootPath = pathfs.resolve(args.rootPath, '.runeya');
  if (!existsSync(rootPath)) mkdirSync(rootPath, { recursive: true });
  return rootPath;
}

Stack.parse = async function () {
  const dbsRootPath = await dbs.getDbs('services');
  let services = [];
  let environments = [];
  try {
    services = await PromiseB.map(dbsRootPath, (id) => Service.load(id, Stack));
    environments = await EnvironmentModel.all();
  } catch (error) {
    console.error(error);
    this.Socket.emit('system:wrongKey');
  }

  return new Stack({
    environments,
    services,
  });
};

Stack.prototype.launch = async function () {
  await PromiseB.map(this.getServices(), (microservice) => {
    if (microservice.enabled) {
      return microservice.launch();
    }
    return microservice.kill();
  });
};

Stack.getStack = function () {
  return Stack.currentStack;
};

Stack.getServices = function () {
  return Stack.currentStack?.services || [];
};

Stack.deleteService = async function (label) {
  if (!Stack.currentStack) return;
  const service = this.findService(label);
  Stack.currentStack.services = Stack.currentStack.services.filter((a) => a.label !== label);
  await service.delete();
};

Stack.prototype.getServices = function () {
  return Stack.getServices();
};
Stack.getAxios = function () {
  return axios.create({baseURL: this.url});
};

Stack.getEnabledServices = function () {
  return Stack.getServices().filter((s) => s.enabled);
};

Stack.prototype.getEnabledServices = function () {
  return Stack.getEnabledServices();
};

Stack.prototype.exportInApi = function () {
  const res = { ...this };
  res.services = res.services?.map((s) => s.exportInApi());
  return res;
};

/**
   *
   * @param {string} serviceLabel
   * @returns
   */
Stack.findService = function (serviceLabel) {
  return Stack.getServices().filter((s) => s.label === serviceLabel)[0];
};

/**
   *
   * @param {string} serviceLabel
   * @returns
   */
Stack.prototype.findService = function (serviceLabel) {
  return Stack.findService(serviceLabel);
};

Stack.selectConf = async function () {
  await EncryptionKey.init();
  if (!EncryptionKey.encryptionKey) {
    await EncryptionKey.saveKey(await EncryptionKey.generateKey());
  }
  Stack.currentStack = await this.parse();
  Stack.currentEnvironment = (args.e || process.env.RUNEYA_DEFAULT_ENVIRONMENT)
    ? Stack.currentStack.environments.find((env) => (
      env.label === args.e?.toString() ||
      env.label === process.env.RUNEYA_DEFAULT_ENVIRONMENT
    )) || null
    : Stack.currentStack.environments.find((env) => env.default) || null;
  if (process.env.RUNEYA_SERVICES) {
    process.env.RUNEYA_SERVICES.split(',').forEach((serviceLabel) => {
      const service = Stack.findService(serviceLabel)
      if(service) service.enable()
    })
  }
  return sockets.emit('stack:selectConf');
};

/**
   *
   * @param {string} envLabel
   */
Stack.prototype.changeEnvironment = async function (envLabel) {
  const environment = await EnvironmentModel.find(envLabel);
  if (environment) {
    Stack.currentEnvironment = environment;
    Stack.getServices().forEach((service) => {
      if (!service.envs[envLabel]) {
        service.envs[envLabel] = {};
      }
    });
    const enabledServices = Stack.getEnabledServices();
    await Stack.kill();
    enabledServices.forEach((s) => {
      s.enabled = true;
      s.store = [];
    });
    await Stack.getStack()?.launch();
  } else {
    throw new Error('Environment not found');
  }
};

Stack.stopWatchers = function () {
  Stack.currentWatches.forEach((currentWatch) => currentWatch.close());
};

const pluginsToLoad = /** @type {(keyof typeof plugins)[]} */(Object.keys(plugins)).reduce((p, key) => {
  const plugin = plugins[key];
  if (plugin.export) {
    p[key] = typeof plugin.export === 'function' && !(/^\s*class\s+/.test(plugin.export.toString()))
      ? plugin.export(/** @type {StackWithPlugins} */(Stack))
      // @ts-ignore
      : plugin.export;
  }
  return p;
}, /** @type {OmitNever<typeof plugins>} */({}));

module.exports = /** @type {StackWithPlugins} */(Object.assign(Stack, pluginsToLoad));

/**
 * @typedef {typeof Stack & OmitNever<typeof plugins>} StackWithPlugins
 */

/**
 * @typedef {Omit<import('@runeya/common-typings').NonFunctionProperties<Service>, 'pids' | 'store' | 'enabled'>[]} StackArray
 */

/**
 * @typedef {{
 * watchFiles?: string[],
 * logParsers?: import('./Service').Parser[],
 * stack?: StackArray,
 * monorepo?: boolean,
 * services?: StackArray,
 * }} StackObject
 */

/**
 * @typedef {(runeya: StackWithPlugins) => StackObject | Promise<StackObject>} StackFunction
 */

/**
 * @typedef {StackArray | StackObject | StackFunction} StackFile
 */

/**
 * @typedef {{
 *  id?: string,
 *  label: string,
 *  envs: Record<string, any>,
 *  color?: string,
 *  bgColor?: string
 *  default?: boolean
 * }} Environment
 */

/**
 * @template {{ [key: string]: {export: any }}} T
 * @typedef {{
 *  [K in keyof T]: T[K]['export'] extends Function ? ReturnType<T[K]['export']> : never;
 * }} KeysMatching
 */
/**
 * @template {{ [key: string]: {export: any }}} T
 * @typedef {{ [K in keyof T as (
 *  T[K]['export'] extends undefined|null ? never : K)
 * ]: T[K]['export'] extends Function ? ReturnType<T[K]['export']> : T[K]['export'] }} OmitNever
 */
</file>

<file path="modules/docker/backend/package.json">
{
  "name": "@runeya/modules-docker-backend",
  "version": "2.1.1",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "@runeya/modules-plugins-loader-front": "workspace:*",
    "@types/express": "^4.17.21"
  },
  "dependencies": {
    "express": "^4.18.2"
  }
}
</file>

<file path="modules/vscode/backend/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.1.1](https://github.com/runeya/runeya/compare/v2.1.0...v2.1.1) (2025-02-11)

**Note:** Version bump only for package @runeya/modules-vscode-backend

# [2.1.0](https://github.com/runeya/runeya/compare/v2.0.17...v2.1.0) (2025-01-31)

**Note:** Version bump only for package @runeya/modules-vscode-backend

## [2.0.17](https://github.com/runeya/runeya/compare/v2.0.16...v2.0.17) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-vscode-backend

## [2.0.16](https://github.com/runeya/runeya/compare/v2.0.15...v2.0.16) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-vscode-backend

## [2.0.15](https://github.com/runeya/runeya/compare/v2.0.14...v2.0.15) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-vscode-backend

## [2.0.14](https://github.com/runeya/runeya/compare/v2.0.13...v2.0.14) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-vscode-backend

## [2.0.13](https://github.com/runeya/runeya/compare/v2.0.12...v2.0.13) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-vscode-backend

## [2.0.12](https://github.com/runeya/runeya/compare/v2.0.11...v2.0.12) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-vscode-backend

## [2.0.8](https://github.com/runeya/runeya/compare/v2.0.7...v2.0.8) (2025-01-13)

**Note:** Version bump only for package @runeya/modules-vscode-backend

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* remove some dependencies ([5667402](https://github.com/runeya/runeya/commit/5667402d57add874a89ba029ce62b16b3bbed9e0))
* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

## [2.0.1](https://github.com/runeya/runeya/compare/v2.0.0...v2.0.1) (2024-12-25)

### Bug Fixes

* various fixes ([18129e9](https://github.com/runeya/runeya/commit/18129e96f7c92a69176d6a75add45f3a48ab11ae))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-vscode-backend

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

**Note:** Version bump only for package @runeya/modules-vscode-backend

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

**Note:** Version bump only for package @runeya/modules-vscode-backend

## [1.18.6](https://github.com/runeya/runeya/compare/v1.18.5...v1.18.6) (2024-02-25)

### Bug Fixes

* **extension:** fix code lens ([d17b922](https://github.com/runeya/runeya/commit/d17b9228c15b9cb0acd21e3839fd0b85e07c5a69))

## [1.18.2](https://github.com/runeya/runeya/compare/v1.18.1...v1.18.2) (2024-02-24)

### Bug Fixes

* **extension:** create vscodeextension ([dfb2589](https://github.com/runeya/runeya/commit/dfb258912ca717cca9b2dc857c2774bfddd59251))
* **front:** cosmetic changes ([ff9b282](https://github.com/runeya/runeya/commit/ff9b2821de658eae571a1da4407ec0651a102e15))
</file>

<file path="modules/bugs/backend/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.1.1](https://github.com/runeya/runeya/compare/v2.1.0...v2.1.1) (2025-02-11)

**Note:** Version bump only for package @runeya/modules-bugs-backend

# [2.1.0](https://github.com/runeya/runeya/compare/v2.0.17...v2.1.0) (2025-01-31)

**Note:** Version bump only for package @runeya/modules-bugs-backend

## [2.0.17](https://github.com/runeya/runeya/compare/v2.0.16...v2.0.17) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-bugs-backend

## [2.0.16](https://github.com/runeya/runeya/compare/v2.0.15...v2.0.16) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-bugs-backend

## [2.0.15](https://github.com/runeya/runeya/compare/v2.0.14...v2.0.15) (2025-01-24)

### Bug Fixes

* **Bugs:** support for new command selector ([afd2815](https://github.com/runeya/runeya/commit/afd2815b8c7cf3dd01e5f9408174000e8913996b))

## [2.0.14](https://github.com/runeya/runeya/compare/v2.0.13...v2.0.14) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-bugs-backend

## [2.0.13](https://github.com/runeya/runeya/compare/v2.0.12...v2.0.13) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-bugs-backend

## [2.0.12](https://github.com/runeya/runeya/compare/v2.0.11...v2.0.12) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-bugs-backend

## [2.0.8](https://github.com/runeya/runeya/compare/v2.0.7...v2.0.8) (2025-01-13)

**Note:** Version bump only for package @runeya/modules-bugs-backend

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* remove some dependencies ([5667402](https://github.com/runeya/runeya/commit/5667402d57add874a89ba029ce62b16b3bbed9e0))
* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

## [2.0.1](https://github.com/runeya/runeya/compare/v2.0.0...v2.0.1) (2024-12-25)

### Bug Fixes

* various fixes ([18129e9](https://github.com/runeya/runeya/commit/18129e96f7c92a69176d6a75add45f3a48ab11ae))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-bugs-backend

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

**Note:** Version bump only for package @runeya/modules-bugs-backend

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

**Note:** Version bump only for package @runeya/modules-bugs-backend

## [1.18.6](https://github.com/runeya/runeya/compare/v1.18.5...v1.18.6) (2024-02-25)

**Note:** Version bump only for package @runeya/modules-bugs-backend

## [1.18.2](https://github.com/runeya/runeya/compare/v1.18.1...v1.18.2) (2024-02-24)

**Note:** Version bump only for package @runeya/modules-bugs-backend

## [1.18.1](https://github.com/runeya/runeya/compare/v1.18.0...v1.18.1) (2024-02-20)

**Note:** Version bump only for package @runeya/modules-bugs-backend

# [1.18.0](https://github.com/runeya/runeya/compare/v1.17.30...v1.18.0) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-bugs-backend

## [1.17.30](https://github.com/runeya/runeya/compare/v1.17.29...v1.17.30) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-bugs-backend

## [1.17.29](https://github.com/runeya/runeya/compare/v1.17.28...v1.17.29) (2024-02-15)

**Note:** Version bump only for package @runeya/modules-bugs-backend

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

**Note:** Version bump only for package @runeya/modules-bugs-backend

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

**Note:** Version bump only for package @runeya/modules-bugs-backend

## [1.17.24](https://github.com/runeya/runeya/compare/v1.17.23...v1.17.24) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-bugs-backend

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-bugs-backend

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-bugs-backend

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* build for npm ([0c07b41](https://github.com/runeya/runeya/commit/0c07b410a237412c1c73bbb42fe45c1f9c220482))
* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/configuration/backend/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.1.1](https://github.com/runeya/runeya/compare/v2.1.0...v2.1.1) (2025-02-11)

**Note:** Version bump only for package @runeya/modules-configuration-backend

# [2.1.0](https://github.com/runeya/runeya/compare/v2.0.17...v2.1.0) (2025-01-31)

**Note:** Version bump only for package @runeya/modules-configuration-backend

## [2.0.17](https://github.com/runeya/runeya/compare/v2.0.16...v2.0.17) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-configuration-backend

## [2.0.16](https://github.com/runeya/runeya/compare/v2.0.15...v2.0.16) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-configuration-backend

## [2.0.15](https://github.com/runeya/runeya/compare/v2.0.14...v2.0.15) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-configuration-backend

## [2.0.14](https://github.com/runeya/runeya/compare/v2.0.13...v2.0.14) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-configuration-backend

## [2.0.13](https://github.com/runeya/runeya/compare/v2.0.12...v2.0.13) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-configuration-backend

## [2.0.12](https://github.com/runeya/runeya/compare/v2.0.11...v2.0.12) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-configuration-backend

## [2.0.8](https://github.com/runeya/runeya/compare/v2.0.7...v2.0.8) (2025-01-13)

**Note:** Version bump only for package @runeya/modules-configuration-backend

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

## [2.0.1](https://github.com/runeya/runeya/compare/v2.0.0...v2.0.1) (2024-12-25)

**Note:** Version bump only for package @runeya/modules-configuration-backend

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

* feat!: migrate runeya to entire UI ([e173073](https://github.com/runeya/runeya/commit/e173073d932be7e400b1f51261c090116e8fb543))

### BREAKING CHANGES

* all stack files are useless now

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

**Note:** Version bump only for package @runeya/modules-configuration-backend

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

**Note:** Version bump only for package @runeya/modules-configuration-backend

## [1.18.6](https://github.com/runeya/runeya/compare/v1.18.5...v1.18.6) (2024-02-25)

**Note:** Version bump only for package @runeya/modules-configuration-backend

## [1.18.2](https://github.com/runeya/runeya/compare/v1.18.1...v1.18.2) (2024-02-24)

**Note:** Version bump only for package @runeya/modules-configuration-backend

## [1.18.1](https://github.com/runeya/runeya/compare/v1.18.0...v1.18.1) (2024-02-20)

**Note:** Version bump only for package @runeya/modules-configuration-backend

# [1.18.0](https://github.com/runeya/runeya/compare/v1.17.30...v1.18.0) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-configuration-backend

## [1.17.30](https://github.com/runeya/runeya/compare/v1.17.29...v1.17.30) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-configuration-backend

## [1.17.29](https://github.com/runeya/runeya/compare/v1.17.28...v1.17.29) (2024-02-15)

**Note:** Version bump only for package @runeya/modules-configuration-backend

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

**Note:** Version bump only for package @runeya/modules-configuration-backend

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

**Note:** Version bump only for package @runeya/modules-configuration-backend

## [1.17.24](https://github.com/runeya/runeya/compare/v1.17.23...v1.17.24) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-configuration-backend

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-configuration-backend

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-configuration-backend

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/configuration/backend/package.json">
{
  "name": "@runeya/modules-configuration-backend",
  "version": "2.1.1",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "@runeya/modules-plugins-loader-front": "workspace:*"
  }
}
</file>

<file path="modules/dev-ops/backend/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.1.1](https://github.com/runeya/runeya/compare/v2.1.0...v2.1.1) (2025-02-11)

**Note:** Version bump only for package @runeya/modules-dev-ops-backend

# [2.1.0](https://github.com/runeya/runeya/compare/v2.0.17...v2.1.0) (2025-01-31)

**Note:** Version bump only for package @runeya/modules-dev-ops-backend

## [2.0.17](https://github.com/runeya/runeya/compare/v2.0.16...v2.0.17) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-dev-ops-backend

## [2.0.16](https://github.com/runeya/runeya/compare/v2.0.15...v2.0.16) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-dev-ops-backend

## [2.0.15](https://github.com/runeya/runeya/compare/v2.0.14...v2.0.15) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-dev-ops-backend

## [2.0.14](https://github.com/runeya/runeya/compare/v2.0.13...v2.0.14) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-dev-ops-backend

## [2.0.13](https://github.com/runeya/runeya/compare/v2.0.12...v2.0.13) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-dev-ops-backend

## [2.0.12](https://github.com/runeya/runeya/compare/v2.0.11...v2.0.12) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-dev-ops-backend

## [2.0.8](https://github.com/runeya/runeya/compare/v2.0.7...v2.0.8) (2025-01-13)

**Note:** Version bump only for package @runeya/modules-dev-ops-backend

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

## [2.0.1](https://github.com/runeya/runeya/compare/v2.0.0...v2.0.1) (2024-12-25)

**Note:** Version bump only for package @runeya/modules-dev-ops-backend

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-dev-ops-backend

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

**Note:** Version bump only for package @runeya/modules-dev-ops-backend

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

**Note:** Version bump only for package @runeya/modules-dev-ops-backend

## [1.18.6](https://github.com/runeya/runeya/compare/v1.18.5...v1.18.6) (2024-02-25)

**Note:** Version bump only for package @runeya/modules-dev-ops-backend

## [1.18.2](https://github.com/runeya/runeya/compare/v1.18.1...v1.18.2) (2024-02-24)

**Note:** Version bump only for package @runeya/modules-dev-ops-backend

## [1.18.1](https://github.com/runeya/runeya/compare/v1.18.0...v1.18.1) (2024-02-20)

**Note:** Version bump only for package @runeya/modules-dev-ops-backend

# [1.18.0](https://github.com/runeya/runeya/compare/v1.17.30...v1.18.0) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-dev-ops-backend

## [1.17.30](https://github.com/runeya/runeya/compare/v1.17.29...v1.17.30) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-dev-ops-backend

## [1.17.29](https://github.com/runeya/runeya/compare/v1.17.28...v1.17.29) (2024-02-15)

**Note:** Version bump only for package @runeya/modules-dev-ops-backend

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

**Note:** Version bump only for package @runeya/modules-dev-ops-backend

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

**Note:** Version bump only for package @runeya/modules-dev-ops-backend

## [1.17.24](https://github.com/runeya/runeya/compare/v1.17.23...v1.17.24) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-dev-ops-backend

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-dev-ops-backend

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-dev-ops-backend

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/dev-ops/backend/package.json">
{
  "name": "@runeya/modules-dev-ops-backend",
  "version": "2.1.1",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "@runeya/modules-plugins-loader-front": "workspace:*"
  }
}
</file>

<file path="modules/diff/backend/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.1.1](https://github.com/runeya/runeya/compare/v2.1.0...v2.1.1) (2025-02-11)

**Note:** Version bump only for package @runeya/modules-diff-backend

# [2.1.0](https://github.com/runeya/runeya/compare/v2.0.17...v2.1.0) (2025-01-31)

**Note:** Version bump only for package @runeya/modules-diff-backend

## [2.0.17](https://github.com/runeya/runeya/compare/v2.0.16...v2.0.17) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-diff-backend

## [2.0.16](https://github.com/runeya/runeya/compare/v2.0.15...v2.0.16) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-diff-backend

## [2.0.15](https://github.com/runeya/runeya/compare/v2.0.14...v2.0.15) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-diff-backend

## [2.0.14](https://github.com/runeya/runeya/compare/v2.0.13...v2.0.14) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-diff-backend

## [2.0.13](https://github.com/runeya/runeya/compare/v2.0.12...v2.0.13) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-diff-backend

## [2.0.12](https://github.com/runeya/runeya/compare/v2.0.11...v2.0.12) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-diff-backend

## [2.0.8](https://github.com/runeya/runeya/compare/v2.0.7...v2.0.8) (2025-01-13)

**Note:** Version bump only for package @runeya/modules-diff-backend

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

## [2.0.1](https://github.com/runeya/runeya/compare/v2.0.0...v2.0.1) (2024-12-25)

**Note:** Version bump only for package @runeya/modules-diff-backend

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-diff-backend

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

**Note:** Version bump only for package @runeya/modules-diff-backend

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

**Note:** Version bump only for package @runeya/modules-diff-backend

## [1.18.6](https://github.com/runeya/runeya/compare/v1.18.5...v1.18.6) (2024-02-25)

**Note:** Version bump only for package @runeya/modules-diff-backend

## [1.18.2](https://github.com/runeya/runeya/compare/v1.18.1...v1.18.2) (2024-02-24)

**Note:** Version bump only for package @runeya/modules-diff-backend

## [1.18.1](https://github.com/runeya/runeya/compare/v1.18.0...v1.18.1) (2024-02-20)

**Note:** Version bump only for package @runeya/modules-diff-backend

# [1.18.0](https://github.com/runeya/runeya/compare/v1.17.30...v1.18.0) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-diff-backend

## [1.17.30](https://github.com/runeya/runeya/compare/v1.17.29...v1.17.30) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-diff-backend

## [1.17.29](https://github.com/runeya/runeya/compare/v1.17.28...v1.17.29) (2024-02-15)

**Note:** Version bump only for package @runeya/modules-diff-backend

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

**Note:** Version bump only for package @runeya/modules-diff-backend

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

**Note:** Version bump only for package @runeya/modules-diff-backend

## [1.17.24](https://github.com/runeya/runeya/compare/v1.17.23...v1.17.24) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-diff-backend

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-diff-backend

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-diff-backend

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/diff/backend/package.json">
{
  "name": "@runeya/modules-diff-backend",
  "version": "2.1.1",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "@runeya/modules-plugins-loader-front": "workspace:*",
    "@types/express": "^4.17.21",
    "@types/uuid": "^9.0.8"
  },
  "dependencies": {
    "express": "^4.18.2",
    "uuid": "^9.0.1"
  }
}
</file>

<file path="modules/documentation/backend/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.1.1](https://github.com/runeya/runeya/compare/v2.1.0...v2.1.1) (2025-02-11)

**Note:** Version bump only for package @runeya/modules-documentation-backend

# [2.1.0](https://github.com/runeya/runeya/compare/v2.0.17...v2.1.0) (2025-01-31)

**Note:** Version bump only for package @runeya/modules-documentation-backend

## [2.0.17](https://github.com/runeya/runeya/compare/v2.0.16...v2.0.17) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-documentation-backend

## [2.0.16](https://github.com/runeya/runeya/compare/v2.0.15...v2.0.16) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-documentation-backend

## [2.0.15](https://github.com/runeya/runeya/compare/v2.0.14...v2.0.15) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-documentation-backend

## [2.0.14](https://github.com/runeya/runeya/compare/v2.0.13...v2.0.14) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-documentation-backend

## [2.0.13](https://github.com/runeya/runeya/compare/v2.0.12...v2.0.13) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-documentation-backend

## [2.0.12](https://github.com/runeya/runeya/compare/v2.0.11...v2.0.12) (2025-01-24)

### Bug Fixes

* reenable documentation and improve global git view ([2e4dd75](https://github.com/runeya/runeya/commit/2e4dd75c0513d92f12b8303b3dddd2f2fa6ccc73))

## [2.0.8](https://github.com/runeya/runeya/compare/v2.0.7...v2.0.8) (2025-01-13)

**Note:** Version bump only for package @runeya/modules-documentation-backend

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* remove some dependencies ([5667402](https://github.com/runeya/runeya/commit/5667402d57add874a89ba029ce62b16b3bbed9e0))
* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

## [2.0.1](https://github.com/runeya/runeya/compare/v2.0.0...v2.0.1) (2024-12-25)

**Note:** Version bump only for package @runeya/modules-documentation-backend

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-documentation-backend

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

**Note:** Version bump only for package @runeya/modules-documentation-backend

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

**Note:** Version bump only for package @runeya/modules-documentation-backend

## [1.18.6](https://github.com/runeya/runeya/compare/v1.18.5...v1.18.6) (2024-02-25)

**Note:** Version bump only for package @runeya/modules-documentation-backend

## [1.18.2](https://github.com/runeya/runeya/compare/v1.18.1...v1.18.2) (2024-02-24)

**Note:** Version bump only for package @runeya/modules-documentation-backend

## [1.18.1](https://github.com/runeya/runeya/compare/v1.18.0...v1.18.1) (2024-02-20)

**Note:** Version bump only for package @runeya/modules-documentation-backend

# [1.18.0](https://github.com/runeya/runeya/compare/v1.17.30...v1.18.0) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-documentation-backend

## [1.17.30](https://github.com/runeya/runeya/compare/v1.17.29...v1.17.30) (2024-02-19)

### Bug Fixes

* **documentation:** add a global documentation ([0ef6b0f](https://github.com/runeya/runeya/commit/0ef6b0f15760d06380e9d7df3fc9c3a0393305d5))

## [1.17.29](https://github.com/runeya/runeya/compare/v1.17.28...v1.17.29) (2024-02-15)

**Note:** Version bump only for package @runeya/modules-documentation-backend

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

**Note:** Version bump only for package @runeya/modules-documentation-backend

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

**Note:** Version bump only for package @runeya/modules-documentation-backend

## [1.17.24](https://github.com/runeya/runeya/compare/v1.17.23...v1.17.24) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-documentation-backend

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-documentation-backend

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-documentation-backend

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* build for npm ([0c07b41](https://github.com/runeya/runeya/commit/0c07b410a237412c1c73bbb42fe45c1f9c220482))
* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.14](https://github.com/runeya/runeya/compare/v1.17.13...v1.17.14) (2024-02-05)

### Bug Fixes

* **front:** can edit markdown and migrate away from vue markdown ([ef11ae3](https://github.com/runeya/runeya/commit/ef11ae39ee563ee6af4b2bc6f916f4c4705287dd))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/finder/backend/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.1.1](https://github.com/runeya/runeya/compare/v2.1.0...v2.1.1) (2025-02-11)

**Note:** Version bump only for package @runeya/modules-finder-backend

# [2.1.0](https://github.com/runeya/runeya/compare/v2.0.17...v2.1.0) (2025-01-31)

**Note:** Version bump only for package @runeya/modules-finder-backend

## [2.0.17](https://github.com/runeya/runeya/compare/v2.0.16...v2.0.17) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-finder-backend

## [2.0.16](https://github.com/runeya/runeya/compare/v2.0.15...v2.0.16) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-finder-backend

## [2.0.15](https://github.com/runeya/runeya/compare/v2.0.14...v2.0.15) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-finder-backend

## [2.0.14](https://github.com/runeya/runeya/compare/v2.0.13...v2.0.14) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-finder-backend

## [2.0.13](https://github.com/runeya/runeya/compare/v2.0.12...v2.0.13) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-finder-backend

## [2.0.12](https://github.com/runeya/runeya/compare/v2.0.11...v2.0.12) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-finder-backend

## [2.0.8](https://github.com/runeya/runeya/compare/v2.0.7...v2.0.8) (2025-01-13)

**Note:** Version bump only for package @runeya/modules-finder-backend

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* remove some dependencies ([5667402](https://github.com/runeya/runeya/commit/5667402d57add874a89ba029ce62b16b3bbed9e0))
* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

## [2.0.1](https://github.com/runeya/runeya/compare/v2.0.0...v2.0.1) (2024-12-25)

**Note:** Version bump only for package @runeya/modules-finder-backend

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-finder-backend

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

**Note:** Version bump only for package @runeya/modules-finder-backend

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

**Note:** Version bump only for package @runeya/modules-finder-backend

## [1.18.6](https://github.com/runeya/runeya/compare/v1.18.5...v1.18.6) (2024-02-25)

**Note:** Version bump only for package @runeya/modules-finder-backend

## [1.18.2](https://github.com/runeya/runeya/compare/v1.18.1...v1.18.2) (2024-02-24)

**Note:** Version bump only for package @runeya/modules-finder-backend

## [1.18.1](https://github.com/runeya/runeya/compare/v1.18.0...v1.18.1) (2024-02-20)

**Note:** Version bump only for package @runeya/modules-finder-backend

# [1.18.0](https://github.com/runeya/runeya/compare/v1.17.30...v1.18.0) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-finder-backend

## [1.17.30](https://github.com/runeya/runeya/compare/v1.17.29...v1.17.30) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-finder-backend

## [1.17.29](https://github.com/runeya/runeya/compare/v1.17.28...v1.17.29) (2024-02-15)

### Bug Fixes

* **theme:** add black theme ([bee4697](https://github.com/runeya/runeya/commit/bee469731be182ac929298dc13fe1c230eccb7ba))

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

**Note:** Version bump only for package @runeya/modules-finder-backend

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

**Note:** Version bump only for package @runeya/modules-finder-backend

## [1.17.24](https://github.com/runeya/runeya/compare/v1.17.23...v1.17.24) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-finder-backend

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-finder-backend

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-finder-backend

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* build for npm ([0c07b41](https://github.com/runeya/runeya/commit/0c07b410a237412c1c73bbb42fe45c1f9c220482))
* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/git/backend/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.1.1](https://github.com/runeya/runeya/compare/v2.1.0...v2.1.1) (2025-02-11)

**Note:** Version bump only for package @runeya/modules-git-backend

# [2.1.0](https://github.com/runeya/runeya/compare/v2.0.17...v2.1.0) (2025-01-31)

**Note:** Version bump only for package @runeya/modules-git-backend

## [2.0.17](https://github.com/runeya/runeya/compare/v2.0.16...v2.0.17) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-git-backend

## [2.0.16](https://github.com/runeya/runeya/compare/v2.0.15...v2.0.16) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-git-backend

## [2.0.15](https://github.com/runeya/runeya/compare/v2.0.14...v2.0.15) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-git-backend

## [2.0.14](https://github.com/runeya/runeya/compare/v2.0.13...v2.0.14) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-git-backend

## [2.0.13](https://github.com/runeya/runeya/compare/v2.0.12...v2.0.13) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-git-backend

## [2.0.12](https://github.com/runeya/runeya/compare/v2.0.11...v2.0.12) (2025-01-24)

### Bug Fixes

* reenable documentation and improve global git view ([2e4dd75](https://github.com/runeya/runeya/commit/2e4dd75c0513d92f12b8303b3dddd2f2fa6ccc73))

## [2.0.8](https://github.com/runeya/runeya/compare/v2.0.7...v2.0.8) (2025-01-13)

**Note:** Version bump only for package @runeya/modules-git-backend

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

## [2.0.1](https://github.com/runeya/runeya/compare/v2.0.0...v2.0.1) (2024-12-25)

### Bug Fixes

* various fixes ([18129e9](https://github.com/runeya/runeya/commit/18129e96f7c92a69176d6a75add45f3a48ab11ae))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

* feat!: migrate runeya to entire UI ([e173073](https://github.com/runeya/runeya/commit/e173073d932be7e400b1f51261c090116e8fb543))

### BREAKING CHANGES

* all stack files are useless now

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

### Bug Fixes

* improve performance + add jsoncrack view ([c534a97](https://github.com/runeya/runeya/commit/c534a9749162f5f15589ec335da149656c757bfb))

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

### Bug Fixes

* **docker:** add docker support ([f3abb42](https://github.com/runeya/runeya/commit/f3abb4237b8f708585769a8ff51c393d5f21dc5c))

## [1.18.6](https://github.com/runeya/runeya/compare/v1.18.5...v1.18.6) (2024-02-25)

**Note:** Version bump only for package @runeya/modules-git-backend

## [1.18.2](https://github.com/runeya/runeya/compare/v1.18.1...v1.18.2) (2024-02-24)

**Note:** Version bump only for package @runeya/modules-git-backend

## [1.18.1](https://github.com/runeya/runeya/compare/v1.18.0...v1.18.1) (2024-02-20)

**Note:** Version bump only for package @runeya/modules-git-backend

# [1.18.0](https://github.com/runeya/runeya/compare/v1.17.30...v1.18.0) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-git-backend

## [1.17.30](https://github.com/runeya/runeya/compare/v1.17.29...v1.17.30) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-git-backend

## [1.17.29](https://github.com/runeya/runeya/compare/v1.17.28...v1.17.29) (2024-02-15)

**Note:** Version bump only for package @runeya/modules-git-backend

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

**Note:** Version bump only for package @runeya/modules-git-backend

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

**Note:** Version bump only for package @runeya/modules-git-backend

## [1.17.24](https://github.com/runeya/runeya/compare/v1.17.23...v1.17.24) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-git-backend

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-git-backend

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-git-backend

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* build for npm ([0c07b41](https://github.com/runeya/runeya/commit/0c07b410a237412c1c73bbb42fe45c1f9c220482))
* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/git/backend/package.json">
{
  "name": "@runeya/modules-git-backend",
  "version": "2.1.1",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "@runeya/modules-plugins-loader-front": "workspace:*",
    "@types/command-exists": "^1.2.3",
    "@types/express": "^4.17.21"
  },
  "dependencies": {
    "command-exists": "^1.2.9",
    "express": "^4.18.2"
  }
}
</file>

<file path="modules/github/backend/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.1.1](https://github.com/runeya/runeya/compare/v2.1.0...v2.1.1) (2025-02-11)

**Note:** Version bump only for package @runeya/modules-github-backend

# [2.1.0](https://github.com/runeya/runeya/compare/v2.0.17...v2.1.0) (2025-01-31)

**Note:** Version bump only for package @runeya/modules-github-backend

## [2.0.17](https://github.com/runeya/runeya/compare/v2.0.16...v2.0.17) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-github-backend

## [2.0.16](https://github.com/runeya/runeya/compare/v2.0.15...v2.0.16) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-github-backend

## [2.0.15](https://github.com/runeya/runeya/compare/v2.0.14...v2.0.15) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-github-backend

## [2.0.14](https://github.com/runeya/runeya/compare/v2.0.13...v2.0.14) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-github-backend

## [2.0.13](https://github.com/runeya/runeya/compare/v2.0.12...v2.0.13) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-github-backend

## [2.0.12](https://github.com/runeya/runeya/compare/v2.0.11...v2.0.12) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-github-backend

## [2.0.8](https://github.com/runeya/runeya/compare/v2.0.7...v2.0.8) (2025-01-13)

**Note:** Version bump only for package @runeya/modules-github-backend

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* remove some dependencies ([5667402](https://github.com/runeya/runeya/commit/5667402d57add874a89ba029ce62b16b3bbed9e0))
* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

## [2.0.1](https://github.com/runeya/runeya/compare/v2.0.0...v2.0.1) (2024-12-25)

**Note:** Version bump only for package @runeya/modules-github-backend

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-github-backend

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

**Note:** Version bump only for package @runeya/modules-github-backend

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

**Note:** Version bump only for package @runeya/modules-github-backend

## [1.18.6](https://github.com/runeya/runeya/compare/v1.18.5...v1.18.6) (2024-02-25)

**Note:** Version bump only for package @runeya/modules-github-backend

## [1.18.2](https://github.com/runeya/runeya/compare/v1.18.1...v1.18.2) (2024-02-24)

**Note:** Version bump only for package @runeya/modules-github-backend

## [1.18.1](https://github.com/runeya/runeya/compare/v1.18.0...v1.18.1) (2024-02-20)

**Note:** Version bump only for package @runeya/modules-github-backend

# [1.18.0](https://github.com/runeya/runeya/compare/v1.17.30...v1.18.0) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-github-backend

## [1.17.30](https://github.com/runeya/runeya/compare/v1.17.29...v1.17.30) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-github-backend

## [1.17.29](https://github.com/runeya/runeya/compare/v1.17.28...v1.17.29) (2024-02-15)

**Note:** Version bump only for package @runeya/modules-github-backend

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

**Note:** Version bump only for package @runeya/modules-github-backend

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

**Note:** Version bump only for package @runeya/modules-github-backend

## [1.17.24](https://github.com/runeya/runeya/compare/v1.17.23...v1.17.24) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-github-backend

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-github-backend

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-github-backend

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* build for npm ([0c07b41](https://github.com/runeya/runeya/commit/0c07b410a237412c1c73bbb42fe45c1f9c220482))
* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/global-scripts/backend/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.1.1](https://github.com/runeya/runeya/compare/v2.1.0...v2.1.1) (2025-02-11)

**Note:** Version bump only for package @runeya/modules-global-scripts-backend

# [2.1.0](https://github.com/runeya/runeya/compare/v2.0.17...v2.1.0) (2025-01-31)

**Note:** Version bump only for package @runeya/modules-global-scripts-backend

## [2.0.17](https://github.com/runeya/runeya/compare/v2.0.16...v2.0.17) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-global-scripts-backend

## [2.0.16](https://github.com/runeya/runeya/compare/v2.0.15...v2.0.16) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-global-scripts-backend

## [2.0.15](https://github.com/runeya/runeya/compare/v2.0.14...v2.0.15) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-global-scripts-backend

## [2.0.14](https://github.com/runeya/runeya/compare/v2.0.13...v2.0.14) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-global-scripts-backend

## [2.0.13](https://github.com/runeya/runeya/compare/v2.0.12...v2.0.13) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-global-scripts-backend

## [2.0.12](https://github.com/runeya/runeya/compare/v2.0.11...v2.0.12) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-global-scripts-backend

## [2.0.8](https://github.com/runeya/runeya/compare/v2.0.7...v2.0.8) (2025-01-13)

**Note:** Version bump only for package @runeya/modules-global-scripts-backend

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

## [2.0.1](https://github.com/runeya/runeya/compare/v2.0.0...v2.0.1) (2024-12-25)

**Note:** Version bump only for package @runeya/modules-global-scripts-backend

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-global-scripts-backend

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

**Note:** Version bump only for package @runeya/modules-global-scripts-backend

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

**Note:** Version bump only for package @runeya/modules-global-scripts-backend

## [1.18.6](https://github.com/runeya/runeya/compare/v1.18.5...v1.18.6) (2024-02-25)

**Note:** Version bump only for package @runeya/modules-global-scripts-backend

## [1.18.2](https://github.com/runeya/runeya/compare/v1.18.1...v1.18.2) (2024-02-24)

**Note:** Version bump only for package @runeya/modules-global-scripts-backend

## [1.18.1](https://github.com/runeya/runeya/compare/v1.18.0...v1.18.1) (2024-02-20)

**Note:** Version bump only for package @runeya/modules-global-scripts-backend

# [1.18.0](https://github.com/runeya/runeya/compare/v1.17.30...v1.18.0) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-global-scripts-backend

## [1.17.30](https://github.com/runeya/runeya/compare/v1.17.29...v1.17.30) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-global-scripts-backend

## [1.17.29](https://github.com/runeya/runeya/compare/v1.17.28...v1.17.29) (2024-02-15)

**Note:** Version bump only for package @runeya/modules-global-scripts-backend

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

**Note:** Version bump only for package @runeya/modules-global-scripts-backend

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

**Note:** Version bump only for package @runeya/modules-global-scripts-backend

## [1.17.24](https://github.com/runeya/runeya/compare/v1.17.23...v1.17.24) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-global-scripts-backend

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-global-scripts-backend

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-global-scripts-backend

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* build for npm ([0c07b41](https://github.com/runeya/runeya/commit/0c07b410a237412c1c73bbb42fe45c1f9c220482))
* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/help/backend/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.1.1](https://github.com/runeya/runeya/compare/v2.1.0...v2.1.1) (2025-02-11)

**Note:** Version bump only for package @runeya/modules-help-backend

# [2.1.0](https://github.com/runeya/runeya/compare/v2.0.17...v2.1.0) (2025-01-31)

**Note:** Version bump only for package @runeya/modules-help-backend

## [2.0.17](https://github.com/runeya/runeya/compare/v2.0.16...v2.0.17) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-help-backend

## [2.0.16](https://github.com/runeya/runeya/compare/v2.0.15...v2.0.16) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-help-backend

## [2.0.15](https://github.com/runeya/runeya/compare/v2.0.14...v2.0.15) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-help-backend

## [2.0.14](https://github.com/runeya/runeya/compare/v2.0.13...v2.0.14) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-help-backend

## [2.0.13](https://github.com/runeya/runeya/compare/v2.0.12...v2.0.13) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-help-backend

## [2.0.12](https://github.com/runeya/runeya/compare/v2.0.11...v2.0.12) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-help-backend

## [2.0.8](https://github.com/runeya/runeya/compare/v2.0.7...v2.0.8) (2025-01-13)

**Note:** Version bump only for package @runeya/modules-help-backend

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

## [2.0.1](https://github.com/runeya/runeya/compare/v2.0.0...v2.0.1) (2024-12-25)

**Note:** Version bump only for package @runeya/modules-help-backend

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-help-backend

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

**Note:** Version bump only for package @runeya/modules-help-backend

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

**Note:** Version bump only for package @runeya/modules-help-backend

## [1.18.6](https://github.com/runeya/runeya/compare/v1.18.5...v1.18.6) (2024-02-25)

**Note:** Version bump only for package @runeya/modules-help-backend

## [1.18.2](https://github.com/runeya/runeya/compare/v1.18.1...v1.18.2) (2024-02-24)

**Note:** Version bump only for package @runeya/modules-help-backend

## [1.18.1](https://github.com/runeya/runeya/compare/v1.18.0...v1.18.1) (2024-02-20)

**Note:** Version bump only for package @runeya/modules-help-backend

# [1.18.0](https://github.com/runeya/runeya/compare/v1.17.30...v1.18.0) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-help-backend

## [1.17.30](https://github.com/runeya/runeya/compare/v1.17.29...v1.17.30) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-help-backend

## [1.17.29](https://github.com/runeya/runeya/compare/v1.17.28...v1.17.29) (2024-02-15)

**Note:** Version bump only for package @runeya/modules-help-backend

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

### Bug Fixes

* **server:** resolve dependencies ([7a15ef0](https://github.com/runeya/runeya/commit/7a15ef01ba9946fb2662c0f15a6da758f0c40280))

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

### Bug Fixes

* add link to runeya help ([62c1d4e](https://github.com/runeya/runeya/commit/62c1d4e07455759e6468133b2ee7fa4ed1cb8cb6))
</file>

<file path="modules/help/backend/package.json">
{
  "name": "@runeya/modules-help-backend",
  "version": "2.1.1",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "@runeya/modules-plugins-loader-front": "workspace:*"
  }
}
</file>

<file path="modules/json-formatter/backend/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.1.1](https://github.com/runeya/runeya/compare/v2.1.0...v2.1.1) (2025-02-11)

**Note:** Version bump only for package @runeya/modules-json-formatter-backend

# [2.1.0](https://github.com/runeya/runeya/compare/v2.0.17...v2.1.0) (2025-01-31)

**Note:** Version bump only for package @runeya/modules-json-formatter-backend

## [2.0.17](https://github.com/runeya/runeya/compare/v2.0.16...v2.0.17) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-json-formatter-backend

## [2.0.16](https://github.com/runeya/runeya/compare/v2.0.15...v2.0.16) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-json-formatter-backend

## [2.0.15](https://github.com/runeya/runeya/compare/v2.0.14...v2.0.15) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-json-formatter-backend

## [2.0.14](https://github.com/runeya/runeya/compare/v2.0.13...v2.0.14) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-json-formatter-backend

## [2.0.13](https://github.com/runeya/runeya/compare/v2.0.12...v2.0.13) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-json-formatter-backend

## [2.0.12](https://github.com/runeya/runeya/compare/v2.0.11...v2.0.12) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-json-formatter-backend

## [2.0.8](https://github.com/runeya/runeya/compare/v2.0.7...v2.0.8) (2025-01-13)

**Note:** Version bump only for package @runeya/modules-json-formatter-backend

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

## [2.0.1](https://github.com/runeya/runeya/compare/v2.0.0...v2.0.1) (2024-12-25)

**Note:** Version bump only for package @runeya/modules-json-formatter-backend

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-json-formatter-backend

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

**Note:** Version bump only for package @runeya/modules-json-formatter-backend

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

**Note:** Version bump only for package @runeya/modules-json-formatter-backend

## [1.18.6](https://github.com/runeya/runeya/compare/v1.18.5...v1.18.6) (2024-02-25)

**Note:** Version bump only for package @runeya/modules-json-formatter-backend

## [1.18.2](https://github.com/runeya/runeya/compare/v1.18.1...v1.18.2) (2024-02-24)

**Note:** Version bump only for package @runeya/modules-json-formatter-backend

## [1.18.1](https://github.com/runeya/runeya/compare/v1.18.0...v1.18.1) (2024-02-20)

**Note:** Version bump only for package @runeya/modules-json-formatter-backend

# [1.18.0](https://github.com/runeya/runeya/compare/v1.17.30...v1.18.0) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-json-formatter-backend

## [1.17.30](https://github.com/runeya/runeya/compare/v1.17.29...v1.17.30) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-json-formatter-backend

## [1.17.29](https://github.com/runeya/runeya/compare/v1.17.28...v1.17.29) (2024-02-15)

**Note:** Version bump only for package @runeya/modules-json-formatter-backend

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

**Note:** Version bump only for package @runeya/modules-json-formatter-backend

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

**Note:** Version bump only for package @runeya/modules-json-formatter-backend

## [1.17.24](https://github.com/runeya/runeya/compare/v1.17.23...v1.17.24) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-json-formatter-backend

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-json-formatter-backend

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-json-formatter-backend

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/json-formatter/backend/package.json">
{
  "name": "@runeya/modules-json-formatter-backend",
  "version": "2.1.1",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "@runeya/modules-plugins-loader-front": "workspace:*"
  }
}
</file>

<file path="modules/jwt/backend/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.1.1](https://github.com/runeya/runeya/compare/v2.1.0...v2.1.1) (2025-02-11)

**Note:** Version bump only for package @runeya/modules-jwt-backend

# [2.1.0](https://github.com/runeya/runeya/compare/v2.0.17...v2.1.0) (2025-01-31)

**Note:** Version bump only for package @runeya/modules-jwt-backend

## [2.0.17](https://github.com/runeya/runeya/compare/v2.0.16...v2.0.17) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-jwt-backend

## [2.0.16](https://github.com/runeya/runeya/compare/v2.0.15...v2.0.16) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-jwt-backend

## [2.0.15](https://github.com/runeya/runeya/compare/v2.0.14...v2.0.15) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-jwt-backend

## [2.0.14](https://github.com/runeya/runeya/compare/v2.0.13...v2.0.14) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-jwt-backend

## [2.0.13](https://github.com/runeya/runeya/compare/v2.0.12...v2.0.13) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-jwt-backend

## [2.0.12](https://github.com/runeya/runeya/compare/v2.0.11...v2.0.12) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-jwt-backend

## [2.0.8](https://github.com/runeya/runeya/compare/v2.0.7...v2.0.8) (2025-01-13)

**Note:** Version bump only for package @runeya/modules-jwt-backend

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

## [2.0.1](https://github.com/runeya/runeya/compare/v2.0.0...v2.0.1) (2024-12-25)

**Note:** Version bump only for package @runeya/modules-jwt-backend

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-jwt-backend

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

**Note:** Version bump only for package @runeya/modules-jwt-backend

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

**Note:** Version bump only for package @runeya/modules-jwt-backend

## [1.18.6](https://github.com/runeya/runeya/compare/v1.18.5...v1.18.6) (2024-02-25)

**Note:** Version bump only for package @runeya/modules-jwt-backend

## [1.18.2](https://github.com/runeya/runeya/compare/v1.18.1...v1.18.2) (2024-02-24)

**Note:** Version bump only for package @runeya/modules-jwt-backend

## [1.18.1](https://github.com/runeya/runeya/compare/v1.18.0...v1.18.1) (2024-02-20)

**Note:** Version bump only for package @runeya/modules-jwt-backend

# [1.18.0](https://github.com/runeya/runeya/compare/v1.17.30...v1.18.0) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-jwt-backend

## [1.17.30](https://github.com/runeya/runeya/compare/v1.17.29...v1.17.30) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-jwt-backend

## [1.17.29](https://github.com/runeya/runeya/compare/v1.17.28...v1.17.29) (2024-02-15)

**Note:** Version bump only for package @runeya/modules-jwt-backend

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

**Note:** Version bump only for package @runeya/modules-jwt-backend

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

**Note:** Version bump only for package @runeya/modules-jwt-backend

## [1.17.24](https://github.com/runeya/runeya/compare/v1.17.23...v1.17.24) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-jwt-backend

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-jwt-backend

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-jwt-backend

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/jwt/backend/package.json">
{
  "name": "@runeya/modules-jwt-backend",
  "version": "2.1.1",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "@runeya/modules-plugins-loader-front": "workspace:*",
    "@types/express": "^4.17.21",
    "@types/jsonwebtoken": "^9.0.5"
  },
  "dependencies": {
    "express": "^4.18.2",
    "jsonwebtoken": "^9.0.2"
  }
}
</file>

<file path="modules/kanban/backend/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.1.1](https://github.com/runeya/runeya/compare/v2.1.0...v2.1.1) (2025-02-11)

**Note:** Version bump only for package @runeya/modules-kanban-backend

# [2.1.0](https://github.com/runeya/runeya/compare/v2.0.17...v2.1.0) (2025-01-31)

**Note:** Version bump only for package @runeya/modules-kanban-backend

## [2.0.17](https://github.com/runeya/runeya/compare/v2.0.16...v2.0.17) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-kanban-backend

## [2.0.16](https://github.com/runeya/runeya/compare/v2.0.15...v2.0.16) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-kanban-backend

## [2.0.15](https://github.com/runeya/runeya/compare/v2.0.14...v2.0.15) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-kanban-backend

## [2.0.14](https://github.com/runeya/runeya/compare/v2.0.13...v2.0.14) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-kanban-backend

## [2.0.13](https://github.com/runeya/runeya/compare/v2.0.12...v2.0.13) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-kanban-backend

## [2.0.12](https://github.com/runeya/runeya/compare/v2.0.11...v2.0.12) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-kanban-backend

## [2.0.8](https://github.com/runeya/runeya/compare/v2.0.7...v2.0.8) (2025-01-13)

**Note:** Version bump only for package @runeya/modules-kanban-backend

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

## [2.0.1](https://github.com/runeya/runeya/compare/v2.0.0...v2.0.1) (2024-12-25)

**Note:** Version bump only for package @runeya/modules-kanban-backend

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-kanban-backend

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

**Note:** Version bump only for package @runeya/modules-kanban-backend

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

**Note:** Version bump only for package @runeya/modules-kanban-backend

## [1.18.6](https://github.com/runeya/runeya/compare/v1.18.5...v1.18.6) (2024-02-25)

**Note:** Version bump only for package @runeya/modules-kanban-backend

## [1.18.2](https://github.com/runeya/runeya/compare/v1.18.1...v1.18.2) (2024-02-24)

**Note:** Version bump only for package @runeya/modules-kanban-backend

## [1.18.1](https://github.com/runeya/runeya/compare/v1.18.0...v1.18.1) (2024-02-20)

**Note:** Version bump only for package @runeya/modules-kanban-backend

# [1.18.0](https://github.com/runeya/runeya/compare/v1.17.30...v1.18.0) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-kanban-backend

## [1.17.30](https://github.com/runeya/runeya/compare/v1.17.29...v1.17.30) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-kanban-backend

## [1.17.29](https://github.com/runeya/runeya/compare/v1.17.28...v1.17.29) (2024-02-15)

**Note:** Version bump only for package @runeya/modules-kanban-backend

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

**Note:** Version bump only for package @runeya/modules-kanban-backend

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

**Note:** Version bump only for package @runeya/modules-kanban-backend

## [1.17.24](https://github.com/runeya/runeya/compare/v1.17.23...v1.17.24) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-kanban-backend

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-kanban-backend

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-kanban-backend

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* build for npm ([0c07b41](https://github.com/runeya/runeya/commit/0c07b410a237412c1c73bbb42fe45c1f9c220482))
* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/kanban/backend/package.json">
{
  "name": "@runeya/modules-kanban-backend",
  "version": "2.1.1",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "@runeya/modules-plugins-loader-front": "workspace:*",
    "@types/express": "^4.17.21",
    "@types/uuid": "^9.0.8"
  },
  "dependencies": {
    "express": "^4.18.2",
    "uuid": "^9.0.1"
  }
}
</file>

<file path="modules/logs/backend/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.1.1](https://github.com/runeya/runeya/compare/v2.1.0...v2.1.1) (2025-02-11)

**Note:** Version bump only for package @runeya/modules-logs-backend

# [2.1.0](https://github.com/runeya/runeya/compare/v2.0.17...v2.1.0) (2025-01-31)

**Note:** Version bump only for package @runeya/modules-logs-backend

## [2.0.17](https://github.com/runeya/runeya/compare/v2.0.16...v2.0.17) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-logs-backend

## [2.0.16](https://github.com/runeya/runeya/compare/v2.0.15...v2.0.16) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-logs-backend

## [2.0.15](https://github.com/runeya/runeya/compare/v2.0.14...v2.0.15) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-logs-backend

## [2.0.14](https://github.com/runeya/runeya/compare/v2.0.13...v2.0.14) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-logs-backend

## [2.0.13](https://github.com/runeya/runeya/compare/v2.0.12...v2.0.13) (2025-01-24)

### Bug Fixes

* **services:** dont guess anymore cwd from the first command ([e62077f](https://github.com/runeya/runeya/commit/e62077f377c11553fcae6dfd19dbffe989342551))

## [2.0.12](https://github.com/runeya/runeya/compare/v2.0.11...v2.0.12) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-logs-backend

## [2.0.8](https://github.com/runeya/runeya/compare/v2.0.7...v2.0.8) (2025-01-13)

### Bug Fixes

* documentation + various bugfixes ([bddd9f6](https://github.com/runeya/runeya/commit/bddd9f6a5507a5a45ea2e54d0fe836e1e518c820))

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

## [2.0.1](https://github.com/runeya/runeya/compare/v2.0.0...v2.0.1) (2024-12-25)

**Note:** Version bump only for package @runeya/modules-logs-backend

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

* feat!: migrate runeya to entire UI ([e173073](https://github.com/runeya/runeya/commit/e173073d932be7e400b1f51261c090116e8fb543))

### BREAKING CHANGES

* all stack files are useless now

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

**Note:** Version bump only for package @runeya/modules-logs-backend

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

### Bug Fixes

* **devcontainer:** add container support ([f2559fb](https://github.com/runeya/runeya/commit/f2559fb90bba3de5fcfef2c95dd45826358b7ad4))

## [1.18.6](https://github.com/runeya/runeya/compare/v1.18.5...v1.18.6) (2024-02-25)

**Note:** Version bump only for package @runeya/modules-logs-backend

## [1.18.2](https://github.com/runeya/runeya/compare/v1.18.1...v1.18.2) (2024-02-24)

**Note:** Version bump only for package @runeya/modules-logs-backend

## [1.18.1](https://github.com/runeya/runeya/compare/v1.18.0...v1.18.1) (2024-02-20)

**Note:** Version bump only for package @runeya/modules-logs-backend

# [1.18.0](https://github.com/runeya/runeya/compare/v1.17.30...v1.18.0) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-logs-backend

## [1.17.30](https://github.com/runeya/runeya/compare/v1.17.29...v1.17.30) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-logs-backend

## [1.17.29](https://github.com/runeya/runeya/compare/v1.17.28...v1.17.29) (2024-02-15)

**Note:** Version bump only for package @runeya/modules-logs-backend

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

**Note:** Version bump only for package @runeya/modules-logs-backend

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

**Note:** Version bump only for package @runeya/modules-logs-backend

## [1.17.24](https://github.com/runeya/runeya/compare/v1.17.23...v1.17.24) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-logs-backend

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-logs-backend

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-logs-backend

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* build for npm ([0c07b41](https://github.com/runeya/runeya/commit/0c07b410a237412c1c73bbb42fe45c1f9c220482))
* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/logs/backend/package.json">
{
  "name": "@runeya/modules-logs-backend",
  "version": "2.1.1",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "@runeya/modules-plugins-loader-front": "workspace:*",
    "@types/express": "^4.17.21",
    "@types/uuid": "^9.0.8"
  },
  "dependencies": {
    "dayjs": "^1.11.10",
    "express": "^4.18.2",
    "uuid": "^9.0.1"
  }
}
</file>

<file path="modules/mongo/backend/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.1.1](https://github.com/runeya/runeya/compare/v2.1.0...v2.1.1) (2025-02-11)

**Note:** Version bump only for package @runeya/modules-mongo-backend

# [2.1.0](https://github.com/runeya/runeya/compare/v2.0.17...v2.1.0) (2025-01-31)

**Note:** Version bump only for package @runeya/modules-mongo-backend

## [2.0.17](https://github.com/runeya/runeya/compare/v2.0.16...v2.0.17) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-mongo-backend

## [2.0.16](https://github.com/runeya/runeya/compare/v2.0.15...v2.0.16) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-mongo-backend

## [2.0.15](https://github.com/runeya/runeya/compare/v2.0.14...v2.0.15) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-mongo-backend

## [2.0.14](https://github.com/runeya/runeya/compare/v2.0.13...v2.0.14) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-mongo-backend

## [2.0.13](https://github.com/runeya/runeya/compare/v2.0.12...v2.0.13) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-mongo-backend

## [2.0.12](https://github.com/runeya/runeya/compare/v2.0.11...v2.0.12) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-mongo-backend

## [2.0.8](https://github.com/runeya/runeya/compare/v2.0.7...v2.0.8) (2025-01-13)

**Note:** Version bump only for package @runeya/modules-mongo-backend

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

## [2.0.1](https://github.com/runeya/runeya/compare/v2.0.0...v2.0.1) (2024-12-25)

**Note:** Version bump only for package @runeya/modules-mongo-backend

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-mongo-backend

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

**Note:** Version bump only for package @runeya/modules-mongo-backend

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

**Note:** Version bump only for package @runeya/modules-mongo-backend

## [1.18.6](https://github.com/runeya/runeya/compare/v1.18.5...v1.18.6) (2024-02-25)

**Note:** Version bump only for package @runeya/modules-mongo-backend

## [1.18.2](https://github.com/runeya/runeya/compare/v1.18.1...v1.18.2) (2024-02-24)

**Note:** Version bump only for package @runeya/modules-mongo-backend

## [1.18.1](https://github.com/runeya/runeya/compare/v1.18.0...v1.18.1) (2024-02-20)

**Note:** Version bump only for package @runeya/modules-mongo-backend

# [1.18.0](https://github.com/runeya/runeya/compare/v1.17.30...v1.18.0) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-mongo-backend

## [1.17.30](https://github.com/runeya/runeya/compare/v1.17.29...v1.17.30) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-mongo-backend

## [1.17.29](https://github.com/runeya/runeya/compare/v1.17.28...v1.17.29) (2024-02-15)

**Note:** Version bump only for package @runeya/modules-mongo-backend

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

**Note:** Version bump only for package @runeya/modules-mongo-backend

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

**Note:** Version bump only for package @runeya/modules-mongo-backend

## [1.17.24](https://github.com/runeya/runeya/compare/v1.17.23...v1.17.24) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-mongo-backend

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-mongo-backend

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-mongo-backend

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/mongo/backend/package.json">
{
  "name": "@runeya/modules-mongo-backend",
  "version": "2.1.1",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "@runeya/modules-plugins-loader-front": "workspace:*",
    "@types/express": "^4.17.21"
  },
  "dependencies": {
    "express": "^4.18.2",
    "mongodb": "^6.3.0"
  }
}
</file>

<file path="modules/node-repl/backend/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.1.1](https://github.com/runeya/runeya/compare/v2.1.0...v2.1.1) (2025-02-11)

**Note:** Version bump only for package @runeya/modules-node-repl-backend

# [2.1.0](https://github.com/runeya/runeya/compare/v2.0.17...v2.1.0) (2025-01-31)

**Note:** Version bump only for package @runeya/modules-node-repl-backend

## [2.0.17](https://github.com/runeya/runeya/compare/v2.0.16...v2.0.17) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-node-repl-backend

## [2.0.16](https://github.com/runeya/runeya/compare/v2.0.15...v2.0.16) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-node-repl-backend

## [2.0.15](https://github.com/runeya/runeya/compare/v2.0.14...v2.0.15) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-node-repl-backend

## [2.0.14](https://github.com/runeya/runeya/compare/v2.0.13...v2.0.14) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-node-repl-backend

## [2.0.13](https://github.com/runeya/runeya/compare/v2.0.12...v2.0.13) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-node-repl-backend

## [2.0.12](https://github.com/runeya/runeya/compare/v2.0.11...v2.0.12) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-node-repl-backend

## [2.0.8](https://github.com/runeya/runeya/compare/v2.0.7...v2.0.8) (2025-01-13)

**Note:** Version bump only for package @runeya/modules-node-repl-backend

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* remove some dependencies ([5667402](https://github.com/runeya/runeya/commit/5667402d57add874a89ba029ce62b16b3bbed9e0))
* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

## [2.0.1](https://github.com/runeya/runeya/compare/v2.0.0...v2.0.1) (2024-12-25)

**Note:** Version bump only for package @runeya/modules-node-repl-backend

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-node-repl-backend

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

**Note:** Version bump only for package @runeya/modules-node-repl-backend

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

**Note:** Version bump only for package @runeya/modules-node-repl-backend

## [1.18.6](https://github.com/runeya/runeya/compare/v1.18.5...v1.18.6) (2024-02-25)

**Note:** Version bump only for package @runeya/modules-node-repl-backend

## [1.18.2](https://github.com/runeya/runeya/compare/v1.18.1...v1.18.2) (2024-02-24)

**Note:** Version bump only for package @runeya/modules-node-repl-backend

## [1.18.1](https://github.com/runeya/runeya/compare/v1.18.0...v1.18.1) (2024-02-20)

**Note:** Version bump only for package @runeya/modules-node-repl-backend

# [1.18.0](https://github.com/runeya/runeya/compare/v1.17.30...v1.18.0) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-node-repl-backend

## [1.17.30](https://github.com/runeya/runeya/compare/v1.17.29...v1.17.30) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-node-repl-backend

## [1.17.29](https://github.com/runeya/runeya/compare/v1.17.28...v1.17.29) (2024-02-15)

**Note:** Version bump only for package @runeya/modules-node-repl-backend

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

### Bug Fixes

* various changes ([06e6241](https://github.com/runeya/runeya/commit/06e624176595b95c4227fe684242919c7eeda192))

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

**Note:** Version bump only for package @runeya/modules-node-repl-backend

## [1.17.24](https://github.com/runeya/runeya/compare/v1.17.23...v1.17.24) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-node-repl-backend

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-node-repl-backend

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-node-repl-backend

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* build for npm ([0c07b41](https://github.com/runeya/runeya/commit/0c07b410a237412c1c73bbb42fe45c1f9c220482))
* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/npm/backend/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.1.1](https://github.com/runeya/runeya/compare/v2.1.0...v2.1.1) (2025-02-11)

**Note:** Version bump only for package @runeya/modules-npm-backend

# [2.1.0](https://github.com/runeya/runeya/compare/v2.0.17...v2.1.0) (2025-01-31)

**Note:** Version bump only for package @runeya/modules-npm-backend

## [2.0.17](https://github.com/runeya/runeya/compare/v2.0.16...v2.0.17) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-npm-backend

## [2.0.16](https://github.com/runeya/runeya/compare/v2.0.15...v2.0.16) (2025-01-24)

### Bug Fixes

* **Npm:** priority to commands over rootpath ([460df64](https://github.com/runeya/runeya/commit/460df64d4ed66056ae26c213b8f83e5fe932d980))

## [2.0.15](https://github.com/runeya/runeya/compare/v2.0.14...v2.0.15) (2025-01-24)

### Bug Fixes

* **Bugs:** support for new command selector ([afd2815](https://github.com/runeya/runeya/commit/afd2815b8c7cf3dd01e5f9408174000e8913996b))
* **Npm:** support for new command selector ([edfbb76](https://github.com/runeya/runeya/commit/edfbb76cfddec911a210f5be9554e497c60f92fb))

## [2.0.14](https://github.com/runeya/runeya/compare/v2.0.13...v2.0.14) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-npm-backend

## [2.0.13](https://github.com/runeya/runeya/compare/v2.0.12...v2.0.13) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-npm-backend

## [2.0.12](https://github.com/runeya/runeya/compare/v2.0.11...v2.0.12) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-npm-backend

## [2.0.8](https://github.com/runeya/runeya/compare/v2.0.7...v2.0.8) (2025-01-13)

**Note:** Version bump only for package @runeya/modules-npm-backend

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* remove some dependencies ([5667402](https://github.com/runeya/runeya/commit/5667402d57add874a89ba029ce62b16b3bbed9e0))
* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

## [2.0.1](https://github.com/runeya/runeya/compare/v2.0.0...v2.0.1) (2024-12-25)

**Note:** Version bump only for package @runeya/modules-npm-backend

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-npm-backend

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

**Note:** Version bump only for package @runeya/modules-npm-backend

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

**Note:** Version bump only for package @runeya/modules-npm-backend

## [1.18.6](https://github.com/runeya/runeya/compare/v1.18.5...v1.18.6) (2024-02-25)

**Note:** Version bump only for package @runeya/modules-npm-backend

## [1.18.2](https://github.com/runeya/runeya/compare/v1.18.1...v1.18.2) (2024-02-24)

**Note:** Version bump only for package @runeya/modules-npm-backend

## [1.18.1](https://github.com/runeya/runeya/compare/v1.18.0...v1.18.1) (2024-02-20)

**Note:** Version bump only for package @runeya/modules-npm-backend

# [1.18.0](https://github.com/runeya/runeya/compare/v1.17.30...v1.18.0) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-npm-backend

## [1.17.30](https://github.com/runeya/runeya/compare/v1.17.29...v1.17.30) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-npm-backend

## [1.17.29](https://github.com/runeya/runeya/compare/v1.17.28...v1.17.29) (2024-02-15)

**Note:** Version bump only for package @runeya/modules-npm-backend

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

**Note:** Version bump only for package @runeya/modules-npm-backend

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

**Note:** Version bump only for package @runeya/modules-npm-backend

## [1.17.24](https://github.com/runeya/runeya/compare/v1.17.23...v1.17.24) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-npm-backend

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-npm-backend

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-npm-backend

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* build for npm ([0c07b41](https://github.com/runeya/runeya/commit/0c07b410a237412c1c73bbb42fe45c1f9c220482))
* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/openai/backend/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.1.1](https://github.com/runeya/runeya/compare/v2.1.0...v2.1.1) (2025-02-11)

**Note:** Version bump only for package @runeya/modules-openai-backend

# [2.1.0](https://github.com/runeya/runeya/compare/v2.0.17...v2.1.0) (2025-01-31)

**Note:** Version bump only for package @runeya/modules-openai-backend

## [2.0.17](https://github.com/runeya/runeya/compare/v2.0.16...v2.0.17) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-openai-backend

## [2.0.16](https://github.com/runeya/runeya/compare/v2.0.15...v2.0.16) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-openai-backend

## [2.0.15](https://github.com/runeya/runeya/compare/v2.0.14...v2.0.15) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-openai-backend

## [2.0.14](https://github.com/runeya/runeya/compare/v2.0.13...v2.0.14) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-openai-backend

## [2.0.13](https://github.com/runeya/runeya/compare/v2.0.12...v2.0.13) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-openai-backend

## [2.0.12](https://github.com/runeya/runeya/compare/v2.0.11...v2.0.12) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-openai-backend

## [2.0.8](https://github.com/runeya/runeya/compare/v2.0.7...v2.0.8) (2025-01-13)

### Bug Fixes

* documentation + various bugfixes ([bddd9f6](https://github.com/runeya/runeya/commit/bddd9f6a5507a5a45ea2e54d0fe836e1e518c820))

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* attach heritage to environment instead of service + various fixes ([4647010](https://github.com/runeya/runeya/commit/4647010eadbf3370155faca171a0b10caea32baf))
* remove some dependencies ([5667402](https://github.com/runeya/runeya/commit/5667402d57add874a89ba029ce62b16b3bbed9e0))
* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

## [2.0.1](https://github.com/runeya/runeya/compare/v2.0.0...v2.0.1) (2024-12-25)

**Note:** Version bump only for package @runeya/modules-openai-backend

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-openai-backend

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

**Note:** Version bump only for package @runeya/modules-openai-backend

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

### Bug Fixes

* **docker:** add docker support ([f3abb42](https://github.com/runeya/runeya/commit/f3abb4237b8f708585769a8ff51c393d5f21dc5c))

## [1.18.6](https://github.com/runeya/runeya/compare/v1.18.5...v1.18.6) (2024-02-25)

**Note:** Version bump only for package @runeya/modules-openai-backend

## [1.18.2](https://github.com/runeya/runeya/compare/v1.18.1...v1.18.2) (2024-02-24)

**Note:** Version bump only for package @runeya/modules-openai-backend

## [1.18.1](https://github.com/runeya/runeya/compare/v1.18.0...v1.18.1) (2024-02-20)

**Note:** Version bump only for package @runeya/modules-openai-backend

# [1.18.0](https://github.com/runeya/runeya/compare/v1.17.30...v1.18.0) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-openai-backend

## [1.17.30](https://github.com/runeya/runeya/compare/v1.17.29...v1.17.30) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-openai-backend

## [1.17.29](https://github.com/runeya/runeya/compare/v1.17.28...v1.17.29) (2024-02-15)

**Note:** Version bump only for package @runeya/modules-openai-backend

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

**Note:** Version bump only for package @runeya/modules-openai-backend

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

**Note:** Version bump only for package @runeya/modules-openai-backend

## [1.17.24](https://github.com/runeya/runeya/compare/v1.17.23...v1.17.24) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-openai-backend

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-openai-backend

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-openai-backend

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.13](https://github.com/runeya/runeya/compare/v1.17.12...v1.17.13) (2024-02-05)

### Bug Fixes

* **openai:** dont initialize openai if no apikey is configured ([0746e78](https://github.com/runeya/runeya/commit/0746e786fc54ae832b09ba5b99a33dc1d741da6f))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/openapi/backend/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.1.1](https://github.com/runeya/runeya/compare/v2.1.0...v2.1.1) (2025-02-11)

**Note:** Version bump only for package @runeya/modules-openapi-backend

# [2.1.0](https://github.com/runeya/runeya/compare/v2.0.17...v2.1.0) (2025-01-31)

**Note:** Version bump only for package @runeya/modules-openapi-backend

## [2.0.17](https://github.com/runeya/runeya/compare/v2.0.16...v2.0.17) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-openapi-backend

## [2.0.16](https://github.com/runeya/runeya/compare/v2.0.15...v2.0.16) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-openapi-backend

## [2.0.15](https://github.com/runeya/runeya/compare/v2.0.14...v2.0.15) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-openapi-backend

## [2.0.14](https://github.com/runeya/runeya/compare/v2.0.13...v2.0.14) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-openapi-backend

## [2.0.13](https://github.com/runeya/runeya/compare/v2.0.12...v2.0.13) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-openapi-backend

## [2.0.12](https://github.com/runeya/runeya/compare/v2.0.11...v2.0.12) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-openapi-backend

## [2.0.8](https://github.com/runeya/runeya/compare/v2.0.7...v2.0.8) (2025-01-13)

**Note:** Version bump only for package @runeya/modules-openapi-backend

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* attach heritage to environment instead of service + various fixes ([4647010](https://github.com/runeya/runeya/commit/4647010eadbf3370155faca171a0b10caea32baf))
* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

## [2.0.1](https://github.com/runeya/runeya/compare/v2.0.0...v2.0.1) (2024-12-25)

**Note:** Version bump only for package @runeya/modules-openapi-backend

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-openapi-backend

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

**Note:** Version bump only for package @runeya/modules-openapi-backend

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

**Note:** Version bump only for package @runeya/modules-openapi-backend

## [1.18.6](https://github.com/runeya/runeya/compare/v1.18.5...v1.18.6) (2024-02-25)

**Note:** Version bump only for package @runeya/modules-openapi-backend

## [1.18.2](https://github.com/runeya/runeya/compare/v1.18.1...v1.18.2) (2024-02-24)

**Note:** Version bump only for package @runeya/modules-openapi-backend

## [1.18.1](https://github.com/runeya/runeya/compare/v1.18.0...v1.18.1) (2024-02-20)

**Note:** Version bump only for package @runeya/modules-openapi-backend

# [1.18.0](https://github.com/runeya/runeya/compare/v1.17.30...v1.18.0) (2024-02-19)

### Features

* **swagger:** can read an opoenapi url from service ([481b543](https://github.com/runeya/runeya/commit/481b54305b2606f6f360287b17a4b4270a99eb3d))
</file>

<file path="modules/plugins-loader/front/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.1.1](https://github.com/runeya/runeya/compare/v2.1.0...v2.1.1) (2025-02-11)

**Note:** Version bump only for package @runeya/modules-plugins-loader-front

# [2.1.0](https://github.com/runeya/runeya/compare/v2.0.17...v2.1.0) (2025-01-31)

### Features

* **nodered:** add nodered into app ([f897eb2](https://github.com/runeya/runeya/commit/f897eb2c4a9128e0d4615f6765d3ef0ce1d2ca3e))

## [2.0.17](https://github.com/runeya/runeya/compare/v2.0.16...v2.0.17) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-plugins-loader-front

## [2.0.16](https://github.com/runeya/runeya/compare/v2.0.15...v2.0.16) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-plugins-loader-front

## [2.0.15](https://github.com/runeya/runeya/compare/v2.0.14...v2.0.15) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-plugins-loader-front

## [2.0.14](https://github.com/runeya/runeya/compare/v2.0.13...v2.0.14) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-plugins-loader-front

## [2.0.13](https://github.com/runeya/runeya/compare/v2.0.12...v2.0.13) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-plugins-loader-front

## [2.0.12](https://github.com/runeya/runeya/compare/v2.0.11...v2.0.12) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-plugins-loader-front

## [2.0.8](https://github.com/runeya/runeya/compare/v2.0.7...v2.0.8) (2025-01-13)

**Note:** Version bump only for package @runeya/modules-plugins-loader-front

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

## [2.0.1](https://github.com/runeya/runeya/compare/v2.0.0...v2.0.1) (2024-12-25)

**Note:** Version bump only for package @runeya/modules-plugins-loader-front

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-plugins-loader-front

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

**Note:** Version bump only for package @runeya/modules-plugins-loader-front

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

### Bug Fixes

* **docker:** add docker support ([f3abb42](https://github.com/runeya/runeya/commit/f3abb4237b8f708585769a8ff51c393d5f21dc5c))
* resolve issues for permission on docker volumes + cosmetic changes ([7a822cd](https://github.com/runeya/runeya/commit/7a822cd1c205e5808247075828c1d3ce49d1524b))

## [1.18.6](https://github.com/runeya/runeya/compare/v1.18.5...v1.18.6) (2024-02-25)

**Note:** Version bump only for package @runeya/modules-plugins-loader-front

## [1.18.2](https://github.com/runeya/runeya/compare/v1.18.1...v1.18.2) (2024-02-24)

### Bug Fixes

* **extension:** create vscodeextension ([dfb2589](https://github.com/runeya/runeya/commit/dfb258912ca717cca9b2dc857c2774bfddd59251))

## [1.18.1](https://github.com/runeya/runeya/compare/v1.18.0...v1.18.1) (2024-02-20)

**Note:** Version bump only for package @runeya/modules-plugins-loader-front

# [1.18.0](https://github.com/runeya/runeya/compare/v1.17.30...v1.18.0) (2024-02-19)

### Features

* **swagger:** can read an opoenapi url from service ([481b543](https://github.com/runeya/runeya/commit/481b54305b2606f6f360287b17a4b4270a99eb3d))

## [1.17.30](https://github.com/runeya/runeya/compare/v1.17.29...v1.17.30) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-plugins-loader-front

## [1.17.29](https://github.com/runeya/runeya/compare/v1.17.28...v1.17.29) (2024-02-15)

**Note:** Version bump only for package @runeya/modules-plugins-loader-front

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

### Bug Fixes

* **server:** resolve dependencies ([7a15ef0](https://github.com/runeya/runeya/commit/7a15ef01ba9946fb2662c0f15a6da758f0c40280))

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

### Bug Fixes

* add link to runeya help ([62c1d4e](https://github.com/runeya/runeya/commit/62c1d4e07455759e6468133b2ee7fa4ed1cb8cb6))

## [1.17.24](https://github.com/runeya/runeya/compare/v1.17.23...v1.17.24) (2024-02-11)

### Bug Fixes

* link front to backend deps ([351abfd](https://github.com/runeya/runeya/commit/351abfd8f8cde96bce80d5202a78dd1daabbf6bb))

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

### Bug Fixes

* link front to backend deps ([66b3135](https://github.com/runeya/runeya/commit/66b313523d99765b692208de0043303dcb6a0914))
* link front to backend deps ([54fcbf3](https://github.com/runeya/runeya/commit/54fcbf371cf03dc4f51a7196de15fe5d352088e9))

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

### Bug Fixes

* link front to backend deps ([91b2dce](https://github.com/runeya/runeya/commit/91b2dcefddc5d51520f7cd8ec31b4289461a9077))

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* no cyclic dependencies ([496f153](https://github.com/runeya/runeya/commit/496f153c9492fc25873f1498a0b1f22556601eed))
* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.15](https://github.com/runeya/runeya/compare/v1.17.14...v1.17.15) (2024-02-07)

**Note:** Version bump only for package @runeya/modules-plugins-loader

## [1.17.14](https://github.com/runeya/runeya/compare/v1.17.13...v1.17.14) (2024-02-05)

**Note:** Version bump only for package @runeya/modules-plugins-loader

## [1.17.13](https://github.com/runeya/runeya/compare/v1.17.12...v1.17.13) (2024-02-05)

**Note:** Version bump only for package @runeya/modules-plugins-loader

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/regex/backend/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.1.1](https://github.com/runeya/runeya/compare/v2.1.0...v2.1.1) (2025-02-11)

**Note:** Version bump only for package @runeya/modules-regex-backend

# [2.1.0](https://github.com/runeya/runeya/compare/v2.0.17...v2.1.0) (2025-01-31)

**Note:** Version bump only for package @runeya/modules-regex-backend

## [2.0.17](https://github.com/runeya/runeya/compare/v2.0.16...v2.0.17) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-regex-backend

## [2.0.16](https://github.com/runeya/runeya/compare/v2.0.15...v2.0.16) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-regex-backend

## [2.0.15](https://github.com/runeya/runeya/compare/v2.0.14...v2.0.15) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-regex-backend

## [2.0.14](https://github.com/runeya/runeya/compare/v2.0.13...v2.0.14) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-regex-backend

## [2.0.13](https://github.com/runeya/runeya/compare/v2.0.12...v2.0.13) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-regex-backend

## [2.0.12](https://github.com/runeya/runeya/compare/v2.0.11...v2.0.12) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-regex-backend

## [2.0.8](https://github.com/runeya/runeya/compare/v2.0.7...v2.0.8) (2025-01-13)

**Note:** Version bump only for package @runeya/modules-regex-backend

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

## [2.0.1](https://github.com/runeya/runeya/compare/v2.0.0...v2.0.1) (2024-12-25)

**Note:** Version bump only for package @runeya/modules-regex-backend

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-regex-backend

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

**Note:** Version bump only for package @runeya/modules-regex-backend

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

**Note:** Version bump only for package @runeya/modules-regex-backend

## [1.18.6](https://github.com/runeya/runeya/compare/v1.18.5...v1.18.6) (2024-02-25)

**Note:** Version bump only for package @runeya/modules-regex-backend

## [1.18.2](https://github.com/runeya/runeya/compare/v1.18.1...v1.18.2) (2024-02-24)

**Note:** Version bump only for package @runeya/modules-regex-backend

## [1.18.1](https://github.com/runeya/runeya/compare/v1.18.0...v1.18.1) (2024-02-20)

**Note:** Version bump only for package @runeya/modules-regex-backend

# [1.18.0](https://github.com/runeya/runeya/compare/v1.17.30...v1.18.0) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-regex-backend

## [1.17.30](https://github.com/runeya/runeya/compare/v1.17.29...v1.17.30) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-regex-backend

## [1.17.29](https://github.com/runeya/runeya/compare/v1.17.28...v1.17.29) (2024-02-15)

**Note:** Version bump only for package @runeya/modules-regex-backend

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

**Note:** Version bump only for package @runeya/modules-regex-backend

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

**Note:** Version bump only for package @runeya/modules-regex-backend

## [1.17.24](https://github.com/runeya/runeya/compare/v1.17.23...v1.17.24) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-regex-backend

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-regex-backend

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-regex-backend

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.15](https://github.com/runeya/runeya/compare/v1.17.14...v1.17.15) (2024-02-07)

### Bug Fixes

* **logs:** fix json load on ui ([bae5dd8](https://github.com/runeya/runeya/commit/bae5dd829faf72d59215a3a9941155af6413a3eb))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/regex/backend/package.json">
{
  "name": "@runeya/modules-regex-backend",
  "version": "2.1.1",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "@runeya/modules-plugins-loader-front": "workspace:*"
  }
}
</file>

<file path="modules/toolbox/backend/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.1.1](https://github.com/runeya/runeya/compare/v2.1.0...v2.1.1) (2025-02-11)

**Note:** Version bump only for package @runeya/modules-toolbox-backend

# [2.1.0](https://github.com/runeya/runeya/compare/v2.0.17...v2.1.0) (2025-01-31)

**Note:** Version bump only for package @runeya/modules-toolbox-backend

## [2.0.17](https://github.com/runeya/runeya/compare/v2.0.16...v2.0.17) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-toolbox-backend

## [2.0.16](https://github.com/runeya/runeya/compare/v2.0.15...v2.0.16) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-toolbox-backend

## [2.0.15](https://github.com/runeya/runeya/compare/v2.0.14...v2.0.15) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-toolbox-backend

## [2.0.14](https://github.com/runeya/runeya/compare/v2.0.13...v2.0.14) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-toolbox-backend

## [2.0.13](https://github.com/runeya/runeya/compare/v2.0.12...v2.0.13) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-toolbox-backend

## [2.0.12](https://github.com/runeya/runeya/compare/v2.0.11...v2.0.12) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-toolbox-backend

## [2.0.8](https://github.com/runeya/runeya/compare/v2.0.7...v2.0.8) (2025-01-13)

**Note:** Version bump only for package @runeya/modules-toolbox-backend

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

## [2.0.1](https://github.com/runeya/runeya/compare/v2.0.0...v2.0.1) (2024-12-25)

**Note:** Version bump only for package @runeya/modules-toolbox-backend

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-toolbox-backend

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

**Note:** Version bump only for package @runeya/modules-toolbox-backend

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

**Note:** Version bump only for package @runeya/modules-toolbox-backend

## [1.18.6](https://github.com/runeya/runeya/compare/v1.18.5...v1.18.6) (2024-02-25)

**Note:** Version bump only for package @runeya/modules-toolbox-backend

## [1.18.2](https://github.com/runeya/runeya/compare/v1.18.1...v1.18.2) (2024-02-24)

**Note:** Version bump only for package @runeya/modules-toolbox-backend

## [1.18.1](https://github.com/runeya/runeya/compare/v1.18.0...v1.18.1) (2024-02-20)

**Note:** Version bump only for package @runeya/modules-toolbox-backend

# [1.18.0](https://github.com/runeya/runeya/compare/v1.17.30...v1.18.0) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-toolbox-backend

## [1.17.30](https://github.com/runeya/runeya/compare/v1.17.29...v1.17.30) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-toolbox-backend

## [1.17.29](https://github.com/runeya/runeya/compare/v1.17.28...v1.17.29) (2024-02-15)

**Note:** Version bump only for package @runeya/modules-toolbox-backend

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

**Note:** Version bump only for package @runeya/modules-toolbox-backend

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

**Note:** Version bump only for package @runeya/modules-toolbox-backend

## [1.17.24](https://github.com/runeya/runeya/compare/v1.17.23...v1.17.24) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-toolbox-backend

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-toolbox-backend

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-toolbox-backend

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/toolbox/backend/package.json">
{
  "name": "@runeya/modules-toolbox-backend",
  "version": "2.1.1",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "@runeya/modules-plugins-loader-front": "workspace:*"
  }
}
</file>

<file path="modules/uuid/backend/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.1.1](https://github.com/runeya/runeya/compare/v2.1.0...v2.1.1) (2025-02-11)

**Note:** Version bump only for package @runeya/modules-uuid-backend

# [2.1.0](https://github.com/runeya/runeya/compare/v2.0.17...v2.1.0) (2025-01-31)

**Note:** Version bump only for package @runeya/modules-uuid-backend

## [2.0.17](https://github.com/runeya/runeya/compare/v2.0.16...v2.0.17) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-uuid-backend

## [2.0.16](https://github.com/runeya/runeya/compare/v2.0.15...v2.0.16) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-uuid-backend

## [2.0.15](https://github.com/runeya/runeya/compare/v2.0.14...v2.0.15) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-uuid-backend

## [2.0.14](https://github.com/runeya/runeya/compare/v2.0.13...v2.0.14) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-uuid-backend

## [2.0.13](https://github.com/runeya/runeya/compare/v2.0.12...v2.0.13) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-uuid-backend

## [2.0.12](https://github.com/runeya/runeya/compare/v2.0.11...v2.0.12) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-uuid-backend

## [2.0.8](https://github.com/runeya/runeya/compare/v2.0.7...v2.0.8) (2025-01-13)

**Note:** Version bump only for package @runeya/modules-uuid-backend

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

## [2.0.1](https://github.com/runeya/runeya/compare/v2.0.0...v2.0.1) (2024-12-25)

**Note:** Version bump only for package @runeya/modules-uuid-backend

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-uuid-backend

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

**Note:** Version bump only for package @runeya/modules-uuid-backend

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

**Note:** Version bump only for package @runeya/modules-uuid-backend

## [1.18.6](https://github.com/runeya/runeya/compare/v1.18.5...v1.18.6) (2024-02-25)

**Note:** Version bump only for package @runeya/modules-uuid-backend

## [1.18.2](https://github.com/runeya/runeya/compare/v1.18.1...v1.18.2) (2024-02-24)

**Note:** Version bump only for package @runeya/modules-uuid-backend

## [1.18.1](https://github.com/runeya/runeya/compare/v1.18.0...v1.18.1) (2024-02-20)

**Note:** Version bump only for package @runeya/modules-uuid-backend

# [1.18.0](https://github.com/runeya/runeya/compare/v1.17.30...v1.18.0) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-uuid-backend

## [1.17.30](https://github.com/runeya/runeya/compare/v1.17.29...v1.17.30) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-uuid-backend

## [1.17.29](https://github.com/runeya/runeya/compare/v1.17.28...v1.17.29) (2024-02-15)

**Note:** Version bump only for package @runeya/modules-uuid-backend

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

**Note:** Version bump only for package @runeya/modules-uuid-backend

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

**Note:** Version bump only for package @runeya/modules-uuid-backend

## [1.17.24](https://github.com/runeya/runeya/compare/v1.17.23...v1.17.24) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-uuid-backend

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-uuid-backend

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-uuid-backend

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* build for npm ([0c07b41](https://github.com/runeya/runeya/commit/0c07b410a237412c1c73bbb42fe45c1f9c220482))
* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="modules/uuid/backend/package.json">
{
  "name": "@runeya/modules-uuid-backend",
  "version": "2.1.1",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "@runeya/modules-plugins-loader-front": "workspace:*",
    "@types/express": "^4.17.21",
    "@types/uuid": "^9.0.8"
  },
  "dependencies": {
    "express": "^4.18.2",
    "uuid": "^9.0.1"
  }
}
</file>

<file path="modules/bugs/backend/package.json">
{
  "name": "@runeya/modules-bugs-backend",
  "version": "2.1.1",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "@runeya/modules-plugins-loader-front": "workspace:*",
    "@types/express": "^4.17.21",
    "typescript": "^5.3.3"
  },
  "dependencies": {
    "express": "^4.18.2"
  }
}
</file>

<file path="modules/documentation/backend/package.json">
{
  "name": "@runeya/modules-documentation-backend",
  "version": "2.1.1",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "@runeya/modules-plugins-loader-front": "workspace:*",
    "@types/bluebird": "^3.5.38",
    "@types/express": "^4.17.21",
    "@types/uuid": "^9.0.8"
  },
  "dependencies": {
    "bluebird": "^3.7.2",
    "express": "^4.18.2",
    "uuid": "^9.0.1"
  }
}
</file>

<file path="modules/finder/backend/package.json">
{
  "name": "@runeya/modules-finder-backend",
  "version": "2.1.1",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "@runeya/modules-plugins-loader-front": "workspace:*",
    "@types/bluebird": "^3.5.38",
    "@types/command-exists": "^1.2.3",
    "@types/express": "^4.17.21"
  },
  "dependencies": {
    "bluebird": "^3.7.2",
    "command-exists": "^1.2.9",
    "express": "^4.18.2"
  }
}
</file>

<file path="modules/github/backend/package.json">
{
  "name": "@runeya/modules-github-backend",
  "version": "2.1.1",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "@runeya/modules-plugins-loader-front": "workspace:*",
    "@types/express": "^4.17.21"
  },
  "dependencies": {
    "express": "^4.18.2",
    "fix-esm": "^1.0.1"
  }
}
</file>

<file path="modules/global-scripts/backend/package.json">
{
  "name": "@runeya/modules-global-scripts-backend",
  "version": "2.1.1",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "@runeya/modules-plugins-loader-front": "workspace:*",
    "@types/express": "^4.17.21",
    "@types/uuid": "^9.0.8"
  },
  "dependencies": {
    "express": "^4.18.2",
    "uuid": "^9.0.1"
  }
}
</file>

<file path="modules/node-repl/backend/package.json">
{
  "name": "@runeya/modules-node-repl-backend",
  "version": "2.1.1",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "@runeya/modules-plugins-loader-front": "workspace:*",
    "@types/express": "^4.17.21",
    "@types/uuid": "^9.0.8"
  },
  "dependencies": {
    "express": "^4.18.2",
    "uuid": "^9.0.1"
  }
}
</file>

<file path="modules/npm/backend/package.json">
{
  "name": "@runeya/modules-npm-backend",
  "version": "2.1.1",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "peerDependencies": {
    "@runeya/servers-server": "workspace:*"
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "@runeya/modules-plugins-loader-front": "workspace:*",
    "@types/express": "^4.17.21"
  },
  "dependencies": {
    "express": "^4.18.2"
  }
}
</file>

<file path="modules/openapi/backend/package.json">
{
  "name": "@runeya/modules-openapi-backend",
  "version": "2.1.1",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "dependencies": {
    "axios": "^1.7.9",
    "express": "^4.18.2"
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "@runeya/modules-plugins-loader-front": "workspace:*"
  }
}
</file>

<file path="modules/vscode/backend/package.json">
{
  "name": "@runeya/modules-vscode-backend",
  "version": "2.1.1",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "@runeya/modules-plugins-loader-front": "workspace:*",
    "@types/bluebird": "^3.5.38",
    "@types/express": "^4.17.21",
    "vue-router": "^4.2.5"
  },
  "dependencies": {
    "bluebird": "^3.7.2",
    "command-exists": "^1.2.9",
    "express": "^4.18.2",
    "open": "^8",
    "workspace-tools": "^0.36.4"
  }
}
</file>

<file path="fronts/app/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.1.1](https://github.com/runeya/runeya/compare/v2.1.0...v2.1.1) (2025-02-11)

### Bug Fixes

* improve code health ([865b996](https://github.com/runeya/runeya/commit/865b996fa0adcf49668fa770c465bac1f1d8f21a))

# [2.1.0](https://github.com/runeya/runeya/compare/v2.0.17...v2.1.0) (2025-01-31)

### Features

* **nodered:** add nodered into app ([f897eb2](https://github.com/runeya/runeya/commit/f897eb2c4a9128e0d4615f6765d3ef0ce1d2ca3e))

## [2.0.17](https://github.com/runeya/runeya/compare/v2.0.16...v2.0.17) (2025-01-24)

**Note:** Version bump only for package @runeya/fronts-app

## [2.0.16](https://github.com/runeya/runeya/compare/v2.0.15...v2.0.16) (2025-01-24)

**Note:** Version bump only for package @runeya/fronts-app

## [2.0.15](https://github.com/runeya/runeya/compare/v2.0.14...v2.0.15) (2025-01-24)

### Bug Fixes

* **Npm:** support for new command selector ([edfbb76](https://github.com/runeya/runeya/commit/edfbb76cfddec911a210f5be9554e497c60f92fb))

## [2.0.14](https://github.com/runeya/runeya/compare/v2.0.13...v2.0.14) (2025-01-24)

**Note:** Version bump only for package @runeya/fronts-app

## [2.0.13](https://github.com/runeya/runeya/compare/v2.0.12...v2.0.13) (2025-01-24)

**Note:** Version bump only for package @runeya/fronts-app

## [2.0.12](https://github.com/runeya/runeya/compare/v2.0.11...v2.0.12) (2025-01-24)

### Bug Fixes

* **editor:** disable for stackmultiple ([ae4735f](https://github.com/runeya/runeya/commit/ae4735f27d3a443da4eedf11d6688ce8e9b6bc79))
* **editor:** fix a reactive problem ([b292771](https://github.com/runeya/runeya/commit/b292771896ea9c37bcf03f4bbf0fd53d6819c718))
* **editors:** can choose an editor by services ([0807227](https://github.com/runeya/runeya/commit/08072273fa2b3a7c3b133baddb2983771b68063c))
* **notifications:** can mute channel error from each command in settings ([ede9be5](https://github.com/runeya/runeya/commit/ede9be5f819d13364e2e96503e3ee70cdcf5181b))
* reenable documentation and improve global git view ([2e4dd75](https://github.com/runeya/runeya/commit/2e4dd75c0513d92f12b8303b3dddd2f2fa6ccc73))
* **stack-multiple:** resolve wrong tabs height ([32fcb7f](https://github.com/runeya/runeya/commit/32fcb7fac9c4ef464d13bcb9cfdc34bb7c480597))

## [2.0.8](https://github.com/runeya/runeya/compare/v2.0.7...v2.0.8) (2025-01-13)

### Bug Fixes

* documentation + various bugfixes ([bddd9f6](https://github.com/runeya/runeya/commit/bddd9f6a5507a5a45ea2e54d0fe836e1e518c820))

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* attach heritage to environment instead of service + various fixes ([4647010](https://github.com/runeya/runeya/commit/4647010eadbf3370155faca171a0b10caea32baf))
* remove some dependencies ([5667402](https://github.com/runeya/runeya/commit/5667402d57add874a89ba029ce62b16b3bbed9e0))
* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

## [2.0.1](https://github.com/runeya/runeya/compare/v2.0.0...v2.0.1) (2024-12-25)

### Bug Fixes

* **env_vars:** fix reactivity ([12f7180](https://github.com/runeya/runeya/commit/12f718070723d79e1adef9050894c131ec6343f9))
* various fixes ([18129e9](https://github.com/runeya/runeya/commit/18129e96f7c92a69176d6a75add45f3a48ab11ae))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

* feat!: migrate runeya to entire UI ([e173073](https://github.com/runeya/runeya/commit/e173073d932be7e400b1f51261c090116e8fb543))

### BREAKING CHANGES

* all stack files are useless now

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

### Bug Fixes

* improve performance + add jsoncrack view ([c534a97](https://github.com/runeya/runeya/commit/c534a9749162f5f15589ec335da149656c757bfb))

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

### Bug Fixes

* **devcontainer:** add container support ([f2559fb](https://github.com/runeya/runeya/commit/f2559fb90bba3de5fcfef2c95dd45826358b7ad4))
* **docker:** add docker support ([f3abb42](https://github.com/runeya/runeya/commit/f3abb4237b8f708585769a8ff51c393d5f21dc5c))
* resolve issues for permission on docker volumes + cosmetic changes ([7a822cd](https://github.com/runeya/runeya/commit/7a822cd1c205e5808247075828c1d3ce49d1524b))
* **stackchooser:** redirect to the first launched service ([aa53535](https://github.com/runeya/runeya/commit/aa53535c16a4ae729d33fe3017c589e1f69e7ce5))

## [1.18.6](https://github.com/runeya/runeya/compare/v1.18.5...v1.18.6) (2024-02-25)

### Bug Fixes

* cosmetic changes ([87429f3](https://github.com/runeya/runeya/commit/87429f37a57d83f5d568fa4df13cb75e9e4145d1))

## [1.18.4](https://github.com/runeya/runeya/compare/v1.18.3...v1.18.4) (2024-02-24)

### Bug Fixes

* **front:** fix proxy url in production mode ([444f15b](https://github.com/runeya/runeya/commit/444f15be4f83145831f7bc653b09d54ef37f332b))

## [1.18.3](https://github.com/runeya/runeya/compare/v1.18.2...v1.18.3) (2024-02-24)

### Bug Fixes

* **front:** proxy image to prevent cors + close theme at startup ([cdebdf4](https://github.com/runeya/runeya/commit/cdebdf4d878acdcd4c71b39f45df7353acf86a9b))

## [1.18.2](https://github.com/runeya/runeya/compare/v1.18.1...v1.18.2) (2024-02-24)

### Bug Fixes

* **extension:** create vscodeextension ([dfb2589](https://github.com/runeya/runeya/commit/dfb258912ca717cca9b2dc857c2774bfddd59251))
* **front:** cosmetic changes ([ff9b282](https://github.com/runeya/runeya/commit/ff9b2821de658eae571a1da4407ec0651a102e15))

## [1.18.1](https://github.com/runeya/runeya/compare/v1.18.0...v1.18.1) (2024-02-20)

### Bug Fixes

* **theme:** cosmetic changes ([0da5cee](https://github.com/runeya/runeya/commit/0da5cee3b358d85bdc9c0fdf4907d7cd9b249e4a))

# [1.18.0](https://github.com/runeya/runeya/compare/v1.17.30...v1.18.0) (2024-02-19)

### Features

* **swagger:** can read an opoenapi url from service ([481b543](https://github.com/runeya/runeya/commit/481b54305b2606f6f360287b17a4b4270a99eb3d))

## [1.17.30](https://github.com/runeya/runeya/compare/v1.17.29...v1.17.30) (2024-02-19)

### Bug Fixes

* **documentation:** add a global documentation ([0ef6b0f](https://github.com/runeya/runeya/commit/0ef6b0f15760d06380e9d7df3fc9c3a0393305d5))

## [1.17.29](https://github.com/runeya/runeya/compare/v1.17.28...v1.17.29) (2024-02-15)

### Bug Fixes

* **theme:** add black theme ([bee4697](https://github.com/runeya/runeya/commit/bee469731be182ac929298dc13fe1c230eccb7ba))

## [1.17.28](https://github.com/runeya/runeya/compare/v1.17.27...v1.17.28) (2024-02-14)

### Bug Fixes

* **front:** fix cors policy ([2ee35e1](https://github.com/runeya/runeya/commit/2ee35e1178c07507c1ca49b1a2db4f5c17755b58))

## [1.17.27](https://github.com/runeya/runeya/compare/v1.17.26...v1.17.27) (2024-02-14)

### Bug Fixes

* **front:** change icon ([b012ab7](https://github.com/runeya/runeya/commit/b012ab7dea9dde695cbfd95b2f4dbc446211db0a))

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

### Bug Fixes

* **server:** healthcheck working ([13d2960](https://github.com/runeya/runeya/commit/13d2960ffa5125aff7792d95a9306fe6e04d2889))
* **server:** resolve dependencies ([7a15ef0](https://github.com/runeya/runeya/commit/7a15ef01ba9946fb2662c0f15a6da758f0c40280))
* various changes ([06e6241](https://github.com/runeya/runeya/commit/06e624176595b95c4227fe684242919c7eeda192))

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

### Bug Fixes

* cosmetic changes ([a18735e](https://github.com/runeya/runeya/commit/a18735e5b5cec706f3cdf4c4f4ca22482ce7ea0f))

## [1.17.24](https://github.com/runeya/runeya/compare/v1.17.23...v1.17.24) (2024-02-11)

**Note:** Version bump only for package @runeya/fronts-app

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

**Note:** Version bump only for package @runeya/fronts-app

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/fronts-app

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* no cyclic dependencies ([496f153](https://github.com/runeya/runeya/commit/496f153c9492fc25873f1498a0b1f22556601eed))
* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.15](https://github.com/runeya/runeya/compare/v1.17.14...v1.17.15) (2024-02-07)

**Note:** Version bump only for package @runeya/fronts-app

## [1.17.14](https://github.com/runeya/runeya/compare/v1.17.13...v1.17.14) (2024-02-05)

### Bug Fixes

* **front:** can edit markdown and migrate away from vue markdown ([ef11ae3](https://github.com/runeya/runeya/commit/ef11ae39ee563ee6af4b2bc6f916f4c4705287dd))
* **front:** fix drag n drop ([39f5d4b](https://github.com/runeya/runeya/commit/39f5d4b2c9d69500402a8cf76e373836c5e9b596))

## [1.17.13](https://github.com/runeya/runeya/compare/v1.17.12...v1.17.13) (2024-02-05)

**Note:** Version bump only for package @runeya/fronts-app

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))

## [1.17.10](https://github.com/runeya/runeya/compare/v1.17.9...v1.17.10) (2024-02-04)

**Note:** Version bump only for package @runeya/fronts-app

## [1.17.9](https://github.com/runeya/runeya/compare/v1.17.8...v1.17.9) (2024-02-04)

**Note:** Version bump only for package @runeya/fronts-app

## [1.17.8](https://github.com/runeya/runeya/compare/v1.17.7...v1.17.8) (2024-02-04)

**Note:** Version bump only for package @runeya/fronts-app

## [1.17.7](https://github.com/runeya/runeya/compare/v1.17.6...v1.17.7) (2024-02-04)

**Note:** Version bump only for package @runeya/fronts-app

## [1.17.6](https://github.com/runeya/runeya/compare/v1.17.5...v1.17.6) (2024-02-04)

**Note:** Version bump only for package @runeya/fronts-app

## [1.17.5](https://github.com/runeya/runeya/compare/v1.17.4...v1.17.5) (2024-02-04)

**Note:** Version bump only for package @runeya/fronts-app

## [1.17.4](https://github.com/runeya/runeya/compare/v1.17.3...v1.17.4) (2024-02-04)

**Note:** Version bump only for package @runeya/fronts-app

## [1.17.3](https://github.com/runeya/runeya/compare/v1.11.23...v1.17.3) (2024-02-04)

**Note:** Version bump only for package @runeya/fronts-app
</file>

<file path="modules/openai/backend/package.json">
{
  "name": "@runeya/modules-openai-backend",
  "version": "2.1.1",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "@runeya/modules-plugins-loader-front": "workspace:*",
    "@types/express": "^4.17.21",
    "@types/uuid": "^9.0.8"
  },
  "dependencies": {
    "axios": "^1.7.9",
    "bluebird": "^3.7.2",
    "express": "^4.18.2",
    "gpt-3-encoder": "^1.1.4",
    "openai": "^4.26.1",
    "uuid": "^9.0.1"
  }
}
</file>

<file path="modules/plugins-loader/backend/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.1.4](https://github.com/runeya/runeya/compare/v2.1.3...v2.1.4) (2025-03-16)

**Note:** Version bump only for package @runeya/modules-plugins-loader-backend

## [2.1.3](https://github.com/runeya/runeya/compare/v2.1.2...v2.1.3) (2025-03-05)

**Note:** Version bump only for package @runeya/modules-plugins-loader-backend

## [2.1.2](https://github.com/runeya/runeya/compare/v2.1.1...v2.1.2) (2025-03-05)

**Note:** Version bump only for package @runeya/modules-plugins-loader-backend

## [2.1.1](https://github.com/runeya/runeya/compare/v2.1.0...v2.1.1) (2025-02-11)

**Note:** Version bump only for package @runeya/modules-plugins-loader-backend

# [2.1.0](https://github.com/runeya/runeya/compare/v2.0.17...v2.1.0) (2025-01-31)

### Features

* **nodered:** add nodered into app ([f897eb2](https://github.com/runeya/runeya/commit/f897eb2c4a9128e0d4615f6765d3ef0ce1d2ca3e))

## [2.0.17](https://github.com/runeya/runeya/compare/v2.0.16...v2.0.17) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-plugins-loader-backend

## [2.0.16](https://github.com/runeya/runeya/compare/v2.0.15...v2.0.16) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-plugins-loader-backend

## [2.0.15](https://github.com/runeya/runeya/compare/v2.0.14...v2.0.15) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-plugins-loader-backend

## [2.0.14](https://github.com/runeya/runeya/compare/v2.0.13...v2.0.14) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-plugins-loader-backend

## [2.0.13](https://github.com/runeya/runeya/compare/v2.0.12...v2.0.13) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-plugins-loader-backend

## [2.0.12](https://github.com/runeya/runeya/compare/v2.0.11...v2.0.12) (2025-01-24)

**Note:** Version bump only for package @runeya/modules-plugins-loader-backend

## [2.0.8](https://github.com/runeya/runeya/compare/v2.0.7...v2.0.8) (2025-01-13)

**Note:** Version bump only for package @runeya/modules-plugins-loader-backend

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

## [2.0.1](https://github.com/runeya/runeya/compare/v2.0.0...v2.0.1) (2024-12-25)

**Note:** Version bump only for package @runeya/modules-plugins-loader-backend

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

**Note:** Version bump only for package @runeya/modules-plugins-loader-backend

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

**Note:** Version bump only for package @runeya/modules-plugins-loader-backend

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

### Bug Fixes

* resolve issues for permission on docker volumes + cosmetic changes ([7a822cd](https://github.com/runeya/runeya/commit/7a822cd1c205e5808247075828c1d3ce49d1524b))

## [1.18.6](https://github.com/runeya/runeya/compare/v1.18.5...v1.18.6) (2024-02-25)

**Note:** Version bump only for package @runeya/modules-plugins-loader-backend

## [1.18.2](https://github.com/runeya/runeya/compare/v1.18.1...v1.18.2) (2024-02-24)

### Bug Fixes

* **extension:** create vscodeextension ([dfb2589](https://github.com/runeya/runeya/commit/dfb258912ca717cca9b2dc857c2774bfddd59251))

## [1.18.1](https://github.com/runeya/runeya/compare/v1.18.0...v1.18.1) (2024-02-20)

**Note:** Version bump only for package @runeya/modules-plugins-loader-backend

# [1.18.0](https://github.com/runeya/runeya/compare/v1.17.30...v1.18.0) (2024-02-19)

### Features

* **swagger:** can read an opoenapi url from service ([481b543](https://github.com/runeya/runeya/commit/481b54305b2606f6f360287b17a4b4270a99eb3d))

## [1.17.30](https://github.com/runeya/runeya/compare/v1.17.29...v1.17.30) (2024-02-19)

**Note:** Version bump only for package @runeya/modules-plugins-loader-backend

## [1.17.29](https://github.com/runeya/runeya/compare/v1.17.28...v1.17.29) (2024-02-15)

**Note:** Version bump only for package @runeya/modules-plugins-loader-backend

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

**Note:** Version bump only for package @runeya/modules-plugins-loader-backend

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

### Bug Fixes

* add link to runeya help ([62c1d4e](https://github.com/runeya/runeya/commit/62c1d4e07455759e6468133b2ee7fa4ed1cb8cb6))

## [1.17.24](https://github.com/runeya/runeya/compare/v1.17.23...v1.17.24) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-plugins-loader-backend

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

### Bug Fixes

* link front to backend deps ([66b3135](https://github.com/runeya/runeya/commit/66b313523d99765b692208de0043303dcb6a0914))

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/modules-plugins-loader-backend

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* build for npm ([0c07b41](https://github.com/runeya/runeya/commit/0c07b410a237412c1c73bbb42fe45c1f9c220482))
* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.14](https://github.com/runeya/runeya/compare/v1.17.13...v1.17.14) (2024-02-05)

**Note:** Version bump only for package @runeya/modules-plugins-loader

## [1.17.13](https://github.com/runeya/runeya/compare/v1.17.12...v1.17.13) (2024-02-05)

**Note:** Version bump only for package @runeya/modules-plugins-loader

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))
</file>

<file path="servers/server/models/Service.js">
/* eslint-disable func-names */
/// <reference path="@runeya/common-typings.d.ts">
const os = require('os');
const { spawn } = require('child_process');
const killport = require('kill-port');
const URL = require('url');
const path = require('path');
const PromiseB = require('bluebird');
const dayjs = require('dayjs');
const { v4 } = require('uuid');
const { existsSync, readFileSync } = require('fs');
const kill = require('tree-kill');
const axios = require('axios').default;
const pathfs = require('path');
const net = require('net');
// eslint-disable-next-line import/no-extraneous-dependencies
const { sockets } = require('@runeya/common-socket-server');
const { mkdir, writeFile } = require('fs/promises');
const { cloneDeep, over } = require('lodash');
const CreateInterface = require('../helpers/readline');
const { stripAnsi, ansiconvert, unescapeAnsi } = require('../helpers/ansiconvert');
const isWindows = require('../helpers/isWindows');
const { execAsync } = require('../helpers/exec');
const { humanStringToKey, replaceEnvs } = require('../helpers/stringTransformer.helper');
const dbs = require('../helpers/dbs');
const Environment = require('./Environment');
const ParserModel = require('./Parser');

const userInfo = os.userInfo();
const { gid, uid, username } = userInfo;

/** @type {Record<string, {cmd: string, args: string[]}>} */
const alias = {
  ls: { cmd: 'ls', args: ['--color=force'] },
  gco: { cmd: 'git', args: ['checkout'] },
};

/**
 * @param {import('@runeya/common-typings').NonFunctionProperties<Service>} service
 * @param {import('./stack')} Stack
 */
function Service(service, Stack, { isUpdate } = { isUpdate: false }) {
  return (async () => {
    this.Stack = Stack;
    /** @type {LogMessage[]} */
    this.queue = service.queue || [];
    this.stopQueue = false
    if (!isUpdate) {
      this.processQueue()
    }
    /** @type {string} */
    this.label = service.label || '';
    /** @type {string} */
    this.description = service.description || '';
    /**
     * @type {{
     *  home: string,
     *  remote: string,
     * }}
     * */
    this.git = {
      home: service.git?.home || '',
      remote: service.git?.remote || '',
    };
    /** @type {string} */
    this.documentation = service.documentation || '';
    /** @type {string} */
    this.openapiURL = service.openapiURL || '';
    /** @type {string} */
    this.url = service.url || '';
    /** @type {string} */
    this.rootPath = service.rootPath || '.';
    /** @type {string[]} */
    this.urls = service.urls || [];
    /** @type {string[]} */
    this.groups = service.groups || [];
    /** @type {string[]} */
    this.parsers = service.parsers || [
      'runeya-parser-debug',
      'runeya-parser-jsons',
      'runeya-parser-links',
    ];
    /** @type {boolean} */
    this.enabled = service.enabled || false;
    /** @type {boolean} */
    this.crashed = service.crashed || false;
    /**
     * @type {{
     *  enabled: boolean
     *  name: string,
     *  user?: string,
     *  build: string,
     *  volumes: string[],
     *  ignoreVolumes: string[],
     *  sharedVolume: string,
     *  ports: string[],
     *  noHostUser: true
     *  noChangeWorkDir: true,
     *  customPid?: ({cmd, args, pid})=> Promise<number | null>
     *  bootstrap: {commands: Array<{user: string, cmd: string, entrypoint:string}>}
     * }}
     */
    // @ts-ignore
    this.container = service.container || {};
    if (this.container) {
      this.container.name = humanStringToKey(this.label);
      if (!this.container.volumes?.length) this.container.volumes = [];
      if (!this.container.build) this.container.build = '';
      this.container.ports = this.container.ports || [];
      this.container.sharedVolume = this.container.sharedVolume || '~/.runeya';
      this.container.ignoreVolumes = this.container.ignoreVolumes?.length
        ? this.container.ignoreVolumes.filter((f) => !f.startsWith(this.container?.sharedVolume || ''))
        : [];
      if (!this.container.bootstrap) this.container.bootstrap = { commands: [] };
      if (!this.container.bootstrap.commands) this.container.bootstrap.commands = [];
    }
    /** @type {boolean} */
    this.exited = service.exited || false;
    /** @type {{[key:string]: {[key:string]: {value: string, override: string, systemOverride?: string, prefix?: string, suffix?: string}}}} */
    this.envs = service.envs || {}
    /**
     * @type {{
     *  id: string,
     *  spawnArgs: string[],
     *  spawnCmd: string,
     *  spawnOptions: SpawnOptions
     *  effectiveParsers: ParserModel[]
     *  parsers: string[]
     * }[]}
     * */
    this.commands = service.commands || [];
    /**
     * @type {{
     *  id: string,
     *  spawnArgs: string[],
     *  spawnCmd: string,
     *  spawnOptions: SpawnOptions
     *  effectiveParsers: ParserModel[]
     *  parsers: string[]
     * }[]}
     * */
    this.shortcuts = service.shortcuts || [];
    /** @type {LogMessage[]} */
    this.store = service.store || [];
    /** @type {import('child_process').ChildProcess[]} */
    this.pids = service.pids || [];
    /** @type {number | null} */
    this.lastDatePrinted = service.lastDatePrinted || null;

    /**
     * @type {{
     *  enabled: boolean,
     *  url: string,
     *  interval: string,
     *  method: 'GET' | 'POST' | 'PATCH' | 'PUT' | 'DELETE'
     *  returnCode: number,
     *  responseText: string,
     *  timeout: number,
     *  startAfter: number
     * }}
     * */
    this.health = service.health || {
      enabled: false,
      url: '',
      interval: '',
      method: 'GET',
      returnCode: 200,
      responseText: '',
      timeout: 0,
      startAfter: 0,
    };
    const environments = await Environment.all();
    const overrides = await dbs.getDb(`overrides/${this.label}-envs`).read();
    // Load variables from db and envs
    if (!isUpdate) {
      environments.forEach((environment) => {
        const envs = this.envs[environment.label] || {}
        Object.keys(envs).forEach((key) => {
          const env = envs[key] 
          const override = overrides[environment.label]?.[key];
          if (!env || !override) return
          envs[key].override = override
        });
      });
    }
    /** @type {Record<string, string>} */
    this.meta = service.meta || {};
    await PromiseB.map(this.commands || [], async (command) => {
      // @ts-ignore
      command.effectiveParsers = await PromiseB.map([
        ...(this.parsers || []),
        ...(command.parsers || []),
      ], (parserId) => ParserModel.find(parserId)).filter((a) => !!a);
    });
    return this;
  })();
}
Service.prototype.getRootPath = function () {
  return replaceEnvs(this.rootPath);
};

Service.prototype.processQueue = function() {
  if (this.queue.length) {
    const messages = this.queue.splice(0, this.queue.length);
    sockets.emit('logs:update', messages);
  }
  if(this.stopQueue) return
  setTimeout(() => {this.processQueue()}, 100);
}

Service.prototype.save = async function () {
  const obj = this.toStorage();
  const overrides = {};
  await PromiseB.map(Object.keys(obj.envs), (environmentLabel) => {
    if (!overrides[environmentLabel]) overrides[environmentLabel] = {};
    Object.keys(obj.envs[environmentLabel]).forEach((key) => {
      const env = obj.envs[environmentLabel][key]
      overrides[environmentLabel][key] = env.override;
      delete env.systemOverride;
      delete env.override;
    });
  });
  await dbs.getDb(`overrides/${this.label}-envs`).write(overrides);
  await dbs.getDb(`services/${this.label}`).write(obj);
};

Service.prototype.delete = async function () {
  await dbs.getDb(`overrides/${this.label}-envs`).delete();
  await dbs.getDb(`services/${this.label}`).delete();
};

Service.load = async function (label, Stack) {
  return new Service(await dbs.getDb(`services/${label}`).read(), Stack);
};

/** @param {string} path */
Service.prototype.loadCustomEnv = function (path) {
  const dotEnvPath = pathfs.resolve(path, '.env');
  if (existsSync(dotEnvPath) && readFileSync(dotEnvPath, { encoding: 'utf-8' }).trim()) {
    console.log(`! A .env will override your ${this.label} service !`);
    return require('dotenv').parse(readFileSync(dotEnvPath, 'utf-8'));
  }
  return null;
};

Service.prototype.exportInApi = function () {
  const res = { ...this };
  // @ts-ignore
  delete res.pids;
  // @ts-ignore
  delete res.store;
  // @ts-ignore
  delete res.Stack;
  return res;
};
/** @return {Partial<import('@runeya/common-typings').NonFunctionProperties<Service>>} */
Service.prototype.toStorage = function () {
  const service = cloneDeep({
    label: this.label,
    commands: this.commands,
    description: this.description,
    git: this.git,
    groups: this.groups,
    url: this.url,
    rootPath: this.rootPath,
    openapiURL: this.openapiURL,
    health: this.health,
    urls: this.urls,
    parsers: this.parsers,
    container: this.container,
    meta: this.meta,
    envs: this.envs,
    shortcuts: this.shortcuts
  });
  return service;
};

Service.prototype.restart = async function () {
  await this.kill();
  await this.launch();
};

Service.prototype.sendHasBeenModified = function () {
  sockets.emit('conf:update', [this.label]);
};

Service.prototype.kill = async function (keepEnabled = false) {
  if (this.container?.enabled && this.container?.name) {
    await execAsync(`docker stop ${this.container.name}`, {}).catch(console.error);
    await execAsync(`docker rm ${this.container.name}`, {}).catch(console.error);
  } else {
    await PromiseB.map(this.pids, async (spawnedProcess) => {
      if (!spawnedProcess.pid) return;
      await killAsync(spawnedProcess.pid);
      spawnedProcess.kill('SIGKILL');
    });
    const urls = [...this.urls || [], this.url].filter((a) => a);
    if (urls.length) {
      await PromiseB.mapSeries(urls, async (url) => {
        const { port } = URL.parse(url);
        if (port && !Number.isNaN(+port)) {
          let free = false;
          for (let i = 0; i < 16; i += 1) {
            // eslint-disable-next-line no-await-in-loop
            await wait(100);
            // eslint-disable-next-line no-await-in-loop
            free = await checkport(+port);
            if (free) break;
          }
          if (!free) {
            await killport(+port).catch((err) => console.error('Error: (Kill port):', err?.message || err));
          }
        }
      });
    }
  }
  this.pids = [];
  sockets.emit('logs:clear', { label: this.label });
  this.store = [];
  await wait(100);
  this.enabled = keepEnabled;
  this.crashed = false;
  this.sendHasBeenModified();
};

Service.prototype.launch = async function () {
  this.store = [];
  await this.kill(true).catch(console.error);
  if(this.container?.enabled) {
    await this.buildDocker({isMainProcess: true})
  }
  if (this.commands?.length) {
    await PromiseB.map(this.commands, async (command) => {
      if (command?.spawnCmd) {
        await this.launchProcess(command);
      }
    });
  }
  this.enabled = true;
  this.sendHasBeenModified();
};

/**
 * @param {Buffer | string} data
 * @param {Partial<LogMessage>} logMessageOverride
 */
Service.prototype.add = async function (data, logMessageOverride, {
  pid, isMainProcess, command,
}) {
  const timestamp = Date.now();

  const ansiMsg = unescapeAnsi(data.toString());
  const stripMsg = stripAnsi(ansiMsg);
  const htmlMessage = ansiMsg ? ansiconvert.toHtml(ansiMsg) : '<br/>';
  /** @type {LogMessage} */
  let line = {
    pid,
    msg: htmlMessage,
    raw: stripMsg,
    timestamp,
    label: this.label,
    json: null,
    debug: null,
    ...logMessageOverride,
    id: v4(),
  };
  line = await PromiseB.reduce(command.effectiveParsers || [], async (line, parser) => {
    try {
      const result = await parser.transformFunction(line, this);
      if (!result?.id) {
        console.error(`It seems your parser "${parser.label}" not return correct value. Please verify or disable it..`);
        return line;
      }
      return result;
    } catch (err) {
      console.error('[PARSER]:', parser.label, ':', err);
      return line;
    }
  }, line);

  if (line.hide) return;

  if (line.source === 'stderr' && isMainProcess) {
    sockets.emit('alert', { label: this.label, message: line.raw.toString(), type: 'error', commandId: command?.id });
  }

  if (timestamp > (this.lastDatePrinted || Date.now()) + 2000) {
    const date = `🕑  ${dayjs().format('YYYY-MM-DD HH:mm:ss')}`;
    /** @type {LogMessage} */
    const line = {
      id: v4(), raw: date, label: this.label, msg: date, timestamp, isSeparator: true,
    };
    this.store.push(line);
    this.queue.push(line);
  }
  this.lastDatePrinted = Date.now();

  if (line.msg.length > 100000 && !line.msg.startsWith('["runeya"')) line.msg = line.msg.slice(0, 10000);
  this.store.push(line);
  this.queue.push(line);
};

Service.prototype.launchProcess = async function (command, isMainProcess = true) {
  try {
    this.enabled = true;
    this.sendHasBeenModified();
    this.crashed = false;
    this.exited = false;
    let { cmd, args, options } = this.container.enabled
      ? await this.parseIncomingCommandDocker(command)
      : await this.parseIncomingCommand(command);
    if (!existsSync(options.cwd)) {
      this.crashed = true;
      this.exited = true;
      /** @type {LogMessage} */
      const launchMessage = {
        id: v4(),
        timestamp: Date.now(),
        label: this.label,
        pid: null,
        msg: `Path does not exists (${options.cwd})`,
        raw: `Path does not exists (${options.cwd})`,
        cmd: {
          cmd,
          args,
          options,
          status: 'exited',
        },
      };
      console.error(launchMessage.msg);
      this.add(launchMessage.msg, { source: 'stderr' }, { pid: null, command, isMainProcess });
      return {spawnProcess: null, launchMessage};
    }
    const spawnProcess = spawn(cmd, args, { ...options, detached: !isWindows });

    /** @type {number | undefined | null} */
    let pid = 0;
    pid = spawnProcess.pid;
    if (this.container?.customPid) {
      // cant wait for custom pid, because listeners should be attached fast after spawn call
      this.container.customPid({ pid: spawnProcess.pid, cmd, args })
        .then((_pid) => { pid = _pid; });
    }
    if (!this.pids) this.pids = [];
    this.pids.push(spawnProcess);
    // @ts-ignore
    spawnProcess.title = this.label;
    this.lastDatePrinted = Date.now();
    /** @type {LogMessage[]} */
    this.queue = [];
    new CreateInterface({
      input: spawnProcess.stdout,
      emitAfterNoDataMs: 100,
    })
      .on('line', (message) => {
        this.add(message, { source: 'stdout' }, { isMainProcess, pid, command });
      });
    new CreateInterface({
      input: spawnProcess.stderr,
      emitAfterNoDataMs: 100,
    }).on('line', (message) => {
      this.add(message, { source: 'stderr' }, { isMainProcess, pid, command });
    });

    /** @type {LogMessage} */
    const launchMessage = {
      id: v4(),
      timestamp: Date.now(),
      label: this.label,
      pid,
      msg: `${cmd} ${args.join(' ')}`,
      raw: `${cmd} ${args.join(' ')}`,
      cmd: {
        cmd,
        args,
        options,
        status: 'running',
      },
    };
    spawnProcess.on('exit', (code, signal) => {
      if (code) {
        if (launchMessage.cmd) launchMessage.cmd.status = 'error';
        if (isMainProcess) {
          sockets.emit('service:crash', {
            label: this.label, code, signal, pid,
          });
          this.crashed = true;
        }
      } else if (launchMessage.cmd) {
        launchMessage.cmd.status = 'exited';
        if (isMainProcess) {
          this.exited = true;
        }
      }
      sockets.emit('service:exit', {
        label: this.label, code, signal, pid,
      });
      sockets.emit('logs:update:lines', [launchMessage]);
    });

    const date = `🕑  ${dayjs().format('YYYY-MM-DD HH:mm:ss')}`;
    /** @type {LogMessage} */
    const line = {
      id: v4(), raw: date, label: this.label, msg: date, timestamp: this.lastDatePrinted, isSeparator: true,
    };
    this.store.push(line, launchMessage);
    sockets.emit('logs:update', [line, launchMessage]);
    if (isMainProcess) {
      setTimeout(() => {
        this.launchHealthChecker(spawnProcess);
      }, this.health.startAfter || 0);
      sockets.emit('service:start', {
        label: this.label, pid,
      });
    }

    return {
      launchMessage,
      spawnProcess,
    };
  } catch (error) {
    /** @type {LogMessage} */
    const launchMessage = {
      id: v4(),
      timestamp: Date.now(),
      label: this.label,
      pid: null,
      msg: `ERROR: ${error?.message || error}`,
      raw: `ERROR: ${error?.message || error}`,
      cmd: {
        cmd: command.spawnCmd,
        args: command.spawnArgs,
        options: command.spawnOptions,
        status: 'exited',
      },
    };
    const date = `🕑  ${dayjs().format('YYYY-MM-DD HH:mm:ss')}`;
    const line = {
      id: v4(), raw: date, label: this.label, msg: date, timestamp: this.lastDatePrinted, isSeparator: true,
    };
    sockets.emit('logs:update', [line, launchMessage]);
    throw error;
  }
};

/**
   *
   * @param {import('child_process').ChildProcessWithoutNullStreams} spawnProcess
   */
Service.prototype.launchHealthChecker = async function (spawnProcess) {
  if ((!spawnProcess.pid && !this.container?.name) || !this.health?.enabled) return;
  const healthy = await axios({
    method: this.health.method || 'GET',
    url: this.health.url || this.url,
    headers: {Accept: '*/*'},
    timeout: +(this.health.timeout || 0),
    validateStatus: (status) => status === (+(this.health.returnCode || 200)),
  })
    .then(({ data: response }) => {
      if (this.health.responseText && this.health.responseText !== JSON.stringify(response)) {
        return false;
      }
      return true;
    })
    .catch(() => false);
  if (!healthy && !this.crashed) {
    this.crashed = true;
    sockets.emit('service:healthcheck:down', { label: this.label, pid: spawnProcess.pid });
  } else if (healthy && this.crashed) {
    this.crashed = false;
    sockets.emit('service:healthcheck:up', { label: this.label, pid: spawnProcess.pid });
  }
  await wait(+(this.health.interval || 1000));
  this.launchHealthChecker(spawnProcess);
};

/**
   *
   * @param {number} pid
   * @param {string} message
   */
Service.prototype.respondToProcess = function (pid, message) {
  const process = this.pids.find((process) => process.pid === pid);
  if (!process) return console.error(`Pid (${pid}) not found`);
  process.stdin?.write(`${message.trim()}\n`);

  /** @type {LogMessage} */
  const line = {
    id: v4(),
    raw: `${message.trim()}\n`,
    label: this.label,
    msg: `${message.trim()}\n`,
    timestamp: Date.now(),
    prompt: true,
    pid,
  };
  this.store.push(line);
  sockets.emit('logs:update', [line]);
  return null;
};

/**
   * @param {number} pid
   * @param {boolean} forceKill
   */
Service.prototype.terminate = function (pid, forceKill = false) {
  const processFound = this.pids.find((process) => process.pid === pid);
  if (!processFound) return console.error(`Pid (${pid}) not found`);
  if (processFound.pid) {
    if (isWindows) process.kill(processFound.pid, 'SIGKILL');
    else process.kill(-processFound.pid, forceKill ? 'SIGKILL' : 'SIGTERM');
  }
  return null;
};

Service.prototype.enable = function () {
  this.enabled = true;
  this.sendHasBeenModified();
};

Service.prototype.disable = function () {
  this.enabled = false;
  this.sendHasBeenModified();
};

Service.prototype.getGlobalEnvs = async function (environmentLabel) {
  const globalEnvironment = await Environment.find(environmentLabel);
  return (label) => {
    const tag = this.extractTag(label);
    if (tag) {
      return globalEnvironment?.envs[tag] ?? '';
    }
    return label;
  };
};

Service.prototype.buildEnvs = async function (
  environmentLabel,
) {
  const globalEnvironment = await Environment.find(environmentLabel)
  if(!globalEnvironment) return {}
  const extendedEnvironments = await globalEnvironment.getExtendedEnvironments()
  const environmentsKeys = new Map()
  const searchEnv = (label, env) => {
    const tag = this.extractTag(label);
    if (tag) {
      return env[tag] ?? '';
    }
    return label;
  };
  extendedEnvironments.map(extendedEnvironment => {
    Object.keys(this.envs[extendedEnvironment.label] || {}).forEach(key => {
      const env = this.envs[extendedEnvironment.label][key]
      if(!environmentsKeys.has(key)) {
        for (let i = 0; i < extendedEnvironments.length; i++) {
          let occurrence = searchEnv(env.systemOverride, extendedEnvironments[i].envs) || searchEnv(env.override, extendedEnvironments[i].envs) || searchEnv(env.value, extendedEnvironments[i].envs)
          if (occurrence) occurrence = `${env.prefix || ''}${occurrence || ''}${env.suffix || ''}`
          const value = occurrence
          if(value) {
            environmentsKeys.set(key, value)
            return 
          }
        }
      }
    });
  });
  return ([...environmentsKeys]).reduce((agg, [key, value]) => {
    agg[key] = value
    return agg
  }, {})
};

Service.prototype.extractTag = function (field) {
  const extractedTag = /{{(.*)}}/gi.exec(field)?.[1]?.trim();
  return extractedTag;
};

Service.prototype.parseIncomingCommandDocker = async function (command) {
  let { spawnCmd, spawnArgs = [], spawnOptions = { envs: [] } } = command;
  const isAlive = await execAsync(`docker inspect --format {{.State.Pid}}  ${this.container.name}`, {})
    .then((pid) => pid.trim() !== '0')
    .catch(() => false);
  const cmd = 'docker'
  const args = isAlive 
    ? ['exec', this.container.name, spawnCmd, ...spawnArgs]
    : [
      'run',
      '--rm',
      ...await this.getDockerEnvsArgs(), ...await this.getDockerVolumesArgs(), ...await this.getDockerPorts(),
      '--network', 'host',
      '--name', this.container.name,
      this.container.name,
      'sh', `-c '${spawnCmd} ${spawnArgs.join(' ')}'`
    ]
  const cwd = pathfs.resolve(replaceEnvs(spawnOptions.cwd || this.getRootPath() || '.'));
  const options = {
    cwd,
    shell: isWindows ? process.env.ComSpec : '/bin/sh',
  };
  return {cmd, args, options}
}

Service.prototype.parseIncomingCommand = async function (command) {
  const { spawnCmd, spawnArgs = [], spawnOptions = { envs: [] } } = command;
  let cmd = spawnCmd?.split(' ')?.[0];
  const argFromCmd = spawnCmd?.split(' ')?.slice(1).join(' ');
  let args = [argFromCmd, ...spawnArgs].filter((a) => a);

  const currentAlias = alias[cmd];
  if (currentAlias) {
    cmd = currentAlias?.cmd || cmd;
    args = [...(currentAlias?.args || []), ...args];
  }
  const cwd = pathfs.resolve(replaceEnvs(spawnOptions.cwd || this.getRootPath() || '.'));
  const options = {
    ...spawnOptions,
    cwd,
    shell: isWindows ? process.env.ComSpec : '/bin/sh',
    env: {
      ...process.env,
      ...await this.buildEnvs(this.Stack.getCurrentEnvironment()?.label)
    },
  };

  if (cmd.match(/[/\\]/g)) {
    cmd = path.resolve(options.cwd.toString(), cmd);
  }
  options.env = { ...process.env, ...options.env };
  return { cmd, args, options };
};

function replaceHome(str) {
  return str.startsWith('~')
    ? pathfs.resolve(os.homedir(), str.replace('~/', ''))
    : pathfs.resolve(str);
}

Service.prototype.getDockerVolumesArgs = async function () {
  const internalVolumeRootPath = replaceHome(this.container.sharedVolume)
  const volumesCmd = this.container.volumes.map((v) => {
    let [external, internal] = v.split(':');
    if (external) external = pathfs.resolve(replaceHome(replaceEnvs(external)));
    if (internal) internal = pathfs.resolve(replaceHome(replaceEnvs(internal)));
    return ['-v', `"${external}:${internal || external}"`];
  });
  volumesCmd.push(...await PromiseB.map(this.container.ignoreVolumes, async (ignoredVolume) => {
    const volumePath = pathfs.join(internalVolumeRootPath, `ignored-volume-${humanStringToKey(this.label)}`, ignoredVolume);
    if (!existsSync(volumePath)) await mkdir(volumePath, { recursive: true }); // Pre create folders with host uid,gid to prevent docker to create as root user
    return ['-v', `"${volumePath}:${ignoredVolume}"`];
  }).filter((f) => !!f?.length));
  return volumesCmd.flat(1)
}
Service.prototype.getDockerPorts = async function () {
  const portsCmd = []
  this.container.ports.forEach(port => {
    portsCmd.push('-p', port)
  })
  return portsCmd.flat(1)
}

Service.prototype.getDockerEnvsArgs = async function () {
  const envs = await this.buildEnvs(this.Stack.getCurrentEnvironment()?.label)
  const envCmd = []
  Object.keys(envs).forEach(key => {
    envCmd.push('-e', `"${key}=${envs[key]}"`)
  })
  return envCmd
}

Service.prototype.launchDockerBuild = async function ({ isMainProcess }) {
  const internalVolumeRootPath = replaceHome(this.container.sharedVolume)
  const dockerFilePath = pathfs.resolve(internalVolumeRootPath, `Dockerfile.${this.container.name}`);
  const dockerContextPath = pathfs.resolve(internalVolumeRootPath, '.empty-context');
  const command = {
    spwanCmd: 'docker',
    spawnArgs: ['build', '-f', dockerFilePath, '-t', this.container?.name || '', dockerContextPath],
    spawnOptions: { cwd: internalVolumeRootPath, shell: isWindows ? true : '/bin/sh', env: process.env },
  };
  this.add('<i class="fab fa-docker" title="docker"></i> <i class="fas fa-hard-hat" title="build"></i> Building docker image...', { source: 'stdout' }, { pid: null, isMainProcess, command });
  this.add(`<i class="fab fa-docker" title="docker"></i> <i class="fas fa-hard-hat" title="build"></i> ${command.spwanCmd} ${command.spawnArgs?.join(' ')}}`, { source: 'stdout' }, { pid: null, isMainProcess, command });
  await new Promise((resolve, reject) => {
    const buildProcess = spawn(command.spwanCmd, command.spawnArgs, command.spawnOptions);
    new CreateInterface({
      input: buildProcess.stdout,
    })
      .on('line', (message) => {
        this.add(`<i class="fab fa-docker" title="docker"></i> <i class="fas fa-hard-hat" title="build"></i> ${message}`, { source: 'stdout' }, { isMainProcess, pid: buildProcess.pid, command });
      });
    new CreateInterface({
      input: buildProcess.stderr,
    }).on('line', (message) => {
      this.add(`<i class="fab fa-docker" title="docker"></i> <i class="fas fa-hard-hat" title="build"></i> ${message}`, { source: 'stdout' }, { isMainProcess, pid: buildProcess.pid, command });
    });
    buildProcess.on('exit', (code) => {
      if (code) {
        this.exited = true;
        this.crashed = true;
        return reject(code);
      }
      return resolve(null);
    });
  });
}


Service.prototype.launchDockerBootstrap = async function ({ isMainProcess }) {
  const volumesCmd = await this.getDockerVolumesArgs()
  const baseArgs = ['run', '--name', this.container.name, '--init', '--rm', , ...(isWindows ? [] : ['--user', this.container.user || `${uid}:${gid}`]), '--network', 'host', ...volumesCmd];
  if (this.container.bootstrap) {
    const envCmd = await this.getDockerEnvsArgs()
    await PromiseB.mapSeries(this.container.bootstrap.commands || [], async (command) => {
      await new Promise((resolve, reject) => {
        const entrypoint = command.entrypoint ? ['--entrypoint', `${command.entrypoint}`] : [];
        const userEntrypoint = command.user && !isWindows ? ['--user', `${command.user || this.container.user || `${uid}:${gid}`}`] : [];
        const bootstrapArgs = /**@type {String[]}*/([
          ...baseArgs,
          ...entrypoint.flat(1),
          ...userEntrypoint.flat(1),
          ...envCmd.flat(1),
          this.container.name,
          command.cmd,
        ].filter((a) => !!a));
        const commandBootstrap = {
          spawnCmd: 'docker',
          spawnArgs: bootstrapArgs,
          spawnOptions: { shell: isWindows ? process.env.ComSpec : '/bin/sh' },
        };
        this.add(`<i class="fab fa-docker" title="docker"></i> <i class="fas fa-hourglass-start" title="bootstrap"></i> ${commandBootstrap.spawnCmd} ${commandBootstrap.spawnArgs?.join(' ')}`, { source: 'stdout' }, { isMainProcess, pid: null, command: commandBootstrap });
        const bootstrapProcess = spawn(
          commandBootstrap.spawnCmd,
          commandBootstrap.spawnArgs,
          commandBootstrap.spawnOptions,
        );
        new CreateInterface({
          input: bootstrapProcess.stdout,
        })
          .on('line', (message) => {
            this.add(`<i class="fab fa-docker" title="docker"></i> <i class="fas fa-hourglass-start" title="bootstrap"></i> ${message}`, { source: 'stdout' }, { isMainProcess, pid: bootstrapProcess.pid, command: commandBootstrap });
          });
        new CreateInterface({
          input: bootstrapProcess.stderr,
        }).on('line', (message) => {
          this.add(`<i class="fab fa-docker" title="docker"></i> <i class="fas fa-hourglass-start" title="bootstrap"></i> ${message}`, { source: 'stderr' }, { isMainProcess, pid: bootstrapProcess.pid, command: commandBootstrap });
        });
        bootstrapProcess.on('exit', (code) => {
          if (code) return reject(code);
          return resolve(null);
        });
      });
    })
  }
}


/**
   * @param {{isMainProcess: boolean}} spawnCmd
   */
Service.prototype.buildDocker = async function ({
   isMainProcess
}) {
  const internalVolumeRootPath = replaceHome(this.container.sharedVolume)
  const dockerFilePath = pathfs.resolve(internalVolumeRootPath, `Dockerfile.${this.container.name}`);
  const dockerIgnoreFilePath = pathfs.resolve(internalVolumeRootPath, '.dockerignore');
  const dockerContextPath = pathfs.resolve(internalVolumeRootPath, '.empty-context');
  if (!existsSync(internalVolumeRootPath)) await mkdir(internalVolumeRootPath, { recursive: true });
  if (!existsSync(dockerContextPath)) await mkdir(dockerContextPath, { recursive: true });
  await writeFile(dockerFilePath, `${this.container.build || ''}`);
  await writeFile(dockerIgnoreFilePath, 'Dockerfile.*'.trim(), 'utf-8');
  await this.launchDockerBuild({ isMainProcess })
  await this.launchDockerBootstrap({ isMainProcess })
  this.container.customPid = async () => {
    const getPid = () => execAsync(`docker inspect --format {{.State.Pid}}  ${this.container?.name}`, {}).then((a) => a.trim()).catch(() => null);
    let pid = await getPid();
    if (!pid) {
      await wait(1000);
      pid = await getPid();
    }
    return pid && !Number.isNaN(+pid) ? +pid : null;
  };
};

const wait = (ms) => new Promise((resolve) => { setTimeout(resolve, ms); });
/**
 * @param {number} pid
 */
function killAsync(pid) {
  return new Promise((resolve, reject) => {
    kill(pid, (err, children) => {
      if (err) return reject(err);
      return resolve(children);
    });
  });
}

/** @param {number} _port */
function checkport(_port) {
  return new Promise((resolve) => {
    const s = net.createServer();
    s.once('error', () => {
      s.close();
      resolve(false);
    });
    s.once('listening', () => {
      resolve(true);
      s.close();
    });
    s.listen(_port);
  });
}

module.exports = Service;

/**
 * @typedef {import('child_process').ExecOptions &
 *  {overrideEnvs?: import('child_process').ExecOptions['env']}
 * } SpawnOptions
 */

/**
 * @typedef {Service} ServiceType
 */
/**
 * @typedef {{
 *  msg: string,
 *  raw: string,
 *  timestamp: number,
 *  prompt?: boolean,
 *  id: string,
 *  source?: 'stdout' | 'stderr'
 *  json?: Record<any, any> | any[] | null,
 *  debug?: Record<any, any> | any[] | null,
 *  isSeparator?: boolean,
 *  label: string,
 *  pid?: number | null,
 *  hide?: boolean,
 *  cmd?: {cmd: string, args: string[], options: import('child_process').ExecOptions, status: 'running' | 'error' | 'exited'},
 * }} LogMessage
 */

/**
 * @typedef {{
 *  id: string,
 *  transform: ((msg: LogMessage, service?: Service | null) => LogMessage)
 * }} Parser
 */
</file>

<file path="modules/plugins-loader/front/package.json">
{
  "name": "@runeya/modules-plugins-loader-front",
  "version": "2.1.1",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "main": "./plugins.js",
  "types": "./plugins.js",
  "scripts": {
    "test": ""
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "@runeya/modules-bugs-front": "workspace:*",
    "@runeya/modules-configuration-front": "workspace:*",
    "@runeya/modules-dev-ops-front": "workspace:*",
    "@runeya/modules-diff-front": "workspace:*",
    "@runeya/modules-docker-front": "workspace:*",
    "@runeya/modules-documentation-front": "workspace:*",
    "@runeya/modules-finder-front": "workspace:*",
    "@runeya/modules-git-front": "workspace:*",
    "@runeya/modules-github-front": "workspace:*",
    "@runeya/modules-global-scripts-front": "workspace:*",
    "@runeya/modules-help-front": "workspace:*",
    "@runeya/modules-json-formatter-front": "workspace:*",
    "@runeya/modules-jwt-front": "workspace:*",
    "@runeya/modules-kanban-front": "workspace:*",
    "@runeya/modules-logs-front": "workspace:*",
    "@runeya/modules-mongo-front": "workspace:*",
    "@runeya/modules-node-repl-front": "workspace:*",
    "@runeya/modules-npm-front": "workspace:*",
    "@runeya/modules-openai-front": "workspace:*",
    "@runeya/modules-openapi-front": "workspace:*",
    "@runeya/modules-regex-front": "workspace:*",
    "@runeya/modules-toolbox-front": "workspace:*",
    "@runeya/modules-uuid-front": "workspace:*",
    "@runeya/modules-vscode-front": "workspace:*",
    "@runeya/modules-workflows-front": "workspace:*",
    "@types/express": "^4.17.21",
    "express": "^4.18.2",
    "vue": "^3.4.18",
    "vue-eslint-parser": "^9.4.2",
    "vue-router": "^4.2.5"
  }
}
</file>

<file path="modules/plugins-loader/backend/package.json">
{
  "name": "@runeya/modules-plugins-loader-backend",
  "version": "2.1.4",
  "repository": "https://github.com/runeya/runeya",
  "private": true,
  "main": "./plugins.js",
  "types": "./plugins.js",
  "scripts": {
    "test": ""
  },
  "dependencies": {
    "@runeya/modules-bugs-backend": "workspace:*",
    "@runeya/modules-configuration-backend": "workspace:*",
    "@runeya/modules-dev-ops-backend": "workspace:*",
    "@runeya/modules-diff-backend": "workspace:*",
    "@runeya/modules-docker-backend": "workspace:*",
    "@runeya/modules-documentation-backend": "workspace:*",
    "@runeya/modules-finder-backend": "workspace:*",
    "@runeya/modules-git-backend": "workspace:*",
    "@runeya/modules-github-backend": "workspace:*",
    "@runeya/modules-global-scripts-backend": "workspace:*",
    "@runeya/modules-help-backend": "workspace:*",
    "@runeya/modules-json-formatter-backend": "workspace:*",
    "@runeya/modules-jwt-backend": "workspace:*",
    "@runeya/modules-kanban-backend": "workspace:*",
    "@runeya/modules-logs-backend": "workspace:*",
    "@runeya/modules-mongo-backend": "workspace:*",
    "@runeya/modules-node-repl-backend": "workspace:*",
    "@runeya/modules-npm-backend": "workspace:*",
    "@runeya/modules-openai-backend": "workspace:*",
    "@runeya/modules-openapi-backend": "workspace:*",
    "@runeya/modules-regex-backend": "workspace:*",
    "@runeya/modules-toolbox-backend": "workspace:*",
    "@runeya/modules-uuid-backend": "workspace:*",
    "@runeya/modules-vscode-backend": "workspace:*",
    "@runeya/modules-workflows-backend": "workspace:*"
  },
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*"
  }
}
</file>

<file path="fronts/app/package.json">
{
  "name": "@runeya/fronts-app",
  "version": "2.1.1",
  "private": true,
  "description": "Monitor processes as a stack",
  "repository": "https://github.com/runeya/runeya",
  "author": {
    "name": "runeya",
    "email": "corentinlabroche@gmail.com",
    "url": "https://corentinlabroche.fr/"
  },
  "scripts": {
    "build": "vite build",
    "serve:front": "vite",
    "test": ""
  },
  "main": "./background.js",
  "files": [
    "server/**/*",
    "typings/**/*",
    "modules/**/*",
    ".env.production",
    "package.json"
  ],
  "typings": "./typings/export.d.ts",
  "types": "./typings/export.d.ts",
  "devDependencies": {
    "@runeya/common-retrigger-all-build": "workspace:*",
    "@runeya/common-socket-front": "workspace:*",
    "@runeya/common-typings": "workspace:*",
    "@runeya/modules-plugins-loader-front": "workspace:*",
    "@fortawesome/fontawesome-free": "^6.5.1",
    "@primevue/themes": "^4.2.5",
    "@shopify/draggable": "^1.1.3",
    "@vitejs/plugin-vue": "^5.0.3",
    "autoprefixer": "^10.4.20",
    "axios": "^1.7.9",
    "bluebird": "^3.7.2",
    "dayjs": "^1.11.10",
    "debounce": "^2.0.0",
    "dot-object": "^2.1.4",
    "fast-sort": "^3.4.0",
    "highlight.js": "^11.9.0",
    "lodash-es": "^4.17.21",
    "markdown-it": "^14.0.0",
    "monaco-editor": "^0.46.0",
    "new-github-issue-url": "^1.0.0",
    "postcss": "^8.4.35",
    "primevue": "^4.2.5",
    "sass": "^1.70.0",
    "swagger-ui": "^5.11.7",
    "tailwindcss": "^3.4.16",
    "tippy.js": "^6.3.7",
    "uuid": "^9.0.1",
    "vite": "^6.0.3",
    "vite-plugin-html": "^3.2.2",
    "vue": "^3.4.18",
    "vue-router": "^4.2.5",
    "vuedraggable": "^4.1.0"
  },
  "postcss": {
    "plugins": {
      "autoprefixer": {}
    }
  },
  "browserslist": [
    "> 1%",
    "last 2 versions"
  ],
  "bin": "server/bin/www",
  "keywords": [
    "runeya",
    "stack",
    "microservices",
    "git",
    "github",
    "bitbucket",
    "npm",
    "process",
    "command",
    "cli",
    "monitor",
    "monitoring"
  ],
  "license": "MIT",
  "packageManager": "yarn@4.0.2"
}
</file>

<file path="servers/server/CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.1.4](https://github.com/runeya/runeya/compare/v2.1.3...v2.1.4) (2025-03-16)

### Bug Fixes

* **nodered:** add possibility to launch single command or shortcut ([a9f5d09](https://github.com/runeya/runeya/commit/a9f5d094098c08a04278464013b0eb3956c460e9))

## [2.1.3](https://github.com/runeya/runeya/compare/v2.1.2...v2.1.3) (2025-03-05)

### Bug Fixes

* can pull env from cli ([4ca6d49](https://github.com/runeya/runeya/commit/4ca6d49aaa7d05c36e4349b4aac2e26100df2b54))

## [2.1.2](https://github.com/runeya/runeya/compare/v2.1.1...v2.1.2) (2025-03-05)

**Note:** Version bump only for package @runeya/servers-server

## [2.1.1](https://github.com/runeya/runeya/compare/v2.1.0...v2.1.1) (2025-02-11)

### Bug Fixes

* improve code health ([865b996](https://github.com/runeya/runeya/commit/865b996fa0adcf49668fa770c465bac1f1d8f21a))

# [2.1.0](https://github.com/runeya/runeya/compare/v2.0.17...v2.1.0) (2025-01-31)

### Features

* **nodered:** add nodered into app ([f897eb2](https://github.com/runeya/runeya/commit/f897eb2c4a9128e0d4615f6765d3ef0ce1d2ca3e))

## [2.0.17](https://github.com/runeya/runeya/compare/v2.0.16...v2.0.17) (2025-01-24)

**Note:** Version bump only for package @runeya/servers-server

## [2.0.16](https://github.com/runeya/runeya/compare/v2.0.15...v2.0.16) (2025-01-24)

**Note:** Version bump only for package @runeya/servers-server

## [2.0.15](https://github.com/runeya/runeya/compare/v2.0.14...v2.0.15) (2025-01-24)

### Bug Fixes

* **Bugs:** support for new command selector ([afd2815](https://github.com/runeya/runeya/commit/afd2815b8c7cf3dd01e5f9408174000e8913996b))

## [2.0.14](https://github.com/runeya/runeya/compare/v2.0.13...v2.0.14) (2025-01-24)

**Note:** Version bump only for package @runeya/servers-server

## [2.0.13](https://github.com/runeya/runeya/compare/v2.0.12...v2.0.13) (2025-01-24)

### Bug Fixes

* **services:** dont guess anymore cwd from the first command ([e62077f](https://github.com/runeya/runeya/commit/e62077f377c11553fcae6dfd19dbffe989342551))

## [2.0.12](https://github.com/runeya/runeya/compare/v2.0.11...v2.0.12) (2025-01-24)

### Bug Fixes

* **editors:** can choose an editor by services ([0807227](https://github.com/runeya/runeya/commit/08072273fa2b3a7c3b133baddb2983771b68063c))
* **notifications:** can mute channel error from each command in settings ([ede9be5](https://github.com/runeya/runeya/commit/ede9be5f819d13364e2e96503e3ee70cdcf5181b))
* reenable documentation and improve global git view ([2e4dd75](https://github.com/runeya/runeya/commit/2e4dd75c0513d92f12b8303b3dddd2f2fa6ccc73))

## [2.0.11](https://github.com/runeya/runeya/compare/v2.0.10...v2.0.11) (2025-01-13)

### Bug Fixes

* and same for octokit/plugin-rest-endpoint-methods ([6a3e460](https://github.com/runeya/runeya/commit/6a3e46059860cdac48d0bb5f9b37be32ea5429ac))

## [2.0.10](https://github.com/runeya/runeya/compare/v2.0.9...v2.0.10) (2025-01-13)

### Bug Fixes

* fix-esm for octokit ([30f63bc](https://github.com/runeya/runeya/commit/30f63bc85a7480724a6a983d063ac0fe91bf7218))

## [2.0.8](https://github.com/runeya/runeya/compare/v2.0.7...v2.0.8) (2025-01-13)

### Bug Fixes

* documentation + various bugfixes ([bddd9f6](https://github.com/runeya/runeya/commit/bddd9f6a5507a5a45ea2e54d0fe836e1e518c820))
* replace npm tag to version 2 ([3ca5665](https://github.com/runeya/runeya/commit/3ca56655b588e6e9449044e3f389fbb7c678481f))
* **windows:** add specific code to windows support ([f15719d](https://github.com/runeya/runeya/commit/f15719dd5cf13e076831c1bcfedf8497127068fe))

## [2.0.7](https://github.com/runeya/runeya/compare/v2.0.6...v2.0.7) (2025-01-05)

### Bug Fixes

* **windows:** fix windows support ([5590e7d](https://github.com/runeya/runeya/commit/5590e7de8f27c45ee76d401e53eeda6fcae5bbfe))

## [2.0.6](https://github.com/runeya/runeya/compare/v2.0.5...v2.0.6) (2025-01-04)

### Bug Fixes

* externalize packages since gpt read external file from his package ([e8e50a2](https://github.com/runeya/runeya/commit/e8e50a2729fef674e9c9bf831ab8c31dac2ffa75))

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* add missing deps for building server ([abffa86](https://github.com/runeya/runeya/commit/abffa86a56889384338d06213cad4370c2cbea17))
* attach heritage to environment instead of service + various fixes ([4647010](https://github.com/runeya/runeya/commit/4647010eadbf3370155faca171a0b10caea32baf))
* remove some dependencies ([5667402](https://github.com/runeya/runeya/commit/5667402d57add874a89ba029ce62b16b3bbed9e0))
* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

## [2.0.4](https://github.com/runeya/runeya/compare/v2.0.3...v2.0.4) (2024-12-26)

### Bug Fixes

* cwd when prompt a command ([483001f](https://github.com/runeya/runeya/commit/483001f826b65f163b48278636a0d840c7b6703b))

## [2.0.3](https://github.com/runeya/runeya/compare/v2.0.2...v2.0.3) (2024-12-26)

### Bug Fixes

* load external deps ([bf3907b](https://github.com/runeya/runeya/commit/bf3907bd35fb6ae9711ed425de37c1f6c95286f7))

## [2.0.2](https://github.com/runeya/runeya/compare/v2.0.1...v2.0.2) (2024-12-26)

### Bug Fixes

* fix entrypoint loading ([8b35198](https://github.com/runeya/runeya/commit/8b35198cc2ab6e02cf5fd452dd65742ba90f1efa))

## [2.0.1](https://github.com/runeya/runeya/compare/v2.0.0...v2.0.1) (2024-12-25)

### Bug Fixes

* **docker:** fix volume paths with interpreted characters ([38eb09b](https://github.com/runeya/runeya/commit/38eb09b8f7cdab2799c4cad35d2ea9f66083ad70))
* **env_vars:** fix reactivity ([12f7180](https://github.com/runeya/runeya/commit/12f718070723d79e1adef9050894c131ec6343f9))
* various fixes ([18129e9](https://github.com/runeya/runeya/commit/18129e96f7c92a69176d6a75add45f3a48ab11ae))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

* feat!: migrate runeya to entire UI ([e173073](https://github.com/runeya/runeya/commit/e173073d932be7e400b1f51261c090116e8fb543))

### BREAKING CHANGES

* all stack files are useless now

## [1.18.12](https://github.com/runeya/runeya/compare/v1.18.11...v1.18.12) (2024-11-11)

### Bug Fixes

* authorize iframe from jsoncrack ([1faaab2](https://github.com/runeya/runeya/commit/1faaab27db8f2cd2c2199375df9d77fe8a9341b6))

## [1.18.11](https://github.com/runeya/runeya/compare/v1.18.10...v1.18.11) (2024-11-11)

**Note:** Version bump only for package @runeya/servers-server

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

### Bug Fixes

* improve performance + add jsoncrack view ([c534a97](https://github.com/runeya/runeya/commit/c534a9749162f5f15589ec335da149656c757bfb))

## [1.18.9](https://github.com/runeya/runeya/compare/v1.18.8...v1.18.9) (2024-05-17)

### Bug Fixes

* **docker:** add bootstrap scripts ([040e036](https://github.com/runeya/runeya/commit/040e036dc53c67e875d2e1a6e2b6147ca4070754))

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

### Bug Fixes

* **devcontainer:** add container support ([f2559fb](https://github.com/runeya/runeya/commit/f2559fb90bba3de5fcfef2c95dd45826358b7ad4))
* **docker:** add docker support ([f3abb42](https://github.com/runeya/runeya/commit/f3abb4237b8f708585769a8ff51c393d5f21dc5c))
* **docker:** add user to container ([3116d66](https://github.com/runeya/runeya/commit/3116d66459fe2877fa64183abbf2cb0599c7535a))
* resolve issues for permission on docker volumes + cosmetic changes ([7a822cd](https://github.com/runeya/runeya/commit/7a822cd1c205e5808247075828c1d3ce49d1524b))
* **stackchooser:** redirect to the first launched service ([aa53535](https://github.com/runeya/runeya/commit/aa53535c16a4ae729d33fe3017c589e1f69e7ce5))

## [1.18.7](https://github.com/runeya/runeya/compare/v1.18.6...v1.18.7) (2024-02-25)

### Bug Fixes

* **extension:** notification on health down is too verbose ([a96aad7](https://github.com/runeya/runeya/commit/a96aad77ce6d01be5a8411bdd9a32d4f7c1ad438))

## [1.18.6](https://github.com/runeya/runeya/compare/v1.18.5...v1.18.6) (2024-02-25)

**Note:** Version bump only for package @runeya/servers-server

## [1.18.5](https://github.com/runeya/runeya/compare/v1.18.4...v1.18.5) (2024-02-24)

### Bug Fixes

* create new version ([deebf7b](https://github.com/runeya/runeya/commit/deebf7bdd118dd1919995716ded6c5ba186afa05))

## [1.18.3](https://github.com/runeya/runeya/compare/v1.18.2...v1.18.3) (2024-02-24)

### Bug Fixes

* **front:** proxy image to prevent cors + close theme at startup ([cdebdf4](https://github.com/runeya/runeya/commit/cdebdf4d878acdcd4c71b39f45df7353acf86a9b))

## [1.18.2](https://github.com/runeya/runeya/compare/v1.18.1...v1.18.2) (2024-02-24)

### Bug Fixes

* **extension:** create vscodeextension ([dfb2589](https://github.com/runeya/runeya/commit/dfb258912ca717cca9b2dc857c2774bfddd59251))
* **front:** cosmetic changes ([ff9b282](https://github.com/runeya/runeya/commit/ff9b2821de658eae571a1da4407ec0651a102e15))

## [1.18.1](https://github.com/runeya/runeya/compare/v1.18.0...v1.18.1) (2024-02-20)

### Bug Fixes

* **theme:** cosmetic changes ([0da5cee](https://github.com/runeya/runeya/commit/0da5cee3b358d85bdc9c0fdf4907d7cd9b249e4a))

# [1.18.0](https://github.com/runeya/runeya/compare/v1.17.30...v1.18.0) (2024-02-19)

### Features

* **swagger:** can read an opoenapi url from service ([481b543](https://github.com/runeya/runeya/commit/481b54305b2606f6f360287b17a4b4270a99eb3d))

## [1.17.30](https://github.com/runeya/runeya/compare/v1.17.29...v1.17.30) (2024-02-19)

### Bug Fixes

* **documentation:** add a global documentation ([0ef6b0f](https://github.com/runeya/runeya/commit/0ef6b0f15760d06380e9d7df3fc9c3a0393305d5))

## [1.17.29](https://github.com/runeya/runeya/compare/v1.17.28...v1.17.29) (2024-02-15)

**Note:** Version bump only for package @runeya/servers-server

## [1.17.28](https://github.com/runeya/runeya/compare/v1.17.27...v1.17.28) (2024-02-14)

### Bug Fixes

* **front:** fix cors policy ([2ee35e1](https://github.com/runeya/runeya/commit/2ee35e1178c07507c1ca49b1a2db4f5c17755b58))

## [1.17.27](https://github.com/runeya/runeya/compare/v1.17.26...v1.17.27) (2024-02-14)

### Bug Fixes

* **front:** change icon ([b012ab7](https://github.com/runeya/runeya/commit/b012ab7dea9dde695cbfd95b2f4dbc446211db0a))

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

### Bug Fixes 

* **server:** healthcheck working ([13d2960](https://github.com/runeya/runeya/commit/13d2960ffa5125aff7792d95a9306fe6e04d2889))
* **server:** resolve dependencies ([7a15ef0](https://github.com/runeya/runeya/commit/7a15ef01ba9946fb2662c0f15a6da758f0c40280))
* various changes ([06e6241](https://github.com/runeya/runeya/commit/06e624176595b95c4227fe684242919c7eeda192))

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

**Note:** Version bump only for package @runeya/servers-server

## [1.17.24](https://github.com/runeya/runeya/compare/v1.17.23...v1.17.24) (2024-02-11)

**Note:** Version bump only for package @runeya/servers-server

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

### Bug Fixes

* link front to backend deps ([66b3135](https://github.com/runeya/runeya/commit/66b313523d99765b692208de0043303dcb6a0914))

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

**Note:** Version bump only for package @runeya/servers-server

## [1.17.20](https://github.com/runeya/runeya/compare/v1.17.19...v1.17.20) (2024-02-11)

### Bug Fixes

* link front to backend deps ([8e46943](https://github.com/runeya/runeya/commit/8e469434e8142afcb47b9589edb0b95e9bf32c71))

## [1.17.19](https://github.com/runeya/runeya/compare/v1.17.18...v1.17.19) (2024-02-11)

### Bug Fixes

* fix ci ([47d1230](https://github.com/runeya/runeya/commit/47d12308afc56e027c4c3faebba4dc24e16e6731))

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* build for npm ([0c07b41](https://github.com/runeya/runeya/commit/0c07b410a237412c1c73bbb42fe45c1f9c220482))
* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))

## [1.17.15](https://github.com/runeya/runeya/compare/v1.17.14...v1.17.15) (2024-02-07)

**Note:** Version bump only for package @runeya/runeya

## [1.17.14](https://github.com/runeya/runeya/compare/v1.17.13...v1.17.14) (2024-02-05)

### Bug Fixes

* **front:** fix drag n drop ([39f5d4b](https://github.com/runeya/runeya/commit/39f5d4b2c9d69500402a8cf76e373836c5e9b596))

## [1.17.13](https://github.com/runeya/runeya/compare/v1.17.12...v1.17.13) (2024-02-05)

**Note:** Version bump only for package @runeya/runeya

## [1.17.12](https://github.com/runeya/runeya/compare/v1.17.11...v1.17.12) (2024-02-04)

**Note:** Version bump only for package @runeya/runeya

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))

## [1.17.10](https://github.com/runeya/runeya/compare/v1.17.9...v1.17.10) (2024-02-04)

**Note:** Version bump only for package @runeya/runeya

## [1.17.9](https://github.com/runeya/runeya/compare/v1.17.8...v1.17.9) (2024-02-04)

**Note:** Version bump only for package @runeya/runeya

## [1.17.8](https://github.com/runeya/runeya/compare/v1.17.7...v1.17.8) (2024-02-04)

**Note:** Version bump only for package @runeya/runeya

## [1.17.7](https://github.com/runeya/runeya/compare/v1.17.6...v1.17.7) (2024-02-04)

**Note:** Version bump only for package @runeya/runeya

## [1.17.6](https://github.com/runeya/runeya/compare/v1.17.5...v1.17.6) (2024-02-04)

**Note:** Version bump only for package @runeya/runeya

## [1.17.5](https://github.com/runeya/runeya/compare/v1.17.4...v1.17.5) (2024-02-04)

**Note:** Version bump only for package @runeya/runeya

## [1.17.4](https://github.com/runeya/runeya/compare/v1.17.3...v1.17.4) (2024-02-04)

**Note:** Version bump only for package @runeya/runeya

## [1.17.3](https://github.com/runeya/runeya/compare/v1.11.23...v1.17.3) (2024-02-04)

**Note:** Version bump only for package @runeya/runeya
</file>

<file path="CHANGELOG.md">
# Change Log

All notable changes to this project will be documented in this file.
See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.

## [2.1.4](https://github.com/runeya/runeya/compare/v2.1.3...v2.1.4) (2025-03-16)

### Bug Fixes

* **nodered:** add possibility to launch single command or shortcut ([a9f5d09](https://github.com/runeya/runeya/commit/a9f5d094098c08a04278464013b0eb3956c460e9))

## [2.1.3](https://github.com/runeya/runeya/compare/v2.1.2...v2.1.3) (2025-03-05)

### Bug Fixes

* can pull env from cli ([4ca6d49](https://github.com/runeya/runeya/commit/4ca6d49aaa7d05c36e4349b4aac2e26100df2b54))
* uuid vanilla for nodered ([20ec123](https://github.com/runeya/runeya/commit/20ec1232a9db39f024c8db3159123bd2266aa915))

## [2.1.2](https://github.com/runeya/runeya/compare/v2.1.1...v2.1.2) (2025-03-05)

### Bug Fixes

* **docs:** update actions ([ad568b0](https://github.com/runeya/runeya/commit/ad568b04e4227aa5714ef1093428fc3972be77ec))
* increase action versions ([2c5c66c](https://github.com/runeya/runeya/commit/2c5c66c474c499f8c92a1707bb30336037d85119))
* set needed fields on nodered packagejson when missing ([8e6bdce](https://github.com/runeya/runeya/commit/8e6bdcef674023ed560d631fa2d0dc5f1cb16cfd))

## [2.1.1](https://github.com/runeya/runeya/compare/v2.1.0...v2.1.1) (2025-02-11)

### Bug Fixes

* improve code health ([865b996](https://github.com/runeya/runeya/commit/865b996fa0adcf49668fa770c465bac1f1d8f21a))
* **nodered:** respect git versionning ([0965d44](https://github.com/runeya/runeya/commit/0965d445f6ad3ff9165cb8b3c3397958229ff7a8))

# [2.1.0](https://github.com/runeya/runeya/compare/v2.0.17...v2.1.0) (2025-01-31)

### Features

* **nodered:** add nodered into app ([f897eb2](https://github.com/runeya/runeya/commit/f897eb2c4a9128e0d4615f6765d3ef0ce1d2ca3e))

## [2.0.17](https://github.com/runeya/runeya/compare/v2.0.16...v2.0.17) (2025-01-24)

### Bug Fixes

* **Logs:** fix arrow height for terminal bar ([eaa2dc3](https://github.com/runeya/runeya/commit/eaa2dc3f4333040dfb23dc04221bec1735f1ca3f))

## [2.0.16](https://github.com/runeya/runeya/compare/v2.0.15...v2.0.16) (2025-01-24)

### Bug Fixes

* **Npm:** priority to commands over rootpath ([460df64](https://github.com/runeya/runeya/commit/460df64d4ed66056ae26c213b8f83e5fe932d980))

## [2.0.15](https://github.com/runeya/runeya/compare/v2.0.14...v2.0.15) (2025-01-24)

### Bug Fixes

* **Bugs:** support for new command selector ([afd2815](https://github.com/runeya/runeya/commit/afd2815b8c7cf3dd01e5f9408174000e8913996b))
* **Npm:** support for new command selector ([edfbb76](https://github.com/runeya/runeya/commit/edfbb76cfddec911a210f5be9554e497c60f92fb))

## [2.0.14](https://github.com/runeya/runeya/compare/v2.0.13...v2.0.14) (2025-01-24)

### Bug Fixes

* **Log:** fix color css to view the cwd path ([8e38a36](https://github.com/runeya/runeya/commit/8e38a36394c1332c9607696fb659a0e3cf8247a3))

## [2.0.13](https://github.com/runeya/runeya/compare/v2.0.12...v2.0.13) (2025-01-24)

### Bug Fixes

* **services:** dont guess anymore cwd from the first command ([e62077f](https://github.com/runeya/runeya/commit/e62077f377c11553fcae6dfd19dbffe989342551))

## [2.0.12](https://github.com/runeya/runeya/compare/v2.0.11...v2.0.12) (2025-01-24)

### Bug Fixes

* **editor:** disable for stackmultiple ([ae4735f](https://github.com/runeya/runeya/commit/ae4735f27d3a443da4eedf11d6688ce8e9b6bc79))
* **editor:** fix a reactive problem ([b292771](https://github.com/runeya/runeya/commit/b292771896ea9c37bcf03f4bbf0fd53d6819c718))
* **editors:** can choose an editor by services ([0807227](https://github.com/runeya/runeya/commit/08072273fa2b3a7c3b133baddb2983771b68063c))
* **notifications:** can mute channel error from each command in settings ([ede9be5](https://github.com/runeya/runeya/commit/ede9be5f819d13364e2e96503e3ee70cdcf5181b))
* reenable documentation and improve global git view ([2e4dd75](https://github.com/runeya/runeya/commit/2e4dd75c0513d92f12b8303b3dddd2f2fa6ccc73))
* **stack-multiple:** resolve wrong tabs height ([32fcb7f](https://github.com/runeya/runeya/commit/32fcb7fac9c4ef464d13bcb9cfdc34bb7c480597))

## [2.0.11](https://github.com/runeya/runeya/compare/v2.0.10...v2.0.11) (2025-01-13)

### Bug Fixes

* and same for octokit/plugin-rest-endpoint-methods ([6a3e460](https://github.com/runeya/runeya/commit/6a3e46059860cdac48d0bb5f9b37be32ea5429ac))

## [2.0.10](https://github.com/runeya/runeya/compare/v2.0.9...v2.0.10) (2025-01-13)

### Bug Fixes

* fix-esm for octokit ([30f63bc](https://github.com/runeya/runeya/commit/30f63bc85a7480724a6a983d063ac0fe91bf7218))

## [2.0.9](https://github.com/runeya/runeya/compare/v2.0.8...v2.0.9) (2025-01-13)

**Note:** Version bump only for package @runeya/runeya

## [2.0.8](https://github.com/runeya/runeya/compare/v2.0.7...v2.0.8) (2025-01-13)

### Bug Fixes

* documentation + various bugfixes ([bddd9f6](https://github.com/runeya/runeya/commit/bddd9f6a5507a5a45ea2e54d0fe836e1e518c820))
* replace npm tag to version 2 ([3ca5665](https://github.com/runeya/runeya/commit/3ca56655b588e6e9449044e3f389fbb7c678481f))
* **windows:** add specific code to windows support ([f15719d](https://github.com/runeya/runeya/commit/f15719dd5cf13e076831c1bcfedf8497127068fe))

## [2.0.7](https://github.com/runeya/runeya/compare/v2.0.6...v2.0.7) (2025-01-05)

### Bug Fixes

* **windows:** fix windows support ([5590e7d](https://github.com/runeya/runeya/commit/5590e7de8f27c45ee76d401e53eeda6fcae5bbfe))

## [2.0.6](https://github.com/runeya/runeya/compare/v2.0.5...v2.0.6) (2025-01-04)

### Bug Fixes

* externalize packages since gpt read external file from his package ([e8e50a2](https://github.com/runeya/runeya/commit/e8e50a2729fef674e9c9bf831ab8c31dac2ffa75))

## [2.0.5](https://github.com/runeya/runeya/compare/v2.0.4...v2.0.5) (2025-01-04)

### Bug Fixes

* add missing deps for building server ([abffa86](https://github.com/runeya/runeya/commit/abffa86a56889384338d06213cad4370c2cbea17))
* attach heritage to environment instead of service + various fixes ([4647010](https://github.com/runeya/runeya/commit/4647010eadbf3370155faca171a0b10caea32baf))
* remove some dependencies ([5667402](https://github.com/runeya/runeya/commit/5667402d57add874a89ba029ce62b16b3bbed9e0))
* various fixes ([d3ac538](https://github.com/runeya/runeya/commit/d3ac538093a6d475cf1eca0f262a2accf91b3373))

## [2.0.4](https://github.com/runeya/runeya/compare/v2.0.3...v2.0.4) (2024-12-26)

### Bug Fixes

* cwd when prompt a command ([483001f](https://github.com/runeya/runeya/commit/483001f826b65f163b48278636a0d840c7b6703b))

## [2.0.3](https://github.com/runeya/runeya/compare/v2.0.2...v2.0.3) (2024-12-26)

### Bug Fixes

* load external deps ([bf3907b](https://github.com/runeya/runeya/commit/bf3907bd35fb6ae9711ed425de37c1f6c95286f7))

## [2.0.2](https://github.com/runeya/runeya/compare/v2.0.1...v2.0.2) (2024-12-26)

### Bug Fixes

* fix entrypoint loading ([8b35198](https://github.com/runeya/runeya/commit/8b35198cc2ab6e02cf5fd452dd65742ba90f1efa))

## [2.0.1](https://github.com/runeya/runeya/compare/v2.0.0...v2.0.1) (2024-12-25)

### Bug Fixes

* **docker:** fix volume paths with interpreted characters ([38eb09b](https://github.com/runeya/runeya/commit/38eb09b8f7cdab2799c4cad35d2ea9f66083ad70))
* **env_vars:** fix reactivity ([12f7180](https://github.com/runeya/runeya/commit/12f718070723d79e1adef9050894c131ec6343f9))
* various fixes ([18129e9](https://github.com/runeya/runeya/commit/18129e96f7c92a69176d6a75add45f3a48ab11ae))

# [2.0.0](https://github.com/runeya/runeya/compare/v1.18.12...v2.0.0) (2024-12-19)

* feat!: migrate runeya to entire UI ([e173073](https://github.com/runeya/runeya/commit/e173073d932be7e400b1f51261c090116e8fb543))

### BREAKING CHANGES

* all stack files are useless now

## [1.18.12](https://github.com/runeya/runeya/compare/v1.18.11...v1.18.12) (2024-11-11)

### Bug Fixes

* authorize iframe from jsoncrack ([1faaab2](https://github.com/runeya/runeya/commit/1faaab27db8f2cd2c2199375df9d77fe8a9341b6))

## [1.18.11](https://github.com/runeya/runeya/compare/v1.18.10...v1.18.11) (2024-11-11)

### Bug Fixes

* remove eiwos ([86bbff3](https://github.com/runeya/runeya/commit/86bbff321bd3cd7a70faeb0de6ccbbe93be4bab4))
* remove eiwos ([12ff054](https://github.com/runeya/runeya/commit/12ff0548941856cd5ca627f1a0a157141366b3cf))

## [1.18.10](https://github.com/runeya/runeya/compare/v1.18.9...v1.18.10) (2024-11-11)

### Bug Fixes

* improve performance + add jsoncrack view ([c534a97](https://github.com/runeya/runeya/commit/c534a9749162f5f15589ec335da149656c757bfb))

## [1.18.9](https://github.com/runeya/runeya/compare/v1.18.8...v1.18.9) (2024-05-17)

### Bug Fixes

* **docker:** add bootstrap scripts ([040e036](https://github.com/runeya/runeya/commit/040e036dc53c67e875d2e1a6e2b6147ca4070754))
* increase turborepo and yarn version ([9d1d179](https://github.com/runeya/runeya/commit/9d1d17943af8f873b94bf736fdb2fa025eba5c34))

## [1.18.8](https://github.com/runeya/runeya/compare/v1.18.7...v1.18.8) (2024-03-19)

### Bug Fixes

* **configuration:** can search through envs ([3673cf9](https://github.com/runeya/runeya/commit/3673cf939a12fae76d851180fe79dcf01d6dcde7))
* **devcontainer:** add container support ([f2559fb](https://github.com/runeya/runeya/commit/f2559fb90bba3de5fcfef2c95dd45826358b7ad4))
* **docker:** add docker support ([f3abb42](https://github.com/runeya/runeya/commit/f3abb4237b8f708585769a8ff51c393d5f21dc5c))
* **docker:** add user to container ([3116d66](https://github.com/runeya/runeya/commit/3116d66459fe2877fa64183abbf2cb0599c7535a))
* **logs:** dont render html on simplified mode ([713b2c7](https://github.com/runeya/runeya/commit/713b2c736d9d4f62b791076450b01d4f657e7ff1))
* resolve issues for permission on docker volumes + cosmetic changes ([7a822cd](https://github.com/runeya/runeya/commit/7a822cd1c205e5808247075828c1d3ce49d1524b))
* **stackchooser:** redirect to the first launched service ([aa53535](https://github.com/runeya/runeya/commit/aa53535c16a4ae729d33fe3017c589e1f69e7ce5))

## [1.18.7](https://github.com/runeya/runeya/compare/v1.18.6...v1.18.7) (2024-02-25)

### Bug Fixes

* **extension:** notification on health down is too verbose ([a96aad7](https://github.com/runeya/runeya/commit/a96aad77ce6d01be5a8411bdd9a32d4f7c1ad438))

## [1.18.6](https://github.com/runeya/runeya/compare/v1.18.5...v1.18.6) (2024-02-25)

### Bug Fixes

* cosmetic changes ([87429f3](https://github.com/runeya/runeya/commit/87429f37a57d83f5d568fa4df13cb75e9e4145d1))
* **extension:** autodiscovery ([dcb1b24](https://github.com/runeya/runeya/commit/dcb1b24c486971a1538a86db9cfdf96f16244bff))
* **extension:** fix code lens ([d17b922](https://github.com/runeya/runeya/commit/d17b9228c15b9cb0acd21e3839fd0b85e07c5a69))
* **yarn:** upgrade to 4.1.0 ([439079a](https://github.com/runeya/runeya/commit/439079a46de4ea4c905799955278e95e195e3710))

## [1.18.5](https://github.com/runeya/runeya/compare/v1.18.4...v1.18.5) (2024-02-24)

### Bug Fixes

* create new version ([deebf7b](https://github.com/runeya/runeya/commit/deebf7bdd118dd1919995716ded6c5ba186afa05))

## [1.18.4](https://github.com/runeya/runeya/compare/v1.18.3...v1.18.4) (2024-02-24)

### Bug Fixes

* **front:** fix proxy url in production mode ([444f15b](https://github.com/runeya/runeya/commit/444f15be4f83145831f7bc653b09d54ef37f332b))

## [1.18.3](https://github.com/runeya/runeya/compare/v1.18.2...v1.18.3) (2024-02-24)

### Bug Fixes

* **front:** proxy image to prevent cors + close theme at startup ([cdebdf4](https://github.com/runeya/runeya/commit/cdebdf4d878acdcd4c71b39f45df7353acf86a9b))

## [1.18.2](https://github.com/runeya/runeya/compare/v1.18.1...v1.18.2) (2024-02-24)

### Bug Fixes

* **extension:** add command and keybinding to print variable into runeya ([0c5d65f](https://github.com/runeya/runeya/commit/0c5d65fdf8a97ed312cc3bfcfa46f74590ca3895))
* **extension:** create vscodeextension ([dfb2589](https://github.com/runeya/runeya/commit/dfb258912ca717cca9b2dc857c2774bfddd59251))
* **front:** cosmetic changes ([ff9b282](https://github.com/runeya/runeya/commit/ff9b2821de658eae571a1da4407ec0651a102e15))

## [1.18.1](https://github.com/runeya/runeya/compare/v1.18.0...v1.18.1) (2024-02-20)

### Bug Fixes

* **theme:** cosmetic changes ([0da5cee](https://github.com/runeya/runeya/commit/0da5cee3b358d85bdc9c0fdf4907d7cd9b249e4a))

# [1.18.0](https://github.com/runeya/runeya/compare/v1.17.30...v1.18.0) (2024-02-19)

### Bug Fixes

* **documentation:** deployment for doc ([fb7dd7f](https://github.com/runeya/runeya/commit/fb7dd7f1f93c6e0dbaf9e17047b2e7c5b880a7e4))

### Features

* **swagger:** can read an opoenapi url from service ([481b543](https://github.com/runeya/runeya/commit/481b54305b2606f6f360287b17a4b4270a99eb3d))

## [1.17.30](https://github.com/runeya/runeya/compare/v1.17.29...v1.17.30) (2024-02-19)

### Bug Fixes

* **documentation:** add a global documentation ([0ef6b0f](https://github.com/runeya/runeya/commit/0ef6b0f15760d06380e9d7df3fc9c3a0393305d5))
* **documentation:** add documentation for documentation ([6290ce7](https://github.com/runeya/runeya/commit/6290ce7fc6aa070c1fb0f99e0cd815e5f51391b1))
* **documentation:** deployment for doc ([acacca6](https://github.com/runeya/runeya/commit/acacca68f431eb78a9852d67191ab454c1d59e4b))

## [1.17.29](https://github.com/runeya/runeya/compare/v1.17.28...v1.17.29) (2024-02-15)

### Bug Fixes

* **theme:** add black theme ([bee4697](https://github.com/runeya/runeya/commit/bee469731be182ac929298dc13fe1c230eccb7ba))

## [1.17.28](https://github.com/runeya/runeya/compare/v1.17.27...v1.17.28) (2024-02-14)

### Bug Fixes

* **front:** fix cors policy ([2ee35e1](https://github.com/runeya/runeya/commit/2ee35e1178c07507c1ca49b1a2db4f5c17755b58))

## [1.17.27](https://github.com/runeya/runeya/compare/v1.17.26...v1.17.27) (2024-02-14)

### Bug Fixes

* **front:** change icon ([b012ab7](https://github.com/runeya/runeya/commit/b012ab7dea9dde695cbfd95b2f4dbc446211db0a))

## [1.17.26](https://github.com/runeya/runeya/compare/v1.17.25...v1.17.26) (2024-02-14)

### Bug Fixes

* **server:** healthcheck working ([13d2960](https://github.com/runeya/runeya/commit/13d2960ffa5125aff7792d95a9306fe6e04d2889))
* **server:** resolve dependencies ([7a15ef0](https://github.com/runeya/runeya/commit/7a15ef01ba9946fb2662c0f15a6da758f0c40280))
* various changes ([06e6241](https://github.com/runeya/runeya/commit/06e624176595b95c4227fe684242919c7eeda192))

## [1.17.25](https://github.com/runeya/runeya/compare/v1.17.24...v1.17.25) (2024-02-12)

### Bug Fixes

* add link to runeya help ([62c1d4e](https://github.com/runeya/runeya/commit/62c1d4e07455759e6468133b2ee7fa4ed1cb8cb6))
* cosmetic changes ([a18735e](https://github.com/runeya/runeya/commit/a18735e5b5cec706f3cdf4c4f4ca22482ce7ea0f))

## [1.17.24](https://github.com/runeya/runeya/compare/v1.17.23...v1.17.24) (2024-02-11)

### Bug Fixes

* link front to backend deps ([351abfd](https://github.com/runeya/runeya/commit/351abfd8f8cde96bce80d5202a78dd1daabbf6bb))

## [1.17.23](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.23) (2024-02-11)

### Bug Fixes

* link front to backend deps ([66b3135](https://github.com/runeya/runeya/commit/66b313523d99765b692208de0043303dcb6a0914))
* link front to backend deps ([54fcbf3](https://github.com/runeya/runeya/commit/54fcbf371cf03dc4f51a7196de15fe5d352088e9))

## [1.17.22](https://github.com/runeya/runeya/compare/v1.17.21...v1.17.22) (2024-02-11)

**Note:** Version bump only for package @runeya/runeya

## [1.17.21](https://github.com/runeya/runeya/compare/v1.17.20...v1.17.21) (2024-02-11)

### Bug Fixes

* link front to backend deps ([91b2dce](https://github.com/runeya/runeya/commit/91b2dcefddc5d51520f7cd8ec31b4289461a9077))

## [1.17.20](https://github.com/runeya/runeya/compare/v1.17.19...v1.17.20) (2024-02-11)

### Bug Fixes

* link front to backend deps ([8e46943](https://github.com/runeya/runeya/commit/8e469434e8142afcb47b9589edb0b95e9bf32c71))

## [1.17.19](https://github.com/runeya/runeya/compare/v1.17.18...v1.17.19) (2024-02-11)

### Bug Fixes

* fix ci ([47d1230](https://github.com/runeya/runeya/commit/47d12308afc56e027c4c3faebba4dc24e16e6731))

## [1.17.18](https://github.com/runeya/runeya/compare/v1.17.15...v1.17.18) (2024-02-11)

### Bug Fixes

* build for npm ([0c07b41](https://github.com/runeya/runeya/commit/0c07b410a237412c1c73bbb42fe45c1f9c220482))
* no cyclic dependencies ([496f153](https://github.com/runeya/runeya/commit/496f153c9492fc25873f1498a0b1f22556601eed))
* resolve conflict ([e29ed8c](https://github.com/runeya/runeya/commit/e29ed8c50536109b0a05ec24d212b03a0f0b7922))
* sync yarn.lock ([a1debd2](https://github.com/runeya/runeya/commit/a1debd247fc9b8f1e8eac8049949415b6d02fd2e))

## [1.17.15](https://github.com/runeya/runeya/compare/v1.17.14...v1.17.15) (2024-02-07)

### Bug Fixes

* **logs:** fix json load on ui ([bae5dd8](https://github.com/runeya/runeya/commit/bae5dd829faf72d59215a3a9941155af6413a3eb))

## [1.17.14](https://github.com/runeya/runeya/compare/v1.17.13...v1.17.14) (2024-02-05)

### Bug Fixes

* **front:** can edit markdown and migrate away from vue markdown ([ef11ae3](https://github.com/runeya/runeya/commit/ef11ae39ee563ee6af4b2bc6f916f4c4705287dd))
* **front:** fix drag n drop ([39f5d4b](https://github.com/runeya/runeya/commit/39f5d4b2c9d69500402a8cf76e373836c5e9b596))

## [1.17.13](https://github.com/runeya/runeya/compare/v1.17.12...v1.17.13) (2024-02-05)

### Bug Fixes

* **openai:** dont initialize openai if no apikey is configured ([0746e78](https://github.com/runeya/runeya/commit/0746e786fc54ae832b09ba5b99a33dc1d741da6f))

## [1.17.12](https://github.com/runeya/runeya/compare/v1.17.11...v1.17.12) (2024-02-04)

**Note:** Version bump only for package @runeya/runeya

## [1.17.11](https://github.com/runeya/runeya/compare/v1.17.10...v1.17.11) (2024-02-04)

### Bug Fixes

* link modules between them ([a9a087c](https://github.com/runeya/runeya/commit/a9a087c7cd00ba09bdf075e476d6ea669a86dc06))

## [1.17.10](https://github.com/runeya/runeya/compare/v1.17.9...v1.17.10) (2024-02-04)

**Note:** Version bump only for package @runeya/runeya

## [1.17.9](https://github.com/runeya/runeya/compare/v1.17.8...v1.17.9) (2024-02-04)

**Note:** Version bump only for package @runeya/runeya

## [1.17.8](https://github.com/runeya/runeya/compare/v1.17.7...v1.17.8) (2024-02-04)

**Note:** Version bump only for package @runeya/runeya

## [1.17.7](https://github.com/runeya/runeya/compare/v1.17.6...v1.17.7) (2024-02-04)

**Note:** Version bump only for package @runeya/runeya

## [1.17.6](https://github.com/runeya/runeya/compare/v1.17.5...v1.17.6) (2024-02-04)

**Note:** Version bump only for package @runeya/runeya

## [1.17.5](https://github.com/runeya/runeya/compare/v1.17.4...v1.17.5) (2024-02-04)

**Note:** Version bump only for package @runeya/runeya

## [1.17.4](https://github.com/runeya/runeya/compare/v1.17.3...v1.17.4) (2024-02-04)

**Note:** Version bump only for package @runeya/runeya

## [1.17.3](https://github.com/runeya/runeya/compare/v1.11.23...v1.17.3) (2024-02-04)

**Note:** Version bump only for package @runeya/runeya
</file>

<file path="lerna.json">
{
  "useWorkspaces": true,
  "npmClient": "yarn",
  "version": "2.1.4",
  "commands": {
    "version": {
      "ignore": [
        "**/*.md",
        "**/*.json",
        "./*.json"
      ],
      "ignore-changes": [
        "**/*.md",
        "**/*.json",
        "./*.json"
      ]
    },
    "changed": {
      "ignore": [
        "**/*.md",
        "**/*.json",
        "./*.json"
      ],
      "ignore-changes": [
        "**/CHANGELOG.md",
        "**/package.json",
        "**/*lerna.json",
        "package.json",
        "yarn.lock"
      ]
    },
    "diff": {
      "ignore": [
        "**/*.md",
        "**/*.json",
        "./*.json"
      ],
      "ignore-changes": [
        "**/*.md",
        "**/*.json",
        "./*.json"
      ]
    }
  }
}
</file>

<file path="servers/server/package.json">
{
  "name": "@runeya/servers-server",
  "version": "2.1.4",
  "private": true,
  "description": "Monitor processes as a stack",
  "git": "https://github.com/runeya/runeya",
  "repository": "https://github.com/runeya/runeya",
  "publishConfig": {
    "access": "public",
    "registry": "https://registry.npmjs.org",
    "scope": "@iryu54"
  },
  "author": {
    "name": "runeya",
    "email": "corentinlabroche@gmail.com",
    "url": "https://corentinlabroche.fr/"
  },
  "scripts": {
    "start": "cross-env-shell node bin/www $RUNEYA_ROOT_PATH \"$SERVICE\"",
    "serve": "nodemon -e js,ts,jsx,tsx,vue,swagger.yml,swagger.yaml -x \"node ../../watch.js npm run start\"",
    "build": "tsup",
    "test": ""
  },
  "main": "bin/server.js",
  "typings": "./typings/export.d.ts",
  "types": "./typings/export.d.ts",
  "dependencies": {
    "@babel/preset-env": "^7.26.0",
    "@runeya/common-express": "workspace:*",
    "@runeya/common-socket-server": "workspace:*",
    "@runeya/modules-plugins-loader-backend": "workspace:*",
    "@octokit/core": "^6.1.2",
    "@octokit/plugin-rest-endpoint-methods": "^13.2.6",
    "alasql": "^4.6.2",
    "ansi-to-html": "^0.7.2",
    "axios": "^1.7.9",
    "bluebird": "^3.7.2",
    "command-exists": "^1.2.9",
    "dayjs": "^1.11.10",
    "debounce": "^2.0.0",
    "dot-object": "^2.1.4",
    "dotenv": "^16.4.2",
    "express": "^4.18.2",
    "express-async-errors": "^3.1.1",
    "express-http-proxy": "^2.1.1",
    "fast-sort": "^3.4.0",
    "fdir": "^6.4.2",
    "kill-port": "^2.0.1",
    "libsodium-wrappers": "^0.7.15",
    "lodash": "^4.17.21",
    "open": "^8",
    "os-utils": "0.0.14",
    "pidusage-tree": "^2.0.5",
    "slugify": "^1.6.6",
    "tree-kill": "^1.2.2",
    "uuid": "^9.0.1",
    "yargs": "^17.7.2"
  },
  "devDependencies": {
    "@babel/preset-typescript": "^7.26.0",
    "@runeya/common-retrigger-all-build": "workspace:*",
    "@runeya/modules-plugins-loader-front": "workspace:*",
    "@runeya/modules-vscode-extension": "workspace:*",
    "@types/babel__preset-env": "^7",
    "@types/http-proxy": "^1",
    "@types/libsodium-wrappers": "^0",
    "http-proxy": "^1.18.1",
    "nodemon": "^3.0.3",
    "supertest": "^6.3.4",
    "tsup": "^8.3.5",
    "xlsx": "^0.18.5"
  },
  "bin": "bin/www",
  "keywords": [
    "runeya",
    "stack",
    "microservices",
    "git",
    "github",
    "bitbucket",
    "npm",
    "process",
    "command",
    "cli",
    "monitor",
    "monitoring"
  ],
  "license": "MIT",
  "packageManager": "yarn@4.0.2"
}
</file>

</files>
