import{u as U,S as v,n as w,s as F,P as H,M as N,a as K}from"./router-dRrCuWpc.js";import P from"./system-lKZWhhFR.js";import{_ as x}from"./_plugin-vue_export-helper-x3n3nnut.js";import{c as W,o as a,a as s,b as j,p as R,d as V,e as f,f as B,r as b,w as G,F as k,g as S,h as p,i as m,j as g,k as L,T as Y}from"./runtime-core.esm-bundler-MKLD6zL_.js";import{t as _,n as M,r as y,a as z}from"./reactivity.esm-bundler-LrxtCAaW.js";import{v as q,w as J,T as Q}from"./vue.runtime.esm-bundler-9Vkzbhtf.js";import{S as T}from"./index-sqC47xDA.js";import{a as X}from"./axios-_p75_7XV.js";import"./vue3-markdown-it.umd.min-7JKSWcHD.js";const Z=t=>(R("data-v-a64536a2"),t=t(),V(),t),$=Z(()=>f("i",{class:"fas fa-chevron-right","aria-hidden":"true"},null,-1)),ee={__name:"sidebarItem",props:{service:{default:null}},setup(t){const i=U(),e=t,n=W(()=>{var c;const l=i.currentRoute.value.fullPath.split("?")[0].split("/").filter(u=>u).pop();return(c=e.service)!=null&&c.label?encodeURIComponent(e.service.label)===l:!1});return(o,l)=>(a(),s("div",{onClick:l[0]||(l[0]=c=>o.$router.push({name:"stack-single",params:{label:t.service.label}})),class:M(["sidebar-item",{active:n.value,disabled:!t.service.enabled,crashed:t.service.crashed}])},[j(_(t.service.label)+" ",1),$],2))}},te=x(ee,[["__scopeId","data-v-a64536a2"]]),ne={components:{sidebarItem:te},props:{currentService:{default:null}},setup(){const t=U(),i=y("");B(async()=>{await v.loadServices(),T.socket.on("service:crash",async({label:n,code:o,signal:l})=>{w.next("error",`${n} has crashed with code ${o}`),await v.loadServices()}),T.socket.on("service:healthcheck:down",async({label:n,code:o,signal:l})=>{const c=await v.getService(n);c!=null&&c.crashed||await v.loadServices()}),T.socket.on("service:healthcheck:up",async({label:n,code:o,signal:l})=>{const c=await v.getService(n);c!=null&&c.crashed&&await v.loadServices()})});const e=W(()=>F(v.services.value.filter(n=>(n.label||"").toUpperCase().includes(i.value.toUpperCase()))).desc(n=>n.enabled));return{search:i,sortedStack:e,System:P,launchService(n){const o=e.value[0];n.ctrlKey&&o&&(o==null||o.restart(),t.push({name:"stack-single",params:{label:o.label}}))}}}},oe={class:"sidebar"};function ae(t,i,e,n,o,l){const c=b("sidebar-item");return a(),s("div",oe,[f("ul",null,[G(f("input",{type:"text","onUpdate:modelValue":i[0]||(i[0]=u=>n.search=u),placeholder:"Search service...",onKeypress:i[1]||(i[1]=J((...u)=>n.launchService&&n.launchService(...u),["enter"]))},null,544),[[q,n.search]]),n.sortedStack.length?(a(!0),s(k,{key:0},S(n.sortedStack,u=>(a(),p(c,{key:u.label,service:u},null,8,["service"]))),128)):m("",!0)])])}const ie=x(ne,[["render",ae],["__scopeId","data-v-66aeb35d"]]);function se(t={}){let i;if(t.repoUrl)i=t.repoUrl;else if(t.user&&t.repo)i=`https://github.com/${t.user}/${t.repo}`;else throw new Error("You need to specify either the `repoUrl` option or both the `user` and `repo` options");const e=new URL(`${i}/issues/new`),n=["body","title","labels","template","milestone","assignee","projects"];for(const o of n){let l=t[o];if(l!==void 0){if(o==="labels"||o==="projects"){if(!Array.isArray(l))throw new TypeError(`The \`${o}\` option should be an array`);l=l.join(",")}e.searchParams.set(o,l)}}return e.toString()}const le=se({user:"clabroche",repo:"stack-monitor",body:`
## Issue

### Plateform
\`\`\`<Windows10, Archlinux, MacOS...>\`\`\`

### Configuration file
\`\`\` javascript
<upload your configuration file but without sensitive infos>
\`\`\`

### Description
\\<Which part of this application bug...>


### Reproduction 
\\<Step to bug...>

        `}),re=t=>(R("data-v-bcf19f88"),t=t(),V(),t),ce={key:0},de={key:1},ue=re(()=>f("i",{class:"fas fa-chevron-right","aria-hidden":"true"},null,-1)),fe=[ue],he={class:"messages"},ve={key:0,class:"badge"},me={key:2,class:"badge"},_e={__name:"Notification",props:{width:{default:"420px"},notif:{default:null},nolimit:{default:!1}},setup(t){return(i,e)=>{var n,o,l,c,u,r,d;return t.notif?(a(),s("div",{key:0,class:M([t.notif.type,"notif"]),style:z({maxWidth:t.width})},[t.notif.hover?t.notif.serviceLabel?(a(),s("h2",de,fe)):m("",!0):(a(),s(k,{key:0},[t.notif.serviceLabel?(a(),s("h2",ce,_(t.notif.serviceLabel),1)):m("",!0)],64)),f("div",he,[(a(!0),s(k,null,S((n=t.notif)==null?void 0:n.msgs,h=>{var I,C;return a(),s("div",{class:M(["message",{glow:((C=(I=t.notif)==null?void 0:I.msgs)==null?void 0:C.length)>1,oneline:!t.nolimit}]),key:h.label},[j(_(h.label)+" ",1),t.notif.msgs.length>1&&(h==null?void 0:h.nb)>1?(a(),s("label",ve,_(h==null?void 0:h.nb),1)):m("",!0)],2)}),128))]),((l=(o=t.notif)==null?void 0:o.msgs)==null?void 0:l.length)===1&&((u=(c=t.notif)==null?void 0:c.msgs[0])==null?void 0:u.nb)>1?(a(),s("label",me,_((d=(r=t.notif)==null?void 0:r.msgs[0])==null?void 0:d.nb),1)):m("",!0)],6)):m("",!0)}}},O=x(_e,[["__scopeId","data-v-bcf19f88"]]),be={components:{Notification:O},setup(){const t=(i,e)=>w.remove(i,e);return{notifs:w.notifs,remove:t,trash(){H.map(w.notifs.value||[],async i=>{await new Promise(e=>setTimeout(e,50)),w.notifs.value.map(e=>t(e,!1))})}}}},ke=t=>(R("data-v-63c94c4d"),t=t(),V(),t),ye={class:"notifications-container"},ge=ke(()=>f("i",{class:"fas fa-trash"},null,-1)),we=[ge];function Se(t,i,e,n,o,l){var u;const c=b("notification");return a(),s("div",ye,[(u=n.notifs)!=null&&u.length?(a(),s("div",{key:0,class:"trash",onClick:i[0]||(i[0]=(...r)=>n.trash&&n.trash(...r))},we)):m("",!0),g(Q,{tag:"div",class:"root-notification",name:"slide"},{default:L(()=>[(a(!0),s(k,null,S(n.notifs,r=>(a(),p(c,{key:r.id,notif:r,onClick:d=>n.remove(r,!0),onMouseenter:d=>r.hover=!0,onMouseleave:d=>r.hover=!1},null,8,["notif","onClick","onMouseenter","onMouseleave"]))),128))]),_:1})])}const xe=x(be,[["render",Se],["__scopeId","data-v-63c94c4d"]]);T.socket.on("alert",t=>{w.next(t.type||"error",t.message,t.label)});const Ce={components:{Modal:N,Notification:O},setup(){const t=y(null);return B(()=>{w.openHistory.subscribe(()=>{var e;(e=t.value)==null||e.open()})}),{notifs:y(w.notifsHistory.value),remove(e){w.removeHistory(e,!0)},modal:t}}},je={class:"notif-history-root"},Te={class:"notifications"};function pe(t,i,e,n,o,l){const c=b("notification"),u=b("modal");return a(),s("div",je,[g(u,{position:"right",ref:"modal",width:"600px",noActions:!0},{header:L(()=>[j(" Mes notifications ")]),body:L(()=>[f("div",Te,[(a(!0),s(k,null,S(n.notifs,r=>(a(),p(c,{key:r.id,width:"100%",notif:r,onClick:d=>n.remove(r),nolimit:!0},null,8,["notif","onClick"]))),128))])]),_:1},512)])}const Ie=x(Ce,[["render",pe],["__scopeId","data-v-1abc4de5"]]),We=["title"],Be={__name:"SidebarViewModeItem",props:{button:{default:null}},setup(t){const i=U(),e=t,n=W(()=>i.currentRoute.value.fullPath.includes(e.button.active));return(o,l)=>(a(),s("button",{onClick:l[0]||(l[0]=c=>t.button.click()),class:M([{active:n.value},"sidebar-item"]),title:t.button.text},[f("i",{class:M({[t.button.icon]:!0}),"aria-hidden":"true"},null,2)],10,We))}},Me=x(Be,[["__scopeId","data-v-ae54c87d"]]),Ee={name:"doughtnut-chart",props:{value:{default:0},rayon:{default:150},strokeWidth:{default:25},strokeWidthBg:{default:10},strokeColorBg:{default:"#b8d3ca"},strokeColor:{default:"#5e9985"},padding:{default:50},title:{default:""},adjustTop:{default:0},adjustLeft:{default:0},adjustTitleTop:{default:0},adjustTitleLeft:{default:0},adjustSubtitleTop:{default:0},adjustSubtitleLeft:{default:0},adjustContainer:{default:0},subtitle:{default:""},width:{default:"auto"},textAlign:{default:"left"},noSubtitle:{default:!1},fontSize:{default:30},titleSuffix:{default:""},color:{default:"#606060"},placeholder:{default:""}},data(){return{anim:1}},mounted(){this.animation()},methods:{animation(){this.anim=this.anim?1:2}}},Le=["title"],Ue=["width","height"],Pe=["stroke","stroke-width","cx","cy","r"],Re=["stroke","stroke-width","cx","cy","r","stroke-dasharray","stroke-dashoffset"],Ve=["x","y","fill","font-size"],ze=["x","y","fill","font-size"],Ae=["x","y","fill"];function Ne(t,i,e,n,o,l){return e.value!==null?(a(),s("div",{key:0,style:z({width:e.width,textAlign:e.textAlign,marginLeft:e.adjustLeft,marginTop:e.adjustTop}),class:"root",title:e.placeholder},[f("section",null,[(a(),s("svg",{width:e.rayon*2+e.strokeWidth+e.padding+e.adjustContainer,height:e.rayon*2+e.strokeWidth+e.padding+e.adjustContainer,xmlns:"http://www.w3.org/2000/svg"},[f("circle",{stroke:e.strokeColorBg,"stroke-width":e.strokeWidthBg,fill:"none",cx:e.rayon+e.strokeWidth/2+e.padding/2+e.adjustContainer/2,cy:e.rayon+e.strokeWidth/2+e.padding/2+e.adjustContainer/2,r:e.rayon},null,8,Pe),f("circle",{class:"circle",stroke:e.strokeColor,"stroke-width":e.strokeWidth,fill:"none",cx:e.rayon+e.strokeWidth/2+e.padding/2+e.adjustContainer/2,cy:e.rayon+e.strokeWidth/2+e.padding/2+e.adjustContainer/2,r:e.rayon,"stroke-dasharray":2*3.14*e.rayon,"stroke-dashoffset":2*3.14*e.rayon*(1-e.value/100)},null,8,Re),e.noSubtitle?m("",!0):(a(),s("g",{key:0,class:M("info info-anim-"+o.anim)},[f("text",{class:"text",x:17+e.adjustSubtitleLeft,y:e.rayon+13+e.padding/2+e.adjustSubtitleTop,width:"60","dominant-baseline":"central","alignment-baseline":"central","text-anchor":"left",fill:e.strokeColorBg,"font-size":e.fontSize},_(e.value.toFixed(0))+"% ",9,Ve)],2)),f("text",{class:"additionnalText",x:e.rayon+e.padding-10+e.adjustTitleLeft+e.adjustContainer/2,y:e.rayon+e.padding-25+e.adjustTitleTop+e.adjustContainer/2,width:"60","dominant-baseline":"central","alignment-baseline":"central","text-anchor":"middle",fill:e.color,"font-size":e.fontSize},_(e.title)+" "+_(e.titleSuffix),9,ze),f("text",{class:"additionnalSubText",x:e.rayon+e.padding-10+e.adjustTitleLeft,y:e.rayon+10+e.padding+e.adjustTitleTop,width:"60","dominant-baseline":"central","alignment-baseline":"central","text-anchor":"middle",fill:e.color,"font-size":"15"},_(e.subtitle),9,Ae)],8,Ue))])],12,Le)):m("",!0)}const Oe=x(Ee,[["render",Ne],["__scopeId","data-v-f9e89767"]]),De={components:{SidebarViewModeItem:Me,DoughtnutChart:Oe},props:{currentService:{default:null}},setup(){const t=U(),i=y([]),e=y(0),n=y(0);return B(async()=>{await v.loadServices();const{data:o}=await X.get("/plugins/sidebar");i.value=(o==null?void 0:o.flat())||[],T.socket.on("infos:global",l=>{const{memPercentage:c,cpu:u}=l;e.value=u,n.value=c})}),{buttons:W(()=>[{text:"Single View",active:"single",icon:"fas fa-columns",click:()=>{var o;return t.push({name:"stack-single",params:{label:(o=v.services.value[0])==null?void 0:o.label}})}},{text:"Multiple view",active:"multiple",icon:"fas fa-th",click:()=>t.push({name:"stack-multiple"})}]),buttonsPlugins:W(()=>[...i.value.map(o=>o.placements.map(l=>{if(typeof l!="string")return{text:l.label,icon:l.icon,click:l.goTo?()=>t.push(l.goTo||"/"):()=>{},active:l.active}})).flat().filter(o=>o)]),buttonsBottom:W(()=>[{text:"Disconnect",icon:"fas fa-unlink",click:()=>P.disconnect()}]),cpu:e,mem:n,System:P}}},Fe={class:"sidebar"},He={key:0},Ke={key:1};function Ge(t,i,e,n,o,l){const c=b("sidebar-view-mode-item"),u=b("doughtnut-chart");return a(),s("div",Fe,[n.buttons.length?(a(),s("ul",He,[(a(!0),s(k,null,S(n.buttons,r=>(a(),p(c,{key:r.label,button:r},null,8,["button"]))),128))])):m("",!0),n.buttonsBottom.length?(a(),s("ul",Ke,[(a(!0),s(k,null,S(n.buttonsPlugins,r=>(a(),p(c,{key:r.label,button:r},null,8,["button"]))),128)),g(u,{placeholder:"CPU",width:"10px",rayon:17,fontSize:"11",value:n.cpu*100,strokeWidth:3,strokeWidthBg:5,adjustSubtitleLeft:-2,adjustTitleTop:-5,adjustSubtitleTop:-11,padding:14,strokeColor:"#e900ff",strokeColorBg:"#761e7e"},null,8,["value"]),g(u,{placeholder:"RAM",width:"10px",rayon:17,value:n.mem,fontSize:"11",strokeWidth:3,strokeWidthBg:5,adjustSubtitleTop:-11,adjustSubtitleLeft:-2,adjustTitleTop:-5,padding:14,strokeColor:"#00f7ff",strokeColorBg:"#2db7d0"},null,8,["value"]),(a(!0),s(k,null,S(n.buttonsBottom,r=>(a(),p(c,{key:r.label,button:r},null,8,["button"]))),128))])):m("",!0)])}const Ye=x(De,[["render",Ge],["__scopeId","data-v-b4994ded"]]),qe=["value"],Je=["value"],Qe={class:"reload-modal"},Xe={__name:"EnvironmentsChooser",setup(t){const i=y(null),e=y({}),n=y(!1),o=y("");B(async()=>{i.value=await v.getEnvironment(),e.value=await v.getEnvironments()});function l(){var u;return(u=v.services.value)==null?void 0:u.filter(r=>r.enabled).reduce((r,d)=>{var C,E;const h=Object.keys(((C=d==null?void 0:d.spawnOptions)==null?void 0:C.overrideEnvs)||{});return Object.keys(((E=d==null?void 0:d.spawnOptions)==null?void 0:E.env)||{}).some(D=>h.includes(D))&&r.push(d),r},[])}async function c(u,r){const d=l();if(d!=null&&d.length&&!await o.value.open(d).promise){r.target.value=i.value.id;return}n.value=!0,await v.changeEnvironment(u).then(()=>{window.location.reload()}).catch(h=>{console.error(h),w.next("error","Problem has occured")}).finally(()=>{n.value=!1})}return(u,r)=>(a(),s(k,null,[i.value?(a(),s("div",{key:0,class:"banner",style:z({backgroundColor:i.value.bgColor||"transparent",color:i.value.color||"transparent"})},[f("div",null,_(i.value.label),1),f("div",null,[f("select",{value:i.value.id,onInput:r[0]||(r[0]=d=>c(d.target.value,d))},[(a(!0),s(k,null,S(e.value,(d,h)=>(a(),s("option",{value:h,key:h},_(d==null?void 0:d.label),9,Je))),128))],40,qe)])],4)):m("",!0),n.value?(a(),p(Y,{key:1,to:"body"},[f("div",Qe,[g(K),j(" Change environments... ")])])):m("",!0),g(N,{ref_key:"overrideModalRef",ref:o,cancelString:"Cancel",validateString:"Ok"},{header:L(({data:d})=>[j(" Change environment ")]),body:L(({data:d})=>[j(" Because .env in services root folder is the main truth. Some environments may not be taken into account. "),f("ul",null,[(a(!0),s(k,null,S(d,h=>(a(),s("li",{key:h.id},[j(_(h.label)+" ",1),f("ul",null,[(a(!0),s(k,null,S(h.spawnOptions.overrideEnvs,(I,C)=>(a(),s("li",null,_(C)+": "+_(I),1))),256))])]))),128))])]),_:1},512)],64))}},Ze=x(Xe,[["__scopeId","data-v-d5605dac"]]),$e={components:{sidebar:ie,Notifications:xe,NotifHistory:Ie,SidebarViewMode:Ye,EnvironmentsChooser:Ze},setup(){const t=U(),i=y(!0),e=async()=>{i.value=T.socket.connected,i.value||(v.services.value=[]);const o=await v.getEnabledServices();(t.currentRoute.value.fullPath.startsWith("/stack-single")||t.currentRoute.value.fullPath.startsWith("/stack-multiple"))&&(i.value&&!v.services.value.length?t.push({name:"import-create"}):!o.length&&t.currentRoute.value.name!=="stack-chooser"&&t.push({name:"stack-chooser"}))};B(async()=>{T.socket.on("connect",e),T.socket.on("disconnect",e),T.socket.on("forceReload",()=>{window.location.reload()}),await e()});let n=y({local:"",remote:"",hasUpdate:!1});return B(async()=>{var o;n.value=await P.hasUpdate(),(o=n.value)!=null&&o.hasUpdate&&w.next("error",`Update available: ${n.value.local} => ${n.value.remote}`)}),{redirect:e,connected:i,githubIssue:le,versions:n}}},A=t=>(R("data-v-b22dcb55"),t=t(),V(),t),et={key:0,id:"app-container"},tt={id:"app"},nt={class:"main"},ot={key:1,class:"not-connected"},at=A(()=>f("br",null,null,-1)),it=A(()=>f("br",null,null,-1)),st=A(()=>f("br",null,null,-1)),lt=["href"];function rt(t,i,e,n,o,l){var E;const c=b("sidebar-view-mode"),u=b("sidebar"),r=b("router-view"),d=b("EnvironmentsChooser"),h=b("Finder"),I=b("notif-history"),C=b("notifications");return a(),s(k,null,[n.connected?(a(),s("div",et,[f("div",tt,[["stack-chooser","import-create"].includes(((E=t.$route.name)==null?void 0:E.toString())||"")?m("",!0):(a(),p(c,{key:0})),t.$route.name==="stack-single"?(a(),p(u,{key:1})):m("",!0),f("div",nt,[g(r)])]),g(d)])):(a(),s("div",ot,[j(" Server is not connected or has crashed "),at,j(" Try to restart it or fill an issue: "),it,st,f("a",{href:n.githubIssue,target:"_blank"},"Click here",8,lt)])),g(h),g(I),g(C)],64)}const kt=x($e,[["render",rt],["__scopeId","data-v-b22dcb55"]]);export{kt as default};
